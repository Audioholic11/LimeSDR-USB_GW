\subsection{D\+D\+R2\+\_\+ctrl\+\_\+top\+\_\+tb.\+vhd}
\label{DDR2__ctrl__top__tb_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/wfm\+\_\+ram\+\_\+buffer/\+D\+D\+R2\+\_\+ctrl\+\_\+top\+\_\+tb.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/wfm\+\_\+ram\+\_\+buffer/\+D\+D\+R2\+\_\+ctrl\+\_\+top\+\_\+tb.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    file\_name\_tb.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: }
00004 \textcolor{keyword}{-- DATE:    Feb 13, 2014}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }DDR2_ctrl_top_tb \textcolor{keywordflow}{is}
00016 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{DDR2\_ctrl\_top\_tb};
00017 
00018 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00019 \textcolor{keyword}{-- Architecture}
00020 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00021 
00022 \textcolor{keywordflow}{architecture} tb\_behave \textcolor{keywordflow}{of} DDR2_ctrl_top_tb is
00023     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{clk0_period}    \textcolor{vhdlchar}{:} \textcolor{comment}{time} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}.\textcolor{vhdllogic}{66} \textcolor{vhdlchar}{ns};
00024     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{clk1_period}    \textcolor{vhdlchar}{:} \textcolor{comment}{time} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10} \textcolor{vhdlchar}{ns}; 
00025 \textcolor{keyword}{  --signals}
00026     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{clk0}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{clk1}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00027     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{reset_n}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00028     
00029     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_clk}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00030     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_rdy}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00031     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_addr}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{24} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00032     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_wr}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00033     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_data}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00034     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rcmd_clk}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00035     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rcmd_rdy}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00036     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rcmd_addr}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{24} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00037     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rcmd_wr}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00038     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wcmd_brst_en}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00039     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rcmd_brst_en}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00040 
00041     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{local_ready}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00042     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{local_rdata}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00043     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{local_rdata_valid}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00044     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{local_init_done}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00045 
00046     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wr_addr}              \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{24} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00047     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wr_data}              \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00048 
00049     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_wr}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00050     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_wr_cnt}           \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00051 
00052 
00053     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_payload_valid}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00054     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_payload_data}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00055 
00056    \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_fifo_rdreq}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00057     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_fifo_rdempty}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00058     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_fifo_rdusedw}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00059 
00060 
00061  
00062 \textcolor{vhdlkeyword}{begin }
00063   
00064     clock0: \textcolor{keywordflow}{process} \textcolor{keywordflow}{is}
00065 \textcolor{vhdlkeyword}{    begin}
00066         \textcolor{vhdlchar}{clk0} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait} \textcolor{keywordflow}{for} \textcolor{vhdlchar}{clk0_period}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00067         \textcolor{vhdlchar}{clk0} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait} \textcolor{keywordflow}{for} \textcolor{vhdlchar}{clk0_period}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00068     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{clock0};
00069 
00070     clock: \textcolor{keywordflow}{process} \textcolor{keywordflow}{is}
00071 \textcolor{vhdlkeyword}{    begin}
00072         \textcolor{vhdlchar}{clk1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait} \textcolor{keywordflow}{for} \textcolor{vhdlchar}{clk1_period}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00073         \textcolor{vhdlchar}{clk1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait} \textcolor{keywordflow}{for} \textcolor{vhdlchar}{clk1_period}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00074     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{clock};
00075     
00076         res: \textcolor{keywordflow}{process} \textcolor{keywordflow}{is}
00077 \textcolor{vhdlkeyword}{    begin}
00078         \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait} \textcolor{keywordflow}{for} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20} \textcolor{vhdlchar}{ns};
00079         \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}; \textcolor{keywordflow}{wait};
00080     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{res};
00081     
00082   DDR2\_ctrl\_top\_inst : \textcolor{keywordflow}{entity} work.DDR2_ctrl_top 
00083 \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (
00084             cntrl_rate          => \textcolor{vhdllogic}{1},\textcolor{keyword}{ --1 - full rate, 2 - half rate}
00085             cntrl_bus_size      => \textcolor{vhdllogic}{16},
00086             addr_size           => \textcolor{vhdllogic}{25},
00087             lcl_bus_size        => \textcolor{vhdllogic}{63},
00088             lcl_burst_length    => \textcolor{vhdllogic}{2},
00089             cmd_fifo_size       => \textcolor{vhdllogic}{9}
00090 \textcolor{vhdlchar}{)}
00091 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00092       pll_ref_clk       => clk0,
00093       global_reset_n    => reset_n,
00094         soft_reset_n        => reset_n,
00095 
00096         wcmd_clk                => wcmd_clk,
00097         wcmd_rdy                => wcmd_rdy,
00098         wcmd_addr           => wcmd_addr,
00099         wcmd_wr             => wcmd_wr,
00100         wcmd_brst_en        => wcmd_brst_en, 
00101         wcmd_data           => wcmd_data,
00102         rcmd_rdy                => rcmd_rdy,
00103         rcmd_clk                => rcmd_clk,
00104         rcmd_addr           => rcmd_addr,
00105         rcmd_wr             => rcmd_wr,
00106         rcmd_brst_en        => rcmd_brst_en,
00107 
00108         local_ready         => local_ready,
00109         local_rdata         => local_rdata,
00110         local_rdata_valid   => local_rdata_valid,
00111         local_init_done => local_init_done,
00112 
00113         mem_odt             => \textcolor{keywordflow}{open},
00114         mem_cs_n                => \textcolor{keywordflow}{open},
00115         mem_cke             => \textcolor{keywordflow}{open},
00116         mem_addr                => \textcolor{keywordflow}{open},
00117         mem_ba              => \textcolor{keywordflow}{open},
00118         mem_ras_n           => \textcolor{keywordflow}{open},
00119         mem_cas_n           => \textcolor{keywordflow}{open},
00120         mem_we_n                => \textcolor{keywordflow}{open},
00121         mem_dm              => \textcolor{keywordflow}{open},
00122         phy_clk             => \textcolor{keywordflow}{open},
00123 \textcolor{keyword}{        --aux\_full\_rate\_clk : out std\_logic;}
00124 \textcolor{keyword}{        --aux\_half\_rate\_clk : out std\_logic;}
00125 \textcolor{keyword}{        --reset\_request\_n   : out std\_logic;}
00126         mem_clk             => \textcolor{keywordflow}{open},
00127         mem_clk_n           => \textcolor{keywordflow}{open},
00128         mem_dq              => \textcolor{keywordflow}{open},
00129         mem_dqs             => \textcolor{keywordflow}{open}
00130     
00131     \textcolor{vhdlchar}{)};
00132 
00133 
00134 
00135 
00136 
00137 
00138 \textcolor{keywordflow}{process} (reset_n, clk0) 
00139 \textcolor{vhdlkeyword}{    begin }
00140         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00141             \textcolor{vhdlchar}{pct_wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00142         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk0}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk0}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00143             \textcolor{vhdlchar}{pct_wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{pct_wr_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00144         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00145 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00146 
00147 \textcolor{vhdlchar}{pct_wr}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{pct_wr_cnt}\textcolor{vhdlchar}{<}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00148 
00149 payload\_extract\_inst : \textcolor{keywordflow}{entity} work.pct_payload_extrct 
00150     \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (data_w         => \textcolor{vhdllogic}{32},
00151                     header_size     => \textcolor{vhdllogic}{16},\textcolor{keyword}{  --pct header size in bytes }
00152                     pct_size            => \textcolor{vhdllogic}{4096} \textcolor{keyword}{--pct size in bytes}
00153         \textcolor{vhdlchar}{)}
00154   \textcolor{keywordflow}{port} \textcolor{keywordflow}{map} (
00155 \textcolor{keyword}{      --input ports }
00156         clk                     => clk0,
00157         reset_n                 => reset_n,
00158         pct_wr                  => pct_wr,
00159         pct_data                    => x"00000008",
00160         pct_payload_valid       => pct_payload_valid,
00161         pct_payload_data        => pct_payload_data,
00162         pct_payload_dest        => \textcolor{keywordflow}{open}
00163         \textcolor{vhdlchar}{)};
00164 
00165 
00166 data\_fifo   : \textcolor{keywordflow}{entity} work.fifo_inst 
00167 \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (
00168             dev_family          => \textcolor{keyword}{"Cyclone IV E"}  ,
00169             wrwidth             => \textcolor{vhdllogic}{32},
00170             wrusedw_witdth      => \textcolor{vhdllogic}{9},\textcolor{keyword}{ --9=256 words }
00171             rdwidth             => \textcolor{vhdllogic}{32},
00172             rdusedw_width       => \textcolor{vhdllogic}{9},
00173             show_ahead          => \textcolor{keyword}{"ON"}
00174 \textcolor{vhdlchar}{)}
00175 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map} (
00176       reset_n       => reset_n, 
00177       wrclk         => clk0, 
00178       wrreq         => pct_payload_valid, 
00179       data          => pct_payload_data, 
00180       wrfull        => \textcolor{keywordflow}{open}, 
00181         wrempty       => \textcolor{keywordflow}{open}, 
00182       wrusedw       => \textcolor{keywordflow}{open}, 
00183       rdclk          => clk0, 
00184       rdreq         => data_fifo_rdreq, 
00185       q             => \textcolor{keywordflow}{open}, 
00186       rdempty       => data_fifo_rdempty, 
00187       rdusedw       => data_fifo_rdusedw   
00188 \textcolor{vhdlchar}{)};
00189 
00190 \textcolor{vhdlchar}{data_fifo_rdreq}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{when} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{data_fifo_rdusedw}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{>=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00191 
00192 
00193     \textcolor{keywordflow}{end} \textcolor{vhdlchar}{tb\_behave};
00194   
00195   
00196 
00197 
00198   
\end{DoxyCode}
