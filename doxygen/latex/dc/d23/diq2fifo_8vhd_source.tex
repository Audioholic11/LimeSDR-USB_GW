\subsection{diq2fifo.\+vhd}
\label{diq2fifo_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+path\+\_\+top/diq2fifo/synth/diq2fifo.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+path\+\_\+top/diq2fifo/synth/diq2fifo.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    diq2fifo.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION:   Writes DIQ data to FIFO, FIFO word size = 4  DIQ samples }
00004 \textcolor{keyword}{-- DATE: Jan 13, 2016}
00005 \textcolor{keyword}{-- AUTHOR(s): Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }diq2fifo \textcolor{keywordflow}{is}
00016    \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(} 
00017       \textcolor{vhdlchar}{dev_family}           \textcolor{vhdlchar}{:} \textcolor{comment}{string} \textcolor{vhdlchar}{:=} \textcolor{keyword}{"Cyclone IV E"};
00018       \textcolor{vhdlchar}{iq_width}             \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00019       \textcolor{vhdlchar}{invert_input_clocks}  \textcolor{vhdlchar}{:} \textcolor{comment}{string} \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ON"}
00020       \textcolor{vhdlchar}{)};
00021    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00022       \textcolor{vhdlchar}{clk}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00023       \textcolor{vhdlchar}{reset_n}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00024       \textcolor{vhdlchar}{test_ptrn_en}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00025 \textcolor{keyword}{      --Mode settings}
00026       \textcolor{vhdlchar}{mode}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- JESD207: 1; TRXIQ: 0}
00027       \textcolor{vhdlchar}{trxiqpulse}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- trxiqpulse on: 1; trxiqpulse off: 0}
00028       \textcolor{vhdlchar}{ddr_en}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- DDR: 1; SDR: 0}
00029       \textcolor{vhdlchar}{mimo_en}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- MIMO: 1; SISO: 0}
00030       \textcolor{vhdlchar}{ch_en}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"01" - Ch. A, "10" - Ch. B, "11" - Ch. A and Ch.
       B. }
00031       \textcolor{vhdlchar}{fidm}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- External Frame ID mode. Frame start at fsync = 0, when 0. Frame
       start at fsync = 1, when 1.}
00032 \textcolor{keyword}{      --Rx interface data }
00033       \textcolor{vhdlchar}{DIQ}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00034       \textcolor{vhdlchar}{fsync}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00035 \textcolor{keyword}{      --fifo ports }
00036       \textcolor{vhdlchar}{fifo_wfull}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00037       \textcolor{vhdlchar}{fifo_wrreq}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00038       \textcolor{vhdlchar}{fifo_wdata}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00039 \textcolor{keyword}{      --sample compare}
00040       \textcolor{vhdlchar}{smpl_cmp_start} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00041       \textcolor{vhdlchar}{smpl_cmp_length}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042       \textcolor{vhdlchar}{smpl_cmp_done}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00043       \textcolor{vhdlchar}{smpl_cmp_err}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}
00044 
00045         \textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{diq2fifo};
00047 
00048 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00049 \textcolor{keyword}{-- Architecture}
00050 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00051 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} diq2fifo is
00052 \textcolor{keyword}{--declare signals,  components here}
00053 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_diq_out_h}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00054 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_diq_out_l}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00055 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_reset_n}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00056 
00057 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_data_h}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00058 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_data_l}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00059 
00060 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst3_reset_n}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00061 
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux0_diq_h}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00063 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux0_diq_l}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00064 
00065 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux0_diq_h_reg}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00066 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux0_diq_l_reg}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00067   
00068 \textcolor{vhdlkeyword}{begin}
00069 
00070 inst0\_reset\_n <= reset\_n \textcolor{keywordflow}{when} smpl\_cmp\_start = '0' \textcolor{keywordflow}{else} '1';
00071 
00072 inst0\_lms7002\_ddin : \textcolor{keywordflow}{entity} work.lms7002_ddin
00073    \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}( 
00074       dev_family           => dev_family,
00075       iq_width             => iq_width,
00076       invert_input_clocks  => invert_input_clocks
00077    \textcolor{vhdlchar}{)}
00078    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map} (
00079       clk         => clk,
00080       reset_n     => inst0_reset_n, 
00081       rxiq        => DIQ, 
00082       rxiqsel     => fsync, 
00083       data_out_h  => inst0_diq_out_h, 
00084       data_out_l  => inst0_diq_out_l 
00085         \textcolor{vhdlchar}{)};
00086         
00087         
00088 inst1\_rxiq : \textcolor{keywordflow}{entity} work.rxiq
00089    \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}( 
00090       dev_family           => dev_family,
00091       iq_width             => iq_width
00092    \textcolor{vhdlchar}{)}
00093    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map} (
00094       clk         => clk,
00095       reset_n     => reset_n,
00096       trxiqpulse  => trxiqpulse,
00097       ddr_en      => ddr_en,
00098       mimo_en     => mimo_en,
00099       ch_en       => ch_en, 
00100       fidm        => fidm,
00101       DIQ_h       => mux0_diq_h_reg,
00102       DIQ_l       => mux0_diq_l_reg,
00103       fifo_wfull  => fifo_wfull,
00104       fifo_wrreq  => fifo_wrreq,
00105       fifo_wdata  => fifo_wdata
00106         \textcolor{vhdlchar}{)};
00107   
00108 int2\_test\_data\_dd : \textcolor{keywordflow}{entity} work.test_data_dd
00109 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00110 
00111    clk            => clk,
00112    reset_n        => reset_n,
00113    fr_start       => fidm,
00114    mimo_en        => mimo_en,  
00115    data_h         => inst2_data_h,
00116    data_l         => inst2_data_l
00117 
00118 \textcolor{vhdlchar}{)};
00119 
00120 
00121 \textcolor{vhdlchar}{mux0_diq_h} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst0_diq_out_h} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{test_ptrn_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{inst2_data_h};
00122 \textcolor{vhdlchar}{mux0_diq_l} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst0_diq_out_l} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{test_ptrn_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{inst2_data_l};    
00123 
00124 
00125 \textcolor{keywordflow}{process}(clk, reset_n)
00126 \textcolor{vhdlkeyword}{begin }
00127    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00128       \textcolor{vhdlchar}{mux0_diq_h_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00129       \textcolor{vhdlchar}{mux0_diq_l_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00130    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00131       \textcolor{vhdlchar}{mux0_diq_h_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mux0_diq_h};
00132       \textcolor{vhdlchar}{mux0_diq_l_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mux0_diq_l};
00133    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00134 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00135 
00136 
00137 inst3\_reset\_n <= smpl\_cmp\_start;
00138 
00139 inst3\_smpl\_cmp : \textcolor{keywordflow}{entity} work.smpl_cmp
00140    \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
00141       smpl_width  => iq_width
00142    \textcolor{vhdlchar}{)}
00143    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00144 
00145       clk         => clk,
00146       reset_n     => inst3_reset_n,
00147 \textcolor{keyword}{      --Mode settings}
00148       mode        => mode,
00149       trxiqpulse  => trxiqpulse,
00150       ddr_en      => ddr_en,
00151       mimo_en     => mimo_en,
00152       ch_en       => ch_en,
00153       fidm        => fidm,
00154 \textcolor{keyword}{      --control and status}
00155       cmp_start   => smpl_cmp_start,
00156       cmp_length  => smpl_cmp_length,
00157       cmp_AI      => x"AAA",
00158       cmp_AQ      => x"555",
00159       cmp_BI      => x"AAA",
00160       cmp_BQ      => x"555",
00161       cmp_done    => smpl_cmp_done,
00162       cmp_error   => smpl_cmp_err,
00163 \textcolor{keyword}{      --DIQ bus}
00164       diq_h       => inst0_diq_out_h,
00165       diq_l       => inst0_diq_out_l
00166       \textcolor{vhdlchar}{)};      
00167 
00168 
00169   
00170 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00171 
00172 
00173 
00174 
00175 
\end{DoxyCode}
