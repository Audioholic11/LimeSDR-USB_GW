\subsection{p2d\+\_\+wr\+\_\+fsm.\+vhd}
\label{p2d__wr__fsm_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/p2d\+\_\+wr\+\_\+fsm.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/p2d\+\_\+wr\+\_\+fsm.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    p2d\_wr\_fsm.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: For decoding packets.}
00004 \textcolor{keyword}{-- DATE:    March 31, 2017}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 
00009 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00010 \textcolor{keyword}{-- Notes:}
00011 \textcolor{keyword}{-- TODO: implement changeable in\_pct\_data\_w parameter,}
00012 \textcolor{keyword}{-- TODO: implement changeable pct\_size\_w parameter}
00013 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00014 
00015 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00016 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00017 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00018 \textcolor{vhdlkeyword}{use }ieee.math\_real.\textcolor{keywordflow}{all};
00019 \textcolor{vhdlkeyword}{use }ieee.math\_real.\textcolor{keywordflow}{all};
00020 
00021 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00022 \textcolor{keyword}{-- Entity declaration}
00023 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00024 \textcolor{keywordflow}{entity }p2d_wr_fsm \textcolor{keywordflow}{is}
00025    \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
00026       \textcolor{vhdlchar}{pct_size_w}        \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00027       \textcolor{vhdlchar}{n_buff}            \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{ -- 2,4 valid values}
00028       \textcolor{vhdlchar}{in_pct_data_w}     \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}
00029    \textcolor{vhdlchar}{)};
00030    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00031       \textcolor{vhdlchar}{clk}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00032       \textcolor{vhdlchar}{reset_n}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00033       \textcolor{vhdlchar}{pct_size}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{   --Whole packet size in }
00034 \textcolor{keyword}{                                                                        --in\_pct\_data\_w words}
00035       
00036       \textcolor{vhdlchar}{in_pct_wrreq}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00037       \textcolor{vhdlchar}{in_pct_data}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{in_pct_data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00038       \textcolor{vhdlchar}{in_pct_wrfull}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- not registered, comb signal }
00039       
00040       \textcolor{vhdlchar}{pct_hdr_0}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00041       \textcolor{vhdlchar}{pct_hdr_0_valid}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042       
00043       \textcolor{vhdlchar}{pct_hdr_1}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044       \textcolor{vhdlchar}{pct_hdr_1_valid}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00045       
00046       \textcolor{vhdlchar}{pct_data}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00047       \textcolor{vhdlchar}{pct_data_wrreq}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00048 
00049       \textcolor{vhdlchar}{pct_buff_rdy}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}
00050       
00051         \textcolor{vhdlchar}{)};
00052 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{p2d\_wr\_fsm};
00053 
00054 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00055 \textcolor{keyword}{-- Architecture}
00056 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00057 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} p2d_wr_fsm is
00058 \textcolor{keyword}{--declare signals,  components here}
00059 
00060 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{in_pct_data_reg}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{in_pct_data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00061 
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wr_cnt}                 \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00063 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wr_cnt_end}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00064 
00065 
00066 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_hdr_0_reg}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};      
00067 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_hdr_0_valid_reg}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00068 
00069 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_hdr_1_reg}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_hdr_1_valid_reg}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00071 
00072 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_data_wrreq_int}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00073 
00074 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{buff_sel}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00075 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{next_buff_sel_cnt}      \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{comment}{integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ceil}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{log2}\textcolor{vhdlchar}{(}\textcolor{comment}{real}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_buff_sel_cnt}   \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{comment}{integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ceil}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{log2}\textcolor{vhdlchar}{(}\textcolor{comment}{real}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_buff_rdy}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00078 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{next_buff_rdy}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00079 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{buff_check_limit}       \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00080 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_size_limit}         \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00081 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{in_pct_wrfull_int}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00082 
00083 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_data_reg}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};    
00084 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_data_wrreq_reg}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00085 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_data_wrreq_comb}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00086 
00087 
00088 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{state_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{wait\_hdr\_1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{wait\_pct\_end}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{wait\_rdy}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{switch\_buff}\textcolor{vhdlchar}{)};
00089 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{state_type};               
00090 
00091 
00092 
00093 \textcolor{vhdlkeyword}{begin}
00094 
00095 
00096 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00097 \textcolor{keyword}{-- To calculate limits}
00098 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00099 \textcolor{keywordflow}{process}(clk, reset_n)
00100 \textcolor{vhdlkeyword}{begin}
00101    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00102       \textcolor{vhdlchar}{buff_check_limit}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00103       \textcolor{vhdlchar}{pct_size_limit}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00104    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00105       \textcolor{vhdlchar}{buff_check_limit}  \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00106       \textcolor{vhdlchar}{pct_size_limit}    \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00107    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00108 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00109 
00110 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00111 \textcolor{keyword}{-- Counter for selecting new buffer}
00112 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00113 \textcolor{keywordflow}{process}(clk, reset_n)
00114 \textcolor{vhdlkeyword}{begin}
00115    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00116       \textcolor{vhdlchar}{next_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00117       \textcolor{vhdlchar}{current_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00118    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00119       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_hdr_0_valid_reg} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00120          \textcolor{vhdlchar}{next_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_buff_sel_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00121       \textcolor{keywordflow}{else} 
00122          \textcolor{vhdlchar}{next_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_buff_sel_cnt};
00123       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00124       
00125       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{switch\_buff} \textcolor{keywordflow}{then} 
00126          \textcolor{vhdlchar}{current_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_buff_sel_cnt};
00127       \textcolor{keywordflow}{else}
00128          \textcolor{vhdlchar}{current_buff_sel_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_buff_sel_cnt};
00129       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00130       
00131    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00132 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00133 
00134 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00135 \textcolor{keyword}{-- To select buffer and show selected buffer status}
00136 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00137 \textcolor{keywordflow}{process}(pct_buff_rdy,current_buff_sel_cnt)
00138 \textcolor{vhdlkeyword}{begin}
00139    \textcolor{vhdlchar}{current_buff_rdy} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_buff_rdy}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_buff_sel_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00140 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00141 
00142 \textcolor{keywordflow}{process}(pct_buff_rdy,next_buff_sel_cnt)
00143 \textcolor{vhdlkeyword}{begin}
00144    \textcolor{vhdlchar}{next_buff_rdy} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_buff_rdy}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{next_buff_sel_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00145 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00146 
00147 
00148 
00149 \textcolor{keywordflow}{process}(current_state)
00150 \textcolor{vhdlkeyword}{begin}
00151    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{wait\_rdy}  \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{switch\_buff} \textcolor{keywordflow}{then} 
00152       \textcolor{vhdlchar}{in_pct_wrfull_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00153    \textcolor{keywordflow}{else}
00154       \textcolor{vhdlchar}{in_pct_wrfull_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00155    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00156 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00157 
00158 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00159 \textcolor{keyword}{--state machine}
00160 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00161 fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n)\textcolor{keywordflow}{begin}
00162     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00163         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00164     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00165       \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_state};
00166     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00167 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00168 
00169 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00170 \textcolor{keyword}{--state machine combo}
00171 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00172 fsm : \textcolor{keywordflow}{process}(current_state, pct_hdr_1_valid_reg, wr_cnt_end, current_buff_rdy, 
00173                next_buff_rdy, in_pct_wrreq, wr_cnt) \textcolor{keywordflow}{begin}
00174     \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_state};
00175     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_state} \textcolor{keywordflow}{is}
00176       
00177         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00178          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_buff_rdy} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00179             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_hdr\_1};
00180          \textcolor{keywordflow}{else} 
00181             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00182          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00183          
00184       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wait\_hdr\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00185          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{then} 
00186             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_pct\_end};
00187          \textcolor{keywordflow}{else} 
00188             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_hdr\_1};
00189          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00190          
00191       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wait\_pct\_end} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00192          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt_end} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00193             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{next_buff_rdy} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00194                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{switch\_buff};
00195             \textcolor{keywordflow}{else} 
00196                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_rdy};
00197             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00198          \textcolor{keywordflow}{else} 
00199             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_pct\_end};
00200          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00201        
00202       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wait\_rdy} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00203          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{next_buff_rdy} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00204             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{switch\_buff};
00205          \textcolor{keywordflow}{else} 
00206             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wait\_rdy};
00207          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00208          
00209       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{switch\_buff} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00210          \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00211          
00212         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00213             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00214     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00215 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00216 
00217 
00218 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00219 \textcolor{keyword}{-- In packed data register}
00220 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00221 in\_reg\_proc : \textcolor{keywordflow}{process}(clk, reset_n)
00222 \textcolor{vhdlkeyword}{begin}
00223    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00224       \textcolor{vhdlchar}{in_pct_data_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00225    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00226       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00227          \textcolor{vhdlchar}{in_pct_data_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_data};
00228       \textcolor{keywordflow}{else} 
00229          \textcolor{vhdlchar}{in_pct_data_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_data_reg};
00230       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00231    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00232 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00233 
00234 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00235 \textcolor{keyword}{-- Packet write counter}
00236 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00237 pct\_count\_proc : \textcolor{keywordflow}{process}(clk, reset_n)
00238 \textcolor{vhdlkeyword}{begin}
00239    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00240       \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00241       \textcolor{vhdlchar}{wr_cnt_end} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00242    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00243       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00244          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{pct_size_limit} \textcolor{keywordflow}{then} 
00245             \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00246          \textcolor{keywordflow}{else} 
00247             \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00248          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00249 \textcolor{keyword}{         --for fsm}
00250          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{buff_check_limit} \textcolor{keywordflow}{then} 
00251             \textcolor{vhdlchar}{wr_cnt_end} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00252          \textcolor{keywordflow}{else}
00253             \textcolor{vhdlchar}{wr_cnt_end} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00254          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00255          
00256       \textcolor{keywordflow}{else} 
00257          \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wr_cnt};
00258       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00259    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00260 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00261 
00262 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00263 \textcolor{keyword}{-- Packet header 0 register}
00264 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00265 hdr0\_reg : \textcolor{keywordflow}{process}(clk, reset_n)
00266 \textcolor{vhdlkeyword}{begin}
00267    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00268       \textcolor{vhdlchar}{pct_hdr_0_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};     
00269       \textcolor{vhdlchar}{pct_hdr_0_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00270    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00271       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
00272          \textcolor{vhdlchar}{pct_hdr_0_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_data} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{in_pct_data_reg};     
00273          \textcolor{vhdlchar}{pct_hdr_0_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00274       \textcolor{keywordflow}{else} 
00275          \textcolor{vhdlchar}{pct_hdr_0_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_0_reg};     
00276          \textcolor{vhdlchar}{pct_hdr_0_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00277       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00278    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00279 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00280 
00281 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00282 \textcolor{keyword}{-- Packet header 1 register}
00283 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00284 hdr1\_reg : \textcolor{keywordflow}{process}(clk, reset_n)
00285 \textcolor{vhdlkeyword}{begin}
00286    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00287       \textcolor{vhdlchar}{pct_hdr_1_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};     
00288       \textcolor{vhdlchar}{pct_hdr_1_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00289    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00290       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{then}
00291          \textcolor{vhdlchar}{pct_hdr_1_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_data} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{in_pct_data_reg};     
00292          \textcolor{vhdlchar}{pct_hdr_1_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00293       \textcolor{keywordflow}{else} 
00294          \textcolor{vhdlchar}{pct_hdr_1_reg}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_1_reg};     
00295          \textcolor{vhdlchar}{pct_hdr_1_valid_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00296       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00297    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00298 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00299 
00300 
00301 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00302 \textcolor{keyword}{-- Packet wrreq internal signal}
00303 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00304 \textcolor{keywordflow}{process}(clk, reset_n)
00305 \textcolor{vhdlkeyword}{begin}
00306    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}    
00307       \textcolor{vhdlchar}{pct_data_wrreq_int}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00308    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00309       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{in_pct_wrreq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{wait\_pct\_end} \textcolor{keywordflow}{then}  
00310          \textcolor{vhdlchar}{pct_data_wrreq_int}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00311       \textcolor{keywordflow}{else}    
00312          \textcolor{vhdlchar}{pct_data_wrreq_int}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00313       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00314    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00315 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00316 
00317 
00318 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00319 \textcolor{keyword}{-- Buffer select signal }
00320 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00321 \textcolor{keywordflow}{process}(clk, reset_n)
00322 \textcolor{vhdlkeyword}{begin}
00323    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}    
00324       \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00325       \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00326    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00327       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{switch\_buff} \textcolor{keywordflow}{then} 
00328          \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00329             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{i} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{next_buff_sel_cnt} \textcolor{keywordflow}{then} 
00330                \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00331             \textcolor{keywordflow}{else} 
00332                \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00333             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00334          \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00335       \textcolor{keywordflow}{else}    
00336          \textcolor{vhdlchar}{buff_sel}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{buff_sel};
00337       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00338    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00339 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00340 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00341 \textcolor{keyword}{-- Buffer write select signal }
00342 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00343 \textcolor{keywordflow}{process}(pct_data_wrreq_int,current_buff_sel_cnt)
00344 \textcolor{vhdlkeyword}{begin}
00345    \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00346       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{i} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{current_buff_sel_cnt} \textcolor{keywordflow}{then} 
00347          \textcolor{vhdlchar}{pct_data_wrreq_comb}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_data_wrreq_int};
00348       \textcolor{keywordflow}{else} 
00349          \textcolor{vhdlchar}{pct_data_wrreq_comb}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00350       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00351    \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00352 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00353 
00354 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00355 \textcolor{keyword}{-- Packet header capture valid signal }
00356 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00357 \textcolor{keywordflow}{process}(clk, reset_n)
00358 \textcolor{vhdlkeyword}{begin}
00359    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00360       \textcolor{vhdlchar}{pct_hdr_0_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00361       \textcolor{vhdlchar}{pct_hdr_1_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00362    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00363       \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop} 
00364          \textcolor{vhdlchar}{pct_hdr_0_valid}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{pct_hdr_0_valid_reg};
00365          \textcolor{vhdlchar}{pct_hdr_1_valid}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{buff_sel}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{pct_hdr_1_valid_reg};
00366       \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00367    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00368 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00369 
00370 
00371 
00372 proc\_name : \textcolor{keywordflow}{process}(clk, reset_n)
00373 \textcolor{vhdlkeyword}{begin}
00374    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00375       \textcolor{vhdlchar}{pct_data_reg}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};      
00376       \textcolor{vhdlchar}{pct_data_wrreq_reg}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00377    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00378       \textcolor{vhdlchar}{pct_data_reg}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_data_reg};      
00379       \textcolor{vhdlchar}{pct_data_wrreq_reg}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_data_wrreq_comb};
00380    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00381 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00382 
00383 \textcolor{vhdlchar}{pct_hdr_0}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_0_reg};
00384 \textcolor{vhdlchar}{pct_hdr_1}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_1_reg};
00385 \textcolor{vhdlchar}{pct_data}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_data_reg};
00386 \textcolor{vhdlchar}{pct_data_wrreq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_data_wrreq_reg};
00387 \textcolor{vhdlchar}{in_pct_wrfull}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{in_pct_wrfull_int};
00388 
00389 
00390 
00391 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00392 
00393 
00394 
00395 
00396 
\end{DoxyCode}
