\subsection{alt\+\_\+dma\+\_\+dev.\+h}
\label{alt__dma__dev_8h_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/software/lms\+\_\+ctr\+\_\+bsp/\+H\+A\+L/inc/sys/alt\+\_\+dma\+\_\+dev.\+h@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/software/lms\+\_\+ctr\+\_\+bsp/\+H\+A\+L/inc/sys/alt\+\_\+dma\+\_\+dev.\+h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef \_\_ALT\_DMA\_DEV\_H\_\_}
00002 \textcolor{preprocessor}{#define \_\_ALT\_DMA\_DEV\_H\_\_}
00003 
00004 \textcolor{comment}{/******************************************************************************}
00005 \textcolor{comment}{*                                                                             *}
00006 \textcolor{comment}{* License Agreement                                                           *}
00007 \textcolor{comment}{*                                                                             *}
00008 \textcolor{comment}{* Copyright (c) 2004-2005 Altera Corporation, San Jose, California, USA.      *}
00009 \textcolor{comment}{* All rights reserved.                                                        *}
00010 \textcolor{comment}{*                                                                             *}
00011 \textcolor{comment}{* Permission is hereby granted, free of charge, to any person obtaining a     *}
00012 \textcolor{comment}{* copy of this software and associated documentation files (the "Software"),  *}
00013 \textcolor{comment}{* to deal in the Software without restriction, including without limitation   *}
00014 \textcolor{comment}{* the rights to use, copy, modify, merge, publish, distribute, sublicense,    *}
00015 \textcolor{comment}{* and/or sell copies of the Software, and to permit persons to whom the       *}
00016 \textcolor{comment}{* Software is furnished to do so, subject to the following conditions:        *}
00017 \textcolor{comment}{*                                                                             *}
00018 \textcolor{comment}{* The above copyright notice and this permission notice shall be included in  *}
00019 \textcolor{comment}{* all copies or substantial portions of the Software.                         *}
00020 \textcolor{comment}{*                                                                             *}
00021 \textcolor{comment}{* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  *}
00022 \textcolor{comment}{* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,    *}
00023 \textcolor{comment}{* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE *}
00024 \textcolor{comment}{* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER      *}
00025 \textcolor{comment}{* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING     *}
00026 \textcolor{comment}{* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER         *}
00027 \textcolor{comment}{* DEALINGS IN THE SOFTWARE.                                                   *}
00028 \textcolor{comment}{*                                                                             *}
00029 \textcolor{comment}{* This agreement shall be governed in all respects by the laws of the State   *}
00030 \textcolor{comment}{* of California and by the laws of the United States of America.              *}
00031 \textcolor{comment}{*                                                                             *}
00032 \textcolor{comment}{* Altera does not recommend, suggest or require that this reference design    *}
00033 \textcolor{comment}{* file be used in conjunction or combination with any other product.          *}
00034 \textcolor{comment}{******************************************************************************/}
00035 
00036 \textcolor{comment}{/******************************************************************************}
00037 \textcolor{comment}{*                                                                             *}
00038 \textcolor{comment}{* THIS IS A LIBRARY READ-ONLY SOURCE FILE. DO NOT EDIT.                       *}
00039 \textcolor{comment}{*                                                                             *}
00040 \textcolor{comment}{******************************************************************************/}
00041 
00042 \textcolor{preprocessor}{#include "priv/alt_dev_llist.h"}
00043 
00044 \textcolor{preprocessor}{#include "alt_types.h"}
00045 
00046 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00047 \textcolor{keyword}{extern} \textcolor{stringliteral}{"C"}
00048 \{
00049 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* \_\_cplusplus */}\textcolor{preprocessor}{}
00050 
00051 \textcolor{comment}{/*}
00052 \textcolor{comment}{ * This header contains the device driver interface for accessing DMA }
00053 \textcolor{comment}{ * resources. See alt\_dma.h for the DMA application side interface.}
00054 \textcolor{comment}{ *}
00055 \textcolor{comment}{ * The interface model treats a DMA transaction as being composed of two }
00056 \textcolor{comment}{ * halves (read and write). }
00057 \textcolor{comment}{ *}
00058 \textcolor{comment}{ * An "alt\_dma\_txchan\_dev" is used to describe the device associated with a}
00059 \textcolor{comment}{ * DMA transmit channel. An "alt\_dma\_rxchan\_dev" is used to describe the}
00060 \textcolor{comment}{ * device associated with a DMA receive channel. }
00061 \textcolor{comment}{ */}
00062 
00063 \textcolor{comment}{/*}
00064 \textcolor{comment}{ * List of generic ioctl requests that may be supported by a DMA device.}
00065 \textcolor{comment}{ *}
00066 \textcolor{comment}{ * ALT\_DMA\_RX\_ONLY\_ON:    This causes a DMA channel to operate in a mode}
00067 \textcolor{comment}{ *                        where only the receiver is under software control.}
00068 \textcolor{comment}{ *                        The other side reads continously from a single}
00069 \textcolor{comment}{ *                        location. The address to read is the argument to}
00070 \textcolor{comment}{ *                        this request.}
00071 \textcolor{comment}{ * ALT\_DMA\_RX\_ONLY\_OFF:   Return to the default mode where both the receive}
00072 \textcolor{comment}{ *                        and transmit sides of the DMA can be under software}
00073 \textcolor{comment}{ *                        control.}
00074 \textcolor{comment}{ * ALT\_DMA\_TX\_ONLY\_ON:    This causes a DMA channel to operate in a mode}
00075 \textcolor{comment}{ *                        where only the transmitter is under software control.}
00076 \textcolor{comment}{ *                        The other side writes continously to a single}
00077 \textcolor{comment}{ *                        location. The address to write to is the argument to}
00078 \textcolor{comment}{ *                        this request.}
00079 \textcolor{comment}{ * ALT\_DMA\_TX\_ONLY\_OFF:   Return to the default mode where both the receive}
00080 \textcolor{comment}{ *                        and transmit sides of the DMA can be under software}
00081 \textcolor{comment}{ *                        control.}
00082 \textcolor{comment}{ * ALT\_DMA\_SET\_MODE\_8:    Transfer data in units of 8 bits.}
00083 \textcolor{comment}{ * ALT\_DMA\_SET\_MODE\_16:   Transfer data in units of 16 bits.}
00084 \textcolor{comment}{ * ALT\_DMA\_SET\_MODE\_32:   Transfer data in units of 32 bits.}
00085 \textcolor{comment}{ * ALT\_DMA\_SET\_MODE\_64:   Transfer data in units of 64 bits.}
00086 \textcolor{comment}{ * ALT\_DMA\_SET\_MODE\_128:  Transfer data in units of 128 bits.}
00087 \textcolor{comment}{ * ALT\_DMA\_GET\_MODE:      Get the current transfer mode.}
00088 \textcolor{comment}{ *}
00089 \textcolor{comment}{ * The use of the macros: ALT\_DMA\_TX\_STREAM\_ON, ALT\_DMA\_TX\_STREAM\_OFF}
00090 \textcolor{comment}{ * ALT\_DMA\_RX\_STREAM\_OFF and ALT\_DMA\_RX\_STREAM\_ON are depreciated. You should}
00091 \textcolor{comment}{ * instead use the macros: ALT\_DMA\_RX\_ONLY\_ON, ALT\_DMA\_RX\_ONLY\_OFF, }
00092 \textcolor{comment}{ * ALT\_DMA\_TX\_ONLY\_ON and ALT\_DMA\_TX\_ONLY\_OFF.}
00093 \textcolor{comment}{ */}
00094 
00095 \textcolor{preprocessor}{#define ALT\_DMA\_TX\_STREAM\_ON  (0x1)}
00096 \textcolor{preprocessor}{#define ALT\_DMA\_TX\_STREAM\_OFF (0x2)}
00097 \textcolor{preprocessor}{#define ALT\_DMA\_RX\_STREAM\_ON  (0x3)}
00098 \textcolor{preprocessor}{#define ALT\_DMA\_RX\_STREAM\_OFF (0x4)}
00099 \textcolor{preprocessor}{#define ALT\_DMA\_SET\_MODE\_8    (0x5)}
00100 \textcolor{preprocessor}{#define ALT\_DMA\_SET\_MODE\_16   (0x6)}
00101 \textcolor{preprocessor}{#define ALT\_DMA\_SET\_MODE\_32   (0x7)}
00102 \textcolor{preprocessor}{#define ALT\_DMA\_SET\_MODE\_64   (0x8)}
00103 \textcolor{preprocessor}{#define ALT\_DMA\_SET\_MODE\_128  (0x9)}
00104 \textcolor{preprocessor}{#define ALT\_DMA\_GET\_MODE      (0xa)}
00105 
00106 \textcolor{preprocessor}{#define ALT\_DMA\_RX\_ONLY\_ON    ALT\_DMA\_TX\_STREAM\_ON}
00107 \textcolor{preprocessor}{#define ALT\_DMA\_RX\_ONLY\_OFF   ALT\_DMA\_TX\_STREAM\_OFF}
00108 \textcolor{preprocessor}{#define ALT\_DMA\_TX\_ONLY\_ON    ALT\_DMA\_RX\_STREAM\_ON}
00109 \textcolor{preprocessor}{#define ALT\_DMA\_TX\_ONLY\_OFF   ALT\_DMA\_RX\_STREAM\_OFF}
00110 
00111 \textcolor{comment}{/*}
00112 \textcolor{comment}{ *}
00113 \textcolor{comment}{ */}
00114 
00115 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }alt_dma_txchan_dev_s alt_dma_txchan_dev;
00116 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }alt_dma_rxchan_dev_s alt_dma_rxchan_dev;
00117 
00118 \textcolor{keyword}{typedef} alt_dma_txchan_dev* alt_dma_txchan;
00119 \textcolor{keyword}{typedef} alt_dma_rxchan_dev* alt_dma_rxchan;
00120 
00121 \textcolor{keyword}{typedef} void (alt_txchan_done)(\textcolor{keywordtype}{void}* handle);
00122 \textcolor{keyword}{typedef} void (alt_rxchan_done)(\textcolor{keywordtype}{void}* handle, \textcolor{keywordtype}{void}* data);
00123 
00124 \textcolor{comment}{/*}
00125 \textcolor{comment}{ * devices that provide a DMA transmit channel are required to provide an}
00126 \textcolor{comment}{ * instance of the "alt\_dma\_txchan\_dev" structure. }
00127 \textcolor{comment}{ */}
00128 
00129 \textcolor{keyword}{struct }alt_dma_txchan_dev_s \{
00130   alt_llist  llist;                  \textcolor{comment}{/* for internal use */}
00131   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name;                  \textcolor{comment}{/* name of the device instance }
00132 \textcolor{comment}{                                      * (e.g. "/dev/dma\_0"). }
00133 \textcolor{comment}{                                      */}
00134   int (*space) (alt\_dma\_txchan dma); \textcolor{comment}{/* returns the maximum number of }
00135 \textcolor{comment}{                                      * transmit requests that can be posted}
00136 \textcolor{comment}{              */}
00137   int (*dma_send) (alt\_dma\_txchan dma,   
00138          \textcolor{keyword}{const} \textcolor{keywordtype}{void}* from, 
00139          alt_u32 len,
00140          alt_txchan_done* done, 
00141          \textcolor{keywordtype}{void}* handle);        \textcolor{comment}{/* post a transmit request */}
00142   int (*ioctl) (alt\_dma\_txchan dma, \textcolor{keywordtype}{int} req, \textcolor{keywordtype}{void}* arg); \textcolor{comment}{/* perform device}
00143 \textcolor{comment}{              * specific I/O control.}
00144 \textcolor{comment}{                                      */} 
00145 \};
00146 
00147 \textcolor{comment}{/*}
00148 \textcolor{comment}{ * devices that provide a DMA receive channel are required to provide an}
00149 \textcolor{comment}{ * instance of the "alt\_dma\_rxchan\_dev" structure. }
00150 \textcolor{comment}{ */}
00151 
00152 \textcolor{keyword}{struct }alt_dma_rxchan_dev_s \{
00153   alt_llist list;                    \textcolor{comment}{/* for internal use */}
00154   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name;                  \textcolor{comment}{/* name of the device instance }
00155 \textcolor{comment}{                                      * (e.g. "/dev/dma\_0"). }
00156 \textcolor{comment}{                                      */}
00157   alt_u32        depth;              \textcolor{comment}{/* maximum number of receive requests that}
00158 \textcolor{comment}{                                      * can be posted.}
00159 \textcolor{comment}{                                      */}
00160   int (*prepare) (alt\_dma\_rxchan   dma, 
00161                   \textcolor{keywordtype}{void}*            data,
00162                   alt_u32          len,
00163                   alt_rxchan_done* done,  
00164                   \textcolor{keywordtype}{void}*            handle); \textcolor{comment}{/* post a receive request */}
00165   int (*ioctl) (alt\_dma\_rxchan dma, \textcolor{keywordtype}{int} req, \textcolor{keywordtype}{void}* arg);  \textcolor{comment}{/* perform device}
00166 \textcolor{comment}{              * specific I/O control.}
00167 \textcolor{comment}{                                      */} 
00168 \};
00169 
00170 \textcolor{comment}{/*}
00171 \textcolor{comment}{ * Register a DMA transmit channel with the system.}
00172 \textcolor{comment}{ */}
00173 
00174 \textcolor{keyword}{static} ALT_INLINE \textcolor{keywordtype}{int} alt_dma_txchan_reg (alt_dma_txchan_dev* dev)
00175 \{
00176   \textcolor{keyword}{extern} alt_llist alt\_dma\_txchan\_list;
00177 
00178   \textcolor{keywordflow}{return} alt_dev_llist_insert((alt_dev_llist*) dev, &alt\_dma\_txchan\_list);
00179 \}
00180 
00181 \textcolor{comment}{/*}
00182 \textcolor{comment}{ * Register a DMA receive channel with the system.}
00183 \textcolor{comment}{ */}
00184 
00185 \textcolor{keyword}{static} ALT_INLINE \textcolor{keywordtype}{int} alt_dma_rxchan_reg (alt_dma_rxchan_dev* dev)
00186 \{
00187   \textcolor{keyword}{extern} alt_llist alt\_dma\_rxchan\_list;
00188 
00189   \textcolor{keywordflow}{return} alt_dev_llist_insert((alt_dev_llist*) dev, &alt\_dma\_rxchan\_list);
00190 \}
00191 
00192 \textcolor{comment}{/*}
00193 \textcolor{comment}{ *}
00194 \textcolor{comment}{ */}
00195 
00196 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00197 \}
00198 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* \_\_cplusplus */}\textcolor{preprocessor}{}
00199 
00200 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* \_\_ALT\_DMA\_DEV\_H\_\_ */}\textcolor{preprocessor}{}
\end{DoxyCode}
