\subsection{txiq\+\_\+ctrl.\+vhd}
\label{txiq__ctrl_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/fifo2diq/synth/txiq\+\_\+ctrl.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/fifo2diq/synth/txiq\+\_\+ctrl.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:          txiq\_ctrl.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION:   control module for txiq}
00004 \textcolor{keyword}{-- DATE:          August 25, 2017}
00005 \textcolor{keyword}{-- AUTHOR(s):     Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }txiq_ctrl \textcolor{keywordflow}{is}
00016    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00017       \textcolor{vhdlchar}{clk}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00018       \textcolor{vhdlchar}{reset_n}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00019 \textcolor{keyword}{      --Mode settings}
00020       \textcolor{vhdlchar}{pct_sync_mode}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- 0 - timestamp, 1 - external pulse}
00021 \textcolor{keyword}{      --pulse sync mode signals}
00022       \textcolor{vhdlchar}{pct_sync_pulse}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- external packet synchronisation pulse signal}
00023       \textcolor{vhdlchar}{pct_sync_size}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- valid in external pulse mode only}
00024       \textcolor{vhdlchar}{pct_buff_rdy}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ --assert high when there is samples more than pct\_sync\_size}
00025 \textcolor{keyword}{      --signals for txiq module}
00026       \textcolor{vhdlchar}{txiq_rdreq_in}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00027       \textcolor{vhdlchar}{txiq_en}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00028 \textcolor{keyword}{      --tx antenna controll}
00029       \textcolor{vhdlchar}{txant_cyc_before_en} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00030       \textcolor{vhdlchar}{txant_cyc_after_en}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00031       \textcolor{vhdlchar}{txant_en}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}
00032         \textcolor{vhdlchar}{)};
00033 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{txiq\_ctrl};
00034 
00035 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00036 \textcolor{keyword}{-- Architecture}
00037 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00038 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} txiq_ctrl is
00039 \textcolor{keyword}{--declare signals,  components here}
00040 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{txiq_en_mux}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00041 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{txiq_en_mode_1}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00042 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cnt}                 \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00043 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cnt_max}             \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{txant_en_wait_cnt}   \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00045 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{txant_dis_wait_cnt}  \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{txant_en_reg}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00047 
00048 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{state_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{txant\_enable\_wait}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{rd\_samples}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{txant\_dis\_wait}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{wait\_rd\_cycles}\textcolor{vhdlchar}{)};
00049 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{state_type};
00050 
00051   
00052 \textcolor{vhdlkeyword}{begin}
00053 
00054 \textcolor{keyword}{--sample read counter max value}
00055 \textcolor{keywordflow}{process}(clk, reset_n)
00056 \textcolor{vhdlkeyword}{begin}
00057    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00058       \textcolor{vhdlchar}{cnt_max} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00059    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00060       \textcolor{vhdlchar}{cnt_max} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_sync_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00061    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00062 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00063 
00064 
00065 \textcolor{keyword}{--txant\_en wait down counter}
00066 \textcolor{keywordflow}{process}(clk, reset_n)
00067 \textcolor{vhdlkeyword}{   begin}
00068    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00069       \textcolor{vhdlchar}{txant_en_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00070    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00071       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{txant\_enable\_wait} \textcolor{keywordflow}{then} 
00072          \textcolor{vhdlchar}{txant_en_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant_en_wait_cnt}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00073       \textcolor{keywordflow}{else} 
00074          \textcolor{vhdlchar}{txant_en_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{txant_cyc_before_en}\textcolor{vhdlchar}{)};
00075       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00076    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00077 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00078 
00079 \textcolor{keyword}{--txant\_dis wait down counter}
00080 \textcolor{keywordflow}{process}(clk, reset_n)
00081 \textcolor{vhdlkeyword}{   begin}
00082    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00083       \textcolor{vhdlchar}{txant_dis_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00084    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00085       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{txant\_dis\_wait} \textcolor{keywordflow}{then} 
00086          \textcolor{vhdlchar}{txant_dis_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant_dis_wait_cnt}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00087       \textcolor{keywordflow}{else} 
00088          \textcolor{vhdlchar}{txant_dis_wait_cnt} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{txant_cyc_after_en}\textcolor{vhdlchar}{)};
00089       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00090    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00091 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00092 
00093 \textcolor{keyword}{--txiq\_en signal in pulse sync mode}
00094 \textcolor{keywordflow}{process}(current_state)
00095 \textcolor{vhdlkeyword}{begin }
00096    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{rd\_samples} \textcolor{keywordflow}{then} 
00097       \textcolor{vhdlchar}{txiq_en_mode_1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00098    \textcolor{keywordflow}{else} 
00099       \textcolor{vhdlchar}{txiq_en_mode_1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00100    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00101 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00102 
00103 
00104 \textcolor{keyword}{--sample read counter}
00105 cnt\_p : \textcolor{keywordflow}{process}(clk, reset_n)
00106 \textcolor{vhdlkeyword}{begin}
00107    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00108       \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00109    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00110       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{rd\_samples} \textcolor{keywordflow}{then}
00111          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{txiq_rdreq_in} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00112             \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00113          \textcolor{keywordflow}{else} 
00114             \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cnt};
00115          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00116       \textcolor{keywordflow}{else} 
00117          \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00118       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00119    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00120 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00121    
00122    
00123 \textcolor{keyword}{ -- ----------------------------------------------------------------------------}
00124 \textcolor{keyword}{--state machine}
00125 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00126 fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n)\textcolor{keywordflow}{begin}
00127     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00128         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00129     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then} 
00130         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_state};
00131     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00132 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00133 
00134 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00135 \textcolor{keyword}{--state machine combo}
00136 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00137 fsm : \textcolor{keywordflow}{process}(current_state, pct_buff_rdy, pct_sync_pulse, cnt, cnt_max, 
      txiq_rdreq_in, txant_en_wait_cnt,        txant_dis_wait_cnt) \textcolor{keywordflow}{begin}
00138     \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_state};
00139     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_state} \textcolor{keywordflow}{is}
00140       
00141         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{ --idle state}
00142          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_buff_rdy} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{pct_sync_pulse} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00143             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant\_enable\_wait};
00144          \textcolor{keywordflow}{else} 
00145             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00146          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00147          
00148       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{txant\_enable\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00149          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{txant_en_wait_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then} 
00150             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rd\_samples};
00151          \textcolor{keywordflow}{else} 
00152             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant\_enable\_wait};
00153          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00154                
00155       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{rd\_samples} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00156          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cnt} \textcolor{vhdlchar}{>=} \textcolor{vhdlchar}{cnt_max} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{txiq_rdreq_in} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00157             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant\_dis\_wait};
00158          \textcolor{keywordflow}{else} 
00159             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rd\_samples};
00160          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00161          
00162       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{txant\_dis\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00163          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{txant_dis_wait_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then} 
00164             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00165          \textcolor{keywordflow}{else} 
00166             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant\_dis\_wait};
00167          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00168                            
00169         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00170             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00171     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00172 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00173 
00174 \textcolor{keyword}{--txiq\_en mux register}
00175 \textcolor{keyword}{ -- process(reset\_n, clk)}
00176 \textcolor{keyword}{    -- begin}
00177 \textcolor{keyword}{      -- if reset\_n='0' then}
00178 \textcolor{keyword}{         -- txiq\_en\_mux <= '0';}
00179 \textcolor{keyword}{      -- elsif (clk'event and clk = '1') then}
00180 \textcolor{keyword}{         -- if pct\_sync\_mode = '0' then }
00181 \textcolor{keyword}{            -- txiq\_en\_mux <= '1';}
00182 \textcolor{keyword}{         -- else }
00183 \textcolor{keyword}{            -- txiq\_en\_mux <= txiq\_en\_mode\_1;}
00184 \textcolor{keyword}{         -- end if;}
00185 \textcolor{keyword}{      -- end if;}
00186 \textcolor{keyword}{-- end process;}
00187 
00188 \textcolor{vhdlchar}{txiq_en_mux} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{pct_sync_mode} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{txiq_en_mode_1};
00189  
00190 \textcolor{keyword}{--txant\_en register}
00191 \textcolor{keywordflow}{process}(clk, reset_n)
00192 \textcolor{vhdlkeyword}{begin}
00193    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00194       \textcolor{vhdlchar}{txant_en_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00195    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00196       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{txant\_enable\_wait} \textcolor{keywordflow}{then} 
00197          \textcolor{vhdlchar}{txant_en_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00198       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{idle} \textcolor{keywordflow}{then} 
00199          \textcolor{vhdlchar}{txant_en_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00200       \textcolor{keywordflow}{else} 
00201          \textcolor{vhdlchar}{txant_en_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant_en_reg};
00202       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00203    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00204 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00205 
00206 \textcolor{vhdlchar}{txant_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txant_en_reg};
00207     
00208 
00209     
00210 \textcolor{vhdlchar}{txiq_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{txiq_en_mux};
00211   
00212 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00213 
00214 
00215 
00216 
00217 
\end{DoxyCode}
