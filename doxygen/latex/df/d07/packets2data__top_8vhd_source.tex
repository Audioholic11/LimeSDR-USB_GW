\subsection{packets2data\+\_\+top.\+vhd}
\label{packets2data__top_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/packets2data\+\_\+top.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/packets2data\+\_\+top.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    packets2data\_top.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: Reads data from packets.}
00004 \textcolor{keyword}{-- DATE:    April 03, 2017}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 
00009 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00010 \textcolor{keyword}{-- Notes:}
00011 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00012 
00013 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00014 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00015 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00016 
00017 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00018 \textcolor{keyword}{-- Entity declaration}
00019 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00020 \textcolor{keywordflow}{entity }packets2data_top \textcolor{keywordflow}{is}
00021    \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
00022       \textcolor{vhdlchar}{dev_family}        \textcolor{vhdlchar}{:} \textcolor{comment}{string} \textcolor{vhdlchar}{:=} \textcolor{keyword}{"Cyclone IV E"};
00023       \textcolor{vhdlchar}{pct_size_w}        \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00024       \textcolor{vhdlchar}{n_buff}            \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{ -- 2,4 valid values}
00025       \textcolor{vhdlchar}{in_pct_data_w}     \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
00026       \textcolor{vhdlchar}{out_pct_data_w}    \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{64};
00027       \textcolor{vhdlchar}{decomp_fifo_size}  \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{9}\textcolor{keyword}{ -- 256 words}
00028    \textcolor{vhdlchar}{)};
00029    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00030 
00031       \textcolor{vhdlchar}{wclk}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00032       \textcolor{vhdlchar}{rclk}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00033       \textcolor{vhdlchar}{reset_n}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00034       \textcolor{vhdlchar}{pct_size}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00035       
00036 \textcolor{keyword}{      --Mode settings}
00037       \textcolor{vhdlchar}{mode}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- JESD207: 1; TRXIQ: 0}
00038         \textcolor{vhdlchar}{trxiqpulse}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- trxiqpulse on: 1; trxiqpulse off: 0}
00039         \textcolor{vhdlchar}{ddr_en}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- DDR: 1; SDR: 0}
00040         \textcolor{vhdlchar}{mimo_en}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- SISO: 1; MIMO: 0}
00041         \textcolor{vhdlchar}{ch_en}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"11" - Ch. A, "10" - Ch. B, "11" - Ch. A
       and Ch. B. }
00042       \textcolor{vhdlchar}{sample_width}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"10"-12bit, "01"-14bit, "00"-16bit;}
00043       
00044       \textcolor{vhdlchar}{pct_sync_dis}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00045       \textcolor{vhdlchar}{sample_nr}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 
00047       \textcolor{vhdlchar}{in_pct_wrreq}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00048       \textcolor{vhdlchar}{in_pct_data}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{in_pct_data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00049       \textcolor{vhdlchar}{in_pct_last}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00050       \textcolor{vhdlchar}{in_pct_full}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00051       \textcolor{vhdlchar}{in_pct_clr_flag}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00052       \textcolor{vhdlchar}{in_pct_buff_rdy}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00053       
00054       \textcolor{vhdlchar}{smpl_buff_rdempty} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00055       \textcolor{vhdlchar}{smpl_buff_wrfull}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00056       \textcolor{vhdlchar}{smpl_buff_q}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{out_pct_data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00057       \textcolor{vhdlchar}{smpl_buff_rdreq}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
00058       
00059         \textcolor{vhdlchar}{)};
00060 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{packets2data\_top};
00061 
00062 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00063 \textcolor{keyword}{-- Architecture}
00064 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00065 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} packets2data_top is
00066 \textcolor{keyword}{--declare signals,  components here}
00067 
00068 \textcolor{keyword}{--inst0}
00069 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_smpl_buff_q}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{out_pct_data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_smpl_buff_valid}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00071 
00072 \textcolor{keyword}{--inst1}
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_data_out}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{127} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_data_out_valid}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00075 
00076 \textcolor{keyword}{--inst2}
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_wrusedw}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{decomp_fifo_size}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00078 
00079 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{max_fifo_words}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{decomp_fifo_size}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00080 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_limit}                \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{decomp_fifo_size}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00081 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_full_sig}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00082  
00083 \textcolor{vhdlkeyword}{begin}
00084 
00085 \textcolor{vhdlchar}{max_fifo_words} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{decomp_fifo_size}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{,} \textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00086 
00087 
00088 \textcolor{keywordflow}{process}(rclk, reset_n)
00089 \textcolor{vhdlkeyword}{begin}
00090    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00091       \textcolor{vhdlchar}{fifo_limit} \textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00092    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{rclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{rclk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00093       \textcolor{vhdlchar}{fifo_limit} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{max_fifo_words}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
00094    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00095 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00096 
00097 
00098 \textcolor{keywordflow}{process}(rclk, reset_n)
00099 \textcolor{vhdlkeyword}{begin}
00100    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00101       \textcolor{vhdlchar}{fifo_full_sig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00102    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{rclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{rclk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00103       \textcolor{keywordflow}{if} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{inst2_wrusedw}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>} \textcolor{vhdlchar}{fifo_limit} \textcolor{keywordflow}{then}
00104          \textcolor{vhdlchar}{fifo_full_sig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00105       \textcolor{keywordflow}{else}
00106          \textcolor{vhdlchar}{fifo_full_sig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00107       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00108    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00109 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00110 
00111 \textcolor{vhdlchar}{smpl_buff_wrfull} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{fifo_full_sig};
00112 
00113 
00114   packets2data\_inst0 : \textcolor{keywordflow}{entity} work.packets2data
00115    \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (
00116       dev_family        => dev_family,
00117       pct_size_w        => pct_size_w,
00118       n_buff            => n_buff,
00119       in_pct_data_w     => in_pct_data_w,
00120       out_pct_data_w    => out_pct_data_w
00121    \textcolor{vhdlchar}{)}
00122    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00123 
00124       wclk              => wclk,
00125       rclk              => rclk, 
00126       reset_n           => reset_n,
00127       
00128       mode              => mode,
00129       trxiqpulse        => trxiqpulse,  
00130       ddr_en              => ddr_en,
00131       mimo_en             => mimo_en,   
00132       ch_en               => ch_en,
00133       sample_width      => sample_width, 
00134      
00135       pct_size          => pct_size,
00136       
00137       pct_sync_dis      => pct_sync_dis,
00138       sample_nr         => sample_nr,
00139       
00140       in_pct_wrreq      => in_pct_wrreq,
00141       in_pct_data       => in_pct_data,
00142       in_pct_last       => in_pct_last,
00143       in_pct_full       => in_pct_full,
00144       in_pct_clr_flag   => in_pct_clr_flag,
00145       in_pct_buff_rdy   => in_pct_buff_rdy, 
00146       
00147       smpl_buff_full    => fifo_full_sig,
00148       smpl_buff_q       => inst0_smpl_buff_q,    
00149       smpl_buff_valid   => inst0_smpl_buff_valid
00150         \textcolor{vhdlchar}{)};
00151         
00152         
00153 bit\_unpack\_64\_inst1 : \textcolor{keywordflow}{entity} work.bit_unpack_64
00154   \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00155         clk             => rclk,
00156         reset_n         => reset_n,
00157         data_in         => inst0_smpl_buff_q,
00158         data_in_valid   => inst0_smpl_buff_valid,
00159         sample_width    => sample_width,
00160         data_out        => inst1_data_out,
00161         data_out_valid  => inst1_data_out_valid
00162         \textcolor{vhdlchar}{)};
00163         
00164         
00165    fifo\_inst\_isnt2 : \textcolor{keywordflow}{entity} work.fifo_inst
00166       \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
00167          dev_family     => dev_family,
00168          wrwidth         => \textcolor{vhdllogic}{128},
00169          wrusedw_witdth  => decomp_fifo_size,
00170          rdwidth         => out_pct_data_w,
00171          rdusedw_width   => decomp\_fifo\_size+1,
00172          show_ahead      => \textcolor{keyword}{"OFF"}
00173       \textcolor{vhdlchar}{)} 
00174       \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00175 \textcolor{keyword}{         --input ports }
00176          reset_n       => reset_n,
00177          wrclk         => rclk,
00178          wrreq         => inst1_data_out_valid,
00179          data          => inst1_data_out,
00180          wrfull        => \textcolor{keywordflow}{open},
00181          wrempty          => \textcolor{keywordflow}{open},
00182          wrusedw       => inst2_wrusedw,
00183          rdclk       => rclk,
00184          rdreq         => smpl_buff_rdreq,
00185          q             => smpl_buff_q,
00186          rdempty       => smpl_buff_rdempty,
00187          rdusedw       => \textcolor{keywordflow}{open}          
00188          \textcolor{vhdlchar}{)};
00189   
00190   
00191   
00192 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00193 
00194 
00195 
00196 
00197 
\end{DoxyCode}
