\subsection{rxiq\+\_\+mimo\+\_\+ddr.\+vhd}
\label{rxiq__mimo__ddr_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+path\+\_\+top/diq2fifo/synth/rxiq\+\_\+mimo\+\_\+ddr.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+path\+\_\+top/diq2fifo/synth/rxiq\+\_\+mimo\+\_\+ddr.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    rxiq\_mimo\_ddr.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: rxiq samples in MIMO DDR mode}
00004 \textcolor{keyword}{-- DATE:    Jan 13, 2016}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }rxiq_mimo_ddr \textcolor{keywordflow}{is}
00016    \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(}
00017       \textcolor{vhdlchar}{iq_width}      \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}
00018    \textcolor{vhdlchar}{)};
00019   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00020       \textcolor{vhdlchar}{clk}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00021       \textcolor{vhdlchar}{reset_n}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00022         \textcolor{vhdlchar}{ch_en}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"01" - Ch. A, "10" - Ch. B, "11" - Ch. A and
       Ch. B. }
00023       \textcolor{vhdlchar}{fidm}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- External Frame ID mode. Frame start at fsync = 0, when 0. Frame start
       at fsync = 1, when 1.}
00024 \textcolor{keyword}{      --Rx interface data }
00025       \textcolor{vhdlchar}{DIQ_h}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00026         \textcolor{vhdlchar}{DIQ_l}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00027 \textcolor{keyword}{      --fifo ports }
00028       \textcolor{vhdlchar}{fifo_wfull}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00029       \textcolor{vhdlchar}{fifo_wrreq}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00030       \textcolor{vhdlchar}{fifo_wdata}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   
00031         \textcolor{vhdlchar}{)};
00032 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{rxiq\_mimo\_ddr};
00033 
00034 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00035 \textcolor{keyword}{-- Architecture}
00036 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00037 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} rxiq_mimo_ddr is
00038 \textcolor{keyword}{--declare signals,  components here}
00039 
00040 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{reg_h_0}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00041 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{reg_l_0}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042 
00043 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos0_chA_0_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos1_chA_0_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00045 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos2_chB_0_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos3_chB_0_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00047 
00048 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos0_chA_1_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00049 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos1_chA_1_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00050 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos2_chB_1_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00051 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos3_chB_1_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00052 
00053 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_pos0_1_cap_en}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00054 
00055 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chA_0_cap_en}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00056 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chA_1_cap_en}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00057 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chB_0_cap_en}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00058 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chB_1_cap_en}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00059 
00060 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chA_0_cap}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00061 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chA_1_cap}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chB_0_cap}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00063 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_chB_1_cap}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00064 
00065 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{diq_valid}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00066 
00067 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux_fifo_wrreq}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00068 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mux_fifo_wdata}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00069 
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_wrreq_reg}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00071 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_wdata_reg}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00072 
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chA_data}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chA_data_valid}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00075 
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chB_data}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chB_data_valid}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00078 
00079 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chAB_data}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00080 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{chAB_data_valid}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00081 
00082 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{state_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{chA\_0\_cap}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{chA\_1\_cap}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{chB\_0\_cap}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{chB\_1\_cap}\textcolor{vhdlchar}{)};
00083 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{state_type};
00084 
00085 
00086 
00087 \textcolor{vhdlkeyword}{begin}
00088  
00089  \textcolor{vhdlchar}{diq_valid}\textcolor{vhdlchar}{<=}   \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reg_h_0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{XOR} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{XNOR} \textcolor{vhdlchar}{
      DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} 
00090                \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reg_l_0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{XOR} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00091             
00092  
00093  reg\_proc : \textcolor{keywordflow}{process}(reset_n, clk)
00094 \textcolor{vhdlkeyword}{    begin}
00095       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00096             reg\_h\_0<=(others=>'0');
00097          reg\_l\_0<=(others=>'0');
00098       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00099             reg\_h\_0<=DIQ\_h; 
00100          reg\_l\_0<=DIQ\_l; 
00101         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00102     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00103     
00104     
00105 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00106 \textcolor{keyword}{--state machine}
00107 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00108 fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n)\textcolor{keywordflow}{begin}
00109     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00110         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00111     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then} 
00112         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_state};
00113     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00114 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00115 
00116 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00117 \textcolor{keyword}{--state machine combo}
00118 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00119 fsm : \textcolor{keywordflow}{process}(current_state, diq_valid, diq_chA_0_cap, diq_chA_1_cap, 
      diq_chB_0_cap, diq_chB_1_cap, ch_en) \textcolor{keywordflow}{begin}
00120     \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_state};
00121     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_state} \textcolor{keywordflow}{is}
00122       
00123         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{ --idle state}
00124          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00125             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00126                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_0\_cap};
00127             \textcolor{keywordflow}{else} 
00128                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_0\_cap};
00129             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00130          \textcolor{keywordflow}{else} 
00131             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00132          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00133       
00134       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{chA\_0\_cap} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00135          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_chA_0_cap} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00136             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00137                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_1\_cap};
00138             \textcolor{keywordflow}{else} 
00139                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_0\_cap};
00140             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00141          \textcolor{keywordflow}{else} 
00142             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_0\_cap};
00143          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00144          
00145       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{chA\_1\_cap} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00146          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00147             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_chA_1_cap} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00148                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_0\_cap};
00149             \textcolor{keywordflow}{else} 
00150                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_1\_cap};
00151             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00152          \textcolor{keywordflow}{else}
00153             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00154          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00155          
00156       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{chB\_0\_cap} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00157          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_chB_0_cap} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00158             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00159                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_1\_cap};
00160             \textcolor{keywordflow}{else} 
00161                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chA\_0\_cap};
00162             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00163          \textcolor{keywordflow}{else} 
00164             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_0\_cap};
00165          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00166          
00167       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{chB\_1\_cap} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00168          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}         
00169             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{diq_chB_1_cap} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00170                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_0\_cap};              
00171             \textcolor{keywordflow}{else} 
00172                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{chB\_1\_cap};
00173             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00174          \textcolor{keywordflow}{else}
00175             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00176          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00177       
00178         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00179             \textcolor{vhdlchar}{next_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{idle};
00180          
00181     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00182 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00183 
00184 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00185 \textcolor{keyword}{-- diq\_ch reg enable signals}
00186 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00187 \textcolor{keywordflow}{process}(current_state, ch_en)
00188 \textcolor{vhdlkeyword}{begin }
00189    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{chA\_0\_cap} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{ch_en} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"11"} \textcolor{keywordflow}{then} 
00190       \textcolor{vhdlchar}{diq_chA_0_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00191    \textcolor{keywordflow}{else} 
00192       \textcolor{vhdlchar}{diq_chA_0_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00193    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00194 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00195 
00196 \textcolor{keywordflow}{process}(current_state)
00197 \textcolor{vhdlkeyword}{begin }
00198    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{chA\_1\_cap} \textcolor{keywordflow}{then} 
00199       \textcolor{vhdlchar}{diq_chA_1_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00200    \textcolor{keywordflow}{else} 
00201       \textcolor{vhdlchar}{diq_chA_1_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00202    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00203 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00204 
00205 \textcolor{keywordflow}{process}(current_state, ch_en, diq_chA_0_cap)
00206 \textcolor{vhdlkeyword}{begin }
00207    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{chB\_0\_cap}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ch_en} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"11"} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_chA_0_cap}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00208       \textcolor{vhdlchar}{diq_chB_0_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00209    \textcolor{keywordflow}{else} 
00210       \textcolor{vhdlchar}{diq_chB_0_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00211    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00212 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00213 
00214 \textcolor{keywordflow}{process}(current_state)
00215 \textcolor{vhdlkeyword}{begin }
00216    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{chB\_1\_cap} \textcolor{keywordflow}{then} 
00217       \textcolor{vhdlchar}{diq_chB_1_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00218    \textcolor{keywordflow}{else} 
00219       \textcolor{vhdlchar}{diq_chB_1_cap_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00220    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00221 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00222     
00223     
00224 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00225 \textcolor{keyword}{-- To capture DIQ data in 0,1 positions (frame start),Ch. A., }
00226 \textcolor{keyword}{-- ch\_en="11" - first FIFO word}
00227 \textcolor{keyword}{-- ch\_en="10" - not captured}
00228 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00229  diq\_chA\_0\_reg\_proc : \textcolor{keywordflow}{process}(reset_n, clk)
00230 \textcolor{vhdlkeyword}{    begin}
00231       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00232          \textcolor{vhdlchar}{diq_pos0_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00233          \textcolor{vhdlchar}{diq_pos1_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00234          \textcolor{vhdlchar}{diq_chA_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00235       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00236             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{fidm} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_chA_0_cap_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00237             \textcolor{vhdlchar}{diq_pos0_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00238             \textcolor{vhdlchar}{diq_pos1_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00239             \textcolor{vhdlchar}{diq_chA_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00240             \textcolor{keywordflow}{else} 
00241                 \textcolor{vhdlchar}{diq_pos0_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos0_chA_0_reg};
00242                 \textcolor{vhdlchar}{diq_pos1_chA_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos1_chA_0_reg};
00243             \textcolor{vhdlchar}{diq_chA_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00244             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00245         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00246     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00247 
00248 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00249 \textcolor{keyword}{-- To capture DIQ data in 0,1 positions (frame start), Ch. A., }
00250 \textcolor{keyword}{-- ch\_en="11" - not captured}
00251 \textcolor{keyword}{-- ch\_en="01" - second fifo word}
00252 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00253  diq\_chA\_1\_reg\_proc : \textcolor{keywordflow}{process}(reset_n, clk)
00254 \textcolor{vhdlkeyword}{    begin}
00255       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00256          \textcolor{vhdlchar}{diq_pos0_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00257          \textcolor{vhdlchar}{diq_pos1_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00258          \textcolor{vhdlchar}{diq_chA_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00259       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00260             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{fidm} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_chA_1_cap_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00261             \textcolor{vhdlchar}{diq_pos0_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00262             \textcolor{vhdlchar}{diq_pos1_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00263             \textcolor{vhdlchar}{diq_chA_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00264             \textcolor{keywordflow}{else} 
00265                 \textcolor{vhdlchar}{diq_pos0_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos0_chA_1_reg};
00266                 \textcolor{vhdlchar}{diq_pos1_chA_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos1_chA_1_reg};
00267             \textcolor{vhdlchar}{diq_chA_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00268             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00269         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00270     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00271 
00272 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00273 \textcolor{keyword}{-- To capture DIQ data in 2,3 positions, Ch. B., second FIFO word}
00274 \textcolor{keyword}{-- ch\_en="11" - second fifo word}
00275 \textcolor{keyword}{-- ch\_en="01" - not captured}
00276 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00277  diq\_chB\_0\_reg\_proc : \textcolor{keywordflow}{process}(reset_n, clk)
00278 \textcolor{vhdlkeyword}{    begin}
00279       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00280          \textcolor{vhdlchar}{diq_pos2_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00281          \textcolor{vhdlchar}{diq_pos3_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00282          \textcolor{vhdlchar}{diq_chB_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00283       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00284             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{keywordflow}{NOT} \textcolor{vhdlchar}{fidm} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_chB_0_cap_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00285             \textcolor{vhdlchar}{diq_pos2_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00286             \textcolor{vhdlchar}{diq_pos3_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00287             \textcolor{vhdlchar}{diq_chB_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00288             \textcolor{keywordflow}{else} 
00289                 \textcolor{vhdlchar}{diq_pos2_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos2_chB_0_reg};
00290                 \textcolor{vhdlchar}{diq_pos3_chB_0_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos3_chB_0_reg};
00291             \textcolor{vhdlchar}{diq_chB_0_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00292             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00293         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00294     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00295 
00296 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00297 \textcolor{keyword}{-- To capture DIQ data in 3 position, Ch. B}
00298 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00299  diq\_chB\_1\_reg\_proc : \textcolor{keywordflow}{process}(reset_n, clk)
00300 \textcolor{vhdlkeyword}{    begin}
00301       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00302          \textcolor{vhdlchar}{diq_pos2_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00303          \textcolor{vhdlchar}{diq_pos3_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00304          \textcolor{vhdlchar}{diq_chB_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00305       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00306             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{keywordflow}{NOT} \textcolor{vhdlchar}{fidm} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{diq_chB_1_cap_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00307             \textcolor{vhdlchar}{diq_pos2_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00308             \textcolor{vhdlchar}{diq_pos3_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{DIQ_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00309             \textcolor{vhdlchar}{diq_chB_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00310             \textcolor{keywordflow}{else} 
00311                 \textcolor{vhdlchar}{diq_pos2_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos2_chB_1_reg};
00312                 \textcolor{vhdlchar}{diq_pos3_chB_1_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos3_chB_1_reg};
00313             \textcolor{vhdlchar}{diq_chB_1_cap}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00314             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00315         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00316     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00317     
00318     
00319 \textcolor{keyword}{--chA\_data       <= diq\_pos0\_chA\_0\_reg & diq\_pos1\_chA\_0\_reg & diq\_pos0\_chA\_1\_reg & diq\_pos1\_chA\_1\_reg;}
00320 \textcolor{vhdlchar}{chA_data}       \textcolor{vhdlchar}{<=}   \textcolor{vhdlchar}{diq_pos1_chA_1_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos0_chA_1_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos1_chA_0_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      diq_pos0_chA_0_reg};     
00321 \textcolor{vhdlchar}{chA_data_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_chA_1_cap};
00322 
00323 \textcolor{keyword}{--chB\_data         <= diq\_pos2\_chB\_0\_reg & diq\_pos3\_chB\_0\_reg & diq\_pos2\_chB\_1\_reg & diq\_pos3\_chB\_1\_reg;}
00324 \textcolor{vhdlchar}{chB_data}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos3_chB_1_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos2_chB_1_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      diq_pos3_chB_0_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos2_chB_0_reg};
00325 \textcolor{vhdlchar}{chB_data_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_chB_1_cap};
00326 
00327 \textcolor{keyword}{--chAB\_data      <= diq\_pos0\_chA\_0\_reg & diq\_pos1\_chA\_0\_reg & diq\_pos2\_chB\_0\_reg & diq\_pos3\_chB\_0\_reg;}
00328 \textcolor{vhdlchar}{chAB_data}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_pos3_chB_0_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos2_chB_0_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{diq_pos1_chA_0_reg} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      diq_pos0_chA_0_reg};
00329 \textcolor{vhdlchar}{chAB_data_valid}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{diq_chB_0_cap};
00330 
00331 
00332 \textcolor{keyword}{--output mux}
00333 \textcolor{vhdlchar}{mux_fifo_wdata} \textcolor{vhdlchar}{<=}   \textcolor{vhdlchar}{chAB_data} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"11"} \textcolor{keywordflow}{else} 
00334                     \textcolor{vhdlchar}{chB_data} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{else}
00335                     \textcolor{vhdlchar}{chA_data};
00336                
00337 \textcolor{vhdlchar}{mux_fifo_wrreq} \textcolor{vhdlchar}{<=}   \textcolor{vhdlchar}{chAB_data_valid} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"11"} \textcolor{keywordflow}{else} 
00338                     \textcolor{vhdlchar}{chB_data_valid} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{else}
00339                     \textcolor{vhdlchar}{chA_data_valid};
00340                      
00341             
00342                      
00343 \textcolor{keyword}{ --output port registers    }
00344 out\_reg\_fifo\_wdata : \textcolor{keywordflow}{process} (reset_n, clk)
00345 \textcolor{vhdlkeyword}{begin}
00346    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00347       \textcolor{vhdlchar}{fifo_wdata_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00348       \textcolor{vhdlchar}{fifo_wrreq_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00349    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00350       \textcolor{vhdlchar}{fifo_wdata_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mux_fifo_wdata};
00351       \textcolor{vhdlchar}{fifo_wrreq_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mux_fifo_wrreq};
00352    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00353 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process}; 
00354 
00355 \textcolor{vhdlchar}{fifo_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{fifo_wdata_reg};
00356 \textcolor{vhdlchar}{fifo_wrreq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{fifo_wrreq_reg} \textcolor{keywordflow}{AND} \textcolor{keywordflow}{NOT} \textcolor{vhdlchar}{fifo_wfull};             
00357 
00358 
00359 
00360         
00361         
00362 
00363 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00364 
00365 
00366 
00367 
00368 
00369 
00370 
\end{DoxyCode}
