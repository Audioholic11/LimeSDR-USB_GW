\subsection{compress\+\_\+v2.\+vhd}
\label{compress__v2_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+packets/compress\+\_\+v2.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+packets/compress\+\_\+v2.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    compress.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: packs data from 12 or 14 bit samples to 16 bit data}
00004 \textcolor{keyword}{-- DATE:    Oct 16, 2015}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity comprlaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }compress_v2 \textcolor{keywordflow}{is}
00016 
00017   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00018 \textcolor{keyword}{        --input ports }
00019         \textcolor{vhdlchar}{clk}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00020         \textcolor{vhdlchar}{reset_n}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00021         \textcolor{vhdlchar}{data_in}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00022         \textcolor{vhdlchar}{data_in_valid}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00023         \textcolor{vhdlchar}{sample_width}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"10"-12bit, "01"-14bit, "00"-16bit;}
00024 \textcolor{keyword}{        --output ports }
00025         \textcolor{vhdlchar}{data_out}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00026         \textcolor{vhdlchar}{data_out_valid}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}       
00027         \textcolor{vhdlchar}{)};
00028 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{compress\_v2};
00029 
00030 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00031 \textcolor{keyword}{-- Architecture}
00032 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00033 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} compress_v2 is
00034 \textcolor{keyword}{--Declare signals,  components here}
00035 
00036 \textcolor{keyword}{--data registers}
00037 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_in_reg}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00038 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{d_out}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{d_out_reg}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00039 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{smpl_cnt}                 \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00040 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{smpl_cnt_max}             \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00041 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{compr_array}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{447} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{compr_array_reg}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{447} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00043 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{tst_out}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{tst_msb}                  \textcolor{vhdlchar}{:} \textcolor{comment}{integer};
00045 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{tst_lsb}                  \textcolor{vhdlchar}{:} \textcolor{comment}{integer};
00046 \textcolor{keywordflow}{signal}  \textcolor{vhdlchar}{wreq_sig}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00047 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wreq_cnt}                 \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00048 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wreq_cnt_max}             \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00049 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_in_valid_reg}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00050   
00051 \textcolor{vhdlkeyword}{begin}
00052 
00053   \textcolor{vhdlchar}{smpl_cnt_max}\textcolor{vhdlchar}{<=}\textcolor{vhdllogic}{"0011"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{sample_width}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{else} 
00054                 \textcolor{vhdllogic}{"0111"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{sample_width}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"01"} \textcolor{keywordflow}{else}
00055                 \textcolor{vhdllogic}{"0000"};
00056 \textcolor{keyword}{--  tst\_msb<=to\_integer(smpl\_cnt*12+11);}
00057 \textcolor{keyword}{--  tst\_lsb<=to\_integer(smpl\_cnt*12);}
00058   
00059   
00060 \textcolor{keyword}{--  tst\_out<= compr\_array(15 downto 0) when wreq\_cnt=0 else }
00061 \textcolor{keyword}{--              compr\_array(31 downto 16) when wreq\_cnt=1 else}
00062 \textcolor{keyword}{--              compr\_array(47 downto 32) when wreq\_cnt=2 else}
00063 \textcolor{keyword}{--              compr\_array(63 downto 48) when wreq\_cnt=3 else}
00064 \textcolor{keyword}{--              compr\_array(79 downto 64) when wreq\_cnt=4 else}
00065 \textcolor{keyword}{--              compr\_array(95 downto 80) when wreq\_cnt=5 else}
00066 \textcolor{keyword}{--              compr\_array(111 downto 96) when wreq\_cnt=6 else}
00067 \textcolor{keyword}{--              compr\_array(127 downto 112);  }
00068 
00069   \textcolor{vhdlchar}{tst_out}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{else} 
00070           \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{127} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{64}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{else}
00071           \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{191} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{128}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{else}
00072                 \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{255} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{192}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{else}
00073                 \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{319} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{256}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{else}
00074                 \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{383} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{320}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{else}
00075                 \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{447} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{384}\textcolor{vhdlchar}{)};            
00076   
00077 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00078 \textcolor{keyword}{-- Sample counter}
00079 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00080  \textcolor{keywordflow}{process} (clk, reset_n)
00081 \textcolor{vhdlkeyword}{    begin}
00082 \textcolor{keyword}{        --}
00083         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00084             \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00085             \textcolor{vhdlchar}{data_in_valid_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00086         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00087           \textcolor{vhdlchar}{data_in_valid_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{data_in_valid};
00088         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{data_in_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00089           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{<}\textcolor{vhdlchar}{smpl_cnt_max} \textcolor{keywordflow}{then}  
00090             \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00091           \textcolor{keywordflow}{else} 
00092             \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00093           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00094         \textcolor{keywordflow}{else} 
00095           \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{smpl_cnt};
00096         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00097         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00098     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00099     
00100     
00101 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00102 \textcolor{keyword}{-- wreq counter}
00103 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00104  \textcolor{keywordflow}{process} (clk, reset_n)
00105 \textcolor{vhdlkeyword}{    begin}
00106 \textcolor{keyword}{        --}
00107         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00108             \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00109         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00110         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wreq_sig}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00111           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{<}\textcolor{vhdlchar}{smpl_cnt_max}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}  
00112             \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00113           \textcolor{keywordflow}{else} 
00114             \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00115           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00116         \textcolor{keywordflow}{else} 
00117           \textcolor{vhdlchar}{wreq_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{wreq_cnt};
00118         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00119         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00120     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00121     
00122 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00123 \textcolor{keyword}{-- Sample counter}
00124 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00125  \textcolor{keywordflow}{process} (clk, reset_n)
00126 \textcolor{vhdlkeyword}{    begin}
00127 \textcolor{keyword}{        --}
00128         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00129             \textcolor{vhdlchar}{wreq_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00130         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00131         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{data_in_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{>=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
00132           \textcolor{vhdlchar}{wreq_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}; 
00133         \textcolor{keywordflow}{else} 
00134           \textcolor{vhdlchar}{wreq_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}; 
00135         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00136         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00137     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};    
00138     
00139     
00140     
00141 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00142 \textcolor{keyword}{-- shift reg}
00143 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00144 \textcolor{keyword}{-- process (clk, reset\_n)}
00145 \textcolor{keyword}{--  begin}
00146 \textcolor{keyword}{--      --}
00147 \textcolor{keyword}{--      if (reset\_n = '0') then}
00148 \textcolor{keyword}{--              compr\_array\_reg<=(others=>'0');}
00149 \textcolor{keyword}{--      elsif (clk'event and clk = '1') then}
00150 \textcolor{keyword}{--        if data\_in\_valid='1' and smpl\_cnt>1 then}
00151 \textcolor{keyword}{--          compr\_array\_reg<=std\_logic\_vector(unsigned(compr\_array) srl 16);}
00152 \textcolor{keyword}{--        else }
00153 \textcolor{keyword}{--          compr\_array\_reg<=compr\_array;}
00154 \textcolor{keyword}{--        end if;}
00155 \textcolor{keyword}{--      end if;}
00156 \textcolor{keyword}{--  end process;    }
00157     
00158   
00159 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00160 \textcolor{keyword}{-- Sample compression}
00161 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00162  \textcolor{keywordflow}{process} (clk, reset_n)
00163 \textcolor{vhdlkeyword}{    begin}
00164 \textcolor{keyword}{        --}
00165         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00166             \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00167         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}          
00168         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{data_in_valid}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00169             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sample_width}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{then} 
00170 \textcolor{keyword}{              --compr\_array(to\_integer(smpl\_cnt*12+11) downto to\_integer(smpl\_cnt*12)) <= data\_in(11 downto
       0);}
00171                   \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{48+47} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      smpl_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{48}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{data_in}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{47} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00172             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sample_width}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"01"} \textcolor{keywordflow}{then}
00173 \textcolor{keyword}{              --compr\_array(to\_integer(smpl\_cnt*14+13) downto to\_integer(smpl\_cnt*13)) <= data\_in(13 downto
       0);}
00174                   \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{smpl_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{56+55} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      smpl_cnt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{56}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{data_in}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{55} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00175             \textcolor{keywordflow}{else}
00176 \textcolor{keyword}{              --compr\_array(15 downto 0)<= data\_in;}
00177                   \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{data_in};
00178           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00179         \textcolor{keywordflow}{else} 
00180           \textcolor{vhdlchar}{compr_array}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{compr_array};
00181         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00182         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00183     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process}; 
00184 
00185 \textcolor{vhdlchar}{data_out_valid}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{data_in_valid_reg} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{sample_width}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{wreq_sig};
00186 \textcolor{vhdlchar}{data_out}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tst_out};
00187   
00188 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00189 
00190 
00191 
00192 
\end{DoxyCode}
