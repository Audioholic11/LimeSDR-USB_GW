\subsection{periphcfg.\+vhd}
\label{periphcfg_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/spi/periphcfg.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/spi/periphcfg.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    periphcfg.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: Serial configuration interface to control TX modules}
00004 \textcolor{keyword}{-- DATE:    June 07, 2007}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:   }
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 
00009 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00010 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00011 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00012 \textcolor{vhdlkeyword}{use }work.mem_package.\textcolor{keywordflow}{all};
00013 
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keyword}{-- Entity declaration}
00016 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00017 \textcolor{keywordflow}{entity }periphcfg \textcolor{keywordflow}{is}
00018     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00019 \textcolor{keyword}{        -- Address and location of this module}
00020 \textcolor{keyword}{        -- Will be hard wired at the top level}
00021         \textcolor{vhdlchar}{maddress}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00022         \textcolor{vhdlchar}{mimo_en} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- MIMO enable, from TOP SPI (always 1)}
00023     
00024 \textcolor{keyword}{        -- Serial port IOs}
00025         \textcolor{vhdlchar}{sdin}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- Data in}
00026         \textcolor{vhdlchar}{sclk}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- Data clock}
00027         \textcolor{vhdlchar}{sen} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- Enable signal (active low)}
00028         \textcolor{vhdlchar}{sdout}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};\textcolor{keyword}{    -- Data out}
00029     
00030 \textcolor{keyword}{        -- Signals coming from the pins or top level serial interface}
00031         \textcolor{vhdlchar}{lreset}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- Logic reset signal, resets logic cells only  (use only one reset)}
00032         \textcolor{vhdlchar}{mreset}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- Memory reset signal, resets configuration memory only (use only one
       reset)}
00033         
00034         \textcolor{vhdlchar}{oen}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};\textcolor{keyword}{ --nc}
00035         \textcolor{vhdlchar}{stateo}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00036         
00037         \textcolor{vhdlchar}{BOARD_GPIO_OVRD}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00038         \textcolor{vhdlchar}{BOARD_GPIO_RD}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00039         \textcolor{vhdlchar}{BOARD_GPIO_DIR}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00040         \textcolor{vhdlchar}{BOARD_GPIO_VAL}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00041         \textcolor{vhdlchar}{PERIPH_INPUT_RD_0}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042         \textcolor{vhdlchar}{PERIPH_INPUT_RD_1}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00043         \textcolor{vhdlchar}{PERIPH_OUTPUT_OVRD_0} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};   
00044         \textcolor{vhdlchar}{PERIPH_OUTPUT_VAL_0} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00045       \textcolor{vhdlchar}{PERIPH_OUTPUT_OVRD_1}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046       \textcolor{vhdlchar}{PERIPH_OUTPUT_VAL_1}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} 
00047     \textcolor{vhdlchar}{)};
00048 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{periphcfg};
00049 
00050 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00051 \textcolor{keyword}{-- Architecture}
00052 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00053 \textcolor{keywordflow}{architecture} periphcfg\_arch \textcolor{keywordflow}{of} periphcfg is
00054 
00055     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst_reg}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{     -- Instruction register}
00056     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst_reg_en}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00057 
00058     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{din_reg}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{      -- Data in register}
00059     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{din_reg_en}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00060     
00061     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{     -- Data out register}
00062     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dout_reg_sen}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{dout_reg_len}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00063     
00064     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{marray32x16};\textcolor{keyword}{                                    -- Config memory}
00065     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mem_we}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00066     
00067     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{oe}\textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                       -- Tri state buffers control}
00068     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{spi_config_data_rev}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{143} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00069     
00070 \textcolor{keyword}{    -- Components}
00071 \textcolor{vhdlkeyword}{    use }work.mcfg_components.mcfg32wm\_fsm;
00072     \textcolor{keywordflow}{for} \textcolor{keywordflow}{all}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{mcfg32wm\_fsm} \textcolor{keywordflow}{use} \textcolor{keywordflow}{entity} \textcolor{vhdlchar}{work}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mcfg32wm\_fsm}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mcfg32wm\_fsm\_arch}\textcolor{vhdlchar}{)};
00073 
00074 \textcolor{vhdlkeyword}{begin}
00075 
00076 
00077 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00078 \textcolor{keyword}{    -- Finite state machines}
00079 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00080     fsm: mcfg32wm_fsm \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}( 
00081         address => maddress, mimo_en => mimo_en, inst_reg => inst_reg, sclk => 
      sclk, sen => sen, reset => lreset,
00082         inst_reg_en => inst_reg_en, din_reg_en => din_reg_en, dout_reg_sen => 
      dout_reg_sen,
00083         dout_reg_len => dout_reg_len, mem_we => mem_we, oe => oe, stateo => 
      stateo\textcolor{vhdlchar}{)};
00084         
00085 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00086 \textcolor{keyword}{    -- Instruction register}
00087 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00088     inst\_reg\_proc: \textcolor{keywordflow}{process}(sclk, lreset)
00089         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{:} \textcolor{comment}{integer};
00090 \textcolor{vhdlkeyword}{    begin}
00091         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{lreset} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00092             inst\_reg <= (\textcolor{keywordflow}{others} => '0');
00093         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sclk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00094             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{inst_reg_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00095                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00096                     inst\_reg(i) <= inst\_reg(i-1);
00097                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00098                 inst\_reg(\textcolor{vhdllogic}{0}) <= sdin;
00099             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00100         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00101     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{inst\_reg\_proc};
00102 
00103 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00104 \textcolor{keyword}{    -- Data input register}
00105 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00106     din\_reg\_proc: \textcolor{keywordflow}{process}(sclk, lreset)
00107         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{:} \textcolor{comment}{integer};
00108 \textcolor{vhdlkeyword}{    begin}
00109         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{lreset} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00110             \textcolor{vhdlchar}{din_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00111         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sclk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00112             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{din_reg_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00113                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00114                     \textcolor{vhdlchar}{din_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{din_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
00115                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00116                 \textcolor{vhdlchar}{din_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sdin};
00117             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00118         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00119     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{din\_reg\_proc};
00120 
00121 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00122 \textcolor{keyword}{    -- Data output register}
00123 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00124     dout\_reg\_proc: \textcolor{keywordflow}{process}(sclk, lreset)
00125         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{:} \textcolor{comment}{integer};
00126 \textcolor{vhdlkeyword}{    begin}
00127         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{lreset} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00128             \textcolor{vhdlchar}{dout_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00129         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sclk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00130 \textcolor{keyword}{            -- Shift operation}
00131             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dout_reg_sen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00132                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00133                     \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
00134                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00135                 \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15}\textcolor{vhdlchar}{)};
00136 \textcolor{keyword}{            -- Load operation}
00137             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dout_reg_len} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00138                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{inst_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}\textcolor{keyword}{    -- mux read-only outputs}
00139                     \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"00010"} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{dout_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{BOARD_GPIO_RD};
00140                     \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"01000"} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{dout_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{PERIPH_INPUT_RD_0};
00141                     \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"01001"} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{dout_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{PERIPH_INPUT_RD_1};
00142                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}  \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{dout_reg} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{inst_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00143                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00144             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};               
00145         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00146     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{dout\_reg\_proc};
00147     
00148 \textcolor{keyword}{    -- Tri state buffer to connect multiple serial interfaces in parallel}
00149 \textcolor{keyword}{    --sdout <= dout\_reg(7) when oe = '1' else 'Z';}
00150 
00151 \textcolor{keyword}{--  sdout <= dout\_reg(7);}
00152 \textcolor{keyword}{--  oen <= oe;}
00153 
00154     \textcolor{vhdlchar}{sdout} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dout_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{oe};
00155     \textcolor{vhdlchar}{oen} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{oe};
00156 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00157 \textcolor{keyword}{    -- Configuration memory}
00158 \textcolor{keyword}{    -- --------------------------------------------------------------------------------------------- }
00159     ram: \textcolor{keywordflow}{process}(sclk, mreset)
00160 \textcolor{vhdlkeyword}{    begin}
00161 \textcolor{keyword}{        -- Defaults}
00162         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mreset} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}    
00163             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"1111111111111111"};\textcolor{keyword}{ --  0 free, BOARD\_GPIO\_OVRD[15:0]}
00164             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00165             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, BOARD\_GPIO\_RD[15:0]}
00166             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00167             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, BOARD\_GPIO\_DIR[15:0]}
00168             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00169             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, BOARD\_GPIO\_VAL[15:0]}
00170             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00171             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_INPUT\_RD\_0}
00172             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_INPUT\_RD\_1}
00173             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00174             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved         }
00175             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_OUTPUT\_OVRD\_0}
00176             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{13}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_OUTPUT\_VAL\_0}
00177             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{14}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_OUTPUT\_OVRD\_1}
00178             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, PERIPH\_OUTPUT\_VAL\_1}
00179             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00180             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{17}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00181             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{18}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00182             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{19}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00183             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{20}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00184             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{21}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00185             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{22}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00186             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00187             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{24}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00188             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{25}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00189             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{26}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00190             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{27}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00191             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{28}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00192             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{29}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00193             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{30}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00194             \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"0000000000000000"};\textcolor{keyword}{ --  0 free, Reserved}
00195 
00196             
00197         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sclk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sclk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00198                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mem_we} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00199                     \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{inst_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{din_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{14} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      sdin};
00200                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00201                 
00202                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dout_reg_len} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00203 \textcolor{keyword}{--                  for\_loop : for i in 0 to 3 loop                 }
00204 \textcolor{keyword}{--                      mem(3)(i+4) <= not mem(3)(i);}
00205 \textcolor{keyword}{--                  end loop;}
00206                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00207                 
00208         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00209     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{ram};
00210     
00211 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00212 \textcolor{keyword}{    -- Decoding logic}
00213 \textcolor{keyword}{    -- ---------------------------------------------------------------------------------------------}
00214         \textcolor{vhdlchar}{BOARD_GPIO_OVRD}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00215         \textcolor{vhdlchar}{BOARD_GPIO_DIR}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00216         \textcolor{vhdlchar}{BOARD_GPIO_VAL}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00217         
00218         \textcolor{vhdlchar}{PERIPH_OUTPUT_OVRD_0}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00219       \textcolor{vhdlchar}{PERIPH_OUTPUT_VAL_0}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{13}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00220       \textcolor{vhdlchar}{PERIPH_OUTPUT_OVRD_1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{14}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00221       \textcolor{vhdlchar}{PERIPH_OUTPUT_VAL_1}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00222         
00223         
00224 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{periphcfg\_arch};
\end{DoxyCode}
