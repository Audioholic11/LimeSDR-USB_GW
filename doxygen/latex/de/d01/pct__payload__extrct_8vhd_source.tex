\subsection{pct\+\_\+payload\+\_\+extrct.\+vhd}
\label{pct__payload__extrct_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/wfm\+\_\+ram\+\_\+buffer/pct\+\_\+payload\+\_\+extrct.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/wfm\+\_\+ram\+\_\+buffer/pct\+\_\+payload\+\_\+extrct.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    pct\_payload\_extrct.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: extracts only data payload from stream packet}
00004 \textcolor{keyword}{-- DATE:    June 17, 2016}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }pct_payload_extrct \textcolor{keywordflow}{is}
00016     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{data_w}         \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
00017                 \textcolor{vhdlchar}{header_size}     \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};\textcolor{keyword}{ --pct header size in bytes }
00018                 \textcolor{vhdlchar}{pct_size}            \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4096}\textcolor{keyword}{ --pct size in bytes}
00019         \textcolor{vhdlchar}{)};
00020   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00021 \textcolor{keyword}{      --input ports }
00022         \textcolor{vhdlchar}{clk}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00023         \textcolor{vhdlchar}{reset_n}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00024         \textcolor{vhdlchar}{pct_data}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00025         \textcolor{vhdlchar}{pct_wr}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00026         \textcolor{vhdlchar}{pct_payload_data}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00027         \textcolor{vhdlchar}{pct_payload_valid}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00028         \textcolor{vhdlchar}{pct_payload_dest}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}
00029     
00030 
00031 \textcolor{keyword}{      --output ports }
00032         
00033         \textcolor{vhdlchar}{)};
00034 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{pct\_payload\_extrct};
00035 
00036 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00037 \textcolor{keyword}{-- Architecture}
00038 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00039 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} pct_payload_extrct is
00040 \textcolor{keyword}{--declare signals,  components here}
00041 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wr_cnt} \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042 
00043 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{hdr_payload_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{data_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044  
00045 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{payload_dest_reg} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{payload_size_reg} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00047 
00048   
00049 \textcolor{vhdlkeyword}{begin}
00050 
00051 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00052 \textcolor{keyword}{-- Pcket write operation counter}
00053 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00054   \textcolor{keywordflow}{process}(reset_n, clk)
00055 \textcolor{vhdlkeyword}{    begin}
00056       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00057         \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}; 
00058       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00059           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_wr}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}    
00060                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{payload_size_reg}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{+}\textcolor{vhdlchar}{header_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{
      data_w} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then} 
00061                     \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00062                 \textcolor{keywordflow}{else} 
00063                     \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00064                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00065             \textcolor{keywordflow}{else} 
00066                 \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{wr_cnt};
00067             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00068         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00069     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00070 
00071 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00072 \textcolor{keyword}{-- to capture header values}
00073 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00074   \textcolor{keywordflow}{process}(reset_n, clk)
00075 \textcolor{vhdlkeyword}{    begin}
00076         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00077             \textcolor{vhdlchar}{hdr_payload_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00078         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00079             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{pct_wr}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00080                 \textcolor{vhdlchar}{hdr_payload_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{pct_data};
00081             \textcolor{keywordflow}{else} 
00082                 \textcolor{vhdlchar}{hdr_payload_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{hdr_payload_reg};
00083             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00084         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00085     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00086 
00087 \textcolor{vhdlchar}{payload_dest_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{hdr_payload_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)};
00088 \textcolor{vhdlchar}{payload_size_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{hdr_payload_reg}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)};
00089 
00090 
00091 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00092 \textcolor{keyword}{-- payload\_wr signal process}
00093 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00094 \textcolor{keywordflow}{process} (wr_cnt,payload_size_reg, pct_wr)
00095 \textcolor{vhdlkeyword}{begin }
00096         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{>}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{wr_cnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{payload_size_reg}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{+}\textcolor{vhdlchar}{
      header_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{data_w} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then} 
00097             \textcolor{vhdlchar}{pct_payload_valid}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_wr};
00098         \textcolor{keywordflow}{else} 
00099             \textcolor{vhdlchar}{pct_payload_valid}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00100         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};      
00101 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00102 
00103 \textcolor{vhdlchar}{pct_payload_data}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{pct_data};
00104 \textcolor{vhdlchar}{pct_payload_dest}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{payload_dest_reg};
00105 
00106 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00107 
00108 
00109 
00110 
00111 
00112 
\end{DoxyCode}
