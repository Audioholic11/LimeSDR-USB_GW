\subsection{rx\+\_\+path.\+vhd}
\label{rx__path_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+modules/rx\+\_\+path.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/rx\+\_\+modules/rx\+\_\+path.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    rx\_path.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: Forms RX packets}
00004 \textcolor{keyword}{-- DATE:    Sep 14, 2016}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }rx_path \textcolor{keywordflow}{is}
00016 \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(}
00017         \textcolor{vhdlchar}{dev_family}      \textcolor{vhdlchar}{:} \textcolor{comment}{STRING} \textcolor{vhdlchar}{:=} \textcolor{keyword}{"Cyclone IV E"};
00018         \textcolor{vhdlchar}{diq_width}       \textcolor{vhdlchar}{:} \textcolor{comment}{INTEGER} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00019         \textcolor{vhdlchar}{infifo_wrsize}   \textcolor{vhdlchar}{:} \textcolor{comment}{INTEGER} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00020         \textcolor{vhdlchar}{outfifo_size}    \textcolor{vhdlchar}{:} \textcolor{comment}{INTEGER} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13}
00021         \textcolor{vhdlchar}{)};
00022   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00023 \textcolor{keyword}{      --input ports}
00024         \textcolor{vhdlchar}{clk_iopll}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00025         \textcolor{vhdlchar}{clk_iodirect}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00026         \textcolor{vhdlchar}{clk}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00027       \textcolor{vhdlchar}{reset_n}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00028         \textcolor{vhdlchar}{en}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00029 \textcolor{keyword}{        --data input }
00030         \textcolor{vhdlchar}{DIQ2}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{diq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00031         \textcolor{vhdlchar}{DIQ2_IQSEL2}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00032 \textcolor{keyword}{        --config signals}
00033         \textcolor{vhdlchar}{drct_clk_en}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00034         \textcolor{vhdlchar}{data_src}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00035         \textcolor{vhdlchar}{fr_start}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00036         \textcolor{vhdlchar}{mimo_en}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00037         \textcolor{vhdlchar}{ch_en}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00038         \textcolor{vhdlchar}{smpl_width}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00039 \textcolor{keyword}{        --other}
00040         \textcolor{vhdlchar}{pct_clr_detect}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00041         \textcolor{vhdlchar}{clr_pct_loss_flag}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00042         \textcolor{vhdlchar}{clr_smpl_nr}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};     
00043 \textcolor{keyword}{        --pct data}
00044         \textcolor{vhdlchar}{outfifo_full}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00045         \textcolor{vhdlchar}{outfifo_wrusedw} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{outfifo_size}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046         \textcolor{vhdlchar}{outfifo_wr}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00047         \textcolor{vhdlchar}{outfifo_data}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00048         \textcolor{vhdlchar}{wrrxfifo_wr}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}
00049         
00050         \textcolor{vhdlchar}{)};
00051 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{rx\_path};
00052 
00053 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00054 \textcolor{keyword}{-- Architecture}
00055 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00056 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} rx_path is
00057 \textcolor{keyword}{--declare signals,  components here}
00058 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{my_sig_name} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00059 
00060 \textcolor{keyword}{-- synchronized enable and reset for other modules}
00061 
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{en_reg}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{en_synch}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00063 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rstn_with_synch_en}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00064 
00065 \textcolor{keyword}{--inst1 (diq2\_samples) signals}
00066 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_diq}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{diq_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00067 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_fifo_wr}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00068 
00069 \textcolor{keyword}{--inst2 signals}
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_wrfull}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00071 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_q}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{diq_width}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{4-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00072 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_rdempty}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst2_rdusedw}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{infifo_wrsize}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 
00075 \textcolor{keyword}{--inst3 signals }
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst3_rdreq}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst3_diq0}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00078 
00079 \textcolor{keywordflow}{component} diq2_samples \textcolor{keywordflow}{is}
00080     \textcolor{keywordflow}{GENERIC} (dev_family     : \textcolor{comment}{string}        := \textcolor{keyword}{"Cyclone IV E"};
00081                 diq_width       : \textcolor{comment}{integer}   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00082                 ch_num          : \textcolor{comment}{integer}   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00083                 fifo_wrsize     : \textcolor{comment}{integer}   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}
00084                 );
00085   \textcolor{keywordflow}{port} (
00086 \textcolor{keyword}{      --input ports}
00087         clk_iopll       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00088         clk_iodirect    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}; 
00089       clk               : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00090       reset_n           : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00091         en                  : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00092 \textcolor{keyword}{        --data in ports}
00093         rxiq                : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(diq_width\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00094         rxiqsel         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00095 \textcolor{keyword}{        --config ports}
00096         data_src            : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}; \textcolor{keyword}{--selects between test data  - 1 and real data - 0  }
00097         fr_start            : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00098         mimo_en         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00099         ch_en               : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(ch_num\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00100         fifo_full       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00101         fifo_wrusedw    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(fifo_wrsize\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});  
00102 \textcolor{keyword}{      --output ports to fifo}
00103         diq             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}*diq_width\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00104         fifo_wr         : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}
00105         );
00106 \textcolor{keywordflow}{end} \textcolor{keywordflow}{component};
00107 
00108  \textcolor{keywordflow}{component} fifo_inst \textcolor{keywordflow}{is}
00109   \textcolor{keywordflow}{generic}(dev_family         : \textcolor{comment}{string}  := \textcolor{keyword}{"Cyclone IV E"};
00110           wrwidth         : \textcolor{comment}{integer} := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
00111           wrusedw_witdth  : \textcolor{comment}{integer} := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}; \textcolor{keyword}{--12=2048 words }
00112           rdwidth         : \textcolor{comment}{integer} := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{48};
00113           rdusedw_width   : \textcolor{comment}{integer} := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
00114           show_ahead      : \textcolor{comment}{string}  := \textcolor{keyword}{"ON"}
00115   );  
00116   \textcolor{keywordflow}{port} (
00117 \textcolor{keyword}{      --input ports }
00118       reset_n       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00119       wrclk         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00120       wrreq         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00121       data          : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(wrwidth\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00122       wrfull        : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00123         wrempty       : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00124       wrusedw       : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}(wrusedw_witdth\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00125       rdclk          : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00126       rdreq         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00127       q             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}(rdwidth\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00128       rdempty       : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00129       rdusedw       : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}(rdusedw_width\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0})     
00130         );
00131 \textcolor{keywordflow}{end} \textcolor{keywordflow}{component};
00132 
00133 \textcolor{keywordflow}{component} rx_pct_data_v2 \textcolor{keywordflow}{is}
00134   \textcolor{keywordflow}{generic} (infifo_rdsize  : \textcolor{comment}{integer} :=\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
00135            outfifo_wrsize : \textcolor{comment}{integer} :=\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
00136            ch_num         : \textcolor{comment}{integer} :=\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00137            pct_size       : \textcolor{comment}{integer} :=\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4096}\textcolor{keyword}{ --in bytes}
00138             );
00139   \textcolor{keywordflow}{port} (
00140 \textcolor{keyword}{        --input ports }
00141         clk             : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00142         reset_n         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00143         diq0            : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00144 \textcolor{keyword}{        --infifo}
00145         infifo_empty    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}; 
00146         infifo_rdusedw  : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(infifo_rdsize\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00147         infifo_rd       : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00148 \textcolor{keyword}{        --outfifo}
00149         outfifo_full    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}; 
00150         outfifo_wrusedw : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(outfifo_wrsize\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00151         outfifo_wr      : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00152         outfifo_data    : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00153 \textcolor{keyword}{        --general}
00154         en              : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00155         ch_en           : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(ch_num\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0});
00156         mimo_en         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00157         sample_width    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}); \textcolor{keyword}{--"00"-16bit, "01"-14bit, "10"-14bit;}
00158         tx_pct_loss     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}; \textcolor{keyword}{-- clock domain of this signal has to be more than 2x slover,
       othervise }
00159 \textcolor{keyword}{                                       --implement synchronizer with handshaking}
00160         tx_pct_loss_clr : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00161           pct_wr_end        : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00162           clr_smpl_nr       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
00163         
00164         
00165         );
00166 \textcolor{keywordflow}{end} \textcolor{keywordflow}{component};
00167 
00168 \textcolor{vhdlkeyword}{begin}
00169 
00170 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00171 \textcolor{keyword}{-- To synchronize enable to clk domain}
00172 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00173   \textcolor{keywordflow}{process}(reset_n, clk)
00174 \textcolor{vhdlkeyword}{    begin}
00175       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00176         \textcolor{vhdlchar}{en_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00177             \textcolor{vhdlchar}{en_synch}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}; 
00178       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00179         \textcolor{vhdlchar}{en_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{en};
00180             \textcolor{vhdlchar}{en_synch}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{en_reg}; 
00181         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00182     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00183  
00184 \textcolor{vhdlchar}{rstn_with_synch_en}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{reset_n} \textcolor{keywordflow}{and}  \textcolor{vhdlchar}{en_synch};
00185 
00186 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00187 \textcolor{keyword}{-- Component instances}
00188 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00189 inst1 : diq2_samples
00190 \textcolor{keywordflow}{GENERIC} \textcolor{keywordflow}{MAP}(
00191             ch_num      => \textcolor{vhdllogic}{2},
00192             dev_family  => dev_family,
00193             diq_width   => diq_width,
00194             fifo_wrsize => infifo_wrsize
00195             \textcolor{vhdlchar}{)}
00196 \textcolor{keywordflow}{PORT} \textcolor{keywordflow}{MAP}(
00197         clk_iopll       => clk_iopll,
00198         clk_iodirect    => clk_iodirect,
00199         clk             => clk,
00200         reset_n         => rstn_with_synch_en,
00201         en                  => rstn_with_synch_en,
00202         rxiq                => DIQ2,
00203         rxiqsel         => DIQ2_IQSEL2,
00204         data_src            => data_src,
00205         fr_start        => fr_start,
00206         mimo_en         => mimo_en,
00207         ch_en               => ch_en\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{DOWNTO} \textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)},
00208         fifo_full       => inst2_wrfull,
00209         fifo_wrusedw    => \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}=>'0'\textcolor{vhdlchar}{)},
00210         diq                 => inst1_diq,
00211         fifo_wr             => inst1_fifo_wr
00212 \textcolor{vhdlchar}{)};
00213 
00214 inst2 : fifo_inst
00215 \textcolor{keywordflow}{GENERIC} \textcolor{keywordflow}{MAP}(
00216             dev_family      => dev_family,
00217             rdusedw_width   => infifo_wrsize-\textcolor{vhdllogic}{1},
00218             rdwidth             => diq\_width*4,
00219             show_ahead      => \textcolor{keyword}{"ON"},
00220             wrusedw_witdth => infifo_wrsize,
00221             wrwidth             => diq\_width*2
00222             \textcolor{vhdlchar}{)}
00223 \textcolor{keywordflow}{PORT} \textcolor{keywordflow}{MAP}(
00224             reset_n             => rstn_with_synch_en,
00225             wrclk           => clk,
00226             wrreq           => inst1_fifo_wr,
00227             data                => inst1_diq,
00228             rdclk           => clk,
00229             rdreq           => inst3_rdreq,
00230             wrfull          => inst2_wrfull,
00231             wrempty         => \textcolor{keywordflow}{open},
00232             wrusedw         => \textcolor{keywordflow}{open}, 
00233             q                   => inst2_q,
00234             rdempty             => inst2_rdempty,
00235             rdusedw             => inst2_rdusedw\textcolor{vhdlchar}{)};
00236  
00237 inst3 : rx_pct_data_v2
00238 \textcolor{keywordflow}{GENERIC} \textcolor{keywordflow}{MAP}(
00239             infifo_rdsize       => infifo_wrsize-\textcolor{vhdllogic}{1},
00240             outfifo_wrsize  => outfifo_size,
00241             ch_num              => \textcolor{vhdllogic}{16},
00242             pct_size            => \textcolor{vhdllogic}{4096}
00243             \textcolor{vhdlchar}{)}
00244 \textcolor{keywordflow}{PORT} \textcolor{keywordflow}{MAP}(
00245             clk                     => clk,
00246             reset_n                 => rstn_with_synch_en,
00247             diq0                    => inst3_diq0,
00248             infifo_empty        => inst2_rdempty,
00249             infifo_rdusedw  => inst2_rdusedw,
00250             infifo_rd           => inst3_rdreq,
00251             outfifo_full        => outfifo_full,
00252             outfifo_wrusedw     => outfifo_wrusedw,
00253             outfifo_wr          => outfifo_wr,
00254             outfifo_data        => outfifo_data,
00255             en                  => rstn_with_synch_en,
00256             ch_en               => ch_en,
00257             mimo_en                 => mimo_en,
00258             sample_width        => smpl_width,
00259             tx_pct_loss         => pct_clr_detect,
00260             tx_pct_loss_clr     => clr_pct_loss_flag,
00261             pct_wr_end          => \textcolor{keywordflow}{open},
00262             clr_smpl_nr         => clr_smpl_nr
00263 
00264             \textcolor{vhdlchar}{)};
00265  
00266 inst3\_diq0<=inst2\_q(\textcolor{vhdllogic}{47} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{36}) & "\textcolor{vhdllogic}{0000}" & 
00267                 inst2\_q(\textcolor{vhdllogic}{35} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{24}) & "\textcolor{vhdllogic}{0000}" & 
00268                 inst2\_q(\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{12}) & "\textcolor{vhdllogic}{0000}" & 
00269                 inst2\_q(\textcolor{vhdllogic}{11} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})  & "\textcolor{vhdllogic}{0000}";
00270                 
00271                 
00272 \textcolor{keyword}{----12bit samples are packed to 16 bit words with sign extension }
00273 \textcolor{keyword}{--inst3\_diq0<=(63 downto 60 => inst2\_q(47)) & inst2\_q(47 downto 36) & }
00274 \textcolor{keyword}{--              (47 downto 44 => inst2\_q(35)) & inst2\_q(35 downto 24) & }
00275 \textcolor{keyword}{--              (31 downto 28 => inst2\_q(23)) & inst2\_q(23 downto 12) & }
00276 \textcolor{keyword}{--              (15 downto 12 => inst2\_q(11)) & inst2\_q(11 downto 0);               }
00277 
00278 \textcolor{vhdlchar}{wrrxfifo_wr}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{inst1_fifo_wr};
00279 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00280 
00281 
\end{DoxyCode}
