\subsection{ddr2\+\_\+phy\+\_\+report\+\_\+timing\+\_\+core.\+tcl}
\label{ddr2__phy__report__timing__core_8tcl_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/ip/ddr2/ddr2\+\_\+phy\+\_\+report\+\_\+timing\+\_\+core.\+tcl@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/ip/ddr2/ddr2\+\_\+phy\+\_\+report\+\_\+timing\+\_\+core.\+tcl}}

\begin{DoxyCode}
00001 \textcolor{comment}{##############################################################}
00002 \textcolor{comment}{}\textcolor{comment}{## Write Timing Analysis}
00003 \textcolor{comment}{}\textcolor{comment}{##############################################################}
00004 \textcolor{comment}{}
00005 \textcolor{keyword}{proc} perform\_flexible\_write\_launch\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name MP\_name IP\_name\} \{
00006 
00007    \textcolor{comment}{################################################################################}
00008 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This timing analysis covers the write timing constraints.  It includes support }
00009 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# for uncalibrated and calibrated write paths.  The analysis starts by running a }
00010 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# conventional timing analysis for the write paths and then adds support for }
00011 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# topologies and IP options which are unique to source-synchronous data transfers.  }
00012 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The support for further topologies includes common clock paths in DDR3 as well as }
00013 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# correlation between DQ and DQS.  The support for further IP includes support for }
00014 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# write-deskew calibration.}
00015 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
00016 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# During write deskew calibration, the IP will adjust delay chain settings along }
00017 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# each signal path to reduce the skew between DQ pins and to centre align the DQS }
00018 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# strobe within the DVW.  This operation has the benefit of increasing margin on the }
00019 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# setup and hold, as well as removing some of the unknown process variation on each }
00020 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# signal path.  This timing analysis emulates the IP process by deskewing each pin as }
00021 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# well as accounting for the elimination of the unknown process variation.  Once the }
00022 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# deskew emulation is complete, the analysis further considers the effect of changing }
00023 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the delay chain settings to the operation of the device after calibration: these }
00024 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# effects include changes in voltage and temperature which may affect the optimality }
00025 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# of the deskew process.}
00026 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
00027 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The timing analysis creates a write summary report indicating how the timing analysis }
00028 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# was performed starting with a typical timing analysis before calibration.}
00029 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
00030 \textcolor{comment}{}
00031    \textcolor{comment}{########################################}
00032 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
00033 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
00034 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
00035 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
00036 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
00037 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
00038 \textcolor{comment}{}   \textcolor{keyword}{global} instname\textcolor{comment}{}
00039 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQS\_min\_max\textcolor{comment}{}
00040 \textcolor{comment}{}   \textcolor{keyword}{global} ::WR\_DQS\_DQ\_SETUP\_ERROR\textcolor{comment}{}
00041 \textcolor{comment}{}   \textcolor{keyword}{global} ::WR\_DQS\_DQ\_HOLD\_ERROR\textcolor{comment}{}
00042 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
00043 \textcolor{comment}{}   \textcolor{keyword}{global} ::max\_package\_skew\textcolor{comment}{}
00044 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqdmpins\textcolor{comment}{}
00045 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
00046 \textcolor{comment}{}   
00047    \textcolor{comment}{########################################}
00048 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
00049 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!(($::family == "arria ii") || ($::family == "stratix iv") || ($::family == "hardcopy iii") ||
       ($::family == "hardcopy iv") || ($::family == "cyclone iv"))\} \{
00050        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
00051 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
00052 \textcolor{comment}{}   \}\textcolor{comment}{   }
00053 \textcolor{comment}{}   
00054    \textcolor{comment}{# Debug switch. Change to 1 to get more run-time debug information}
00055 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} debug 0\textcolor{comment}{}
00056 \textcolor{comment}{}
00057    \textcolor{keyword}{set} result 1\textcolor{comment}{}
00058 \textcolor{comment}{}   
00059    \textcolor{comment}{########################################}
00060 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Initialize the write analysis panel  }
00061 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} panel\_name "$::instname Write"\textcolor{comment}{}
00062 \textcolor{comment}{}   \textcolor{keyword}{set} root\_folder\_name [get\_current\_timequest\_report\_folder]\textcolor{comment}{}
00063 \textcolor{comment}{}
00064    \textcolor{keyword}{if} \{ ! [\textcolor{keyword}{string} match "$\{root\_folder\_name\}*" $panel\_name] \} \{
00065        \textcolor{keyword}{set} panel\_name "$\{root\_folder\_name\}||$panel\_name"\textcolor{comment}{}
00066 \textcolor{comment}{}   \}\textcolor{comment}{}
00067 \textcolor{comment}{}   \textcolor{comment}{# Create the root if it doesn't yet exist}
00068 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{[get\_report\_panel\_id $root\_folder\_name] == -1\} \{
00069        \textcolor{keyword}{set} panel\_id [create\_report\_panel -folder $root\_folder\_name]\textcolor{comment}{}
00070 \textcolor{comment}{}   \}\textcolor{comment}{}
00071 \textcolor{comment}{}
00072    \textcolor{comment}{# Delete any pre-existing summary panel}
00073 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} panel\_id [get\_report\_panel\_id $panel\_name]\textcolor{comment}{}
00074 \textcolor{comment}{}   \textcolor{keyword}{if} \{$panel\_id != -1\} \{
00075        delete\_report\_panel -id $panel\_id\textcolor{comment}{}
00076 \textcolor{comment}{}   \}\textcolor{comment}{}
00077 \textcolor{comment}{}
00078    \textcolor{keyword}{set} panel\_id [create\_report\_panel -table $panel\_name]\textcolor{comment}{}
00079 \textcolor{comment}{}   add\_row\_to\_table -id $panel\_id [list "Operation" "Setup Slack" "Hold Slack"]\textcolor{comment}{ }
00080 \textcolor{comment}{}   
00081    \textcolor{comment}{##################################}
00082 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Find the clock output of the PLL}
00083 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} dqs\_pll\_clock\_id [get_output_clock_id [get_all_dqs_pins $pins(dqsgroup)] "DQS output" msg\_list]\textcolor{comment}{}
00084 \textcolor{comment}{}   \textcolor{keyword}{if} \{$dqs\_pll\_clock\_id == -1\} \{
00085        \textcolor{keyword}{foreach} \{msg\_type msg\} $msg\_list \{
00086            post\_message -type $msg\_type "$msg"\textcolor{comment}{}
00087 \textcolor{comment}{}       \}\textcolor{comment}{}
00088 \textcolor{comment}{}       post\_message -type warning "Failed to find PLL clock for pins [\textcolor{keyword}{join} [
      get_all_dqs_pins $pins(dqsgroup)]]"\textcolor{comment}{}
00089 \textcolor{comment}{}       \textcolor{keyword}{set} result 0\textcolor{comment}{}
00090 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00091        \textcolor{keyword}{set} dqsclksource [get\_node\_info -name $dqs\_pll\_clock\_id]\textcolor{comment}{}
00092 \textcolor{comment}{}   \}\textcolor{comment}{}
00093 \textcolor{comment}{}   
00094    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(num\_ranks) == 1)\} \{
00095        \textcolor{keyword}{set} panel\_name\_setup  "Before Calibration \(\backslash\)u0028Negative slacks are OK\(\backslash\)u0029||$::instname Write
       \(\backslash\)u0028Before Calibration\(\backslash\)u0029 \(\backslash\)u0028setup\(\backslash\)u0029"\textcolor{comment}{}
00096 \textcolor{comment}{}       \textcolor{keyword}{set} panel\_name\_hold   "Before Calibration \(\backslash\)u0028Negative slacks are OK\(\backslash\)u0029||$::instname Write
       \(\backslash\)u0028Before Calibration\(\backslash\)u0029 \(\backslash\)u0028hold\(\backslash\)u0029"\textcolor{comment}{}
00097 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00098        \textcolor{keyword}{set} panel\_name\_setup  "Before Spatial Pessimism Removal \(\backslash\)u0028Negative slacks are
       OK\(\backslash\)u0029||$::instname Write (setup)"\textcolor{comment}{}
00099 \textcolor{comment}{}       \textcolor{keyword}{set} panel\_name\_hold   "Before Spatial Pessimism Removal \(\backslash\)u0028Negative slacks are
       OK\(\backslash\)u0029||$::instname Write (hold)"\textcolor{comment}{}
00100 \textcolor{comment}{}   \}\textcolor{comment}{   }
00101 \textcolor{comment}{}   
00102    \textcolor{comment}{######################################################################      }
00103 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Default Write Analysis}
00104 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} before\_calibration\_reporting [get\_ini\_var -name "qsta\_enable\_before\_calibration\_ddr\_reporting"]\textcolor{comment}{}
00105 \textcolor{comment}{}   \textcolor{keyword}{if} \{![\textcolor{keyword}{string} equal -nocase $before\_calibration\_reporting off]\}  \{
00106        \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to [get\_ports $::alldqdmpins] -npaths 100 
      -panel\_name $panel\_name\_setup -setup -quiet -disable\_panel\_color]\textcolor{comment}{}
00107 \textcolor{comment}{}       \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to [get\_ports $::alldqdmpins] -npaths 100 
      -panel\_name $panel\_name\_hold  -hold  -quiet -disable\_panel\_color]\textcolor{comment}{}
00108 \textcolor{comment}{}   \}\textcolor{comment}{}
00109 \textcolor{comment}{}   
00110    \textcolor{comment}{# Perform the default timing analysis to get required and arrival times}
00111 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} paths\_setup [get\_timing\_paths -to [get\_ports $::alldqdmpins] -npaths 400 -setup]\textcolor{comment}{}
00112 \textcolor{comment}{}   \textcolor{keyword}{set} paths\_hold  [get\_timing\_paths -to [get\_ports $::alldqdmpins] -npaths 400 -hold]\textcolor{comment}{}
00113 \textcolor{comment}{}   
00114    \textcolor{comment}{######################################}
00115 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Find Memory Calibration Improvement }
00116 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{######################################              }
00117 \textcolor{comment}{}\textcolor{comment}{   }
00118    \textcolor{keyword}{set} mp\_setup\_slack 0\textcolor{comment}{}
00119 \textcolor{comment}{}   \textcolor{keyword}{set} mp\_hold\_slack  0\textcolor{comment}{}
00120 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
00121        \textcolor{comment}{# Reduce the effect of tDS on the setup slack}
00122 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} mp\_setup\_slack [\textcolor{keyword}{expr} $MP(DS)*$t(DS)]\textcolor{comment}{}
00123 \textcolor{comment}{}       
00124        \textcolor{comment}{# Reduce the effect of tDH on the hold slack}
00125 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} mp\_hold\_slack  [\textcolor{keyword}{expr} $MP(DH)*$t(DH)]\textcolor{comment}{}
00126 \textcolor{comment}{}   \}\textcolor{comment}{   }
00127 \textcolor{comment}{}
00128    \textcolor{comment}{#########################################}
00129 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Go over each pin and compute its slack}
00130 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Then include any effects that are unique}
00131 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# to source synchronous designs including}
00132 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# common clocks, signal correlation, and}
00133 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# IP calibration options to compute the}
00134 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# total slack of the instance}
00135 \textcolor{comment}{}
00136    \textcolor{keyword}{set} setup\_slack 1000000000\textcolor{comment}{}
00137 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  1000000000\textcolor{comment}{}
00138 \textcolor{comment}{}   \textcolor{keyword}{set} default\_setup\_slack 1000000000\textcolor{comment}{}
00139 \textcolor{comment}{}   \textcolor{keyword}{set} default\_hold\_slack  1000000000\textcolor{comment}{}
00140 \textcolor{comment}{}   \textcolor{keyword}{set} DQDQSpessimismremoval 1000000000\textcolor{comment}{}
00141 \textcolor{comment}{}   
00142    \textcolor{keyword}{set} dqsgroup\_number -1\textcolor{comment}{}
00143 \textcolor{comment}{}   \textcolor{keyword}{if} \{($result == 1)\} \{
00144 
00145        \textcolor{comment}{#Go over each DQS pin}
00146 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{foreach} dqsgroup $pins(dqsgroup) \{
00147 
00148            \textcolor{keyword}{set} dqspin [\textcolor{keyword}{lindex} $dqsgroup 0]\textcolor{comment}{}
00149 \textcolor{comment}{}           \textcolor{keyword}{set} dqpins [\textcolor{keyword}{lindex} $dqsgroup 2]\textcolor{comment}{}
00150 \textcolor{comment}{}           \textcolor{keyword}{set} dqmpins [\textcolor{keyword}{lindex} $dqsgroup 1]\textcolor{comment}{}
00151 \textcolor{comment}{}           \textcolor{keyword}{set} dqdqmpins [\textcolor{keyword}{concat} $dqpins $dqmpins]\textcolor{comment}{}
00152 \textcolor{comment}{}           \textcolor{keyword}{set} dqs\_in\_clockname "$\{::instname\}\_ddr\_dqsin\_$\{dqspin\}"\textcolor{comment}{}
00153 \textcolor{comment}{}           \textcolor{keyword}{if} \{[regexp \{\(\backslash\)[\(\backslash\)d+\(\backslash\)]\} $dqspin temp] == 1\} \{
00154                regexp \{\(\backslash\)d+\} $temp dqsgroup\_number\textcolor{comment}{}
00155 \textcolor{comment}{}           \} \textcolor{keyword}{else} \{
00156                \textcolor{keyword}{incr} dqsgroup\_number\textcolor{comment}{}
00157 \textcolor{comment}{}           \}\textcolor{comment}{}
00158 \textcolor{comment}{}
00159            \textcolor{comment}{# Find DQS clock node before the periphery }
00160 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 0)\} \{
00161                \textcolor{keyword}{set} dqs\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[$\{dqsgroup\_number\}
      ].dqs\_op\_gen.dqs\_op|dqs\_ddio\_out\_gen.ddr3\_opa\_phase\_align\_gen.o\_phase\_align|clk\textcolor{comment}{}
00162 \textcolor{comment}{}           \} \textcolor{keyword}{else} \{
00163                \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
00164                    \textcolor{keyword}{set} dqs\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq\_dqs|dqs\_*\_output\_ddio\_out\_inst|muxsel\textcolor{comment}{}
00165 \textcolor{comment}{}               \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
00166                    \textcolor{keyword}{set} dqs\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs[$\{dqsgroup\_number\}
      ].dqs\_ddio\_out|muxsel\textcolor{comment}{}
00167 \textcolor{comment}{}               \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
00168                    \textcolor{keyword}{set} dqs\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dqs\_op\_gen.dqs\_op|dqs\_ddio\_out\_gen.ddr\_ddio\_phase\_align\_gen.dqs\_ddio\_inst|muxsel\textcolor{comment}{}
00169 \textcolor{comment}{}               \}\textcolor{comment}{}
00170 \textcolor{comment}{}           \}\textcolor{comment}{}
00171 \textcolor{comment}{}
00172            \textcolor{comment}{# Find paths from PLL to DQS clock periphery node}
00173 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{set} DQSpaths\_max [get\_path -from $dqsclksource -to $dqs\_periphery\_node -nworst 100]\textcolor{comment}{}
00174 \textcolor{comment}{}           \textcolor{keyword}{set} DQSpaths\_min [get\_path -from $dqsclksource -to $dqs\_periphery\_node -nworst 100 
      -min\_path]\textcolor{comment}{}
00175 \textcolor{comment}{}           \textcolor{keyword}{set} DQSmin\_of\_max [min_in_collection $DQSpaths\_max "arrival\_time"]\textcolor{comment}{}
00176 \textcolor{comment}{}           \textcolor{keyword}{set} DQSmax\_of\_min [max_in_collection $DQSpaths\_min "arrival\_time"]\textcolor{comment}{}
00177 \textcolor{comment}{}           \textcolor{keyword}{set} DQSmax\_of\_max [max_in_collection $DQSpaths\_max "arrival\_time"]\textcolor{comment}{}
00178 \textcolor{comment}{}           \textcolor{keyword}{set} DQSmin\_of\_min [min_in_collection $DQSpaths\_min "arrival\_time"]\textcolor{comment}{      }
00179 \textcolor{comment}{}           
00180            \textcolor{comment}{##############################################}
00181 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{comment}{## Find extra DQS pessimism due to correlation}
00182 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{comment}{##############################################}
00183 \textcolor{comment}{}\textcolor{comment}{           }
00184            \textcolor{comment}{# Find paths from DQS clock periphery node to beginning of output buffer}
00185 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{
00186                \textcolor{keyword}{set} output\_buffer\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[$\{dqsgroup\_number\}
      ].ddr*\_dqsn\_*buf\_gen.dqs\_obuf|i\textcolor{comment}{}
00187 \textcolor{comment}{}           \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
00188                \textcolor{keyword}{set} output\_buffer\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs[$\{dqsgroup\_number\}
      ].dqs\_obuf|i\textcolor{comment}{       }
00189 \textcolor{comment}{}           \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
00190                \textcolor{keyword}{set} output\_buffer\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[$\{dqsgroup\_number\}
      ].dqs\_op\_gen.dqs\_op|obuf|i\textcolor{comment}{}
00191 \textcolor{comment}{}           \}\textcolor{comment}{}
00192 \textcolor{comment}{}           \textcolor{keyword}{set} DQSperiphery\_min [get\_path -from $dqs\_periphery\_node -to $output\_buffer\_node -min\_path 
      -nworst 100]\textcolor{comment}{}
00193 \textcolor{comment}{}           \textcolor{keyword}{set} DQSperiphery\_delay [min_in_collection $DQSperiphery\_min "arrival\_time"]\textcolor{comment}{}
00194 \textcolor{comment}{}           \textcolor{keyword}{set} DQSpath\_pessimism [\textcolor{keyword}{expr} $DQSperiphery\_delay*$::DQS\_min\_max]\textcolor{comment}{}
00195 \textcolor{comment}{}           
00196            \textcolor{comment}{# Go over each DQ pin in group}
00197 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{set} dq\_index 0\textcolor{comment}{}
00198 \textcolor{comment}{}           \textcolor{keyword}{set} dqm\_index 0\textcolor{comment}{}
00199 \textcolor{comment}{}           \textcolor{keyword}{foreach} dqpin $dqdqmpins \{  
00200            
00201                \textcolor{keyword}{if} \{[lsearch -exact $dqmpins $dqpin] >= 0\} \{
00202                    \textcolor{keyword}{set} isdqmpin 1\textcolor{comment}{}
00203 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00204                    \textcolor{keyword}{set} isdqmpin 0\textcolor{comment}{}
00205 \textcolor{comment}{}               \}\textcolor{comment}{}
00206 \textcolor{comment}{}               
00207                \textcolor{comment}{# Get the setup and hold slacks from the default timing analysis }
00208 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{set} pin\_setup\_slack [min_in_collection_to_name $paths\_setup "slack" $dqpin]\textcolor{comment}{}
00209 \textcolor{comment}{}               \textcolor{keyword}{set} pin\_hold\_slack  [min_in_collection_to_name $paths\_hold "slack" $dqpin]\textcolor{comment}{}
00210 \textcolor{comment}{}               
00211                \textcolor{keyword}{set} default\_setup\_slack [min $default\_setup\_slack $pin\_setup\_slack]\textcolor{comment}{}
00212 \textcolor{comment}{}               \textcolor{keyword}{set} default\_hold\_slack  [min $default\_hold\_slack  $pin\_hold\_slack]\textcolor{comment}{              }
00213 \textcolor{comment}{}               
00214                \textcolor{keyword}{if} \{ $debug \} \{
00215                    \textcolor{keyword}{puts} "$dqsgroup\_number $dqspin $dqpin $pin\_setup\_slack $pin\_hold\_slack"\textcolor{comment}{ }
00216 \textcolor{comment}{}               \}\textcolor{comment}{}
00217 \textcolor{comment}{}               
00218                \textcolor{comment}{################################}
00219 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Extra common clock pessimism removal that is not caught by STA}
00220 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{################################}
00221 \textcolor{comment}{}\textcolor{comment}{               }
00222                \textcolor{comment}{# Find the DQ clock node before the periphery}
00223 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 0)\} \{
00224                    \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00225                        \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_pad|ddr3\_dq\_opa\_gen.dq\_opa\_inst|clk\textcolor{comment}{}
00226 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00227                        \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dm\_gen.dm\_pad\_gen[$\{dqm\_index\}].dm\_pad|ddr3\_dm\_opa\_gen.dm\_opa\_inst|clk\textcolor{comment}{}
00228 \textcolor{comment}{}                   \}\textcolor{comment}{}
00229 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00230                    \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
00231                        \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00232                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq\_dqs|bidir\_dq\_$\{dq\_index\}\_output\_ddio\_out\_inst|muxsel\textcolor{comment}{}
00233 \textcolor{comment}{}                       \} \textcolor{keyword}{else} \{
00234                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq\_dqs|output\_dq\_$\{dqm\_index\}\_output\_ddio\_out\_inst|muxsel\textcolor{comment}{}
00235 \textcolor{comment}{}                       \}\textcolor{comment}{               }
00236 \textcolor{comment}{}                   \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
00237                        \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00238                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_ddio\_out|muxsel\textcolor{comment}{}
00239 \textcolor{comment}{}                       \} \textcolor{keyword}{else} \{
00240                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dm[
      $\{dqsgroup\_number\}].dm\_ddio\_out|muxsel\textcolor{comment}{}
00241 \textcolor{comment}{}                       \}\textcolor{comment}{   }
00242 \textcolor{comment}{}                   \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") ||
       ($::family == "hardcopy iv")\} \{
00243                        \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00244                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_pad|ddr\_qdr\_dq\_ddio\_out\_gen.dq\_ddio\_inst|muxsel\textcolor{comment}{}
00245 \textcolor{comment}{}                       \} \textcolor{keyword}{else} \{
00246                            \textcolor{keyword}{set} dq\_periphery\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dm\_gen.dm\_pad\_gen[$\{dqm\_index\}].dm\_pad|ddr\_qdr\_dm\_ddio\_gen.dm\_ddio\_inst|muxsel\textcolor{comment}{}
00247 \textcolor{comment}{}                       \}\textcolor{comment}{               }
00248 \textcolor{comment}{}                   \}\textcolor{comment}{}
00249 \textcolor{comment}{}               \}\textcolor{comment}{}
00250 \textcolor{comment}{}               
00251                \textcolor{comment}{# Find paths from PLL to DQ clock periphery node}
00252 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{set} DQpaths\_max [get\_path -from $dqsclksource -to $dq\_periphery\_node -nworst 1]\textcolor{comment}{}
00253 \textcolor{comment}{}               \textcolor{keyword}{set} DQpaths\_min [get\_path -from $dqsclksource -to $dq\_periphery\_node -nworst 1 
      -min\_path]\textcolor{comment}{}
00254 \textcolor{comment}{}               \textcolor{keyword}{set} DQmin\_of\_max [min_in_collection $DQpaths\_max "arrival\_time"]\textcolor{comment}{}
00255 \textcolor{comment}{}               \textcolor{keyword}{set} DQmax\_of\_min [max_in_collection $DQpaths\_min "arrival\_time"]\textcolor{comment}{}
00256 \textcolor{comment}{}               \textcolor{keyword}{set} DQmax\_of\_max [max_in_collection $DQpaths\_max "arrival\_time"]\textcolor{comment}{}
00257 \textcolor{comment}{}               \textcolor{keyword}{set} DQmin\_of\_min [min_in_collection $DQpaths\_min "arrival\_time"]\textcolor{comment}{            }
00258 \textcolor{comment}{}               \textcolor{keyword}{if} \{([\textcolor{keyword}{expr} abs($DQSmin\_of\_max - $DQmin\_of\_max)] < 0.002) && ([\textcolor{keyword}{expr} abs($DQSmax\_of\_min -
       $DQmax\_of\_min)] < 0.002)\} \{
00259                    \textcolor{keyword}{set} extra\_ccpp\_max [\textcolor{keyword}{expr} $DQSmax\_of\_max - $DQSmax\_of\_min]\textcolor{comment}{}
00260 \textcolor{comment}{}                   \textcolor{keyword}{set} extra\_ccpp\_min [\textcolor{keyword}{expr} $DQSmin\_of\_max - $DQSmin\_of\_min]\textcolor{comment}{}
00261 \textcolor{comment}{}                   \textcolor{keyword}{set} extra\_ccpp [min $extra\_ccpp\_max $extra\_ccpp\_min]\textcolor{comment}{}
00262 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00263                    \textcolor{keyword}{set} extra\_ccpp 0\textcolor{comment}{}
00264 \textcolor{comment}{}               \}\textcolor{comment}{}
00265 \textcolor{comment}{}               
00266                \textcolor{comment}{# Add the extra ccpp to both setup and hold slacks}
00267 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 0)\} \{
00268                    \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $extra\_ccpp]\textcolor{comment}{}
00269 \textcolor{comment}{}                   \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack + $extra\_ccpp]\textcolor{comment}{}
00270 \textcolor{comment}{}               \}\textcolor{comment}{}
00271 \textcolor{comment}{}               
00272                \textcolor{comment}{#########################################}
00273 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Add the memory calibration improvement}
00274 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#########################################}
00275 \textcolor{comment}{}\textcolor{comment}{               }
00276                \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $mp\_setup\_slack]\textcolor{comment}{}
00277 \textcolor{comment}{}               \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack + $mp\_hold\_slack]\textcolor{comment}{              }
00278 \textcolor{comment}{}               
00279                \textcolor{comment}{#############################################}
00280 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Find extra DQ pessimism due to correlation}
00281 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#############################################}
00282 \textcolor{comment}{}\textcolor{comment}{               }
00283                \textcolor{comment}{# Find paths from DQS clock periphery node to beginning of output buffer}
00284 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{
00285                    \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00286                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_obuf|i\textcolor{comment}{}
00287 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00288                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].gen\_dm.dm\_obuf|i\textcolor{comment}{}
00289 \textcolor{comment}{}                   \}\textcolor{comment}{}
00290 \textcolor{comment}{}               \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
00291                    \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00292                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_obuf|i\textcolor{comment}{}
00293 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00294                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dm[
      $\{dqsgroup\_number\}].dm\_obuf|i\textcolor{comment}{}
00295 \textcolor{comment}{}                   \}\textcolor{comment}{           }
00296 \textcolor{comment}{}               \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
00297                    \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00298                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_pad|gen\_ddr\_obuf.dq\_obuf\_inst|i\textcolor{comment}{}
00299 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00300                        \textcolor{keyword}{set} output\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dm\_gen.dm\_pad\_gen[$\{dqm\_index\}].dm\_pad|dq\_obuf\_inst|i\textcolor{comment}{}
00301 \textcolor{comment}{}                   \}\textcolor{comment}{}
00302 \textcolor{comment}{}               \}\textcolor{comment}{}
00303 \textcolor{comment}{}
00304                \textcolor{keyword}{set} DQperiphery\_min [get\_path -from $dq\_periphery\_node -to $output\_buffer\_node\_dq 
      -min\_path -nworst 1]\textcolor{comment}{}
00305 \textcolor{comment}{}               \textcolor{keyword}{set} DQperiphery\_delay [min_in_collection $DQperiphery\_min "arrival\_time"]\textcolor{comment}{}
00306 \textcolor{comment}{}               \textcolor{keyword}{set} DQpath\_pessimism [\textcolor{keyword}{expr} $DQperiphery\_delay*$::DQS\_min\_max]\textcolor{comment}{       }
00307 \textcolor{comment}{}               
00308                \textcolor{comment}{##########################################}
00309 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Merge current slacks with other slacks}
00310 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{##########################################      }
00311 \textcolor{comment}{}\textcolor{comment}{               }
00312                \textcolor{comment}{# If write deskew is available, the setup and hold slacks for this pin will be equal}
00313 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#   and can also remove the extra DQS and DQ pessimism removal}
00314 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00315                
00316                    \textcolor{comment}{# Consider the maximum range of the deskew when deskewing}
00317 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{keyword}{set} shift\_setup\_slack [\textcolor{keyword}{expr} ($pin\_setup\_slack + $pin\_hold\_slack)/2 - 
      $pin\_setup\_slack]\textcolor{comment}{}
00318 \textcolor{comment}{}                   \textcolor{keyword}{set} max\_write\_deskew [\textcolor{keyword}{expr} $IP(write\_deskew\_range)*$IP(quantization\_T9)]\textcolor{comment}{}
00319 \textcolor{comment}{}                   \textcolor{keyword}{if} \{$shift\_setup\_slack >= $max\_write\_deskew\} \{
00320                        \textcolor{keyword}{if} \{ $debug \} \{
00321                            \textcolor{keyword}{puts} "limited setup"\textcolor{comment}{}
00322 \textcolor{comment}{}                       \}\textcolor{comment}{}
00323 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $max\_write\_deskew]\textcolor{comment}{}
00324 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack - $max\_write\_deskew]\textcolor{comment}{}
00325 \textcolor{comment}{}                   \} \textcolor{keyword}{elseif} \{$shift\_setup\_slack <= -$max\_write\_deskew\} \{
00326                        \textcolor{keyword}{if} \{ $debug \} \{
00327                            \textcolor{keyword}{puts} "limited hold"\textcolor{comment}{}
00328 \textcolor{comment}{}                       \}\textcolor{comment}{}
00329 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack - $max\_write\_deskew]\textcolor{comment}{}
00330 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack + $max\_write\_deskew]\textcolor{comment}{}
00331 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00332                        \textcolor{comment}{# In this case we can also consider the DQS/DQpath pessimism since we can
       guarantee we have enough delay chain settings to align it}
00333 \textcolor{comment}{}\textcolor{comment}{                       }\textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $shift\_setup\_slack + 
      $DQSpath\_pessimism/2 + $DQpath\_pessimism/2]\textcolor{comment}{}
00334 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack - $shift\_setup\_slack + 
      $DQSpath\_pessimism/2 + $DQpath\_pessimism/2]\textcolor{comment}{                     }
00335 \textcolor{comment}{}                   \}\textcolor{comment}{}
00336 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00337                    \textcolor{comment}{# For uncalibrated calls, there is some spatial correlation between DQ and DQS
       signals, so remove}
00338 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{comment}{# some of the pessimism}
00339 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{keyword}{set} total\_DQ\_DQS\_pessimism [\textcolor{keyword}{expr} $DQSpath\_pessimism + $DQpath\_pessimism]\textcolor{comment}{}
00340 \textcolor{comment}{}                   \textcolor{keyword}{set} dqs\_width [\textcolor{keyword}{llength} $dqpins]\textcolor{comment}{}
00341 \textcolor{comment}{}                   \textcolor{keyword}{if} \{$dqs\_width <= 9\} \{
00342                        \textcolor{keyword}{set} DQDQSpessimismremoval [min $DQDQSpessimismremoval [\textcolor{keyword}{expr} 
      0.45*$total\_DQ\_DQS\_pessimism]]\textcolor{comment}{}
00343 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + 0.45*$total\_DQ\_DQS\_pessimism]\textcolor{comment}{}
00344 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack  [\textcolor{keyword}{expr} $pin\_hold\_slack  + 0.45*$total\_DQ\_DQS\_pessimism]\textcolor{comment}{}
00345 \textcolor{comment}{}                   \}\textcolor{comment}{ }
00346 \textcolor{comment}{}               \}\textcolor{comment}{}
00347 \textcolor{comment}{}               
00348                \textcolor{keyword}{set} setup\_slack [min $setup\_slack $pin\_setup\_slack]\textcolor{comment}{}
00349 \textcolor{comment}{}               \textcolor{keyword}{set} hold\_slack  [min $hold\_slack $pin\_hold\_slack]\textcolor{comment}{}
00350 \textcolor{comment}{}               
00351                \textcolor{keyword}{if} \{ $debug \} \{
00352                    \textcolor{keyword}{puts} "                                $extra\_ccpp $DQSpath\_pessimism
       $DQpath\_pessimism ($pin\_setup\_slack $pin\_hold\_slack $setup\_slack $hold\_slack)"\textcolor{comment}{ }
00353 \textcolor{comment}{}               \}\textcolor{comment}{}
00354 \textcolor{comment}{}               \textcolor{keyword}{if} \{$isdqmpin == 0\} \{
00355                    \textcolor{keyword}{set} dq\_index [\textcolor{keyword}{expr} $dq\_index + 1]\textcolor{comment}{}
00356 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00357                    \textcolor{keyword}{set} dqm\_index [\textcolor{keyword}{expr} $dqm\_index + 1]\textcolor{comment}{}
00358 \textcolor{comment}{}               \}\textcolor{comment}{}
00359 \textcolor{comment}{}           \}\textcolor{comment}{}
00360 \textcolor{comment}{}       \}\textcolor{comment}{}
00361 \textcolor{comment}{}   \}\textcolor{comment}{ }
00362 \textcolor{comment}{}   
00363    \textcolor{comment}{################################}
00364 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Consider some post calibration effects on calibration}
00365 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{##  and output the write summary report}
00366 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################}
00367 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} positive\_fcolour [list "black" "blue" "blue"]\textcolor{comment}{}
00368 \textcolor{comment}{}   \textcolor{keyword}{set} negative\_fcolour [list "black" "red"  "red"]\textcolor{comment}{    }
00369 \textcolor{comment}{}   
00370    \textcolor{keyword}{set} wr\_summary [list]\textcolor{comment}{}
00371 \textcolor{comment}{}   
00372    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00373        \textcolor{keyword}{lappend} wr\_summary [list "  Before Calibration Write" [format_3dp $default\_setup\_slack] [
      format_3dp $default\_hold\_slack]]\textcolor{comment}{}
00374 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00375        \textcolor{keyword}{lappend} wr\_summary [list "  Standard Write" [format_3dp $default\_setup\_slack] [
      format_3dp $default\_hold\_slack]]\textcolor{comment}{}
00376 \textcolor{comment}{}   \}\textcolor{comment}{}
00377 \textcolor{comment}{}   
00378    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
00379        \textcolor{keyword}{lappend} wr\_summary [list "  Memory Calibration" [format_3dp $mp\_setup\_slack] [
      format_3dp $mp\_hold\_slack]]\textcolor{comment}{}
00380 \textcolor{comment}{}   \}\textcolor{comment}{       }
00381 \textcolor{comment}{}
00382    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00383        \textcolor{keyword}{if} \{ $debug \} \{
00384            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00385 \textcolor{comment}{}       \}\textcolor{comment}{}
00386 \textcolor{comment}{}       \textcolor{comment}{# Remove external delays (add slack) that are fixed by the dynamic deskew}
00387 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{if} \{ $IP(discrete\_device) == 1 \} \{
00388            \textcolor{keyword}{set} t(WL\_PSE) 0\textcolor{comment}{}
00389 \textcolor{comment}{}       \}\textcolor{comment}{}
00390 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack + $t(board\_skew) + $t(WL\_PSE) + $::WR\_DQS\_DQ\_SETUP\_ERROR]\textcolor{comment}{}
00391 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack [\textcolor{keyword}{expr} $hold\_slack + $t(board\_skew) + $t(WL\_PSE) + $::WR\_DQS\_DQ\_HOLD\_ERROR]\textcolor{comment}{}
00392 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00393            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00394 \textcolor{comment}{}       \}\textcolor{comment}{}
00395 \textcolor{comment}{}       \textcolor{keyword}{set} deskew\_setup [\textcolor{keyword}{expr} $setup\_slack - $default\_setup\_slack -$mp\_setup\_slack]\textcolor{comment}{}
00396 \textcolor{comment}{}       \textcolor{keyword}{set} deskew\_hold  [\textcolor{keyword}{expr} $hold\_slack - $default\_hold\_slack - $mp\_hold\_slack]\textcolor{comment}{}
00397 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Deskew Write and/or more clock pessimism removal" [
      format_3dp $deskew\_setup] [format_3dp $deskew\_hold]]\textcolor{comment}{}
00398 \textcolor{comment}{}       
00399        \textcolor{comment}{# Consider errors in the dynamic deskew}
00400 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} t9\_quantization $IP(quantization\_T9)\textcolor{comment}{}
00401 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t9\_quantization/2]\textcolor{comment}{}
00402 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $t9\_quantization/2]\textcolor{comment}{}
00403 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00404            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00405 \textcolor{comment}{}       \}\textcolor{comment}{}
00406 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Quantization error" [format_3dp [\textcolor{keyword}{expr} 0-$t9\_quantization/2]] [
      format_3dp [\textcolor{keyword}{expr} 0-$t9\_quantization/2]]]\textcolor{comment}{}
00407 \textcolor{comment}{}       
00408        \textcolor{comment}{# Consider variation in the delay chains used during dynamic deksew}
00409 \textcolor{comment}{}\textcolor{comment}{       }[\textcolor{keyword}{catch} \{get\_float\_table\_node\_delay -src \{DELAYCHAIN\_T9\} -dst \{VTVARIATION\} -parameters [list IO
       $::interface\_type]\} t9\_vt\_variation\_percent]\textcolor{comment}{}
00410 \textcolor{comment}{}       \textcolor{keyword}{set} t9\_variation [\textcolor{keyword}{expr} (2*$t(board\_skew) + 2*$::max\_package\_skew + 
      $t(WL\_PSE))*2*$t9\_vt\_variation\_percent]\textcolor{comment}{}
00411 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t9\_variation]\textcolor{comment}{}
00412 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $t9\_variation]\textcolor{comment}{  }
00413 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00414            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00415 \textcolor{comment}{}       \}\textcolor{comment}{}
00416 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Calibration uncertainty" [format_3dp [\textcolor{keyword}{expr} 0-$t9\_variation]] [
      format_3dp [\textcolor{keyword}{expr} 0-$t9\_variation]]]\textcolor{comment}{ }
00417 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 0)\} \{
00418        \textcolor{keyword}{set} pessimism 0\textcolor{comment}{}
00419 \textcolor{comment}{}       \textcolor{keyword}{if} \{$DQDQSpessimismremoval != 1000000000\} \{
00420            \textcolor{keyword}{set} pessimism $DQDQSpessimismremoval\textcolor{comment}{ }
00421 \textcolor{comment}{}       \}\textcolor{comment}{}
00422 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Spatial correlation pessimism removal" [
      format_3dp $pessimism] [format_3dp $pessimism]]\textcolor{comment}{}
00423 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  More clock pessimism removal" [
      format_3dp [\textcolor{keyword}{expr} $setup\_slack - $default\_setup\_slack - $mp\_setup\_slack - $pessimism]] [
      format_3dp [\textcolor{keyword}{expr} $hold\_slack - $default\_hold\_slack - $mp\_hold\_slack - $pessimism]]]\textcolor{comment}{}
00424 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00425        \textcolor{keyword}{set} pessimism\_setup [\textcolor{keyword}{expr} $setup\_slack - $default\_setup\_slack - $mp\_setup\_slack]\textcolor{comment}{}
00426 \textcolor{comment}{}       \textcolor{keyword}{set} pessimism\_hold  [\textcolor{keyword}{expr} $hold\_slack - $default\_hold\_slack - $mp\_hold\_slack]\textcolor{comment}{}
00427 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Spatial correlation pessimism removal" [
      format_3dp $pessimism\_setup] [format_3dp $pessimism\_hold]]\textcolor{comment}{}
00428 \textcolor{comment}{}   \}\textcolor{comment}{   }
00429 \textcolor{comment}{}   
00430    \textcolor{comment}{################################}
00431 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Consider Duty Cycle Calibration if enabled}
00432 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################    }
00433 \textcolor{comment}{}
00434    \textcolor{keyword}{if} \{($IP(write\_dcc) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM")\} \{
00435        \textcolor{comment}{#First remove the Systematic DCD}
00436 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack + $t(WL\_DCD)]\textcolor{comment}{}
00437 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack + $t(WL\_DCD)]\textcolor{comment}{}
00438 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00439            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00440 \textcolor{comment}{}       \}\textcolor{comment}{}
00441 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Duty cycle correction" $t(WL\_DCD) $t(WL\_DCD)]\textcolor{comment}{}
00442 \textcolor{comment}{}       
00443        \textcolor{comment}{#Add errors in the DCC}
00444 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} DCC\_quantization $IP(quantization\_DCC)\textcolor{comment}{}
00445 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $DCC\_quantization]\textcolor{comment}{}
00446 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $DCC\_quantization]\textcolor{comment}{}
00447 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00448            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00449 \textcolor{comment}{}       \}\textcolor{comment}{}
00450 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Duty cycle correction quantization error" [
      format_3dp [\textcolor{keyword}{expr} 0-$DCC\_quantization]] [format_3dp [\textcolor{keyword}{expr} 0-$DCC\_quantization]]]\textcolor{comment}{}
00451 \textcolor{comment}{}       
00452        \textcolor{comment}{# Consider variation in the DCC }
00453 \textcolor{comment}{}\textcolor{comment}{       }[\textcolor{keyword}{catch} \{get\_float\_table\_node\_delay -src \{DELAYCHAIN\_DUTY\_CYCLE\} -dst \{VTVARIATION\} -parameters 
      [list IO $::interface\_type]\} dcc\_vt\_variation\_percent]\textcolor{comment}{}
00454 \textcolor{comment}{}       \textcolor{keyword}{set} dcc\_variation [\textcolor{keyword}{expr} $t(WL\_DCD)*2*$dcc\_vt\_variation\_percent]\textcolor{comment}{}
00455 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $dcc\_variation]\textcolor{comment}{}
00456 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $dcc\_variation]\textcolor{comment}{     }
00457 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00458            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00459 \textcolor{comment}{}       \}\textcolor{comment}{}
00460 \textcolor{comment}{}       \textcolor{keyword}{lappend} wr\_summary [list "  Duty cycle correction calibration uncertainity" [
      format_3dp [\textcolor{keyword}{expr} 0-$dcc\_variation]] [format_3dp [\textcolor{keyword}{expr} 0-$dcc\_variation]]]\textcolor{comment}{}
00461 \textcolor{comment}{}   \}\textcolor{comment}{}
00462 \textcolor{comment}{}   
00463    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00464        \textcolor{keyword}{set} fcolour [get_colours $setup\_slack $hold\_slack]\textcolor{comment}{}
00465 \textcolor{comment}{}       add\_row\_to\_table -id $panel\_id [list "After Calibration Write" [
      format_3dp $setup\_slack] [format_3dp $hold\_slack]] -fcolor $fcolour\textcolor{comment}{}
00466 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Write ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
00467 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00468        \textcolor{keyword}{set} fcolour [get_colours $setup\_slack $hold\_slack]\textcolor{comment}{}
00469 \textcolor{comment}{}       add\_row\_to\_table -id $panel\_id [list "Write" [format_3dp $setup\_slack] [
      format_3dp $hold\_slack]] -fcolor $fcolour\textcolor{comment}{}
00470 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Write ($opcname)" [format_3dp $setup\_slack] [
      format_3dp $hold\_slack]]\textcolor{comment}{}
00471 \textcolor{comment}{}   \}\textcolor{comment}{}
00472 \textcolor{comment}{}   
00473    \textcolor{keyword}{foreach} summary\_line $wr\_summary \{
00474        add\_row\_to\_table -id $panel\_id $summary\_line -fcolors $positive\_fcolour\textcolor{comment}{}
00475 \textcolor{comment}{}   \}\textcolor{comment}{}
00476 \textcolor{comment}{}\}\textcolor{comment}{}
00477 \textcolor{comment}{}
00478 \textcolor{keyword}{proc} perform\_macro\_write\_launch\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name IP\_name ISI\_name\} \{
00479 
00480    \textcolor{comment}{################################################################################}
00481 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This timing analysis covers the write timing constraints using the Altera }
00482 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# characterized values.  Altera performs characterization on its devices and IP }
00483 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# to determine all the FPGA uncertainties, and uses these values to provide accurate }
00484 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# timing analysis.  }
00485 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
00486 \textcolor{comment}{}
00487    \textcolor{comment}{########################################}
00488 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
00489 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
00490 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
00491 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
00492 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
00493 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$ISI\_name ISI\textcolor{comment}{}
00494 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{}
00495 \textcolor{comment}{}   \textcolor{keyword}{global} ::dll\_length\textcolor{comment}{}
00496 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
00497 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
00498 \textcolor{comment}{}   
00499    \textcolor{keyword}{set} board\_skew $t(board\_skew)\textcolor{comment}{}
00500 \textcolor{comment}{}   \textcolor{keyword}{set} tDS $t(DS)\textcolor{comment}{}
00501 \textcolor{comment}{}   \textcolor{keyword}{set} tDH $t(DH)\textcolor{comment}{}
00502 \textcolor{comment}{}   \textcolor{keyword}{set} tAC $t(AC)\textcolor{comment}{}
00503 \textcolor{comment}{}   \textcolor{comment}{# Cyclone IV-E 1.0V have TCCS values stored with the DCD within them, like other non-Cyclone
       families}
00504 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$::family == "cyclone iv"\} \{
00505        \textcolor{keyword}{set} speedgrade [\textcolor{keyword}{string} tolower [get\_speedgrade\_string]]\textcolor{comment}{}
00506 \textcolor{comment}{}       \textcolor{keyword}{if} \{$speedgrade == "8l" || $speedgrade == "9l"\} \{
00507            \textcolor{keyword}{set} tDCD\_total 0\textcolor{comment}{}
00508 \textcolor{comment}{}       \} \textcolor{keyword}{else} \{
00509            \textcolor{keyword}{set} tDCD\_total $t(DCD\_total)\textcolor{comment}{}
00510 \textcolor{comment}{}       \}\textcolor{comment}{}
00511 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00512        \textcolor{keyword}{set} tDCD\_total 0\textcolor{comment}{}
00513 \textcolor{comment}{}   \}\textcolor{comment}{}
00514 \textcolor{comment}{}   \textcolor{keyword}{set} all\_read\_dqs\_list [get_all_dqs_pins $pins(dqsgroup)]\textcolor{comment}{}
00515 \textcolor{comment}{}   \textcolor{keyword}{set} all\_write\_dqs\_list $all\_read\_dqs\_list\textcolor{comment}{}
00516 \textcolor{comment}{}   \textcolor{keyword}{set} all\_d\_list [get_all_dq_pins $pins(dqsgroup)]\textcolor{comment}{}
00517 \textcolor{comment}{}
00518    \textcolor{comment}{# Write capture}
00519 \textcolor{comment}{}\textcolor{comment}{   }
00520    \textcolor{comment}{# First find the phase offset between DQ and DQS}
00521 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(mem\_if\_memtype) == "DDR3 SDRAM"\} \{
00522        \textcolor{keyword}{set} dq2dqs\_output\_phase\_offset [\textcolor{keyword}{expr} 360.0/$::dll\_length * 2]\textcolor{comment}{}
00523 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($IP(mem\_if\_memtype) == "DDR2 SDRAM") || ($IP(mem\_if\_memtype) == "DDR SDRAM")\} \{
00524        \textcolor{keyword}{set} msg\_list [list]\textcolor{comment}{}
00525 \textcolor{comment}{}       \textcolor{keyword}{set} dqs\_pll\_output\_id [get_output_clock_id $all\_write\_dqs\_list "DQS output" msg\_list]\textcolor{comment}{}
00526 \textcolor{comment}{}       \textcolor{keyword}{set} dqs\_pll\_clock ""\textcolor{comment}{}
00527 \textcolor{comment}{}       sett_collection dqs\_pll\_clock\_id [get\_clocks [get\_pin\_info -name $dqs\_pll\_output\_id]]\textcolor{comment}{}
00528 \textcolor{comment}{}       \textcolor{keyword}{set} dqs\_output\_phase [get\_clock\_info -phase $dqs\_pll\_clock\_id]\textcolor{comment}{}
00529 \textcolor{comment}{}       \textcolor{keyword}{set} dq\_pll\_output\_id [get_output_clock_id $all\_d\_list "DQ output" msg\_list]\textcolor{comment}{}
00530 \textcolor{comment}{}       \textcolor{keyword}{set} dq\_pll\_clock ""\textcolor{comment}{}
00531 \textcolor{comment}{}       sett_collection dq\_pll\_clock\_id [get\_clocks [get\_pin\_info -name $dq\_pll\_output\_id]]\textcolor{comment}{}
00532 \textcolor{comment}{}       \textcolor{keyword}{set} dq\_output\_phase [get\_clock\_info -phase $dq\_pll\_clock\_id]\textcolor{comment}{}
00533 \textcolor{comment}{}       \textcolor{keyword}{set} dq2dqs\_output\_phase\_offset [\textcolor{keyword}{expr} $dqs\_output\_phase - $dq\_output\_phase]\textcolor{comment}{}
00534 \textcolor{comment}{}       \textcolor{keyword}{if} \{$dq2dqs\_output\_phase\_offset < 0\} \{
00535            \textcolor{keyword}{set} dq2dqs\_output\_phase\_offset [\textcolor{keyword}{expr} $dq2dqs\_output\_phase\_offset + 360.0]\textcolor{comment}{}
00536 \textcolor{comment}{}       \}\textcolor{comment}{   }
00537 \textcolor{comment}{}   \}\textcolor{comment}{}
00538 \textcolor{comment}{}   
00539    \textcolor{keyword}{set} tccs [get_tccs $IP(mem\_if\_memtype) $all\_write\_dqs\_list $::period -write\_deskew 
      $IP(write\_deskew\_mode) -dll\_length $::dll\_length -config\_period $::period -ddr3\_discrete $IP(discrete\_device)]\textcolor{comment}{   }
00540 \textcolor{comment}{}   \textcolor{keyword}{set} write\_board\_skew $board\_skew\textcolor{comment}{}
00541 \textcolor{comment}{}   
00542    \textcolor{keyword}{if} \{($IP(write\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM")\} \{
00543        \textcolor{keyword}{if} \{[\textcolor{keyword}{catch} \{get\_micro\_node\_delay -micro EXTERNAL\_SKEW\_THRESHOLD -parameters [list IO]\} 
      compensated\_skew] != 0 || $compensated\_skew == ""\} \{
00544          \textcolor{comment}{# No skew compensation}
00545 \textcolor{comment}{}\textcolor{comment}{       }\} \textcolor{keyword}{else} \{
00546          \textcolor{keyword}{set} compensated\_skew [\textcolor{keyword}{expr} $compensated\_skew / 1000.0]\textcolor{comment}{}
00547 \textcolor{comment}{}         \textcolor{keyword}{if} \{$board\_skew > $compensated\_skew\} \{
00548            \textcolor{keyword}{set} write\_board\_skew [\textcolor{keyword}{expr} $board\_skew - $compensated\_skew]\textcolor{comment}{}
00549 \textcolor{comment}{}         \} \textcolor{keyword}{else} \{
00550            \textcolor{keyword}{set} write\_board\_skew 0\textcolor{comment}{}
00551 \textcolor{comment}{}         \}\textcolor{comment}{}
00552 \textcolor{comment}{}       \}\textcolor{comment}{}
00553 \textcolor{comment}{}   \}\textcolor{comment}{}
00554 \textcolor{comment}{}
00555    \textcolor{keyword}{set} su   [round_3dp [\textcolor{keyword}{expr} \{$::period*$dq2dqs\_output\_phase\_offset/360.0 - $write\_board\_skew -
       [lindex $tccs 0]/1000.0 - $tDS - $ISI(DQ)/2 - $ISI(DQS)/2\}]]\textcolor{comment}{}
00556 \textcolor{comment}{}   \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} \{$::period*(0.5 - $dq2dqs\_output\_phase\_offset/360.0) - $tDCD\_total -
       $write\_board\_skew - [lindex $tccs 1]/1000.0 - $tDH - $ISI(DQ)/2 - $ISI(DQS)/2\}]]\textcolor{comment}{}
00557 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list "All Conditions" 0 "Write (All Conditions)" $su $hold]\textcolor{comment}{}
00558 \textcolor{comment}{}\}\textcolor{comment}{}
00559 \textcolor{comment}{}   
00560 \textcolor{comment}{##############################################################}
00561 \textcolor{comment}{}\textcolor{comment}{## Read Timing Analysis}
00562 \textcolor{comment}{}\textcolor{comment}{##############################################################}
00563 \textcolor{comment}{}
00564 \textcolor{keyword}{proc} perform\_flexible\_read\_capture\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name MP\_name IP\_name\} \{
00565 
00566    \textcolor{comment}{################################################################################}
00567 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This timing analysis covers the read timing constraints.  It includes support }
00568 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# for uncalibrated and calibrated read paths.  The analysis starts by running a }
00569 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# conventional timing analysis for the read paths and then adds support for }
00570 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# topologies and IP options which are unique to source-synchronous data transfers.  }
00571 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The support for further topologies includes correlation between DQ and DQS signals}
00572 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The support for further IP includes support for read-deskew calibration.}
00573 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
00574 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# During read deskew calibration, the IP will adjust delay chain settings along }
00575 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# each signal path to reduce the skew between DQ pins and to centre align the DQS }
00576 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# strobe within the DVW.  This operation has the benefit of increasing margin on the }
00577 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# setup and hold, as well as removing some of the unknown process variation on each }
00578 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# signal path.  This timing analysis emulates the IP process by deskewing each pin as }
00579 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# well as accounting for the elimination of the unknown process variation.  Once the }
00580 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# deskew emulation is complete, the analysis further considers the effect of changing }
00581 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the delay chain settings to the operation of the device after calibration: these }
00582 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# effects include changes in voltage and temperature which may affect the optimality }
00583 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# of the deskew process.}
00584 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
00585 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The timing analysis creates a read summary report indicating how the timing analysis }
00586 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# was performed starting with a typical timing analysis before calibration.}
00587 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
00588 \textcolor{comment}{}
00589    \textcolor{comment}{########################################}
00590 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
00591 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
00592 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
00593 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
00594 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
00595 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
00596 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{}
00597 \textcolor{comment}{}   \textcolor{keyword}{global} ::full\_instance\_name\textcolor{comment}{}
00598 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQS\_min\_max\textcolor{comment}{}
00599 \textcolor{comment}{}   \textcolor{keyword}{global} ::fpga\_tREAD\_CAPTURE\_SETUP\_ERROR\textcolor{comment}{}
00600 \textcolor{comment}{}   \textcolor{keyword}{global} ::fpga\_tREAD\_CAPTURE\_HOLD\_ERROR\textcolor{comment}{}
00601 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
00602 \textcolor{comment}{}   \textcolor{keyword}{global} ::max\_package\_skew\textcolor{comment}{}
00603 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqpins\textcolor{comment}{}
00604 \textcolor{comment}{}   \textcolor{keyword}{global} ::dqs\_phase\textcolor{comment}{}
00605 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
00606 \textcolor{comment}{}   \textcolor{keyword}{global} ::tDCD\textcolor{comment}{}
00607 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQSpathjitter\textcolor{comment}{ }
00608 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQSpathjitter\_setup\_prop\textcolor{comment}{}
00609 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
00610 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
00611 \textcolor{comment}{}   
00612    \textcolor{comment}{########################################}
00613 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
00614 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!(($::family == "arria ii") || ($::family == "stratix iv") || ($::family == "hardcopy iii") ||
       ($::family == "hardcopy iv"))\} \{
00615        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
00616 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
00617 \textcolor{comment}{}   \}\textcolor{comment}{   }
00618 \textcolor{comment}{}   
00619    \textcolor{comment}{# Debug switch. Change to 1 to get more run-time debug information}
00620 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} debug 0\textcolor{comment}{ }
00621 \textcolor{comment}{}   
00622    \textcolor{keyword}{set} result 1\textcolor{comment}{}
00623 \textcolor{comment}{}   
00624    \textcolor{comment}{########################################}
00625 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Initialize the read analysis panel   }
00626 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} panel\_name "$::instname Read Capture"\textcolor{comment}{}
00627 \textcolor{comment}{}   \textcolor{keyword}{set} root\_folder\_name [get\_current\_timequest\_report\_folder]\textcolor{comment}{}
00628 \textcolor{comment}{}
00629    \textcolor{keyword}{if} \{ ! [\textcolor{keyword}{string} match "$\{root\_folder\_name\}*" $panel\_name] \} \{
00630        \textcolor{keyword}{set} panel\_name "$\{root\_folder\_name\}||$panel\_name"\textcolor{comment}{}
00631 \textcolor{comment}{}   \}\textcolor{comment}{}
00632 \textcolor{comment}{}   \textcolor{comment}{# Create the root if it doesn't yet exist}
00633 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{[get\_report\_panel\_id $root\_folder\_name] == -1\} \{
00634        \textcolor{keyword}{set} panel\_id [create\_report\_panel -folder $root\_folder\_name]\textcolor{comment}{}
00635 \textcolor{comment}{}   \}\textcolor{comment}{}
00636 \textcolor{comment}{}
00637    \textcolor{comment}{# Delete any pre-existing summary panel}
00638 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} panel\_id [get\_report\_panel\_id $panel\_name]\textcolor{comment}{}
00639 \textcolor{comment}{}   \textcolor{keyword}{if} \{$panel\_id != -1\} \{
00640        delete\_report\_panel -id $panel\_id\textcolor{comment}{}
00641 \textcolor{comment}{}   \}\textcolor{comment}{}
00642 \textcolor{comment}{}
00643    \textcolor{keyword}{set} panel\_id [create\_report\_panel -table $panel\_name]\textcolor{comment}{}
00644 \textcolor{comment}{}   add\_row\_to\_table -id $panel\_id [list "Operation" "Setup Slack" "Hold Slack"]\textcolor{comment}{}
00645 \textcolor{comment}{}   
00646    \textcolor{comment}{# Convert from DDR2 type specs to DDR3 type specs to keep the analysis below simple and concise}
00647 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR2 SDRAM") || ($IP(mem\_if\_memtype) == "DDR SDRAM")\} \{
00648        \textcolor{comment}{#Comment, this should really be tHP -tQHS, but leave this for backward compatbility}
00649 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} t(QH) [\textcolor{keyword}{expr} $::period*(0.5 - $::tDCD) - $t(QHS)]\textcolor{comment}{}
00650 \textcolor{comment}{}       \textcolor{keyword}{set} MP(QH) $MP(QHS)\textcolor{comment}{}
00651 \textcolor{comment}{}   \}\textcolor{comment}{}
00652 \textcolor{comment}{}   
00653    \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(num\_ranks) == 1)\} \{
00654        \textcolor{keyword}{set} panel\_name\_setup  "Before Calibration \(\backslash\)u0028Negative slacks are OK\(\backslash\)u0029||$::instname Read
       Capture \(\backslash\)u0028Before Calibration\(\backslash\)u0029 \(\backslash\)u0028setup\(\backslash\)u0029"\textcolor{comment}{}
00655 \textcolor{comment}{}       \textcolor{keyword}{set} panel\_name\_hold   "Before Calibration \(\backslash\)u0028Negative slacks are OK\(\backslash\)u0029||$::instname Read
       Capture \(\backslash\)u0028Before Calibration\(\backslash\)u0029 \(\backslash\)u0028hold\(\backslash\)u0029"\textcolor{comment}{}
00656 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00657        \textcolor{keyword}{set} panel\_name\_setup  "Before Spatial Pessimism Removal \(\backslash\)u0028Negative slacks are
       OK\(\backslash\)u0029||$::instname Read Capture (setup)"\textcolor{comment}{}
00658 \textcolor{comment}{}       \textcolor{keyword}{set} panel\_name\_hold   "Before Spatial Pessimism Removal \(\backslash\)u0028Negative slacks are
       OK\(\backslash\)u0029||$::instname Read Capture (hold)"\textcolor{comment}{}
00659 \textcolor{comment}{}   \}\textcolor{comment}{   }
00660 \textcolor{comment}{}   
00661    
00662    \textcolor{comment}{######################################################################      }
00663 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Default Read Analysis}
00664 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} before\_calibration\_reporting [get\_ini\_var -name "qsta\_enable\_before\_calibration\_ddr\_reporting"]\textcolor{comment}{}
00665 \textcolor{comment}{}   \textcolor{keyword}{if} \{![\textcolor{keyword}{string} equal -nocase $before\_calibration\_reporting off]\}  \{
00666        \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -from [get\_ports $::alldqpins] -to\_clock [get\_clocks
       "$\{::instname\}\_ddr\_dqsin\_*"] -npaths 100 -panel\_name $panel\_name\_setup -setup -quiet -disable\_panel\_color]\textcolor{comment}{}
00667 \textcolor{comment}{}       \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -from [get\_ports $::alldqpins] -to\_clock [get\_clocks
       "$\{::instname\}\_ddr\_dqsin\_*"] -npaths 100 -panel\_name $panel\_name\_hold  -hold -quiet -disable\_panel\_color]\textcolor{comment}{}
00668 \textcolor{comment}{}   \}\textcolor{comment}{}
00669 \textcolor{comment}{}       
00670    \textcolor{keyword}{set} paths\_setup [get\_timing\_paths -from [get\_ports $::alldqpins] -to\_clock [get\_clocks 
      "$\{::instname\}\_ddr\_dqsin\_*"] -npaths 400 -setup]\textcolor{comment}{}
00671 \textcolor{comment}{}   \textcolor{keyword}{set} paths\_hold  [get\_timing\_paths -from [get\_ports $::alldqpins] -to\_clock [get\_clocks 
      "$\{::instname\}\_ddr\_dqsin\_*"] -npaths 400 -hold]\textcolor{comment}{      }
00672 \textcolor{comment}{}       
00673    \textcolor{comment}{######################################}
00674 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Find Memory Calibration Improvement}
00675 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{######################################              }
00676 \textcolor{comment}{}\textcolor{comment}{   }
00677    \textcolor{keyword}{set} mp\_setup\_slack 0\textcolor{comment}{}
00678 \textcolor{comment}{}   \textcolor{keyword}{set} mp\_hold\_slack  0\textcolor{comment}{}
00679 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
00680        \textcolor{comment}{# Reduce the effect of tDQSQ on the setup slack}
00681 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} mp\_setup\_slack [\textcolor{keyword}{expr} $MP(DQSQ)*$t(DQSQ)]\textcolor{comment}{}
00682 \textcolor{comment}{}
00683        \textcolor{comment}{# Reduce the effect of tQH on the hold slack}
00684 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} mp\_hold\_slack  [\textcolor{keyword}{expr} $MP(QH)*(0.5*$::period-$t(QH))]\textcolor{comment}{}
00685 \textcolor{comment}{}   \}\textcolor{comment}{   }
00686 \textcolor{comment}{}
00687    \textcolor{comment}{#########################################}
00688 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Go over each pin and compute its slack}
00689 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Then include any effects that are unique}
00690 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# to source synchronous designs including}
00691 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# common clocks, signal correlation, and}
00692 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# IP calibration options to compute the}
00693 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# total slack of the instance   }
00694 \textcolor{comment}{}\textcolor{comment}{   }
00695    \textcolor{keyword}{set} setup\_slack 1000000000\textcolor{comment}{}
00696 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  1000000000\textcolor{comment}{}
00697 \textcolor{comment}{}   \textcolor{keyword}{set} default\_setup\_slack 1000000000\textcolor{comment}{}
00698 \textcolor{comment}{}   \textcolor{keyword}{set} default\_hold\_slack  1000000000\textcolor{comment}{  }
00699 \textcolor{comment}{}   
00700    \textcolor{comment}{# Find quiet jitter values during calibration}
00701 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} quiet\_setup\_jitter [\textcolor{keyword}{expr} 0.8*$::DQSpathjitter*$::DQSpathjitter\_setup\_prop]\textcolor{comment}{}
00702 \textcolor{comment}{}   \textcolor{keyword}{set} quiet\_hold\_jitter  [\textcolor{keyword}{expr} 0.8*$::DQSpathjitter*(1-$::DQSpathjitter\_setup\_prop) + 
      0.8*$::tJITper/2]\textcolor{comment}{}
00703 \textcolor{comment}{}   
00704    \textcolor{keyword}{set} dqsgroup\_number -1\textcolor{comment}{}
00705 \textcolor{comment}{}   \textcolor{keyword}{if} \{($result == 1)\} \{
00706 
00707        \textcolor{comment}{#Go over each DQS pin}
00708 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{foreach} dqsgroup $pins(dqsgroup) \{
00709        
00710            \textcolor{keyword}{set} dqspin [\textcolor{keyword}{lindex} $dqsgroup 0]\textcolor{comment}{}
00711 \textcolor{comment}{}           \textcolor{keyword}{set} dqpins [\textcolor{keyword}{lindex} $dqsgroup 2]\textcolor{comment}{}
00712 \textcolor{comment}{}           \textcolor{keyword}{set} dqmpins [\textcolor{keyword}{lindex} $dqsgroup 1]\textcolor{comment}{}
00713 \textcolor{comment}{}           \textcolor{keyword}{set} dqdqmpins [\textcolor{keyword}{concat} $dqpins $dqmpins]\textcolor{comment}{ }
00714 \textcolor{comment}{}           \textcolor{keyword}{set} dqs\_in\_clockname "$\{::instname\}\_ddr\_dqsin\_$\{dqspin\}"\textcolor{comment}{}
00715 \textcolor{comment}{}           \textcolor{keyword}{if} \{[regexp \{\(\backslash\)[\(\backslash\)d+\(\backslash\)]\} $dqspin temp] == 1\} \{
00716                regexp \{\(\backslash\)d+\} $temp dqsgroup\_number\textcolor{comment}{}
00717 \textcolor{comment}{}           \} \textcolor{keyword}{else} \{
00718                \textcolor{keyword}{incr} dqsgroup\_number\textcolor{comment}{}
00719 \textcolor{comment}{}           \}\textcolor{comment}{}
00720 \textcolor{comment}{}           
00721            \textcolor{comment}{##############################################}
00722 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{comment}{## Find extra DQS pessimism due to correlation}
00723 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{comment}{##############################################}
00724 \textcolor{comment}{}
00725            \textcolor{comment}{# Find paths from output of the input buffer to the end of the DQS periphery}
00726 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{  
00727                \textcolor{keyword}{set} input\_buffer\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[$\{dqsgroup\_number\}
      ].ddr*\_dqsn\_*buf\_gen.dqs\_inpt\_ibuf|i\textcolor{comment}{}
00728 \textcolor{comment}{}               \textcolor{keyword}{set} DQScapture\_node [list "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq\_dqs|wire\_bidir\_dq\_*\_ddio\_in\_inst\_regouthi" \(\backslash\)
00729                                         "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq\_dqs|bidir\_dq\_*\_ddio\_in\_inst~DFFLO"]\textcolor{comment}{}
00730 \textcolor{comment}{}           \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
00731                \textcolor{keyword}{set} input\_buffer\_node $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[$\{dqsgroup\_number\}
      ].dqs\_ip|ddr*\_dqsn\_ibuf\_gen.dqs\_inpt\_io\_ibuf|o\textcolor{comment}{}
00732 \textcolor{comment}{}               \textcolor{keyword}{set} DQScapture\_node [list "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq*dqi\_captured\_h" \(\backslash\)
00733                                         "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq*ddr\_dq\_ddio\_in\_gen.dqi\_ddio\_in~DFFLO"]\textcolor{comment}{}
00734 \textcolor{comment}{}           \}\textcolor{comment}{}
00735 \textcolor{comment}{}           \textcolor{keyword}{set} DQSperiphery\_min [get\_path -from $input\_buffer\_node -to $DQScapture\_node]\textcolor{comment}{}
00736 \textcolor{comment}{}           \textcolor{keyword}{set} DQSperiphery\_delay [max_in_collection $DQSperiphery\_min "arrival\_time"]\textcolor{comment}{}
00737 \textcolor{comment}{}           \textcolor{keyword}{set} DQSpath\_pessimism [\textcolor{keyword}{expr} 
      ($DQSperiphery\_delay-$::dqs\_phase/360.0*$::period)*$::DQS\_min\_max]\textcolor{comment}{}
00738 \textcolor{comment}{}           
00739            \textcolor{comment}{# Go over each DQ pin in group}
00740 \textcolor{comment}{}\textcolor{comment}{           }\textcolor{keyword}{set} dq\_index 0\textcolor{comment}{}
00741 \textcolor{comment}{}           \textcolor{keyword}{foreach} dqpin $dqpins \{ 
00742            
00743                \textcolor{comment}{# Get the setup and hold slacks from the default timing analysis }
00744 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{set} pin\_setup\_slack [min_in_collection_from_name $paths\_setup "slack" $dqpin]\textcolor{comment}{}
00745 \textcolor{comment}{}               \textcolor{keyword}{set} pin\_hold\_slack  [min_in_collection_from_name $paths\_hold "slack" $dqpin]\textcolor{comment}{}
00746 \textcolor{comment}{}               
00747                \textcolor{keyword}{set} default\_setup\_slack [min $default\_setup\_slack $pin\_setup\_slack]\textcolor{comment}{}
00748 \textcolor{comment}{}               \textcolor{keyword}{set} default\_hold\_slack  [min $default\_hold\_slack  $pin\_hold\_slack]\textcolor{comment}{      }
00749 \textcolor{comment}{}
00750                \textcolor{keyword}{if} \{ $debug \} \{
00751                    \textcolor{keyword}{puts} "READ: $dqsgroup\_number $dqspin $dqpin $pin\_setup\_slack $pin\_hold\_slack (MP:
       $mp\_setup\_slack $mp\_hold\_slack)"\textcolor{comment}{}
00752 \textcolor{comment}{}               \}\textcolor{comment}{}
00753 \textcolor{comment}{}               
00754                \textcolor{comment}{################################}
00755 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Add the memory calibration improvement}
00756 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{################################}
00757 \textcolor{comment}{}\textcolor{comment}{               }
00758                \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $mp\_setup\_slack]\textcolor{comment}{}
00759 \textcolor{comment}{}               \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack + $mp\_hold\_slack]\textcolor{comment}{}
00760 \textcolor{comment}{}               
00761                \textcolor{comment}{#############################################}
00762 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Find extra DQ pessimism due to correlation}
00763 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#############################################}
00764 \textcolor{comment}{}\textcolor{comment}{               }
00765                \textcolor{comment}{# Find paths from output of the input buffer to the end of the DQ periphery}
00766 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{
00767                    \textcolor{keyword}{set} input\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_ibuf|i\textcolor{comment}{}
00768 \textcolor{comment}{}                   \textcolor{keyword}{set} DQcapture\_node [list "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq\_dqs|wire\_bidir\_dq\_$\{dq\_index\}\_ddio\_in\_inst\_regouthi" \(\backslash\)
00769                                             "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}
      ].dq\_dqs|bidir\_dq\_$\{dq\_index\}\_ddio\_in\_inst~DFFLO"]\textcolor{comment}{}
00770 \textcolor{comment}{}
00771                \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
00772                    \textcolor{keyword}{set} input\_buffer\_node\_dq $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[
      $\{dqsgroup\_number\}].dq[$\{dq\_index\}].dq\_pad|dqi\_io\_ibuf|o\textcolor{comment}{}
00773 \textcolor{comment}{}                   \textcolor{keyword}{set} DQcapture\_node [list "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}].dq[
      $\{dq\_index\}]*dqi\_captured\_h" \(\backslash\)
00774                                             "$\{full\_instance\_name\}*dqs\_group[$\{dqsgroup\_number\}].dq[
      $\{dq\_index\}]*ddr\_dq\_ddio\_in\_gen.dqi\_ddio\_in~DFFLO"]\textcolor{comment}{}
00775 \textcolor{comment}{}               \}\textcolor{comment}{}
00776 \textcolor{comment}{}               \textcolor{keyword}{set} DQperiphery\_min [get\_path -from $input\_buffer\_node\_dq -to $DQcapture\_node -min\_path
       -nworst 10]\textcolor{comment}{}
00777 \textcolor{comment}{}               \textcolor{keyword}{set} DQperiphery\_delay [min_in_collection $DQperiphery\_min "arrival\_time"]\textcolor{comment}{}
00778 \textcolor{comment}{}               \textcolor{keyword}{set} DQpath\_pessimism [\textcolor{keyword}{expr} $DQperiphery\_delay*$::DQS\_min\_max]\textcolor{comment}{}
00779 \textcolor{comment}{}               
00780                \textcolor{comment}{#########################################}
00781 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{## Merge current slacks with other slacks}
00782 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#########################################           }
00783 \textcolor{comment}{}
00784                \textcolor{comment}{# If read deskew is available, the setup and hold slacks for this pin will be equal}
00785 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{comment}{#   and can also remove the extra DQS pessimism removal}
00786 \textcolor{comment}{}\textcolor{comment}{               }\textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00787                
00788                    \textcolor{comment}{# Consider the maximum range of the deskew when deskewing}
00789 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{keyword}{set} shift\_setup\_slack [\textcolor{keyword}{expr} (($pin\_setup\_slack + $quiet\_setup\_jitter) + 
      ($pin\_hold\_slack + $quiet\_hold\_jitter))/2 - $pin\_setup\_slack - $quiet\_setup\_jitter]\textcolor{comment}{}
00790 \textcolor{comment}{}                   \textcolor{keyword}{set} max\_read\_deskew [\textcolor{keyword}{expr} $IP(read\_deskew\_range)*$IP(quantization\_T1)]\textcolor{comment}{}
00791 \textcolor{comment}{}                   \textcolor{keyword}{if} \{$shift\_setup\_slack >= $max\_read\_deskew\} \{
00792                        \textcolor{keyword}{if} \{ $debug \} \{
00793                            \textcolor{keyword}{puts} "limited setup"\textcolor{comment}{}
00794 \textcolor{comment}{}                       \}\textcolor{comment}{}
00795 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $max\_read\_deskew]\textcolor{comment}{}
00796 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack - $max\_read\_deskew]\textcolor{comment}{}
00797 \textcolor{comment}{}                   \} \textcolor{keyword}{elseif} \{$shift\_setup\_slack <= -$max\_read\_deskew\} \{
00798                        \textcolor{keyword}{if} \{ $debug \} \{
00799                            \textcolor{keyword}{puts} "limited hold"\textcolor{comment}{}
00800 \textcolor{comment}{}                       \}\textcolor{comment}{}
00801 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack - $max\_read\_deskew]\textcolor{comment}{}
00802 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack + $max\_read\_deskew]\textcolor{comment}{}
00803 \textcolor{comment}{}                   \} \textcolor{keyword}{else} \{
00804                        \textcolor{comment}{# In this case we can also consider the DQSpath pessimism since we can
       guarantee we have enough delay chain settings to align it}
00805 \textcolor{comment}{}\textcolor{comment}{                       }\textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + $shift\_setup\_slack + 
      $DQSpath\_pessimism/2 + $DQpath\_pessimism/2]\textcolor{comment}{}
00806 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack [\textcolor{keyword}{expr} $pin\_hold\_slack - $shift\_setup\_slack + 
      $DQSpath\_pessimism/2 + $DQpath\_pessimism/2]\textcolor{comment}{}
00807 \textcolor{comment}{}                   \}\textcolor{comment}{}
00808 \textcolor{comment}{}               \} \textcolor{keyword}{else} \{
00809                    \textcolor{comment}{# For uncalibrated calls, there is some spatial correlation between DQ and DQS
       signals, so remove}
00810 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{comment}{# some of the pessimism}
00811 \textcolor{comment}{}\textcolor{comment}{                   }\textcolor{keyword}{set} total\_DQ\_DQS\_pessimism [\textcolor{keyword}{expr} $DQSpath\_pessimism + $DQpath\_pessimism]\textcolor{comment}{}
00812 \textcolor{comment}{}                   \textcolor{keyword}{set} dqs\_width [\textcolor{keyword}{llength} $dqpins]\textcolor{comment}{}
00813 \textcolor{comment}{}                   \textcolor{keyword}{if} \{$dqs\_width <= 9\} \{
00814                        \textcolor{keyword}{set} pin\_setup\_slack [\textcolor{keyword}{expr} $pin\_setup\_slack + 0.45*$total\_DQ\_DQS\_pessimism]\textcolor{comment}{}
00815 \textcolor{comment}{}                       \textcolor{keyword}{set} pin\_hold\_slack  [\textcolor{keyword}{expr} $pin\_hold\_slack  + 0.45*$total\_DQ\_DQS\_pessimism]\textcolor{comment}{}
00816 \textcolor{comment}{}                   \}\textcolor{comment}{ }
00817 \textcolor{comment}{}               
00818                \}\textcolor{comment}{}
00819 \textcolor{comment}{}
00820                \textcolor{keyword}{set} setup\_slack [min $setup\_slack $pin\_setup\_slack]\textcolor{comment}{}
00821 \textcolor{comment}{}               \textcolor{keyword}{set} hold\_slack  [min $hold\_slack $pin\_hold\_slack]\textcolor{comment}{}
00822 \textcolor{comment}{}               
00823                \textcolor{keyword}{if} \{ $debug \} \{
00824                    \textcolor{keyword}{puts} "READ:               $DQSpath\_pessimism $DQpath\_pessimism ($pin\_setup\_slack
       $pin\_hold\_slack $setup\_slack $hold\_slack)"\textcolor{comment}{ }
00825 \textcolor{comment}{}               \}\textcolor{comment}{}
00826 \textcolor{comment}{}               \textcolor{keyword}{set} dq\_index [\textcolor{keyword}{expr} $dq\_index + 1]\textcolor{comment}{}
00827 \textcolor{comment}{}           \}\textcolor{comment}{}
00828 \textcolor{comment}{}       \}\textcolor{comment}{}
00829 \textcolor{comment}{}   \}\textcolor{comment}{}
00830 \textcolor{comment}{}   
00831    \textcolor{comment}{#########################################################}
00832 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Consider some post calibration effects on calibration}
00833 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{##  and output the read summary report}
00834 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{#########################################################   }
00835 \textcolor{comment}{}\textcolor{comment}{   }
00836    \textcolor{keyword}{set} positive\_fcolour [list "black" "blue" "blue"]\textcolor{comment}{}
00837 \textcolor{comment}{}   \textcolor{keyword}{set} negative\_fcolour [list "black" "red"  "red"]\textcolor{comment}{    }
00838 \textcolor{comment}{}
00839    \textcolor{keyword}{set} rc\_summary [list]\textcolor{comment}{}
00840 \textcolor{comment}{}
00841    \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00842        \textcolor{keyword}{lappend} rc\_summary [list "  Before Calibration Read Capture" [
      format_3dp $default\_setup\_slack] [format_3dp $default\_hold\_slack]]\textcolor{comment}{}
00843 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00844        \textcolor{keyword}{lappend} rc\_summary [list "  Standard Read Capture" [format_3dp $default\_setup\_slack] [
      format_3dp $default\_hold\_slack]]\textcolor{comment}{}
00845 \textcolor{comment}{}   \}\textcolor{comment}{}
00846 \textcolor{comment}{}   
00847    \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
00848        \textcolor{keyword}{lappend} rc\_summary  [list "  Memory Calibration" [format_3dp $mp\_setup\_slack] [
      format_3dp $mp\_hold\_slack]]\textcolor{comment}{ }
00849 \textcolor{comment}{}   \}\textcolor{comment}{}
00850 \textcolor{comment}{}   
00851    
00852    \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00853        \textcolor{keyword}{if} \{ $debug \} \{
00854            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00855 \textcolor{comment}{}       \}\textcolor{comment}{}
00856 \textcolor{comment}{}       \textcolor{comment}{# Remove external delays (add slack) that are fixed by the dynamic deskew}
00857 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack + $t(board\_skew) + $t(DQS\_PSERR\_max) + 
      $::fpga\_tREAD\_CAPTURE\_SETUP\_ERROR + $t(max\_additional\_dqs\_variation)]\textcolor{comment}{}
00858 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack [\textcolor{keyword}{expr} $hold\_slack + $t(board\_skew) + $t(DQS\_PSERR\_min) + 
      $::fpga\_tREAD\_CAPTURE\_HOLD\_ERROR + $t(max\_additional\_dqs\_variation)]\textcolor{comment}{}
00859 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00860            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00861 \textcolor{comment}{}       \}\textcolor{comment}{}
00862 \textcolor{comment}{}       \textcolor{keyword}{set} deskew\_setup [\textcolor{keyword}{expr} $setup\_slack - $default\_setup\_slack - $mp\_setup\_slack]\textcolor{comment}{}
00863 \textcolor{comment}{}       \textcolor{keyword}{set} deskew\_hold  [\textcolor{keyword}{expr} $hold\_slack - $default\_hold\_slack - $mp\_hold\_slack]\textcolor{comment}{}
00864 \textcolor{comment}{}       
00865        \textcolor{keyword}{lappend} rc\_summary [list "  Deskew Read" [format_3dp $deskew\_setup] [
      format_3dp $deskew\_hold]]\textcolor{comment}{}
00866 \textcolor{comment}{}       
00867        \textcolor{comment}{# Consider errors in the dynamic deskew}
00868 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} t1\_quantization $IP(quantization\_T1)\textcolor{comment}{}
00869 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t1\_quantization/2]\textcolor{comment}{}
00870 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $t1\_quantization/2]\textcolor{comment}{}
00871 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00872            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00873 \textcolor{comment}{}       \}\textcolor{comment}{}
00874 \textcolor{comment}{}       \textcolor{keyword}{lappend} rc\_summary [list "  Quantization error" [format_3dp [\textcolor{keyword}{expr} 0-$t1\_quantization/2]] [
      format_3dp [\textcolor{keyword}{expr} 0-$t1\_quantization/2]]]\textcolor{comment}{}
00875 \textcolor{comment}{}       
00876        \textcolor{comment}{# Consider variation in the delay chains used during dynamic deksew}
00877 \textcolor{comment}{}\textcolor{comment}{       }[\textcolor{keyword}{catch} \{get\_float\_table\_node\_delay -src \{DELAYCHAIN\_T1\} -dst \{VTVARIATION\} -parameters [list IO
       $::interface\_type]\} t1\_vt\_variation\_percent]\textcolor{comment}{}
00878 \textcolor{comment}{}       \textcolor{keyword}{set} t1\_variation [\textcolor{keyword}{expr} ($MP(DQSQ)*$t(DQSQ) + $MP(QH)*(0.5*$::period - $t(QH)) + 
      2*$t(board\_skew) + 2*$::max\_package\_skew + $t(DQS\_PSERR\_max))*2*$t1\_vt\_variation\_percent]\textcolor{comment}{}
00879 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t1\_variation]\textcolor{comment}{}
00880 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $t1\_variation]\textcolor{comment}{  }
00881 \textcolor{comment}{}       \textcolor{keyword}{if} \{ $debug \} \{
00882            \textcolor{keyword}{puts} "  $setup\_slack $hold\_slack"\textcolor{comment}{}
00883 \textcolor{comment}{}       \}\textcolor{comment}{}
00884 \textcolor{comment}{}       \textcolor{keyword}{lappend} rc\_summary [list "  Calibration uncertainty" [format_3dp [\textcolor{keyword}{expr} 0-$t1\_variation]] [
      format_3dp [\textcolor{keyword}{expr} 0-$t1\_variation]]]\textcolor{comment}{}
00885 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00886        \textcolor{keyword}{set} pessimism\_setup [\textcolor{keyword}{expr} $setup\_slack - $default\_setup\_slack - $mp\_setup\_slack]\textcolor{comment}{}
00887 \textcolor{comment}{}       \textcolor{keyword}{set} pessimism\_hold  [\textcolor{keyword}{expr} $hold\_slack - $default\_hold\_slack - $mp\_hold\_slack]\textcolor{comment}{}
00888 \textcolor{comment}{}       \textcolor{keyword}{lappend} rc\_summary [list "  Spatial correlation pessimism removal" [
      format_3dp $pessimism\_setup] [format_3dp $pessimism\_hold]]\textcolor{comment}{}
00889 \textcolor{comment}{}   \}\textcolor{comment}{}
00890 \textcolor{comment}{}   
00891    \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM") &&
       ($IP(num\_ranks) == 1)\} \{
00892        \textcolor{keyword}{set} fcolour [get_colours $setup\_slack $hold\_slack]\textcolor{comment}{ }
00893 \textcolor{comment}{}       add\_row\_to\_table -id $panel\_id [list "After Calibration Read Capture" [
      format_3dp $setup\_slack] [format_3dp $hold\_slack]] -fcolor $fcolour\textcolor{comment}{}
00894 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Capture ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
00895 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
00896        \textcolor{keyword}{set} fcolour [get_colours $setup\_slack $hold\_slack]\textcolor{comment}{ }
00897 \textcolor{comment}{}       add\_row\_to\_table -id $panel\_id [list "Read Capture" [format_3dp $setup\_slack] [
      format_3dp $hold\_slack]] -fcolor $fcolour\textcolor{comment}{}
00898 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Capture ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{  }
00899 \textcolor{comment}{}   \}\textcolor{comment}{}
00900 \textcolor{comment}{}   
00901        \textcolor{keyword}{foreach} summary\_line $rc\_summary \{
00902            add\_row\_to\_table -id $panel\_id $summary\_line -fcolors $positive\_fcolour\textcolor{comment}{}
00903 \textcolor{comment}{}       \}\textcolor{comment}{}
00904 \textcolor{comment}{}   
00905 \}\textcolor{comment}{}
00906 \textcolor{comment}{}
00907 
00908 \textcolor{keyword}{proc} perform\_flexible\_read\_capture\_non\_dqs\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name MP\_name IP\_name board\_parameters\_name\} \{
00909 
00910    \textcolor{comment}{################################################################################}
00911 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This timing analysis covers the read timing constraints for non-DQS capture}
00912 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# which concerns transferring read data from the pins to registers clocked}
00913 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# to a clock domain under the control of the ALTMEMPHY. We use a dedicated PLL }
00914 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# phase that is calibrated by the}
00915 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# sequencer, and tracks any movements in the data valid window of the captured}
00916 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# data. This means that the exact length of the DQS and CK traces don't affect}
00917 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the timing analysis, and the calibration will remove any static offset from}
00918 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the rest of the path too. With static offset removed, the remaining}
00919 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# uncertainties with be limited to VT variation, jitter and skew (since one}
00920 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# clock phase is chosen for the whole interface).}
00921 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
00922 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
00923 \textcolor{comment}{}
00924    \textcolor{comment}{########################################}
00925 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
00926 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
00927 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
00928 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$board\_parameters\_name board\textcolor{comment}{      }
00929 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
00930 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
00931 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
00932 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{}
00933 \textcolor{comment}{}   \textcolor{keyword}{global} ::full\_instance\_name\textcolor{comment}{}
00934 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQS\_min\_max\textcolor{comment}{}
00935 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
00936 \textcolor{comment}{}   \textcolor{keyword}{global} ::max\_package\_skew\textcolor{comment}{}
00937 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqpins\textcolor{comment}{}
00938 \textcolor{comment}{}   \textcolor{keyword}{global} ::dqs\_phase\textcolor{comment}{}
00939 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
00940 \textcolor{comment}{}   \textcolor{keyword}{global} ::tDCD\textcolor{comment}{}
00941 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQSpathjitter\textcolor{comment}{ }
00942 \textcolor{comment}{}   \textcolor{keyword}{global} ::DQSpathjitter\_setup\_prop\textcolor{comment}{}
00943 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
00944 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
00945 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqpins\textcolor{comment}{}
00946 \textcolor{comment}{}   
00947    \textcolor{comment}{########################################}
00948 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
00949 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!($::family == "cyclone iv")\} \{
00950        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
00951 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
00952 \textcolor{comment}{}   \}\textcolor{comment}{   }
00953 \textcolor{comment}{}   
00954    \textcolor{comment}{# Debug switch. Change to 1 to get more run-time debug information}
00955 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} debug 0\textcolor{comment}{ }
00956 \textcolor{comment}{}   
00957    \textcolor{keyword}{set} result 1\textcolor{comment}{}
00958 \textcolor{comment}{}   
00959    \textcolor{comment}{########################################}
00960 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## First get the min/max range of DQ and}
00961 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## clock signals.  Can be a result of}
00962 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## systematic skew or process variations}
00963 \textcolor{comment}{}\textcolor{comment}{   }
00964    \textcolor{comment}{# DQ variation from the pins to the registers}
00965 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This includes setup and hold times of the register as well as variation in the delay of the clock
       in the cell}
00966 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} DQ\_paths\_setup [get\_timing\_paths -from [get\_ports $::alldqpins] -to [all\_registers] -setup]\textcolor{comment}{}
00967 \textcolor{comment}{}   \textcolor{keyword}{set} DQ\_paths\_hold  [get\_timing\_paths -from [get\_ports $::alldqpins] -to [all\_registers] -hold]\textcolor{comment}{}
00968 \textcolor{comment}{}   \textcolor{keyword}{set} DQ\_max [\textcolor{keyword}{expr} [max_in_collection $DQ\_paths\_setup "arrival\_time"] - [
      max_in_collection $DQ\_paths\_setup "launch\_time"] - [min_in_collection $DQ\_paths\_setup "required\_time"] + [
      min_in_collection $DQ\_paths\_setup "latch\_time"]]\textcolor{comment}{}
00969 \textcolor{comment}{}   \textcolor{keyword}{set} DQ\_min [\textcolor{keyword}{expr} [min_in_collection $DQ\_paths\_hold  "arrival\_time"] - [
      min_in_collection $DQ\_paths\_hold  "launch\_time"] - [max_in_collection $DQ\_paths\_hold "required\_time"]  + [
      max_in_collection $DQ\_paths\_hold  "latch\_time"]]\textcolor{comment}{}
00970 \textcolor{comment}{}   \textcolor{keyword}{set} minmax\_DQ\_variation [\textcolor{keyword}{expr} $DQ\_max - $DQ\_min]\textcolor{comment}{}
00971 \textcolor{comment}{}
00972    \textcolor{comment}{# Clock variation (from the PLL to the registers}
00973 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} read\_capture\_clock\_start 
      $\{::instname\}\_alt\_mem\_phy\_inst|clk|pll|altpll\_component|auto\_generated|clk[3]~clkctrl|outclk\textcolor{comment}{}
00974 \textcolor{comment}{}   \textcolor{keyword}{set} read\_capture\_clock\_end   
      $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group\(\backslash\)[*\(\backslash\)].dq\(\backslash\)[*\(\backslash\)].dqi|auto\_generated|input\_cell\_*\(\backslash\)[0\(\backslash\)]|clk\textcolor{comment}{}
00975 \textcolor{comment}{}   \textcolor{keyword}{set} clock\_max\_paths [get\_path -from $read\_capture\_clock\_start -to $read\_capture\_clock\_end -npaths 
      100]\textcolor{comment}{}
00976 \textcolor{comment}{}   \textcolor{keyword}{set} clock\_min\_paths [get\_path -from $read\_capture\_clock\_start -to $read\_capture\_clock\_end -npaths 
      100 -min\_path]\textcolor{comment}{}
00977 \textcolor{comment}{}   \textcolor{keyword}{set} clock\_max [max_in_collection $clock\_max\_paths "arrival\_time"]\textcolor{comment}{}
00978 \textcolor{comment}{}   \textcolor{keyword}{set} clock\_min [min_in_collection $clock\_min\_paths "arrival\_time"]\textcolor{comment}{}
00979 \textcolor{comment}{}   \textcolor{keyword}{set} minmax\_clock\_variation [\textcolor{keyword}{expr} $clock\_max - $clock\_min]\textcolor{comment}{}
00980 \textcolor{comment}{}       
00981    \textcolor{comment}{#########################################}
00982 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Now compute the margin from the ideal}
00983 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## window with uncertainties taken off}
00984 \textcolor{comment}{}\textcolor{comment}{   }
00985    \textcolor{comment}{# Ideal setup and hold slacks is half of the minimum high time}
00986 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} 0.5*$t(HP)]\textcolor{comment}{}
00987 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} 0.5*$t(HP)]\textcolor{comment}{}
00988 \textcolor{comment}{}   
00989    \textcolor{comment}{# Remove the variation in the DQ signals coming back from the memory in reference to the clock}
00990 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tAC $t(AC)\textcolor{comment}{}
00991 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $tAC]\textcolor{comment}{}
00992 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $tAC]\textcolor{comment}{  }
00993 \textcolor{comment}{}   
00994    \textcolor{comment}{# Remove the variation in the clock and DQ signals inside the FPGA}
00995 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $minmax\_DQ\_variation/2.0 - $minmax\_clock\_variation/2.0]\textcolor{comment}{}
00996 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $minmax\_DQ\_variation/2.0 - $minmax\_clock\_variation/2.0]\textcolor{comment}{}
00997 \textcolor{comment}{}   
00998    \textcolor{comment}{# Remove the uncertaininty in the path tracking}
00999 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} pll\_step\_size [\textcolor{keyword}{expr} $::period / $::pll\_steps]\textcolor{comment}{}
01000 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainity\_steps [get\_micro\_node\_delay -micro MIMIC\_PATH\_UNCERTAINTY -parameters [list IO
       VPAD]]\textcolor{comment}{}
01001 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainty [\textcolor{keyword}{expr} $pll\_step\_size * $phy\_uncertainity\_steps]\textcolor{comment}{}
01002 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $phy\_uncertainty]\textcolor{comment}{}
01003 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $phy\_uncertainty]\textcolor{comment}{}
01004 \textcolor{comment}{}   
01005    \textcolor{comment}{# Remove the worst-case quantization uncertainty}
01006 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $pll\_step\_size/2.0]\textcolor{comment}{}
01007 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $pll\_step\_size/2.0]\textcolor{comment}{}
01008 \textcolor{comment}{}
01009    \textcolor{comment}{# Remove SSN effects}
01010 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::SSN(pushout\_i)]\textcolor{comment}{}
01011 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::SSN(pullin\_i)]\textcolor{comment}{}
01012 \textcolor{comment}{}   
01013    \textcolor{comment}{# Remove the board skew}
01014 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::board(intra\_DQS\_group\_skew)/2]\textcolor{comment}{}
01015 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::board(intra\_DQS\_group\_skew)/2]\textcolor{comment}{}
01016 \textcolor{comment}{}
01017    \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Capture ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
01018 \textcolor{comment}{}\}\textcolor{comment}{}
01019 \textcolor{comment}{}
01020 \textcolor{keyword}{proc} perform\_macro\_read\_capture\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name IP\_name\} \{
01021 
01022    \textcolor{comment}{################################################################################}
01023 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# This timing analysis covers the read timing constraints using the Altera }
01024 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# characterized values.  Altera performs characterization on its devices and IP }
01025 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# to determine all the FPGA uncertainties, and uses these values to provide accurate }
01026 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# timing analysis.  }
01027 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01028 \textcolor{comment}{}
01029    \textcolor{comment}{########################################}
01030 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01031 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01032 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01033 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01034 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01035 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{}
01036 \textcolor{comment}{}   \textcolor{keyword}{global} ::dll\_length\textcolor{comment}{}
01037 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
01038 \textcolor{comment}{}   \textcolor{keyword}{global} ::dqs\_phase\textcolor{comment}{}
01039 \textcolor{comment}{}   \textcolor{keyword}{global} ::tDCD\textcolor{comment}{}
01040 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01041 \textcolor{comment}{}   
01042    \textcolor{comment}{# Convert from DDR1/2 type specs to DDR3 type specs to keep the analysis below simple and concise}
01043 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR2 SDRAM") || ($IP(mem\_if\_memtype) == "DDR SDRAM")\} \{
01044        \textcolor{keyword}{set} t(QH) [\textcolor{keyword}{expr} $::period*(0.5 - $::tDCD) - $t(QHS)]\textcolor{comment}{}
01045 \textcolor{comment}{}   \}\textcolor{comment}{   }
01046 \textcolor{comment}{}   
01047    \textcolor{comment}{# Read capture}
01048 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tDQSQ $t(DQSQ)\textcolor{comment}{}
01049 \textcolor{comment}{}   \textcolor{keyword}{set} tQH $t(QH)\textcolor{comment}{}
01050 \textcolor{comment}{}   \textcolor{keyword}{set} tAC $t(AC)\textcolor{comment}{}
01051 \textcolor{comment}{}   \textcolor{keyword}{if} \{$::family == "cyclone iv"\} \{
01052        \textcolor{keyword}{set} tDCD\_total $t(DCD\_total)\textcolor{comment}{}
01053 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01054        \textcolor{keyword}{set} tDCD\_total 0\textcolor{comment}{}
01055 \textcolor{comment}{}   \}\textcolor{comment}{}
01056 \textcolor{comment}{}   \textcolor{keyword}{set} tmin\_additional\_dqs\_variation $t(min\_additional\_dqs\_variation)\textcolor{comment}{}
01057 \textcolor{comment}{}   \textcolor{keyword}{set} tmax\_additional\_dqs\_variation $t(max\_additional\_dqs\_variation)\textcolor{comment}{}
01058 \textcolor{comment}{}   \textcolor{keyword}{set} all\_read\_dqs\_list [get_all_dqs_pins $pins(dqsgroup)]\textcolor{comment}{}
01059 \textcolor{comment}{}   \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01060        \textcolor{keyword}{set} tsw [get_tsw $IP(mem\_if\_memtype) $all\_read\_dqs\_list $::period -dll\_length $::dll\_length 
      -ddr3\_discrete $IP(discrete\_device)]\textcolor{comment}{}
01061 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
01062        \textcolor{keyword}{set} tsw [get_tsw $IP(mem\_if\_memtype) $all\_read\_dqs\_list $::period]\textcolor{comment}{}
01063 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($::family == "stratix iii") || ($::family == "hardcopy iii") || ($::family == "stratix
       iv") || ($::family == "hardcopy iv")\} \{
01064        \textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 1)\} \{
01065            \textcolor{keyword}{set} tsw [get_tsw $IP(mem\_if\_memtype) $all\_read\_dqs\_list $::period -read\_deskew 
      $IP(read\_deskew\_mode) -dll\_length $::dll\_length -config\_period $::period -ddr3\_discrete 1]\textcolor{comment}{  }
01066 \textcolor{comment}{}       \} \textcolor{keyword}{else} \{
01067            \textcolor{keyword}{set} tsw [get_tsw $IP(mem\_if\_memtype) $all\_read\_dqs\_list $::period -read\_deskew 
      $IP(read\_deskew\_mode) -dll\_length $::dll\_length -config\_period $::period]\textcolor{comment}{            }
01068 \textcolor{comment}{}       \}\textcolor{comment}{}
01069 \textcolor{comment}{}   \}\textcolor{comment}{}
01070 \textcolor{comment}{}   \textcolor{keyword}{set} read\_board\_skew $t(board\_skew)\textcolor{comment}{}
01071 \textcolor{comment}{}
01072    \textcolor{keyword}{if} \{$::family == "cyclone iv"\} \{
01073        \textcolor{keyword}{set} su   [round_3dp [\textcolor{keyword}{expr} \{0.25*$::period - 0.5*$tDCD\_total - $tAC - [lindex $tsw 0]/1000.0 -
       0.5 * $t(board\_skew)\}]]\textcolor{comment}{}
01074 \textcolor{comment}{}       \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} \{0.25*$::period - 0.5*$tDCD\_total - $tAC - [lindex $tsw 1]/1000.0 -
       0.5 * $t(board\_skew)\}]]\textcolor{comment}{}
01075 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01076        \textcolor{keyword}{if} \{($IP(read\_deskew\_mode) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM")\} \{
01077            \textcolor{keyword}{if} \{[\textcolor{keyword}{catch} \{get\_micro\_node\_delay -micro EXTERNAL\_SKEW\_THRESHOLD -parameters [list IO]\} 
      compensated\_skew] != 0 || $compensated\_skew == ""\} \{
01078              \textcolor{comment}{# No skew compensation}
01079 \textcolor{comment}{}\textcolor{comment}{           }\} \textcolor{keyword}{else} \{
01080              \textcolor{keyword}{set} compensated\_skew [\textcolor{keyword}{expr} $compensated\_skew / 1000.0]\textcolor{comment}{}
01081 \textcolor{comment}{}             \textcolor{keyword}{if} \{$t(board\_skew) > $compensated\_skew\} \{
01082                \textcolor{keyword}{set} read\_board\_skew [\textcolor{keyword}{expr} $t(board\_skew) - $compensated\_skew]\textcolor{comment}{}
01083 \textcolor{comment}{}             \} \textcolor{keyword}{else} \{
01084                \textcolor{keyword}{set} read\_board\_skew 0\textcolor{comment}{}
01085 \textcolor{comment}{}             \}\textcolor{comment}{}
01086 \textcolor{comment}{}           \}\textcolor{comment}{}
01087 \textcolor{comment}{}       \}\textcolor{comment}{}
01088 \textcolor{comment}{}
01089        \textcolor{keyword}{set} su   [round_3dp [\textcolor{keyword}{expr} \{$::period*$::dqs\_phase/360.0 - [lindex $tsw 0]/1000.0 - $tDQSQ +
       $tmin\_additional\_dqs\_variation - $read\_board\_skew\}]]\textcolor{comment}{}
01090 \textcolor{comment}{}       \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} \{$tQH - $tmax\_additional\_dqs\_variation - $::period*$::dqs\_phase/360.0
       - [lindex $tsw 1]/1000.0 - $read\_board\_skew\}]]\textcolor{comment}{}
01091 \textcolor{comment}{}   \}\textcolor{comment}{}
01092 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list "All Conditions" 0 "Read Capture (All Conditions)" $su $hold]\textcolor{comment}{}
01093 \textcolor{comment}{}\}\textcolor{comment}{}
01094 \textcolor{comment}{}
01095 
01096 \textcolor{comment}{##############################################################}
01097 \textcolor{comment}{}\textcolor{comment}{## Calibrated Path Analysis}
01098 \textcolor{comment}{}\textcolor{comment}{##############################################################}
01099 \textcolor{comment}{}
01100 \textcolor{keyword}{proc} perform\_macro\_resync\_timing\_analysis \{opcs opcname pin\_array\_name timing\_parameters\_array\_name
       summary\_name MP\_name IP\_name board\_parameters\_name\} \{
01101 
01102    \textcolor{comment}{################################################################################}
01103 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The resynchronization timing analysis concerns transferring read data that}
01104 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# has been captured with a DQS strobe to a clock domain under the control of}
01105 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the ALTMEMPHY. We use a dedicated PLL phase that is calibrated by the}
01106 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# sequencer, and tracks any movements in the data valid window of the captured}
01107 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# data. This means that the exact length of the DQS and CK traces don't affect}
01108 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the timing analysis, and the calibration will remove any static offset from}
01109 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the rest of the path too. With static offset removed, the remaining}
01110 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# uncertainties with be limited to VT variation, jitter and skew (since one}
01111 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# clock phase is chosen for the whole interface).}
01112 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
01113 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01114 \textcolor{comment}{}\textcolor{comment}{   }
01115    \textcolor{comment}{########################################}
01116 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01117 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01118 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01119 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01120 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
01121 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01122 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$board\_parameters\_name board\textcolor{comment}{      }
01123 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01124 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
01125 \textcolor{comment}{}   \textcolor{keyword}{global} ::pll\_steps\textcolor{comment}{}
01126 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
01127 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
01128 \textcolor{comment}{}   \textcolor{keyword}{global} ::dqs\_phase\_setting\textcolor{comment}{}
01129 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01130 \textcolor{comment}{}   
01131    \textcolor{keyword}{set} tDQSCK $t(DQSCK)\textcolor{comment}{}
01132 \textcolor{comment}{}   \textcolor{keyword}{set} fpga\_leveling\_step $IP(quantization\_T9)\textcolor{comment}{}
01133 \textcolor{comment}{}   \textcolor{keyword}{set} fpga\_leveling\_step\_variation [\textcolor{keyword}{expr} $fpga\_leveling\_step*[get\_float\_table\_node\_delay -src 
      \{DELAYCHAIN\_T1\} -dst \{VTVARIATION\} -parameters [list IO $::interface\_type]]*2]\textcolor{comment}{}
01134 \textcolor{comment}{}   \textcolor{keyword}{set} DQS\_clock\_period\_jitter [\textcolor{keyword}{expr} [get\_integer\_node\_delay -integer $::dqs\_phase\_setting -parameters
       \{IO MAX HIGH\} -src DQS\_JITTER]/1000.0]\textcolor{comment}{}
01135 \textcolor{comment}{}   
01136    \textcolor{keyword}{if} \{$::family == "stratix iii"\} \{
01137        \textcolor{keyword}{set} ::tJITper 0.160\textcolor{comment}{}
01138 \textcolor{comment}{}   \}\textcolor{comment}{}
01139 \textcolor{comment}{}   
01140    \textcolor{comment}{# Find DQS clock skew}
01141 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{($::family == "arria ii") || ($::family == "stratix iv")\} \{
01142        \textcolor{keyword}{if} \{$IP(mem\_if\_memtype) == "DDR3 SDRAM"\} \{
01143            \textcolor{keyword}{if} \{($::family == "arria ii") || ($::family == "stratix iv")\} \{
01144                \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01145                    \textcolor{keyword}{set} beforeDQSbus $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dq\_dqs|dqs\_*\_inst|dqsbusout\textcolor{comment}{}
01146 \textcolor{comment}{}                   \textcolor{keyword}{set} afterDQSbus  $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dq\_dqs|bidir\_dq\_*\_ddio\_in\_inst|clk\textcolor{comment}{}
01147 \textcolor{comment}{}               \} \textcolor{keyword}{elseif} \{$::family == "stratix iv"\} \{
01148                    \textcolor{keyword}{set} beforeDQSbus $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dqs\_ip|ddr*\_dqs\_enable\_ctrl\_gen.dqs\_enable\_atom|dqsbusout\textcolor{comment}{}
01149 \textcolor{comment}{}                   \textcolor{keyword}{set} afterDQSbus  $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*].dq[*
      ].dq\_pad|ddr\_dq\_ddio\_in\_gen.dqi\_ddio\_in|clk\textcolor{comment}{}
01150 \textcolor{comment}{}               \}\textcolor{comment}{}
01151 \textcolor{comment}{}               \textcolor{keyword}{set} maxDQSskew [max_in_collection [get\_path -from $beforeDQSbus -to $afterDQSbus] 
      "arrival\_time"]\textcolor{comment}{}
01152 \textcolor{comment}{}               \textcolor{keyword}{set} minDQSskew [min_in_collection [get\_path -from $beforeDQSbus -to $afterDQSbus 
      -min\_path]  "arrival\_time"]\textcolor{comment}{}
01153 \textcolor{comment}{}               \textcolor{keyword}{set} DQS\_clock\_skew [\textcolor{keyword}{expr} $maxDQSskew - $minDQSskew]\textcolor{comment}{}
01154 \textcolor{comment}{}               \textcolor{keyword}{set} resync\_clock\_skew $DQS\_clock\_skew\textcolor{comment}{}
01155 \textcolor{comment}{}           \} \textcolor{keyword}{else} \{
01156                \textcolor{keyword}{set} DQS\_clock\_skew 0.035\textcolor{comment}{}
01157 \textcolor{comment}{}               \textcolor{keyword}{set} resync\_clock\_skew 0.05\textcolor{comment}{      }
01158 \textcolor{comment}{}           \}\textcolor{comment}{}
01159 \textcolor{comment}{}       \} \textcolor{keyword}{else} \{
01160            \textcolor{keyword}{set} DQS\_clock\_skew 0.035\textcolor{comment}{}
01161 \textcolor{comment}{}           \textcolor{keyword}{set} resync\_clock\_skew 0.05\textcolor{comment}{      }
01162 \textcolor{comment}{}       \}\textcolor{comment}{}
01163 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01164        \textcolor{keyword}{set} DQS\_clock\_skew 0.035\textcolor{comment}{}
01165 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_clock\_skew 0.05\textcolor{comment}{}
01166 \textcolor{comment}{}   \}\textcolor{comment}{}
01167 \textcolor{comment}{}   
01168    \textcolor{keyword}{if} \{$family == "stratix iii"\} \{
01169        \textcolor{keyword}{global} ::ip\_pll\_steps\textcolor{comment}{}
01170 \textcolor{comment}{}       \textcolor{keyword}{set} pll\_step\_size [\textcolor{keyword}{expr} $::period / $::ip\_pll\_steps]\textcolor{comment}{}
01171 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01172        \textcolor{keyword}{set} pll\_step\_size [\textcolor{keyword}{expr} $::period / $::pll\_steps]\textcolor{comment}{}
01173 \textcolor{comment}{}   \}\textcolor{comment}{}
01174 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainity\_steps [get\_micro\_node\_delay -micro MIMIC\_PATH\_UNCERTAINTY -parameters [list IO
       VPAD]]\textcolor{comment}{}
01175 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainty [\textcolor{keyword}{expr} $pll\_step\_size * $phy\_uncertainity\_steps * 2]\textcolor{comment}{}
01176 \textcolor{comment}{}   \textcolor{keyword}{set} resync\_clock\_jitter $::tJITper\textcolor{comment}{}
01177 \textcolor{comment}{}   \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01178        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried FF -micro TSU -parameters [list IO 
      $::interface\_type FF RESYNC\_FF]]/1000.0]\textcolor{comment}{}
01179 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th  [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried FF -micro TH  -parameters [list IO 
      $::interface\_type FF RESYNC\_FF]]/1000.0]\textcolor{comment}{}
01180 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$::family == "stratix iv"\} \{
01181        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TSU -parameters [list 
      INPUT\_PHASE\_ALIGNMENT $::interface\_type]]/1000.0]\textcolor{comment}{}
01182 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TH -parameters [list 
      INPUT\_PHASE\_ALIGNMENT $::interface\_type]]/1000.0]\textcolor{comment}{}
01183 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($::family == "stratix iii") || ($::family == "hardcopy iii") || ($::family == "hardcopy
       iv")\} \{
01184        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TSU -parameters [list 
      INPUT\_PHASE\_ALIGNMENT]]/1000.0]\textcolor{comment}{}
01185 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TH -parameters [list 
      INPUT\_PHASE\_ALIGNMENT]]/1000.0]\textcolor{comment}{}
01186 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01187        \textcolor{keyword}{set} resync\_micro\_tsu 0.09\textcolor{comment}{}
01188 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th 0.12\textcolor{comment}{}
01189 \textcolor{comment}{}   \}\textcolor{comment}{}
01190 \textcolor{comment}{}   \textcolor{keyword}{set} max\_read\_leveling\_delay\_steps [\textcolor{keyword}{expr} floor($pll\_step\_size / $fpga\_leveling\_step)]\textcolor{comment}{}
01191 \textcolor{comment}{}   
01192    \textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR2 SDRAM") || ($IP(mem\_if\_memtype) == "DDR SDRAM")\} \{
01193        \textcolor{comment}{# DDR1/2 doesn't have deskew calibration}
01194 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} read\_leveling\_delay\_VT\_variation 0\textcolor{comment}{}
01195 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 1)\} \{ 
01196        \textcolor{keyword}{set} read\_leveling\_delay\_VT\_variation 0\textcolor{comment}{}
01197 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01198        \textcolor{keyword}{set} read\_leveling\_delay\_VT\_variation [\textcolor{keyword}{expr} $max\_read\_leveling\_delay\_steps * 
      $fpga\_leveling\_step\_variation]\textcolor{comment}{}
01199 \textcolor{comment}{}   \}\textcolor{comment}{}
01200 \textcolor{comment}{}   
01201    
01202    \textcolor{keyword}{set} resync\_window [\textcolor{keyword}{expr} $::period - 2 * $tDQSCK - 2 * $::tJITper/2 - 2 * $DQS\_clock\_period\_jitter -
       $DQS\_clock\_skew  - $phy\_uncertainty - $resync\_clock\_skew - 2 * $resync\_clock\_jitter/2 - 2 * 
      $read\_leveling\_delay\_VT\_variation - $resync\_micro\_tsu - $resync\_micro\_th]\textcolor{comment}{}
01203 \textcolor{comment}{}   \textcolor{keyword}{set} su [round_3dp [\textcolor{keyword}{expr} $resync\_window * 0.5]]\textcolor{comment}{}
01204 \textcolor{comment}{}   \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} $resync\_window * 0.5]]\textcolor{comment}{}
01205 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Resync ($opcname)" $su $hold]\textcolor{comment}{}
01206 \textcolor{comment}{}
01207 \}\textcolor{comment}{}
01208 \textcolor{comment}{}
01209 \textcolor{keyword}{proc} perform\_flexible\_resync\_timing\_analysis \{opcs opcname pin\_array\_name timing\_parameters\_array\_name
       summary\_name MP\_name IP\_name SSN\_name board\_parameters\_name\} \{
01210 
01211    \textcolor{comment}{################################################################################}
01212 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The resynchronization timing analysis concerns transferring read data that}
01213 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# has been captured with a DQS strobe to a clock domain under the control of}
01214 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the ALTMEMPHY. We use a dedicated PLL phase that is calibrated by the}
01215 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# sequencer, and tracks any movements in the data valid window of the captured}
01216 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# data. This means that the exact length of the DQS and CK traces don't affect}
01217 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the timing analysis, and the calibration will remove any static offset from}
01218 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# the rest of the path too. With static offset removed, the remaining}
01219 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# uncertainties with be limited to VT variation, jitter and skew (since one}
01220 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# clock phase is chosen for the whole interface).}
01221 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# }
01222 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01223 \textcolor{comment}{}
01224    \textcolor{comment}{########################################}
01225 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01226 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01227 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01228 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01229 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
01230 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$SSN\_name SSN\textcolor{comment}{}
01231 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$board\_parameters\_name board\textcolor{comment}{  }
01232 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{   }
01233 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01234 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
01235 \textcolor{comment}{}   \textcolor{keyword}{global} ::pll\_steps\textcolor{comment}{}
01236 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
01237 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
01238 \textcolor{comment}{}   \textcolor{keyword}{global} ::dqs\_phase\_setting\textcolor{comment}{}
01239 \textcolor{comment}{}   \textcolor{keyword}{global} ::max\_package\_skew\textcolor{comment}{}
01240 \textcolor{comment}{}   \textcolor{keyword}{global} ::io\_std\textcolor{comment}{}
01241 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01242 \textcolor{comment}{}   
01243    \textcolor{comment}{########################################}
01244 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
01245 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!(($::family == "arria ii") || ($::family == "stratix iv") || ($::family == "hardcopy iii") ||
       ($::family == "hardcopy iv"))\} \{
01246        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
01247 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
01248 \textcolor{comment}{}   \}\textcolor{comment}{}
01249 \textcolor{comment}{}   
01250    \textcolor{comment}{# Arria II resync-register-in-periphery-check}
01251 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01252        \textcolor{keyword}{set} resync\_dly [max_in_collection [get\_path -from *ddio\_in\_inst\_regout* -to *rdata\_*\_ams*] 
      "arrival\_time"]\textcolor{comment}{}
01253 \textcolor{comment}{}       \textcolor{keyword}{if} \{$resync\_dly > 0.2\} \{
01254            post\_message -type warning "Resynchronization registers are placed in the FPGA core causing
       Read Resync timing to fail"\textcolor{comment}{}
01255 \textcolor{comment}{}           \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} 0 - $resync\_dly]\textcolor{comment}{}
01256 \textcolor{comment}{}           \textcolor{keyword}{set} hold\_slack $setup\_slack\textcolor{comment}{}
01257 \textcolor{comment}{}           \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Resync ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
01258 \textcolor{comment}{}           \textcolor{keyword}{return}\textcolor{comment}{}
01259 \textcolor{comment}{}       \}\textcolor{comment}{}
01260 \textcolor{comment}{}   \}\textcolor{comment}{       }
01261 \textcolor{comment}{}   
01262    \textcolor{comment}{# Ideal setup and hold slacks is half the period}
01263 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} 0.5*$::period]\textcolor{comment}{}
01264 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} 0.5*$::period]\textcolor{comment}{}
01265 \textcolor{comment}{}   
01266    \textcolor{comment}{# Remove the variation in the clock coming back from the memory}
01267 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tDQSCK $t(DQSCK)\textcolor{comment}{}
01268 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
01269        \textcolor{keyword}{set} tDQSCK [\textcolor{keyword}{expr} (1.0-$MP(DQSCK))*$tDQSCK]\textcolor{comment}{}
01270 \textcolor{comment}{}   \}\textcolor{comment}{}
01271 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $tDQSCK]\textcolor{comment}{}
01272 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $tDQSCK]\textcolor{comment}{   }
01273 \textcolor{comment}{}   
01274    \textcolor{comment}{# Remove setup and hold times of the register}
01275 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01276        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried FF -micro TSU -parameters [list IO 
      $::interface\_type FF RESYNC\_FF]]/1000.0]\textcolor{comment}{}
01277 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th  [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried FF -micro TH  -parameters [list IO 
      $::interface\_type FF RESYNC\_FF]]/1000.0]\textcolor{comment}{}
01278 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$::family == "stratix iv"\} \{
01279        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TSU -parameters [list 
      INPUT\_PHASE\_ALIGNMENT $::interface\_type]]/1000.0]\textcolor{comment}{}
01280 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TH -parameters [list 
      INPUT\_PHASE\_ALIGNMENT $::interface\_type]]/1000.0]\textcolor{comment}{}
01281 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($::family == "hardcopy iv") || ($::family == "hardcopy iii")\} \{
01282        \textcolor{keyword}{set} resync\_micro\_tsu [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TSU -parameters [list 
      INPUT\_PHASE\_ALIGNMENT]]/1000.0]\textcolor{comment}{}
01283 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_micro\_th [\textcolor{keyword}{expr} [get\_ff\_node\_delay -buried IN0\_DFF -micro TH -parameters [list 
      INPUT\_PHASE\_ALIGNMENT]]/1000.0]\textcolor{comment}{}
01284 \textcolor{comment}{}   \}\textcolor{comment}{}
01285 \textcolor{comment}{}   \textcolor{keyword}{set} resync\_micro\_tsu\_th [\textcolor{keyword}{expr} ($resync\_micro\_tsu + $resync\_micro\_th)/2]\textcolor{comment}{}
01286 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $resync\_micro\_tsu\_th]\textcolor{comment}{}
01287 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $resync\_micro\_tsu\_th]\textcolor{comment}{}
01288 \textcolor{comment}{}   
01289    \textcolor{comment}{# Remove the DQS clock (and resync clock) skew}
01290 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(mem\_if\_memtype) == "DDR3 SDRAM"\} \{
01291        \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01292            \textcolor{keyword}{set} beforeDQSbus $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dq\_dqs|dqs\_*\_inst|dqsbusout\textcolor{comment}{}
01293 \textcolor{comment}{}           \textcolor{keyword}{set} afterDQSbus  $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dq\_dqs|bidir\_dq\_*\_ddio\_in\_inst|clk\textcolor{comment}{}
01294 \textcolor{comment}{}       \} \textcolor{keyword}{elseif} \{($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family ==
       "hardcopy iv")\} \{
01295            \textcolor{keyword}{set} beforeDQSbus $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*
      ].dqs\_ip|ddr*\_dqs\_enable\_ctrl\_gen.dqs\_enable\_atom|dqsbusout\textcolor{comment}{}
01296 \textcolor{comment}{}           \textcolor{keyword}{set} afterDQSbus  $\{::instname\}\_alt\_mem\_phy\_inst|dpio|dqs\_group[*].dq[*
      ].dq\_pad|ddr\_dq\_ddio\_in\_gen.dqi\_ddio\_in|clk\textcolor{comment}{}
01297 \textcolor{comment}{}       \}\textcolor{comment}{}
01298 \textcolor{comment}{}       \textcolor{keyword}{set} maxDQSskew [max_in_collection [get\_path -from $beforeDQSbus -to $afterDQSbus] 
      "arrival\_time"]\textcolor{comment}{}
01299 \textcolor{comment}{}       \textcolor{keyword}{set} minDQSskew [min_in_collection [get\_path -from $beforeDQSbus -to $afterDQSbus -min\_path]  
      "arrival\_time"]\textcolor{comment}{}
01300 \textcolor{comment}{}       \textcolor{keyword}{set} DQS\_clock\_skew [\textcolor{keyword}{expr} $maxDQSskew - $minDQSskew]\textcolor{comment}{}
01301 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_clock\_skew $DQS\_clock\_skew\textcolor{comment}{}
01302 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01303        \textcolor{keyword}{set} DQS\_clock\_skew 0.035\textcolor{comment}{}
01304 \textcolor{comment}{}       \textcolor{keyword}{set} resync\_clock\_skew 0.05\textcolor{comment}{  }
01305 \textcolor{comment}{}   \}\textcolor{comment}{}
01306 \textcolor{comment}{}   
01307    \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $DQS\_clock\_skew/2 - $resync\_clock\_skew/2]\textcolor{comment}{}
01308 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $DQS\_clock\_skew/2 - $resync\_clock\_skew/2]\textcolor{comment}{  }
01309 \textcolor{comment}{}   
01310    \textcolor{comment}{# Remove the jitter on the clock out to the memory and the resync clock  }
01311 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} resync\_clock\_jitter $::tJITper\textcolor{comment}{}
01312 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::tJITper/2 - $resync\_clock\_jitter/2]\textcolor{comment}{}
01313 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::tJITper/2 - $resync\_clock\_jitter/2]\textcolor{comment}{}
01314 \textcolor{comment}{}   
01315    \textcolor{comment}{# Remove the jitter on the input path (This is the full peak-to-peak jitter)}
01316 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} DQS\_delay\_chain\_period\_jitter [\textcolor{keyword}{expr} [get\_integer\_node\_delay -integer $::dqs\_phase\_setting 
      -parameters \{IO MAX HIGH\} -src DQS\_JITTER]/1000.0]\textcolor{comment}{}
01317 \textcolor{comment}{}   \textcolor{keyword}{set} DQS\_path\_period\_jitter        [\textcolor{keyword}{expr} [get\_io\_standard\_node\_delay -dst DQDQS\_JITTER -io\_standard 
      $::io\_std -parameters [list IO $::interface\_type]]/1000.0]\textcolor{comment}{}
01318 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $DQS\_delay\_chain\_period\_jitter/2 - $DQS\_path\_period\_jitter/2]\textcolor{comment}{}
01319 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $DQS\_delay\_chain\_period\_jitter/2 - $DQS\_path\_period\_jitter/2]\textcolor{comment}{  }
01320 \textcolor{comment}{}   
01321    \textcolor{comment}{# Remove the uncertaininty in the mimic path tracking}
01322 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} pll\_step\_size [\textcolor{keyword}{expr} $::period / $::pll\_steps]\textcolor{comment}{}
01323 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainity\_steps [get\_micro\_node\_delay -micro MIMIC\_PATH\_UNCERTAINTY -parameters [list IO
       VPAD]]\textcolor{comment}{}
01324 \textcolor{comment}{}   \textcolor{keyword}{set} phy\_uncertainty [\textcolor{keyword}{expr} $pll\_step\_size * $phy\_uncertainity\_steps]\textcolor{comment}{}
01325 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $phy\_uncertainty]\textcolor{comment}{}
01326 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $phy\_uncertainty]\textcolor{comment}{}
01327 \textcolor{comment}{}   
01328    \textcolor{comment}{# Remove the uncertainty due to VT variations in T7}
01329 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(mem\_if\_memtype) == "DDR3 SDRAM"\} \{
01330        \textcolor{keyword}{set} max\_t7\_delay [\textcolor{keyword}{expr} $t(board\_skew) + $::max\_package\_skew + $t(DQS\_PSERR\_min) + 
      $DQS\_clock\_skew]\textcolor{comment}{}
01331 \textcolor{comment}{}       \textcolor{keyword}{set} t7\_vt\_variation\_percent [get\_float\_table\_node\_delay -src \{DELAYCHAIN\_T1\} -dst \{VTVARIATION\}
       -parameters [list IO $::interface\_type]]\textcolor{comment}{}
01332 \textcolor{comment}{}       \textcolor{keyword}{set} t7\_vt\_variation [\textcolor{keyword}{expr} $max\_t7\_delay*$t7\_vt\_variation\_percent*2]\textcolor{comment}{}
01333 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t7\_vt\_variation]\textcolor{comment}{}
01334 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $t7\_vt\_variation]\textcolor{comment}{  }
01335 \textcolor{comment}{}   \}\textcolor{comment}{}
01336 \textcolor{comment}{}   
01337    \textcolor{comment}{# Remove the worst-case quantization uncertainty}
01338 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR3 SDRAM") && ($IP(discrete\_device) == 0)\} \{
01339        \textcolor{keyword}{set} read\_levelling\_phase\_step [get\_micro\_node\_delay -micro RL\_PHASE\_TAP -parameters [list IO 
      $::interface\_type]]\textcolor{comment}{}
01340 \textcolor{comment}{}       \textcolor{keyword}{set} quantization\_error [\textcolor{keyword}{expr} $read\_levelling\_phase\_step/360.0*$::period]\textcolor{comment}{}
01341 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $quantization\_error/2.0]\textcolor{comment}{}
01342 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $quantization\_error/2.0]\textcolor{comment}{}
01343 \textcolor{comment}{}   \} \textcolor{keyword}{else} \{
01344        \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $pll\_step\_size/2]\textcolor{comment}{}
01345 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $pll\_step\_size/2]\textcolor{comment}{}
01346 \textcolor{comment}{}       \textcolor{comment}{#Also consider the inter-DQS skew here (only effects non-levelled cases)}
01347 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $board(inter\_DQS\_group\_skew)/2]\textcolor{comment}{}
01348 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $board(inter\_DQS\_group\_skew)/2]\textcolor{comment}{}
01349 \textcolor{comment}{}   \}\textcolor{comment}{}
01350 \textcolor{comment}{}   
01351    \textcolor{comment}{# Remove SSN effects}
01352 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::SSN(pushout\_o) - $::SSN(pushout\_i)]\textcolor{comment}{}
01353 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::SSN(pullin\_o)  - $::SSN(pullin\_i)]\textcolor{comment}{}
01354 \textcolor{comment}{}   \textcolor{comment}{# Remove Multirank board skew effects - Calibration will calibrate to the average of multiple ranks}
01355 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(num\_ranks) > 1\} \{
01356        \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $board(tpd\_inter\_DIMM)]\textcolor{comment}{}
01357 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $board(tpd\_inter\_DIMM)]\textcolor{comment}{}
01358 \textcolor{comment}{}   \}\textcolor{comment}{}
01359 \textcolor{comment}{}   
01360    \textcolor{keyword}{lappend} summary [list $opcname 0 "Read Resync ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
01361 \textcolor{comment}{}   
01362 \}\textcolor{comment}{}
01363 \textcolor{comment}{}
01364 \textcolor{keyword}{proc} perform\_macro\_write\_levelling\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name MP\_name IP\_name board\_parameters\_name ISI\_parameters\_name\} \{
01365 
01366    \textcolor{comment}{################################################################################}
01367 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The write levelling analysis concerns meeting the DDR3 requirements between DQS }
01368 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# and CK such as tDQSS and tDSH/tDSS.  The write-levelling is achieved through }
01369 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# calibration by changing the phase of the DQS signal until levelling is complete }
01370 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# at the memory.  Because of this, the exact length of the DQS and CK traces }
01371 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# don't affect the timing analysis, and the calibration will remove any static }
01372 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# offset from the rest of the path too.  With static offset removed, the }
01373 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# remaining uncertainties with be limited to mostly VT variation, and jitter.}
01374 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01375 \textcolor{comment}{}
01376    \textcolor{comment}{########################################}
01377 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01378 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01379 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01380 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01381 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01382 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{   }
01383 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$board\_parameters\_name board\textcolor{comment}{  }
01384 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$ISI\_parameters\_name ISI\textcolor{comment}{}
01385 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01386 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
01387 \textcolor{comment}{}   \textcolor{keyword}{global} ::pll\_steps\textcolor{comment}{}
01388 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
01389 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITdty\textcolor{comment}{}
01390 \textcolor{comment}{}   \textcolor{keyword}{global} ::tDCD\textcolor{comment}{}
01391 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
01392 \textcolor{comment}{}   \textcolor{keyword}{global} ::dll\_length\textcolor{comment}{}
01393 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01394 \textcolor{comment}{}   
01395    \textcolor{comment}{# The ALTMEMPHY write leveling algorithm increases the DQS output phase and delay until the first
       0->1 is found in the write leveling feedback, thus DQS is slightly skewed 1 step to the right of ideal
       alignment with CK}
01396 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} mem\_fmax [\textcolor{keyword}{expr} 1.0/$t(period)*1000.0]\textcolor{comment}{}
01397 \textcolor{comment}{}   \textcolor{keyword}{set} min\_period [round_3dp [\textcolor{keyword}{expr} 1000.0/$mem\_fmax]]\textcolor{comment}{}
01398 \textcolor{comment}{}
01399    \textcolor{keyword}{set} tWLS $t(WLS)\textcolor{comment}{}
01400 \textcolor{comment}{}   \textcolor{keyword}{set} tWLH $t(WLH)\textcolor{comment}{}
01401 \textcolor{comment}{}   \textcolor{keyword}{set} tDQSS\_CK $t(DQSS)\textcolor{comment}{}
01402 \textcolor{comment}{}   \textcolor{keyword}{set} tDQSS [\textcolor{keyword}{expr} $tDQSS\_CK * $::period]\textcolor{comment}{}
01403 \textcolor{comment}{}   
01404    \textcolor{keyword}{set} fpga\_leveling\_step $IP(quantization\_T9)\textcolor{comment}{}
01405 \textcolor{comment}{}   \textcolor{keyword}{set} fpga\_leveling\_step\_variation [\textcolor{keyword}{expr} $fpga\_leveling\_step*[get\_float\_table\_node\_delay -src 
      \{DELAYCHAIN\_T9\} -dst \{VTVARIATION\} -parameters [list IO $::interface\_type]]*2]\textcolor{comment}{}
01406 \textcolor{comment}{}
01407    \textcolor{comment}{# tDQSS specification}
01408 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} max\_write\_leveling\_delay\_steps [\textcolor{keyword}{expr} floor($::period / $::dll\_length / $fpga\_leveling\_step)]\textcolor{comment}{}
01409 \textcolor{comment}{}   \textcolor{keyword}{set} write\_leveling\_delay\_VT\_variation [\textcolor{keyword}{expr} $max\_write\_leveling\_delay\_steps * 
      $fpga\_leveling\_step\_variation]\textcolor{comment}{}
01410 \textcolor{comment}{}   \textcolor{keyword}{set} min\_write\_leveling\_inaccuracy [\textcolor{keyword}{expr} $tWLS + $write\_leveling\_delay\_VT\_variation]\textcolor{comment}{}
01411 \textcolor{comment}{}   \textcolor{keyword}{set} max\_write\_leveling\_inaccuracy [\textcolor{keyword}{expr} $tWLH + $write\_leveling\_delay\_VT\_variation + 
      $fpga\_leveling\_step]\textcolor{comment}{}
01412 \textcolor{comment}{}   
01413    \textcolor{keyword}{set} su [round_3dp [\textcolor{keyword}{expr} $tDQSS - $min\_write\_leveling\_inaccuracy]]\textcolor{comment}{}
01414 \textcolor{comment}{}   \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} $tDQSS - $max\_write\_leveling\_inaccuracy]]\textcolor{comment}{}
01415 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list $opcname 0 "Write Leveling tDQSS ($opcname)" $su $hold]\textcolor{comment}{}
01416 \textcolor{comment}{}   
01417    \textcolor{comment}{# tDSS/tDSH specification}
01418 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} CK\_period\_jitter $::tJITper\textcolor{comment}{}
01419 \textcolor{comment}{}   \textcolor{keyword}{set} tDSS\_CK $t(DSS)\textcolor{comment}{}
01420 \textcolor{comment}{}   \textcolor{keyword}{set} tDSH\_CK $t(DSH)\textcolor{comment}{}
01421 \textcolor{comment}{}   \textcolor{keyword}{set} tDSS [\textcolor{keyword}{expr} $tDSS\_CK * $::period]\textcolor{comment}{}
01422 \textcolor{comment}{}   \textcolor{keyword}{set} tDSH [\textcolor{keyword}{expr} $tDSH\_CK * $::period]\textcolor{comment}{}
01423 \textcolor{comment}{}   \textcolor{keyword}{set} min\_DQS\_low [\textcolor{keyword}{expr} $::period*(0.5 - $::tDCD) - $::tJITdty]\textcolor{comment}{}
01424 \textcolor{comment}{}   \textcolor{keyword}{set} min\_DQS\_high [\textcolor{keyword}{expr} $::period*(0.5 - $::tDCD) - $::tJITdty]\textcolor{comment}{}
01425 \textcolor{comment}{}   
01426    \textcolor{keyword}{set} su [round_3dp [\textcolor{keyword}{expr} $min\_DQS\_low - $max\_write\_leveling\_inaccuracy - $CK\_period\_jitter/2 - $tDSS
      ]]\textcolor{comment}{}
01427 \textcolor{comment}{}   \textcolor{keyword}{set} hold [round_3dp [\textcolor{keyword}{expr} $min\_DQS\_high - $min\_write\_leveling\_inaccuracy - $tDSH]]\textcolor{comment}{}
01428 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list $opcname 0 "Write Leveling tDSS/tDSH ($opcname)" $su $hold]\textcolor{comment}{}
01429 \textcolor{comment}{}
01430 \}\textcolor{comment}{}
01431 \textcolor{comment}{}
01432 
01433 \textcolor{keyword}{proc} perform\_flexible\_write\_levelling\_timing\_analysis \{opcs opcname pin\_array\_name
       timing\_parameters\_array\_name summary\_name  MP\_name IP\_name SSN\_name board\_parameters\_name ISI\_parameters\_name\} \{
01434 
01435    \textcolor{comment}{################################################################################}
01436 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The write levelling analysis concerns meeting the DDR3 requirements between DQS }
01437 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# and CK such as tDQSS and tDSH/tDSS.  The write-levelling is achieved through }
01438 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# calibration by changing the phase of the DQS signal until levelling is complete }
01439 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# at the memory.  Because of this, the exact length of the DQS and CK traces }
01440 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# don't affect the timing analysis, and the calibration will remove any static }
01441 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# offset from the rest of the path too.  With static offset removed, the }
01442 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# remaining uncertainties with be limited to mostly VT variation, and jitter.}
01443 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01444 \textcolor{comment}{}
01445    \textcolor{comment}{########################################}
01446 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01447 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01448 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01449 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01450 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$MP\_name MP\textcolor{comment}{}
01451 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$SSN\_name SSN\textcolor{comment}{}
01452 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01453 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$board\_parameters\_name board\textcolor{comment}{}
01454 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$ISI\_parameters\_name ISI\textcolor{comment}{  }
01455 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01456 \textcolor{comment}{}   \textcolor{keyword}{global} ::period\textcolor{comment}{}
01457 \textcolor{comment}{}   \textcolor{keyword}{global} ::pll\_steps\textcolor{comment}{}
01458 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITper\textcolor{comment}{}
01459 \textcolor{comment}{}   \textcolor{keyword}{global} ::tJITdty\textcolor{comment}{}
01460 \textcolor{comment}{}   \textcolor{keyword}{global} ::tDCD\textcolor{comment}{}
01461 \textcolor{comment}{}   \textcolor{keyword}{global} ::interface\_type\textcolor{comment}{}
01462 \textcolor{comment}{}   \textcolor{keyword}{global} ::dll\_length\textcolor{comment}{}
01463 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01464 \textcolor{comment}{}   
01465    \textcolor{comment}{########################################}
01466 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
01467 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!(($::family == "stratix iv") || ($::family == "hardcopy iii") || ($::family == "hardcopy
       iv"))\} \{
01468        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
01469 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
01470 \textcolor{comment}{}   \}\textcolor{comment}{       }
01471 \textcolor{comment}{}   
01472    \textcolor{comment}{#################################}
01473 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## tDQSS specification}
01474 \textcolor{comment}{}\textcolor{comment}{   }
01475    \textcolor{comment}{# Ideal setup and hold slacks is the tDQSS specification}
01476 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tDQSS\_CK $t(DQSS)\textcolor{comment}{}
01477 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
01478        \textcolor{keyword}{set} tDQSS\_CK [\textcolor{keyword}{expr} 0.5 - (1-$MP(DQSS))*(0.5-$t(DQSS))]\textcolor{comment}{}
01479 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$IP(mp\_calibration) == 1\} \{
01480        \textcolor{keyword}{set} tDQSS\_CK [\textcolor{keyword}{expr} 0.5 - (1-$MP(DQSS)/2)*(0.5-$t(DQSS))]\textcolor{comment}{}
01481 \textcolor{comment}{}   \}\textcolor{comment}{}
01482 \textcolor{comment}{}   \textcolor{keyword}{set} tDQSS [\textcolor{keyword}{expr} $tDQSS\_CK * $::period]\textcolor{comment}{}
01483 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack $tDQSS\textcolor{comment}{}
01484 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  $tDQSS\textcolor{comment}{}
01485 \textcolor{comment}{}   
01486    \textcolor{comment}{# Remove the setup and hold times of the WL register in the memory}
01487 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tWLS $t(WLS)\textcolor{comment}{}
01488 \textcolor{comment}{}   \textcolor{keyword}{set} tWLH $t(WLH)\textcolor{comment}{}
01489 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
01490        \textcolor{keyword}{set} tWLS [\textcolor{keyword}{expr} (1-$MP(WLS))*$tWLS]\textcolor{comment}{}
01491 \textcolor{comment}{}       \textcolor{keyword}{set} tWLH [\textcolor{keyword}{expr} (1-$MP(WLH))*$tWLH]\textcolor{comment}{}
01492 \textcolor{comment}{}   \}\textcolor{comment}{}
01493 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $tWLH]\textcolor{comment}{}
01494 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $tWLS]\textcolor{comment}{ }
01495 \textcolor{comment}{}   
01496    \textcolor{comment}{# Remove the uncertainty due to VT variations in T9}
01497 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} write\_levelling\_phase\_step [get\_micro\_node\_delay -micro WL\_PHASE\_TAP -parameters [list IO 
      $::interface\_type]]\textcolor{comment}{}
01498 \textcolor{comment}{}   \textcolor{keyword}{set} max\_t9\_delay [\textcolor{keyword}{expr} $write\_levelling\_phase\_step/360.0*$::period]\textcolor{comment}{}
01499 \textcolor{comment}{}   \textcolor{keyword}{set} t9\_vt\_variation\_percent [get\_float\_table\_node\_delay -src \{DELAYCHAIN\_T9\} -dst \{VTVARIATION\} 
      -parameters [list IO $::interface\_type]]\textcolor{comment}{}
01500 \textcolor{comment}{}   \textcolor{keyword}{set} t9\_vt\_variation [\textcolor{keyword}{expr} $max\_t9\_delay*$t9\_vt\_variation\_percent*2]\textcolor{comment}{}
01501 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t9\_vt\_variation]\textcolor{comment}{}
01502 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $t9\_vt\_variation]\textcolor{comment}{}
01503 \textcolor{comment}{}   
01504    \textcolor{comment}{# Remove the jitter on the clock out to the memory (CK and DQS could be in worst-case directions) }
01505 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::tJITper/2 - $::tJITper/2]\textcolor{comment}{}
01506 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::tJITper/2 - $::tJITper/2]\textcolor{comment}{}
01507 \textcolor{comment}{}   
01508    \textcolor{comment}{# Remove the jitter on the Write Levelling delay chains (this is peak-to-peak jitter}
01509 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} WL\_jitter [\textcolor{keyword}{expr} [get\_micro\_node\_delay -micro WL\_JITTER -parameters [list IO $::interface\_type]
      ]/1000.0]\textcolor{comment}{}
01510 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $WL\_jitter/2]\textcolor{comment}{}
01511 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $WL\_jitter/2]\textcolor{comment}{  }
01512 \textcolor{comment}{}   
01513    \textcolor{comment}{# Remove SSN effects}
01514 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::SSN(pushout\_o) - $::SSN(pullin\_o)]\textcolor{comment}{}
01515 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::SSN(pushout\_o) - $::SSN(pullin\_o)]\textcolor{comment}{  }
01516 \textcolor{comment}{}   
01517    \textcolor{comment}{# Remove Multirank board skew effects - Calibration will calibrate to the average of multiple ranks}
01518 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(num\_ranks) > 1\} \{
01519        \textcolor{keyword}{set} max\_calibration\_offset [\textcolor{keyword}{expr} abs($board(maxCK\_DQS\_skew) - $board(minCK\_DQS\_skew))]\textcolor{comment}{}
01520 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $max\_calibration\_offset - $ISI(DQS)/2]\textcolor{comment}{}
01521 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $max\_calibration\_offset - $ISI(DQS)/2]\textcolor{comment}{}
01522 \textcolor{comment}{}   \}\textcolor{comment}{       }
01523 \textcolor{comment}{}   
01524    \textcolor{comment}{# Remove the worst-case quantization uncertainty}
01525 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The ALTMEMPHY write leveling algorithm increases the DQS output phase and delay until the first
       0->1 is found in }
01526 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{#   the write leveling feedback, thus DQS is slightly skewed 1 step to the right of ideal alignment
       with CK}
01527 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} hold\_slack [\textcolor{keyword}{expr} $hold\_slack - $IP(quantization\_T9)]\textcolor{comment}{}
01528 \textcolor{comment}{}   
01529    \textcolor{keyword}{lappend} summary [list $opcname 0 "Write Leveling tDQSS ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
01530 \textcolor{comment}{}   
01531    \textcolor{comment}{#################################}
01532 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## tDSS/tDSH specification  }
01533 \textcolor{comment}{}\textcolor{comment}{   }
01534    \textcolor{comment}{# Ideal setup and hold slacks is half the period}
01535 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} 0.5*$::period]\textcolor{comment}{}
01536 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} 0.5*$::period]\textcolor{comment}{    }
01537 \textcolor{comment}{}   
01538    \textcolor{comment}{# Remove the setup and hold times of the WL register in the memory}
01539 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $tWLS]\textcolor{comment}{}
01540 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $tWLH]\textcolor{comment}{}
01541 \textcolor{comment}{}   
01542    \textcolor{comment}{# Remove the tDSS and tDSH specifications}
01543 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} tDSS\_CK $t(DSS)\textcolor{comment}{}
01544 \textcolor{comment}{}   \textcolor{keyword}{set} tDSH\_CK $t(DSH)\textcolor{comment}{}
01545 \textcolor{comment}{}   \textcolor{keyword}{if} \{($IP(mp\_calibration) == 1) && ($IP(num\_ranks) == 1)\} \{
01546        \textcolor{keyword}{set} tDSS\_CK [\textcolor{keyword}{expr} (1.0-$MP(DSS))*$t(DSS)]\textcolor{comment}{}
01547 \textcolor{comment}{}       \textcolor{keyword}{set} tDSH\_CK [\textcolor{keyword}{expr} (1.0-$MP(DSH))*$t(DSH)]\textcolor{comment}{   }
01548 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$IP(mp\_calibration) == 1\} \{
01549        \textcolor{keyword}{set} tDSS\_CK [\textcolor{keyword}{expr} (1.0-$MP(DSS)/2.5)*$t(DSS)]\textcolor{comment}{}
01550 \textcolor{comment}{}       \textcolor{keyword}{set} tDSH\_CK [\textcolor{keyword}{expr} (1.0-$MP(DSH)/2.5)*$t(DSH)]\textcolor{comment}{   }
01551 \textcolor{comment}{}   \}\textcolor{comment}{}
01552 \textcolor{comment}{}   \textcolor{keyword}{set} tDSS [\textcolor{keyword}{expr} $tDSS\_CK * $::period]\textcolor{comment}{}
01553 \textcolor{comment}{}   \textcolor{keyword}{set} tDSH [\textcolor{keyword}{expr} $tDSH\_CK * $::period]\textcolor{comment}{}
01554 \textcolor{comment}{}   \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $tDSS]\textcolor{comment}{}
01555 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $tDSH]\textcolor{comment}{}
01556 \textcolor{comment}{}   
01557    \textcolor{comment}{# Remove the uncertainty due to VT variations in T9}
01558 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{#set write\_levelling\_phase\_step [get\_micro\_node\_delay -micro WL\_PHASE\_STEP -parameters [list IO
       VPAD]]}
01559 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t9\_vt\_variation]\textcolor{comment}{}
01560 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $t9\_vt\_variation]\textcolor{comment}{      }
01561 \textcolor{comment}{}   
01562    \textcolor{comment}{# Remove the jitter on the clock out to the memory (CK and DQS could be in worst-case directions) }
01563 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::tJITper/2 - $::tJITper/2]\textcolor{comment}{}
01564 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::tJITper/2 - $::tJITper/2]\textcolor{comment}{}
01565 \textcolor{comment}{}   
01566    \textcolor{comment}{# Remove the jitter on the Write Levelling delay chains (this is peak-to-peak jitter}
01567 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $WL\_jitter/2]\textcolor{comment}{}
01568 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $WL\_jitter/2]\textcolor{comment}{  }
01569 \textcolor{comment}{}   
01570    \textcolor{comment}{# Remove SSN effects}
01571 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $::SSN(pushout\_o) - $::SSN(pullin\_o)]\textcolor{comment}{}
01572 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $::SSN(pushout\_o) - $::SSN(pullin\_o)]\textcolor{comment}{      }
01573 \textcolor{comment}{}   
01574    \textcolor{comment}{# Multirank derating}
01575 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$IP(num\_ranks) > 1\} \{
01576        \textcolor{keyword}{set} max\_calibration\_offset [\textcolor{keyword}{expr} abs($board(maxCK\_DQS\_skew) - $board(minCK\_DQS\_skew))]\textcolor{comment}{}
01577 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $max\_calibration\_offset - $ISI(DQS)/2]\textcolor{comment}{}
01578 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $max\_calibration\_offset - $ISI(DQS)/2]\textcolor{comment}{}
01579 \textcolor{comment}{}   \}\textcolor{comment}{       }
01580 \textcolor{comment}{}   
01581    \textcolor{comment}{# Remove the worst-case quantization uncertainty}
01582 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The ALTMEMPHY write leveling algorithm increases the DQS output phase and delay until the first
       0->1 is found in }
01583 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{#   the write leveling feedback, thus DQS is slightly skewed 1 step to the right of ideal alignment
       with CK}
01584 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $IP(quantization\_T9)]\textcolor{comment}{  }
01585 \textcolor{comment}{}   
01586    \textcolor{comment}{# Duty Cycle Effects}
01587 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $t(WL\_DCJ) - $t(WL\_DCD)]\textcolor{comment}{}
01588 \textcolor{comment}{}   \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack  - $t(WL\_DCJ) - $t(WL\_DCD)]\textcolor{comment}{           }
01589 \textcolor{comment}{}   
01590    \textcolor{comment}{# Duty Cycle Correction}
01591 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{($IP(write\_dcc) == "dynamic") && ($IP(mem\_if\_memtype) == "DDR3 SDRAM")\} \{
01592        \textcolor{comment}{#First remove the Systematic DCD}
01593 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack + $t(WL\_DCD)]\textcolor{comment}{}
01594 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack + $t(WL\_DCD)]\textcolor{comment}{}
01595 \textcolor{comment}{}       
01596        \textcolor{comment}{#Add errors in the DCC}
01597 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} DCC\_quantization $IP(quantization\_DCC)\textcolor{comment}{}
01598 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $DCC\_quantization]\textcolor{comment}{}
01599 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $DCC\_quantization]\textcolor{comment}{}
01600 \textcolor{comment}{}       
01601        \textcolor{comment}{# Consider variation in the DCC }
01602 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} dcc\_vt\_variation\_percent [get\_float\_table\_node\_delay -src \{DELAYCHAIN\_DUTY\_CYCLE\} -dst 
      \{VTVARIATION\} -parameters [list IO $::interface\_type]]\textcolor{comment}{}
01603 \textcolor{comment}{}       \textcolor{keyword}{set} dcc\_variation [\textcolor{keyword}{expr} $t(WL\_DCD)*2*$dcc\_vt\_variation\_percent]\textcolor{comment}{}
01604 \textcolor{comment}{}       \textcolor{keyword}{set} setup\_slack [\textcolor{keyword}{expr} $setup\_slack - $dcc\_variation]\textcolor{comment}{}
01605 \textcolor{comment}{}       \textcolor{keyword}{set} hold\_slack  [\textcolor{keyword}{expr} $hold\_slack - $dcc\_variation]\textcolor{comment}{     }
01606 \textcolor{comment}{}   \}\textcolor{comment}{   }
01607 \textcolor{comment}{}
01608    \textcolor{keyword}{lappend} summary [list $opcname 0 "Write Leveling tDSS/tDSH ($opcname)" $setup\_slack $hold\_slack]\textcolor{comment}{}
01609 \textcolor{comment}{}
01610 \}\textcolor{comment}{}
01611 \textcolor{comment}{}
01612 \textcolor{comment}{##############################################################}
01613 \textcolor{comment}{}\textcolor{comment}{## Other Timing Analysis}
01614 \textcolor{comment}{}\textcolor{comment}{##############################################################}
01615 \textcolor{comment}{}
01616 \textcolor{keyword}{proc} perform\_phy\_analyses \{opcs opcname pin\_array\_name timing\_parameters\_array\_name summary\_name
       IP\_name\} \{
01617 
01618    \textcolor{comment}{################################################################################}
01619 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The PHY analysis concerns the timing requirements of the PHY which includes}
01620 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# soft registers in the FPGA core as well as some registers in the hard periphery}
01621 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The read capture and write registers are not analyzed here, even though they }
01622 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# are part of the PHY since they are timing analyzed separately. }
01623 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01624 \textcolor{comment}{}
01625    \textcolor{comment}{########################################}
01626 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01627 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01628 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01629 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01630 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01631 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01632 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqspins\textcolor{comment}{}
01633 \textcolor{comment}{}   \textcolor{keyword}{global} ::full\_instance\_name\textcolor{comment}{}
01634 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01635 \textcolor{comment}{}   
01636    \textcolor{comment}{########################################}
01637 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Check family support}
01638 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{!(($::family == "stratix iii") || ($::family == "hardcopy iii") || ($::family == "arria ii") ||
       ($::family == "stratix iv") || ($::family == "hardcopy iv") || ($::family == "cyclone iv"))\} \{
01639        \textcolor{keyword}{puts} "The report\_timing script does not support the $::family device family"\textcolor{comment}{}
01640 \textcolor{comment}{}       \textcolor{keyword}{return}\textcolor{comment}{}
01641 \textcolor{comment}{}   \}\textcolor{comment}{       }
01642 \textcolor{comment}{}
01643    \textcolor{comment}{# Some of the paths that would be analyzed by default in the Phy timing analysis are already report
       by the Read Capture analysis}
01644 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# Do not repeat the timing analysis of those paths}
01645 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} all\_phy\_registers [get\_registers  "$::full\_instance\_name|*"]\textcolor{comment}{}
01646 \textcolor{comment}{}   \textcolor{keyword}{if} \{$::family == "arria ii"\} \{
01647        \textcolor{keyword}{set} DFF\_low\_registers [get\_registers "$::full\_instance\_name|*ddio\_in\_inst~DFFLO"]\textcolor{comment}{}
01648 \textcolor{comment}{}       \textcolor{keyword}{set} DFF\_high\_registers [get\_registers "$::full\_instance\_name|*\_ddio\_in\_inst\_regouthi"]\textcolor{comment}{}
01649 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{$::family == "cyclone iv"\} \{
01650        \textcolor{keyword}{set} DFF\_low\_registers [get\_registers "$::full\_instance\_name|*input\_cell\_l[*]"]\textcolor{comment}{}
01651 \textcolor{comment}{}       \textcolor{keyword}{set} DFF\_high\_registers [get\_registers "$::full\_instance\_name|*input\_cell\_h[*]"]\textcolor{comment}{}
01652 \textcolor{comment}{}   \} \textcolor{keyword}{elseif} \{($::family == "stratix iii") || ($::family == "hardcopy iii") || ($::family == "stratix
       iv") || ($::family == "hardcopy iv")\}  \{
01653        \textcolor{keyword}{set} DFF\_low\_registers [get\_registers 
      "$::full\_instance\_name|*dq\_pad|ddr\_dq\_ddio\_in\_gen.dqi\_ddio\_in~DFFLO"]\textcolor{comment}{}
01654 \textcolor{comment}{}       \textcolor{keyword}{set} DFF\_high\_registers [get\_registers "$::full\_instance\_name|*dq\_pad|dqi\_captured\_h"]\textcolor{comment}{}
01655 \textcolor{comment}{}   \}\textcolor{comment}{}
01656 \textcolor{comment}{}   \textcolor{keyword}{if} \{[get\_collection\_size $DFF\_low\_registers] != 0\} \{
01657        \textcolor{keyword}{set} all\_phy\_registers [remove\_from\_collection $all\_phy\_registers $DFF\_low\_registers]\textcolor{comment}{}
01658 \textcolor{comment}{}   \}\textcolor{comment}{}
01659 \textcolor{comment}{}   \textcolor{keyword}{if} \{[get\_collection\_size $DFF\_high\_registers] != 0\} \{
01660        \textcolor{keyword}{set} all\_phy\_registers [remove\_from\_collection $all\_phy\_registers $DFF\_high\_registers]\textcolor{comment}{}
01661 \textcolor{comment}{}   \}\textcolor{comment}{       }
01662 \textcolor{comment}{}   \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to $all\_phy\_registers -npaths 100 -panel\_name 
      "$::instname Phy \(\backslash\)u0028setup\(\backslash\)u0029" -setup]\textcolor{comment}{}
01663 \textcolor{comment}{}   \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to $all\_phy\_registers -npaths 100 -panel\_name 
      "$::instname Phy \(\backslash\)u0028hold\(\backslash\)u0029" -hold]\textcolor{comment}{}
01664 \textcolor{comment}{}   \textcolor{keyword}{if} \{$::family == "cyclone iv"\} \{
01665        \textcolor{comment}{# Need to also report the clock to read capture registers here for Cyclone device families}
01666 \textcolor{comment}{}\textcolor{comment}{       }\textcolor{keyword}{set} res\_00 [report\_timing -detail full\_path -from [\textcolor{keyword}{lindex} $pins(ck\_p) 0] -to 
      $DFF\_high\_registers -npaths 100 -panel\_name "$::instname Phy \(\backslash\)u0028setup 2\(\backslash\)u0029" -setup]\textcolor{comment}{}
01667 \textcolor{comment}{}       \textcolor{keyword}{set} res\_11 [report\_timing -detail full\_path -from [\textcolor{keyword}{lindex} $pins(ck\_p) 0] -to 
      $DFF\_high\_registers -npaths 100 -panel\_name "$::instname Phy \(\backslash\)u0028hold 2\(\backslash\)u0029" -hold]\textcolor{comment}{}
01668 \textcolor{comment}{}       \textcolor{keyword}{lset} res\_0 1 [min [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_00 1]]\textcolor{comment}{}
01669 \textcolor{comment}{}       \textcolor{keyword}{lset} res\_1 1 [min [\textcolor{keyword}{lindex} $res\_1 1] [\textcolor{keyword}{lindex} $res\_11 1]]\textcolor{comment}{}
01670 \textcolor{comment}{}   \}\textcolor{comment}{}
01671 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list $opcname 0 "Phy ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_1 1]]\textcolor{comment}{  }
01672 \textcolor{comment}{}
01673    \textcolor{comment}{# Phy Reset}
01674 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to [get\_registers  "$::full\_instance\_name|*"] -npaths 
      100 -panel\_name "$::instname Phy Reset \(\backslash\)u0028recovery\(\backslash\)u0029" -recovery]\textcolor{comment}{}
01675 \textcolor{comment}{}   \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to [get\_registers  "$::full\_instance\_name|*"] -npaths 
      100 -panel\_name "$::instname Phy Reset \(\backslash\)u0028removal\(\backslash\)u0029" -removal]\textcolor{comment}{}
01676 \textcolor{comment}{}   \textcolor{keyword}{lappend} summary [list $opcname 0 "Phy Reset ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_1 1]]\textcolor{comment}{    }
01677 \textcolor{comment}{}   
01678    \textcolor{comment}{# Mimic}
01679 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{$::family == "cyclone iv"\} \{
01680        \textcolor{keyword}{set} res\_1 [list xxx ""]\textcolor{comment}{}
01681 \textcolor{comment}{}       \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -from $pins(ck\_p) -to * -npaths 100 -panel\_name 
      "$::instname Mimic \(\backslash\)u0028setup\(\backslash\)u0029" -setup]\textcolor{comment}{}
01682 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Mimic ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_1 1]]\textcolor{comment}{}
01683 \textcolor{comment}{}   \}\textcolor{comment}{}
01684 \textcolor{comment}{}\}\textcolor{comment}{}
01685 \textcolor{comment}{}
01686 \textcolor{keyword}{proc} perform\_ac\_analyses \{opcs opcname pin\_array\_name timing\_parameters\_array\_name summary\_name
       IP\_name\} \{
01687 
01688    \textcolor{comment}{################################################################################}
01689 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# The adress/command analysis concerns the timing requirements of the pins (other}
01690 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# than the DQ pins) which go to the memory device/DIMM.  These include address/command}
01691 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# pins, some of which are runing at Single-Data-Rate (SDR) and some which are }
01692 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# running at Half-Data-Rate (HDR).  The CK vs DQS requirement for DDR1/2 also occurs}
01693 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{# here.}
01694 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{################################################################################}
01695 \textcolor{comment}{}
01696    \textcolor{comment}{########################################}
01697 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Need access to global variables}
01698 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{upvar} 1 $summary\_name summary\textcolor{comment}{}
01699 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$timing\_parameters\_array\_name t\textcolor{comment}{}
01700 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 $pin\_array\_name pins\textcolor{comment}{}
01701 \textcolor{comment}{}   \textcolor{keyword}{upvar} 1 ::$IP\_name IP\textcolor{comment}{}
01702 \textcolor{comment}{}   \textcolor{keyword}{global} ::instname\textcolor{comment}{   }
01703 \textcolor{comment}{}   \textcolor{keyword}{global} ::alldqspins\textcolor{comment}{}
01704 \textcolor{comment}{}   \textcolor{keyword}{global} ::full\_instance\_name\textcolor{comment}{}
01705 \textcolor{comment}{}   \textcolor{keyword}{global} ::family\textcolor{comment}{}
01706 \textcolor{comment}{}
01707    \textcolor{comment}{########################################}
01708 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## Address/Command Analysis     }
01709 \textcolor{comment}{}
01710    \textcolor{comment}{# Address Command}
01711 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{[\textcolor{keyword}{llength} $pins(addrcmd)] > 0\} \{
01712        \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to $pins(addrcmd) -npaths 100 -panel\_name 
      "$::instname Address Command \(\backslash\)u0028setup\(\backslash\)u0029" -setup]\textcolor{comment}{}
01713 \textcolor{comment}{}       \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to $pins(addrcmd) -npaths 100 -panel\_name 
      "$::instname Address Command \(\backslash\)u0028hold\(\backslash\)u0029" -hold]\textcolor{comment}{}
01714 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Address Command ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_1 
      1]]\textcolor{comment}{}
01715 \textcolor{comment}{}   \}\textcolor{comment}{}
01716 \textcolor{comment}{}   
01717    \textcolor{comment}{# Half Rate Address/Command}
01718 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{keyword}{if} \{[\textcolor{keyword}{llength} $pins(addrcmd\_2t)] > 0\} \{
01719        \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to $pins(addrcmd\_2t) -npaths 100 -panel\_name 
      "$::instname Half Rate Address/Command \(\backslash\)u0028setup\(\backslash\)u0029" -setup]\textcolor{comment}{}
01720 \textcolor{comment}{}       \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to $pins(addrcmd\_2t) -npaths 100 -panel\_name 
      "$::instname Half Rate Address/Command \(\backslash\)u0028hold\(\backslash\)u0029" -hold]\textcolor{comment}{}
01721 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "Half Rate Address/Command ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{
      lindex} $res\_1 1]]\textcolor{comment}{}
01722 \textcolor{comment}{}   \}\textcolor{comment}{}
01723 \textcolor{comment}{}   
01724    \textcolor{comment}{########################################}
01725 \textcolor{comment}{}\textcolor{comment}{   }\textcolor{comment}{## DQS vs CK (For DDR1/2 only)}
01726 \textcolor{comment}{}\textcolor{comment}{   }
01727    \textcolor{keyword}{if} \{($IP(mem\_if\_memtype) == "DDR2 SDRAM") || ($IP(mem\_if\_memtype) == "DDR SDRAM")\} \{
01728        \textcolor{keyword}{set} res\_0 [report\_timing -detail full\_path -to [get\_ports $::alldqspins] -npaths 100 
      -panel\_name "$::instname DQS vs CK \(\backslash\)u0028setup\(\backslash\)u0029" -setup]\textcolor{comment}{}
01729 \textcolor{comment}{}       \textcolor{keyword}{set} res\_1 [report\_timing -detail full\_path -to [get\_ports $::alldqspins] -npaths 100 
      -panel\_name "$::instname DQS vs CK \(\backslash\)u0028hold\(\backslash\)u0029" -hold]\textcolor{comment}{}
01730 \textcolor{comment}{}       \textcolor{keyword}{lappend} summary [list $opcname 0 "DQS vs CK ($opcname)" [\textcolor{keyword}{lindex} $res\_0 1] [\textcolor{keyword}{lindex} $res\_1 1]]\textcolor{comment}{}
01731 \textcolor{comment}{}   \}\textcolor{comment}{}
01732 \textcolor{comment}{}\}
\end{DoxyCode}
