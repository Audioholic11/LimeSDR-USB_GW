\subsection{rd\+\_\+tx\+\_\+fifo.\+vhd}
\label{rd__tx__fifo_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+modules/rd\+\_\+tx\+\_\+fifo.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+modules/rd\+\_\+tx\+\_\+fifo.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    rd\_tx\_fifo.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: reads data from fifo and forms IQ samples}
00004 \textcolor{keyword}{-- DATE:    Apr 11, 2016}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00013 \textcolor{keyword}{-- Entity declaration}
00014 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00015 \textcolor{keywordflow}{entity }rd_tx_fifo \textcolor{keywordflow}{is}
00016   \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width} \textcolor{vhdlchar}{:} \textcolor{comment}{integer}\textcolor{vhdlchar}{:=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}\textcolor{vhdlchar}{)};
00017   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00018 \textcolor{keyword}{        --input ports }
00019       \textcolor{vhdlchar}{clk}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00020       \textcolor{vhdlchar}{reset_n}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00021       \textcolor{vhdlchar}{fr_start}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00022       \textcolor{vhdlchar}{ch_en}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00023       \textcolor{vhdlchar}{mimo_en}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00024       \textcolor{vhdlchar}{fifo_empty}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00025       \textcolor{vhdlchar}{fifo_data} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00026 \textcolor{keyword}{        --output ports }
00027       \textcolor{vhdlchar}{fifo_read} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00028       \textcolor{vhdlchar}{diq_h}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00029       \textcolor{vhdlchar}{diq_l}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}
00030         \textcolor{vhdlchar}{)};
00031 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{rd\_tx\_fifo};
00032 
00033 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00034 \textcolor{keyword}{-- Architecture}
00035 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00036 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} rd_tx_fifo is
00037 \textcolor{keyword}{--declare signals,  components here}
00038 
00039   \textcolor{keywordflow}{type} \textcolor{vhdlchar}{smpl_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{tx\_A}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{tx\_B}\textcolor{vhdlchar}{)};
00040   \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_smpl_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_smpl_state} \textcolor{vhdlchar}{:}  \textcolor{vhdlchar}{smpl_state}; 
00041   
00042   \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{read_sig}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00043   \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iq_sel_sig} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00044   \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iq_sel}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00045   \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_data_reg}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 
00047   
00048 \textcolor{vhdlkeyword}{begin}
00049   
00050 \textcolor{keyword}{------------------------------------------------------------------------------}
00051 \textcolor{keyword}{--iq sel formation}
00052 \textcolor{keyword}{------------------------------------------------------------------------------        }
00053 \textcolor{keywordflow}{process}(current_smpl_state, fifo_empty)\textcolor{keywordflow}{begin}
00054     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_smpl_state}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{tx\_A} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00055             \textcolor{vhdlchar}{iq_sel_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}; 
00056     \textcolor{keywordflow}{else}
00057           \textcolor{vhdlchar}{iq_sel_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00058     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00059 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00060 
00061 
00062 \textcolor{vhdlchar}{iq_sel}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel_sig} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{fr_start}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{else} 
00063         \textcolor{keywordflow}{not} \textcolor{vhdlchar}{iq_sel_sig}; 
00064   
00065 \textcolor{keyword}{------------------------------------------------------------------------------}
00066 \textcolor{keyword}{--sample formatyion}
00067 \textcolor{keyword}{------------------------------------------------------------------------------   }
00068  \textcolor{keywordflow}{process}(current_smpl_state, ch_en, iq_sel, fifo_data, mimo_en, fifo_data_reg) \textcolor{keywordflow}{begin} 
00069     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_smpl_state}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{tx\_A}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00070       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00071         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00072         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00073         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074       
00075         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00076         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00077         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{16-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
00078       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}  
00079         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00080         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00081         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00082       
00083         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00084         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00085         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00086       \textcolor{keywordflow}{else}
00087         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00088         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00089         \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00090         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00091         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00092         \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00093       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00094       
00095     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_smpl_state}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{tx\_b}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00096         \textcolor{keywordflow}{if}  \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00097           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00098           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00099           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00100       
00101           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00102           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00103           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{16-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
00104         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00105           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00106           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00107           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00108       
00109           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00110           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00111           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00112         \textcolor{keywordflow}{else}
00113           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00114           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00115           \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{16-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
00116           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00117           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{iq_sel};
00118           \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data_reg}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sampl_width}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{16-1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
00119         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00120         \textcolor{keywordflow}{else} 
00121             \textcolor{vhdlchar}{diq_h}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00122             \textcolor{vhdlchar}{diq_l}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00123      \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00124    
00125  \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00126   
00127 
00128 \textcolor{keyword}{-------------------------------------------------------------------------------}
00129 \textcolor{keyword}{--fifo read signal}
00130 \textcolor{keyword}{-------------------------------------------------------------------------------  }
00131 \textcolor{keywordflow}{process}(current_smpl_state, fifo_empty, ch_en, mimo_en) \textcolor{keywordflow}{begin}
00132     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_smpl_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{tx\_A} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00133        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00134             \textcolor{vhdlchar}{read_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00135        \textcolor{keywordflow}{else}
00136             \textcolor{vhdlchar}{read_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00137          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00138     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_smpl_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{tx\_B} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00139        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00140             \textcolor{vhdlchar}{read_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00141        \textcolor{keywordflow}{else}
00142             \textcolor{vhdlchar}{read_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00143          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00144     \textcolor{keywordflow}{else} 
00145         \textcolor{vhdlchar}{read_sig}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00146     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00147 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00148 
00149 \textcolor{vhdlchar}{fifo_read}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{read_sig};
00150 
00151 \textcolor{keyword}{-------------------------------------------------------------------------------}
00152 \textcolor{keyword}{--sample formation state machine}
00153 \textcolor{keyword}{-------------------------------------------------------------------------------}
00154 smpl\_fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n) \textcolor{keywordflow}{begin}
00155     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00156         \textcolor{vhdlchar}{current_smpl_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00157         \textcolor{vhdlchar}{fifo_data_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00158     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00159         \textcolor{vhdlchar}{current_smpl_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_smpl_state};
00160         \textcolor{vhdlchar}{fifo_data_reg}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{fifo_data};
00161     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00162 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00163 
00164 smpl\_fsm : \textcolor{keywordflow}{process}(current_smpl_state, fifo_empty)
00165 \textcolor{vhdlkeyword}{begin}
00166   
00167     \textcolor{vhdlchar}{next_smpl_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_smpl_state};
00168     
00169     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_smpl_state} \textcolor{keywordflow}{is}
00170 
00171       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00172        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00173           \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tx\_A};
00174       \textcolor{keywordflow}{else}
00175           \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{idle};
00176       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00177    
00178       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{tx\_A}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00179           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00180               \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tx\_A};           
00181           \textcolor{keywordflow}{else}
00182               \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tx\_B};
00183           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00184           
00185       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{tx\_B}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00186           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{fifo_empty}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00187               \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tx\_B};
00188           \textcolor{keywordflow}{else}
00189               \textcolor{vhdlchar}{next_smpl_state}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{tx\_A};
00190           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};  
00191       \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00192         
00193       \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00194 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process}; 
00195   
00196 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};
00197 
00198 
00199 
00200 
\end{DoxyCode}
