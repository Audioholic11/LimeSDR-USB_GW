\subsection{gpio\+\_\+chirp\+\_\+sync\+\_\+top.\+vhd}
\label{gpio__chirp__sync__top_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/gpio\+\_\+chirp\+\_\+sync/gpio\+\_\+chirp\+\_\+sync\+\_\+top.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/gpio\+\_\+chirp\+\_\+sync/gpio\+\_\+chirp\+\_\+sync\+\_\+top.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    gpio\_sync\_top.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION:  }
00004 \textcolor{keyword}{-- DATE:    July 1, 2018}
00005 \textcolor{keyword}{-- AUTHOR(s):   Erik Moore DU2SRI}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 
00009 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00010 \textcolor{keyword}{-- Notes: To Sync with external square signal on the rising edge}
00011 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00012 
00013 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00014 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00015 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00016 
00017 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00018 \textcolor{keyword}{-- Entity declaration}
00019 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00020 \textcolor{keywordflow}{entity }gpio_chirp_sync_top \textcolor{keywordflow}{is}
00021    \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(}
00022       \textcolor{vhdlchar}{chirp_sync_width}      \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{64}\textcolor{keyword}{ --bus width in bits  }
00023    \textcolor{vhdlchar}{)};
00024    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00025       \textcolor{vhdlchar}{clk}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00026         \textcolor{vhdlchar}{counter_clk}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00027       \textcolor{vhdlchar}{reset_n}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00028         
00029 \textcolor{keyword}{        -- Chirp Sync I/Os}
00030         \textcolor{vhdlchar}{chirp_sig}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00031         \textcolor{vhdlchar}{sync_period}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{chirp_sync_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00032         \textcolor{vhdlchar}{chirp_trig}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00033         
00034         \textcolor{vhdlchar}{TESTOUT}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00035       
00036 \textcolor{keyword}{        --Mode settings}
00037       \textcolor{vhdlchar}{sample_width}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"10"-12bit, "01"-14bit, "00"-16bit;}
00038       \textcolor{vhdlchar}{mode}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- JESD207: 1; TRXIQ: 0}
00039       \textcolor{vhdlchar}{trxiqpulse}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- trxiqpulse on: 1; trxiqpulse off: 0}
00040       \textcolor{vhdlchar}{ddr_en}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- DDR: 1; SDR: 0}
00041       \textcolor{vhdlchar}{mimo_en}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- MIMO: 1; SISO: 0}
00042       \textcolor{vhdlchar}{ch_en}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"01" - Ch. A, "10" - Ch. B, "11" - Ch. A
       and Ch. B. }
00043         \textcolor{vhdlchar}{chirp_sync_en}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}\textcolor{keyword}{  -- chirp sync enable}
00044      
00045         \textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{gpio\_chirp\_sync\_top};
00047 
00048 
00049 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00050 \textcolor{keyword}{-- Architecture}
00051 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00052 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} gpio_chirp_sync_top is
00053 \textcolor{keyword}{--declare signals,  components her}
00054 
00055 \textcolor{keyword}{--sync registers}
00056 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{reset_n_sync}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00057 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sample_width_sync}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00058 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mode_sync}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00059 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{trxiqpulse_sync}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00060 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ddr_en_sync}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic}; 
00061 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mimo_en_sync}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ch_en_sync}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00063 
00064 \textcolor{keyword}{--inst0}
00065 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_chirp_signal}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00066 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_chirp_trig}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00067 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_load_counter}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00068 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_enable_counter} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00069 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_U_D}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00070 
00071 \textcolor{keyword}{--inst5}
00072 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst5_q}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{chirp_sync_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{q_hold}                   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{chirp_sync_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 
00075 \textcolor{keyword}{--internal signals}
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sld_counter}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sclr_counter}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00078 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{data_counter}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{chirp_sync_width}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00079 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{counter_enable}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};    
00080 
00081 
00082 
00083 \textcolor{keyword}{-- ----------------------------------------------------------------------------       }
00084 \textcolor{keyword}{-- gpio\_sync\_FSM(RSET,CLK,SIG,E,L,U\_D,TRIG);}
00085 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00086 \textcolor{keywordflow}{component} gpio\_sync\_FSM \textcolor{keywordflow}{is}
00087     \textcolor{keywordflow}{port}(
00088         RSET        : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00089         CLK     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00090         SIG     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00091         E           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00092         L           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00093         U\_D     : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00094         TRIG        : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}     
00095         );
00096 \textcolor{keywordflow}{end} \textcolor{keywordflow}{component};
00097 
00098 
00099 \textcolor{vhdlkeyword}{begin}
00100 \textcolor{keyword}{-- Default sld and data (only use sclr)}
00101 
00102 \textcolor{keyword}{--sld\_counter <= '0';}
00103 \textcolor{vhdlchar}{sclr_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00104 \textcolor{vhdlchar}{data_counter} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{data_counter}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00105 \textcolor{keyword}{--counter\_enable <= inst0\_enable\_counter and counter\_clk;}
00106 \textcolor{vhdlchar}{counter_enable} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst0_enable_counter};
00107 
00108 inst0\_chirp\_signal <= chirp\_sig;
00109 
00110 \textcolor{keyword}{ -- --------------------------------------------------------------------------        }
00111 \textcolor{keyword}{-- gpio\_sync\_FSM(RSET,CLK,SIG,CLK\_1,E,L,U\_D,TRIG);}
00112 \textcolor{keyword}{-- ---------------------------------------------------------------------------}
00113 
00114 \textcolor{keyword}{--gpio\_sync\_FMS\_inst0 : gpio\_sync\_FSM port map(}
00115 \textcolor{keyword}{--      reset\_n\_sync,}
00116 \textcolor{keyword}{--      clk,}
00117 \textcolor{keyword}{--      inst0\_chirp\_signal,}
00118 \textcolor{keyword}{--      inst0\_enable\_counter,}
00119 \textcolor{keyword}{--      inst0\_load\_counter}
00120 \textcolor{keyword}{--      inst0\_U\_D,}
00121 \textcolor{keyword}{--      inst0\_chirp\_trig}
00122 \textcolor{keyword}{--      );}
00123 
00124 
00125 \textcolor{keyword}{ -- --------------------------------------------------------------------------        }
00126 \textcolor{keyword}{-- Instance of FSM }
00127 \textcolor{keyword}{-- ---------------------------------------------------------------------------}
00128 gpio\_chirp\_sync\_FSM\_inst0 : \textcolor{keywordflow}{entity} work.gpio_chirp_sync_FSM
00129 
00130     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00131         clk               => clk,
00132       reset_n           => reset_n_sync,
00133       sig                   => inst0_chirp_signal,
00134         enable              => inst0_enable_counter,
00135         load                    => inst0_load_counter,
00136         u_d                 => inst0_U_D,
00137         trig                    => inst0_chirp_trig
00138         \textcolor{vhdlchar}{)};
00139 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00140 \textcolor{keyword}{-- Instance for packing sample counter}
00141 \textcolor{keyword}{-- ----------------------------------------------------------------------------        }
00142 smpl\_cnt\_inst5 : \textcolor{keywordflow}{entity} work.smpl_cnt
00143    \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
00144       cnt_width   => chirp_sync_width
00145    \textcolor{vhdlchar}{)}
00146    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00147 
00148       clk         => clk,
00149       reset_n     => reset_n_sync,
00150       mode        => mode_sync,
00151       trxiqpulse  => trxiqpulse_sync,
00152       ddr_en      => ddr_en_sync,
00153       mimo_en     => mimo_en_sync,
00154       ch_en       => ch_en_sync,
00155       sclr        => sclr_counter,
00156       sload       => inst0_load_counter,
00157       data        => data_counter,
00158       cnt_en      => counter_enable,
00159       q           => inst5_q        
00160         \textcolor{vhdlchar}{)};
00161 
00162 
00163 trigger\_hold: \textcolor{keywordflow}{process}(reset_n, clk)
00164 \textcolor{vhdlkeyword}{begin}
00165     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00166         \textcolor{vhdlchar}{q_hold} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};         
00167     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00168         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{inst0_chirp_trig} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00169         \textcolor{vhdlchar}{q_hold} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst5_q};
00170         \textcolor{keywordflow}{else}
00171         \textcolor{vhdlchar}{q_hold} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{q_hold};
00172         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00173  \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00174 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{trigger\_hold};
00175 \textcolor{keyword}{-- bus\_sync\_reg1 : entity work.bus\_sync\_reg}
00176 \textcolor{keyword}{--generic map (chirp\_sync\_width)}
00177 \textcolor{keyword}{--port map(inst0\_chirp\_trig, '1', inst5\_q, q\_hold);}
00178         
00179 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00180 \textcolor{keyword}{-- sync registers}
00181 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00182 sync\_reg0 : \textcolor{keywordflow}{entity} work.sync_reg 
00183 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', reset_n, reset_n_sync\textcolor{vhdlchar}{)};
00184 
00185 sync\_reg1 : \textcolor{keywordflow}{entity} work.sync_reg 
00186 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', mode, mode_sync\textcolor{vhdlchar}{)};
00187 
00188 sync\_reg2 : \textcolor{keywordflow}{entity} work.sync_reg 
00189 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', trxiqpulse, trxiqpulse_sync\textcolor{vhdlchar}{)};
00190 
00191 sync\_reg3 : \textcolor{keywordflow}{entity} work.sync_reg 
00192 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', ddr_en, ddr_en_sync\textcolor{vhdlchar}{)};
00193 
00194 sync\_reg4 : \textcolor{keywordflow}{entity} work.sync_reg 
00195 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', mimo_en, mimo_en_sync\textcolor{vhdlchar}{)};
00196 
00197 
00198 bus\_sync\_reg0 : \textcolor{keywordflow}{entity} work.bus_sync_reg
00199 \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}
00200 \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(clk, '1', ch_en, ch_en_sync\textcolor{vhdlchar}{)};
00201         
00202 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00203 \textcolor{keyword}{-- Outputs}
00204 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00205 \textcolor{vhdlchar}{chirp_trig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst0_chirp_trig};
00206 \textcolor{vhdlchar}{sync_period} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{q_hold};
00207 
00208 \textcolor{vhdlchar}{TESTOUT} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst5_q}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
00209 
00210 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
\end{DoxyCode}
