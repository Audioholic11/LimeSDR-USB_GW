\subsection{sample\+\_\+nr\+\_\+cnt\+\_\+mimo.\+vhd}
\label{sample__nr__cnt__mimo_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+packets/sample\+\_\+nr\+\_\+cnt\+\_\+mimo.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+packets/sample\+\_\+nr\+\_\+cnt\+\_\+mimo.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    sample\_nr\_cnt\_mimo.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: counter for pct sample nr}
00004 \textcolor{keyword}{-- DATE:    June 25, 2015}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00009 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00010 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00011 
00012 \textcolor{vhdlkeyword}{LIBRARY }\textcolor{keywordflow}{lpm};
00013 \textcolor{vhdlkeyword}{USE }\textcolor{keywordflow}{lpm.all};
00014 
00015 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00016 \textcolor{keyword}{-- Entity declaration}
00017 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00018 \textcolor{keywordflow}{entity }sample_nr_cnt_mimo \textcolor{keywordflow}{is}
00019   \textcolor{keywordflow}{generic}\textcolor{vhdlchar}{(}
00020           \textcolor{vhdlchar}{ch_num}         \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}
00021   \textcolor{vhdlchar}{)};
00022   \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00023 \textcolor{keyword}{        --input ports }
00024         \textcolor{vhdlchar}{clk}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00025         \textcolor{vhdlchar}{reset_n}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00026         \textcolor{vhdlchar}{en}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00027         \textcolor{vhdlchar}{fifo_wr}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00028         \textcolor{vhdlchar}{mimo_en}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00029         \textcolor{vhdlchar}{ch_en}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ch_num}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00030 \textcolor{keyword}{                  --output ports }
00031         \textcolor{vhdlchar}{sample_nr} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00032           \textcolor{vhdlchar}{clr_smpl_nr}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
00033 
00034         \textcolor{vhdlchar}{)};
00035 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{sample\_nr\_cnt\_mimo};
00036 
00037 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00038 \textcolor{keyword}{-- Architecture}
00039 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00040 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} sample_nr_cnt_mimo is
00041 \textcolor{keyword}{--declare signals,  components here}
00042 \textcolor{keyword}{--signal lpm\_cnt\_aclr       : std\_logic;}
00043 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{lpm_cnt_cnten}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00044 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{en_reg0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{en_reg1} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00045 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sample_nrcnt}     \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fifo_wr_reg}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00047 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{active_ch_cnt}    \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00048  
00049 
00050     \textcolor{keywordflow}{COMPONENT} lpm\_counter
00051     \textcolor{keywordflow}{GENERIC} (
00052         lpm\_direction           : \textcolor{comment}{STRING};
00053         lpm\_port\_updown     : \textcolor{comment}{STRING};
00054         lpm\_type                    : \textcolor{comment}{STRING};
00055         lpm\_width               : \textcolor{comment}{NATURAL}
00056     );
00057     \textcolor{keywordflow}{PORT} (
00058             aclr        : \textcolor{keywordflow}{IN} \textcolor{comment}{STD\_LOGIC} ;
00059             clock       : \textcolor{keywordflow}{IN} \textcolor{comment}{STD\_LOGIC} ;
00060             cnt\_en  : \textcolor{keywordflow}{IN} \textcolor{comment}{STD\_LOGIC} ;
00061             q           : \textcolor{keywordflow}{OUT} \textcolor{comment}{STD\_LOGIC\_VECTOR} (\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{DOWNTO} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0})
00062     );
00063     \textcolor{keywordflow}{END} \textcolor{keywordflow}{COMPONENT};
00064 
00065 \textcolor{vhdlkeyword}{begin}
00066     
00067     
00068             lpm_cnt_inst : LPM\_COUNTER
00069     \textcolor{keywordflow}{GENERIC} \textcolor{keywordflow}{MAP} (
00070         lpm\_direction       => \textcolor{keyword}{"UP"},
00071         lpm\_port\_updown     => \textcolor{keyword}{"PORT\_UNUSED"},
00072         lpm\_type            => \textcolor{keyword}{"LPM\_COUNTER"},
00073         lpm\_width           => \textcolor{vhdllogic}{64}
00074     \textcolor{vhdlchar}{)}
00075     \textcolor{keywordflow}{PORT} \textcolor{keywordflow}{MAP} (
00076         aclr        => clr_smpl_nr,
00077         clock   => clk,
00078         cnt\_en  => lpm_cnt_cnten,
00079         q           => sample_nr
00080     \textcolor{vhdlchar}{)};
00081 
00082 \textcolor{keyword}{-------------------------------------------------------------------------------}
00083 \textcolor{keyword}{-- signal registers}
00084 \textcolor{keyword}{-------------------------------------------------------------------------------     }
00085   \textcolor{keywordflow}{process}(reset_n, clk)
00086 \textcolor{vhdlkeyword}{    begin}
00087       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00088        \textcolor{vhdlchar}{en_reg0}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00089        \textcolor{vhdlchar}{en_reg1}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00090 \textcolor{keyword}{       --fifo\_wr\_reg<='0';}
00091         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00092 \textcolor{keyword}{          --fifo\_wr\_reg<=fifo\_wr;}
00093           \textcolor{vhdlchar}{en_reg0}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{en};
00094           \textcolor{vhdlchar}{en_reg1}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{en_reg0};
00095         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00096     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00097     
00098 \textcolor{keyword}{-------------------------------------------------------------------------------}
00099 \textcolor{keyword}{-- to count active channels}
00100 \textcolor{keyword}{-------------------------------------------------------------------------------    }
00101       \textcolor{keywordflow}{process} (reset_n, clk) 
00102         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{sum} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}; 
00103 \textcolor{vhdlkeyword}{    begin }
00104       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00105         \textcolor{vhdlchar}{active_ch_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}; 
00106       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00107         \textcolor{vhdlchar}{sum}\textcolor{vhdlchar}{:=}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00108         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{k} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{ch_num} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00109            \textcolor{keywordflow}{if}  \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{k}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}              
00110                  \textcolor{vhdlchar}{sum} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sum} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00111            \textcolor{keywordflow}{else} 
00112                \textcolor{vhdlchar}{sum} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sum};
00113              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00114         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop}; 
00115         \textcolor{vhdlchar}{active_ch_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sum}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{active_ch_cnt}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}; 
00116       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00117     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00118     
00119 \textcolor{keyword}{-------------------------------------------------------------------------------}
00120 \textcolor{keyword}{-- counter }
00121 \textcolor{keyword}{-------------------------------------------------------------------------------   }
00122       \textcolor{keywordflow}{process}(reset_n, clk)
00123 \textcolor{vhdlkeyword}{    begin}
00124       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00125           \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00126         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00127           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{en_reg1}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
00128             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{fifo_wr}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00129                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{<}\textcolor{vhdlchar}{active_ch_cnt}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}   
00130                     \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00131                 \textcolor{keywordflow}{else} 
00132                   \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00133                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00134             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00135           \textcolor{keywordflow}{else}
00136             \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00137           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00138         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00139     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process}; 
00140     
00141 \textcolor{keyword}{    --lpm\_cnt\_aclr<= not en\_reg1;}
00142     \textcolor{vhdlchar}{lpm_cnt_cnten}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{sample_nrcnt}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{active_ch_cnt}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{fifo_wr}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{else} 
00143                    \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};     
00144   
00145 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00146 
00147 
00148 
00149 
\end{DoxyCode}
