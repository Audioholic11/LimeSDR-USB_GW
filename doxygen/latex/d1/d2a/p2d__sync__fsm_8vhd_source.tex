\subsection{p2d\+\_\+sync\+\_\+fsm.\+vhd}
\label{p2d__sync__fsm_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/p2d\+\_\+sync\+\_\+fsm.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/tx\+\_\+path\+\_\+top/packets2data/synth/p2d\+\_\+sync\+\_\+fsm.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00002 \textcolor{keyword}{-- FILE:    p2d\_sync\_fsm.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION: FSm for data reading from packets.}
00004 \textcolor{keyword}{-- DATE:    April 6, 2017}
00005 \textcolor{keyword}{-- AUTHOR(s):   Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ---------------------------------------------------------------------------- }
00008 
00009 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00010 \textcolor{keyword}{-- Notes:}
00011 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00012 
00013 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00014 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00015 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00016 
00017 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00018 \textcolor{keyword}{-- Entity declaration}
00019 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00020 \textcolor{keywordflow}{entity }p2d_sync_fsm \textcolor{keywordflow}{is}
00021    \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
00022       \textcolor{vhdlchar}{pct_size_w}           \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00023       \textcolor{vhdlchar}{n_buff}               \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{keyword}{ -- 2,4 valid values}
00024    \textcolor{vhdlchar}{)};
00025    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00026       \textcolor{vhdlchar}{clk}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00027       \textcolor{vhdlchar}{reset_n}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00028 \textcolor{keyword}{      --Mode settings      }
00029       \textcolor{vhdlchar}{mode}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- JESD207: 1; TRXIQ: 0}
00030       \textcolor{vhdlchar}{trxiqpulse}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- trxiqpulse on: 1; trxiqpulse off: 0}
00031         \textcolor{vhdlchar}{ddr_en}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- DDR: 1; SDR: 0}
00032         \textcolor{vhdlchar}{mimo_en}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- SISO: 1; MIMO: 0}
00033         \textcolor{vhdlchar}{ch_en}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"01" - Ch. A, "10" - Ch. B, "11" -
       Ch. A and Ch. B.  }
00034       \textcolor{vhdlchar}{sample_width}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --"10"-12bit, "01"-14bit, "00"-16bit;}
00035       
00036       \textcolor{vhdlchar}{pct_size}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_size_w}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{   --Whole packet size in }
00037 \textcolor{keyword}{                                                                           --in\_pct\_data\_w words}
00038       \textcolor{vhdlchar}{pct_sync_dis}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00039                                                                            
00040       \textcolor{vhdlchar}{smpl_nr}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00041                                                                            
00042       \textcolor{vhdlchar}{pct_hdr_0}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00043       \textcolor{vhdlchar}{pct_hdr_0_valid}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00044       
00045       \textcolor{vhdlchar}{pct_hdr_1}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00046       \textcolor{vhdlchar}{pct_hdr_1_valid}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00047      
00048       \textcolor{vhdlchar}{pct_data_clr_n}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};      
00049       \textcolor{vhdlchar}{pct_buff_rdy}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ --assert when whole packet is ready}
00050       
00051       \textcolor{vhdlchar}{pct_rd_fsm_hold}      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00052 
00053       \textcolor{vhdlchar}{pct_buff_rd_en}       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   
00054       
00055         \textcolor{vhdlchar}{)};
00056 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{p2d\_sync\_fsm};
00057 
00058 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00059 \textcolor{keyword}{-- Architecture}
00060 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00061 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} p2d_sync_fsm is
00062 \textcolor{keyword}{--declare signals,  components here}
00063 
00064 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{state_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{pct\_sync\_en}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{shift\_sync\_en}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{rd\_buff}\textcolor{vhdlchar}{)};
00065 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{state_type}; 
00066 
00067 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{smpl_nr_array_type}  \textcolor{keywordflow}{is} \textcolor{keywordflow}{array} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{of} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{63} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};  
00068 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{smpl_nr_array}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{smpl_nr_array_type};
00069 
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_smpl_nr_equal}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00071 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_smpl_nr_sync_dis}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00072 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_cnt}               \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_cnt_limit}         \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_cnt_max}           \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00075 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_en_vect}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_en_vect_shift}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sync_en}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00078 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pct_buff_rd_en_int}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00079 
00080 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_mode}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00081 
00082 
00083 
00084 \textcolor{vhdlkeyword}{begin}
00085 
00086 
00087 
00088 \textcolor{keywordflow}{process}(clk, reset_n)
00089 \textcolor{vhdlkeyword}{begin}
00090    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00091       \textcolor{vhdlchar}{sync_cnt_limit} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00092    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00093       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sample_width} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{then}   
00094          \textcolor{vhdlchar}{sync_cnt_limit} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"0550"};
00095       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sample_width} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{then} 
00096          \textcolor{vhdlchar}{sync_cnt_limit} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"0120"};
00097       \textcolor{keywordflow}{else}
00098          \textcolor{vhdlchar}{sync_cnt_limit} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"03FC"};
00099       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00100    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00101 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00102 
00103 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00104 \textcolor{keyword}{--Internal mode selection for DIQ position}
00105 \textcolor{keyword}{-- "00" - MIMO DDR both channels enabled, SISO DDR, TXIQ\_PULSE}
00106 \textcolor{keyword}{-- "01" - MIMO DDR, TXIQ\_PULSE first channel enabled}
00107 \textcolor{keyword}{-- "10" - MIMO DDR, TXIQ\_PULSE second channel enabled}
00108 \textcolor{keyword}{-- "11" - SISO SDR }
00109 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00110  \textcolor{vhdlchar}{int_mode} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{ddr_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{
      trxiqpulse} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"11"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else} 
00111              \textcolor{vhdllogic}{"01"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{trxiqpulse} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"01"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
00112              \textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mimo_en}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{trxiqpulse} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{ch_en}\textcolor{vhdlchar}{=}\textcolor{vhdllogic}{"10"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
00113              \textcolor{vhdllogic}{"11"};
00114              
00115              
00116 \textcolor{keywordflow}{process}(clk, reset_n)
00117 \textcolor{vhdlkeyword}{begin}
00118    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00119       \textcolor{vhdlchar}{sync_cnt_max} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00120    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00121       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{int_mode} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{then} 
00122          \textcolor{vhdlchar}{sync_cnt_max} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_cnt_limit} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00123       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{int_mode} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"11"} \textcolor{keywordflow}{then} 
00124          \textcolor{vhdlchar}{sync_cnt_max} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sync_cnt_limit}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{13} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdllogic}{"00"}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00125       \textcolor{keywordflow}{else}
00126          \textcolor{vhdlchar}{sync_cnt_max} \textcolor{vhdlchar}{<=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sync_cnt_limit}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{14} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00127       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00128    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00129 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00130 
00131 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00132 \textcolor{keyword}{-- Capture sample numbers from packets to reg array}
00133 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00134 \textcolor{keywordflow}{process}(clk, reset_n)
00135 \textcolor{vhdlkeyword}{begin}
00136    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00137       \textcolor{vhdlchar}{smpl_nr_array} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00138    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00139       \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00140          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_hdr_1_valid}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00141             \textcolor{vhdlchar}{smpl_nr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_1};
00142          \textcolor{keywordflow}{else} 
00143             \textcolor{vhdlchar}{smpl_nr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{smpl_nr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)};
00144          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00145       \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00146    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00147 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00148 
00149 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00150 \textcolor{keyword}{-- Capture sample numbers from packets to reg array}
00151 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00152 \textcolor{keywordflow}{process}(clk, reset_n)
00153 \textcolor{vhdlkeyword}{begin}
00154    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00155       \textcolor{vhdlchar}{pct_smpl_nr_sync_dis} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00156    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00157       \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00158          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_hdr_0_valid}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00159             \textcolor{vhdlchar}{pct_smpl_nr_sync_dis}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_hdr_0}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)};
00160          \textcolor{keywordflow}{else} 
00161             \textcolor{vhdlchar}{pct_smpl_nr_sync_dis}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=}\textcolor{vhdlchar}{pct_smpl_nr_sync_dis}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)};
00162          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00163       \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00164    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00165 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00166 
00167 
00168 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00169 \textcolor{keyword}{-- Compare current sample number with received packet sample number}
00170 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00171 \textcolor{keywordflow}{process}(clk, reset_n)
00172 \textcolor{vhdlkeyword}{begin}
00173    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00174       \textcolor{vhdlchar}{pct_smpl_nr_equal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00175    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00176       \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00177          \textcolor{keywordflow}{if} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{smpl_nr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{smpl_nr}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{pct_sync_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00178             \textcolor{vhdlchar}{pct_smpl_nr_equal}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00179          \textcolor{keywordflow}{else} 
00180             \textcolor{vhdlchar}{pct_smpl_nr_equal}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00181          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00182       \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00183    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00184 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00185 
00186 
00187 \textcolor{keywordflow}{process}(clk, reset_n)
00188 \textcolor{vhdlkeyword}{begin}
00189    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00190       \textcolor{vhdlchar}{sync_en_vect} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{,} \textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00191    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00192       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{shift\_sync\_en} \textcolor{keywordflow}{then} 
00193          \textcolor{vhdlchar}{sync_en_vect} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_en_vect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{sync_en_vect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
00194       \textcolor{keywordflow}{else} 
00195          \textcolor{vhdlchar}{sync_en_vect} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_en_vect};
00196       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00197    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00198 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00199 
00200 
00201 \textcolor{keyword}{--sync\_en <= sync\_en\_vect when pct\_sync\_dis = '1' else (others=> '0');}
00202 \textcolor{vhdlchar}{sync_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_en_vect} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_sync_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      pct_smpl_nr_sync_dis}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{keywordflow}{else} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00203 
00204 
00205 
00206 \textcolor{keywordflow}{process}(clk, reset_n)
00207 \textcolor{vhdlkeyword}{begin}
00208    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00209       \textcolor{vhdlchar}{sync_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00210    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00211       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{pct\_sync\_en} \textcolor{keywordflow}{then}
00212          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_rd_fsm_hold} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00213             \textcolor{vhdlchar}{sync_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_cnt}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00214          \textcolor{keywordflow}{else} 
00215             \textcolor{vhdlchar}{sync_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sync_cnt};
00216          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00217       \textcolor{keywordflow}{else} 
00218          \textcolor{vhdlchar}{sync_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00219       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00220    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00221 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00222 
00223 
00224 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00225 \textcolor{keyword}{--state machine}
00226 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00227 fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n)\textcolor{keywordflow}{begin}
00228     \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00229         \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00230     \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00231          \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_state};
00232     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if}; 
00233 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00234 
00235 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00236 \textcolor{keyword}{--state machine combo}
00237 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00238 fsm : \textcolor{keywordflow}{process}(current_state, pct_buff_rd_en_int, sync_cnt, pct_sync_dis, 
      sync_cnt_max) \textcolor{keywordflow}{begin}
00239     \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_state};
00240     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_state} \textcolor{keywordflow}{is}
00241       
00242         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00243 \textcolor{keyword}{         --if unsigned(pct\_buff\_rd\_en\_int) > 0 AND pct\_sync\_dis = '1' then}
00244          \textcolor{keywordflow}{if} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_buff_rd_en_int}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_sync_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      pct_smpl_nr_sync_dis}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
00245             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct\_sync\_en};
00246          \textcolor{keywordflow}{else} 
00247             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00248          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00249          
00250       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{pct\_sync\_en} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00251          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sync_cnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sync_cnt_max} \textcolor{keywordflow}{then} 
00252             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{shift\_sync\_en};
00253          \textcolor{keywordflow}{else}
00254             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct\_sync\_en};
00255          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00256       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{shift\_sync\_en} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
00257          \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00258          
00259         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00260             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00261     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00262 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00263 
00264 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00265 \textcolor{keyword}{-- Trigger packet read when packet is ready}
00266 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00267 \textcolor{keywordflow}{process}(clk, reset_n)
00268 \textcolor{vhdlkeyword}{begin}
00269    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00270       \textcolor{vhdlchar}{pct_buff_rd_en_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00271    \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00272       \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{n_buff}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
00273          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pct_buff_rdy}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{pct_data_clr_n}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} 
00274                                  \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{pct_smpl_nr_equal}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{OR} \textcolor{vhdlchar}{sync_en}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00275             \textcolor{vhdlchar}{pct_buff_rd_en_int}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00276          \textcolor{keywordflow}{else} 
00277             \textcolor{vhdlchar}{pct_buff_rd_en_int}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00278          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00279       \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
00280    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00281 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00282 
00283 
00284 \textcolor{vhdlchar}{pct_buff_rd_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pct_buff_rd_en_int};
00285 
00286 
00287 
00288 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00289 
00290 
00291 
00292 
00293 
\end{DoxyCode}
