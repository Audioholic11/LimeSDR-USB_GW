\subsection{ddr2\+\_\+phy\+\_\+alt\+\_\+mem\+\_\+phy\+\_\+seq.\+vhd}
\label{ddr2__phy__alt__mem__phy__seq_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/ip/ddr2/ddr2\+\_\+phy\+\_\+alt\+\_\+mem\+\_\+phy\+\_\+seq.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/ip/ddr2/ddr2\+\_\+phy\+\_\+alt\+\_\+mem\+\_\+phy\+\_\+seq.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{--}
00002 
00003 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
00004 \textcolor{keyword}{--  Abstract        : constants package for the non-levelling AFI PHY sequencer}
00005 \textcolor{keyword}{--                    The constant package (alt\_mem\_phy\_constants\_pkg) contains global}
00006 \textcolor{keyword}{--                    'constants' which are fixed thoughout the sequencer and will not}
00007 \textcolor{keyword}{--                    change (for constants which may change between sequencer}
00008 \textcolor{keyword}{--                    instances generics are used)}
00009 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
00010 
00011 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00012 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00013 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00014 
00015 \textcolor{keyword}{--}
00016 \textcolor{keywordflow}{package }ddr2_phy_alt_mem_phy_constants_pkg \textcolor{keywordflow}{is}
00017 
00018 \textcolor{keyword}{    -- -------------------------------}
00019 \textcolor{keyword}{    -- Register number definitions}
00020 \textcolor{keyword}{    -- -------------------------------}
00021 
00022 
00023     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_mode_reg_index}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};\textcolor{keyword}{   -- number of MR bits..}
00024 
00025 \textcolor{keyword}{    -- Top bit of vector (i.e. width -1) used for address decoding :}
00026     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_debug_reg_addr_top}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
00027 
00028 
00029     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_mmi_access_codeword}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"00D0\_0DEB"};\textcolor{keyword}{  -- to check
       for legal Avalon interface accesses}
00030 \textcolor{keyword}{    -- Register addresses.}
00031     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_cal_status}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00032     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_debug_access}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00033     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_hl_css}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00034     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_mr_register_a}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00035     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_mr_register_b}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
00036     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_codvw_status}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00037     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_if_param}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
00038     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_if_test}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};\textcolor{keyword}{   -- pll\_phs\_shft, ac\_1t, extra stuff}
00039     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_regofst_test_status}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00040 
00041 
00042     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_cal_dis_bit}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00043     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_phy_initialise_dis_bit}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00044     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_init_dram_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
00045     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_write_ihi_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
00046     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_write_btp_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00047     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_write_mtp_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00048     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_read_mtp_dis_bit}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
00049     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_rrp_reset_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
00050     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_rrp_sweep_dis_bit}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
00051     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_rrp_seek_dis_bit}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{9};
00052     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_rdv_dis_bit}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
00053     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_poa_dis_bit}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
00054     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_was_dis_bit}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
00055     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_adv_rd_lat_dis_bit}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
00056     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_adv_wr_lat_dis_bit}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};
00057     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_prep_customer_mr_setup_dis_bit} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00058     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_css_reg_tracking_dis_bit}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00059 
00060     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_ccs_num_stages}                         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{17};
00061 
00062 
00063 \textcolor{keyword}{    -- -----------------------------------------------------}
00064 \textcolor{keyword}{    -- Constants for DRAM addresses used during calibration:}
00065 \textcolor{keyword}{    -- -----------------------------------------------------}
00066 
00067 \textcolor{keyword}{    -- the mtp training pattern is x30F5}
00068 \textcolor{keyword}{    -- 1. write 0011 0000 and 1100 0000 such that one location will contains 0011 0000}
00069 \textcolor{keyword}{    -- 2. write in 1111 0101}
00070 \textcolor{keyword}{    -- also require locations containing all ones and all zeros}
00071 
00072 \textcolor{keyword}{    -- default choice of calibration burst length (overriden to 8 for reads for DDR3 devices)}
00073     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_burst_len}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00074 
00075     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_step_size}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
00076 
00077     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_zeros}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00078     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_ones}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00079 
00080     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_0}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00081     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_1}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00082 
00083     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_xF5}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00084 
00085     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_wd_lat}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_ofs_step_size};
00086 
00087     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_data_len}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_ofs_wd_lat} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_cal_ofs_step_size};
00088 
00089     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_mtp}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_cal_ofs_step_size};
00090     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_mtp_len}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00091     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_01_pairs}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_burst_len};
00092     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_10_pairs}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_burst_len};
00093     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_1100_step}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_burst_len};
00094     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_ofs_0011_step}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_cal_burst_len};
00095 
00096 
00097 \textcolor{keyword}{    -- -----------------------------------------------------}
00098 \textcolor{keyword}{    -- Reset values. - These are chosen as default values for one PHY variation}
00099 \textcolor{keyword}{    --                 with DDR2 memory and CAS latency 6, however in each calibration}
00100 \textcolor{keyword}{    --                 mode these values will be set for a given PHY configuration.}
00101 \textcolor{keyword}{    -- -----------------------------------------------------}
00102     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_default_rd_lat} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20};
00103     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_default_wr_lat} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00104 
00105 
00106 \textcolor{keyword}{    -- -----------------------------------------------------}
00107 \textcolor{keyword}{    -- Errorcodes}
00108 \textcolor{keyword}{    -- -----------------------------------------------------}
00109 \textcolor{keyword}{    -- implemented}
00110     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_SUCCESS}                             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00111     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_RESYNC_NO_VALID_PHASES}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};\textcolor{keyword}{  -- No valid data-valid windows found}
00112     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_RESYNC_MULTIPLE_EQUAL_WINDOWS}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};\textcolor{keyword}{  -- Multiple equally-sized data valid
       windows}
00113     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_RESYNC_NO_INVALID_PHASES}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};\textcolor{keyword}{  -- No invalid data-valid windows found.
        Training patterns are designed so that there should always be at least one invalid phase.}
00114     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_CRITICAL}                        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};\textcolor{keyword}{ -- A condition that can't happen just
       happened.}
00115 
00116     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_READ_MTP_NO_VALID_ALMT}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{23};
00117     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_READ_MTP_BOTH_ALMT_PASS}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
00118 
00119     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_WD_LAT_DISAGREEMENT}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{22};\textcolor{keyword}{ -- MEM\_IF\_DWIDTH/MEM\_IF\_DQ\_PER\_DQS
       copies of write-latency are written to memory.  If all of these are not the same this error is generated.}
00120     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_MAX_RD_LAT_EXCEEDED}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25};
00121 
00122     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_ERR_MAX_TRK_SHFT_EXCEEDED}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{26};
00123 
00124 \textcolor{keyword}{    -- not implemented yet}
00125     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_ac_lat_some_beats_are_different} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{    -- implies DQ\_1T setup failure or
       earlier.}
00126     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_could_not_find_read_lat}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};\textcolor{keyword}{    -- dodgy RDP setup}
00127     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_could_not_find_write_lat}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};\textcolor{keyword}{    -- dodgy WDP setup}
00128 
00129     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_clock_cycle_iteration_timeout}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{    -- depends on srate calling error 
       -- GENERIC}
00130     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_clock_cycle_it_timeout_rdp}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{9};
00131     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_clock_cycle_it_timeout_rdv}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
00132     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_clock_cycle_it_timeout_poa}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
00133 
00134     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_pll_ack_timeout}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
00135 
00136     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_WindowProc_multiple_rsc_windows} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00137     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_WindowProc_window_det_no_ones}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{17};
00138     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_WindowProc_window_det_no_zeros}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{18};
00139     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_WindowProc_undefined}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{19};\textcolor{keyword}{   -- catch all}
00140 
00141     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_tracked_mmc_offset_overflow}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20};
00142     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_no_mimic_feedback}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{21};
00143 
00144     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_ctrl_ack_timeout}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
00145     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_err_ctrl_done_timeout}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{33};
00146 
00147 \textcolor{keyword}{    -- -----------------------------------------------------}
00148 \textcolor{keyword}{    -- PLL phase locations per device family}
00149 \textcolor{keyword}{    -- (unused but a limited set is maintained here for reference)}
00150 \textcolor{keyword}{    -- -----------------------------------------------------}
00151 
00152     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_resync_phs_select_ciii} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00153     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_mimic_phs_select_ciii}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00154 
00155     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_resync_phs_select_siii} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00156     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_mimic_phs_select_siii}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
00157 
00158 \textcolor{keyword}{    -- -----------------------------------------------------}
00159 \textcolor{keyword}{    -- Maximum sizing constraints}
00160 \textcolor{keyword}{    -- -----------------------------------------------------}
00161     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_MAX_NUM_PLL_RSC_PHASES} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
00162 
00163 \textcolor{keyword}{    -- -----------------------------------------------------}
00164 \textcolor{keyword}{    -- IO control Params}
00165 \textcolor{keyword}{    -- -----------------------------------------------------}
00166     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_set_oct_to_rs} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00167     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_set_oct_to_rt} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00168 
00169     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_set_odt_rt}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
00170     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_set_odt_off}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00171 
00172 \textcolor{keyword}{--}
00173 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_constants\_pkg};
00174 \textcolor{keyword}{--}
00175 
00176 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
00177 \textcolor{keyword}{--  Abstract        : record package for the non-levelling AFI sequencer}
00178 \textcolor{keyword}{--                    The record package (alt\_mem\_phy\_record\_pkg) is used to combine}
00179 \textcolor{keyword}{--                    command and status signals (into records) to be passed between}
00180 \textcolor{keyword}{--                    sequencer blocks. It also contains type and record definitions}
00181 \textcolor{keyword}{--                    for the stages of DRAM memory calibration.}
00182 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
00183 
00184 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00185 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00186 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00187 
00188 \textcolor{keyword}{--}
00189 \textcolor{keywordflow}{package }ddr2_phy_alt_mem_phy_record_pkg \textcolor{keywordflow}{is}
00190 
00191 \textcolor{keyword}{    -- set some maximum constraints to bound natural numbers below}
00192     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_num_dqs_groups} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
00193     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_num_pins}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
00194     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_ranks}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
00195     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_pll_steps}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{80};
00196 
00197 \textcolor{keyword}{-- a prefix for all report signals to identify phy and sequencer block}
00198 \textcolor{keyword}{--}
00199     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{record_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_record\_pkg : "};
00200 
00201 
00202     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_family} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00203         \textcolor{vhdlchar}{cyclone3}\textcolor{vhdlchar}{,}
00204         \textcolor{vhdlchar}{stratix2}\textcolor{vhdlchar}{,}
00205         \textcolor{vhdlchar}{stratix3}
00206     \textcolor{vhdlchar}{)};
00207 
00208 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00209 \textcolor{keyword}{--  the following are required for the non-levelling AFI PHY sequencer block interfaces}
00210 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00211 
00212 \textcolor{keyword}{    -- admin mode register settings (from mmi block)}
00213     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_admin_ctrl} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00214         \textcolor{vhdlchar}{mr0} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00215         \textcolor{vhdlchar}{mr1} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00216         \textcolor{vhdlchar}{mr2} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00217         \textcolor{vhdlchar}{mr3} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00218     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00219 
00220     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_admin_ctrl};
00221 
00222 \textcolor{keyword}{    -- current admin status}
00223     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_admin_stat} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00224         \textcolor{vhdlchar}{mr0}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00225         \textcolor{vhdlchar}{mr1}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00226         \textcolor{vhdlchar}{mr2}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00227         \textcolor{vhdlchar}{mr3}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00228         \textcolor{vhdlchar}{init_done} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00229     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00230 
00231     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_admin_stat};
00232 
00233 \textcolor{keyword}{    -- mmi to iram ctrl signals}
00234     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_ctrl} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00235         \textcolor{vhdlchar}{addr}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1023};
00236         \textcolor{vhdlchar}{wdata}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00237         \textcolor{vhdlchar}{write}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00238         \textcolor{vhdlchar}{read}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00239     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00240 
00241     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_ctrl};
00242 
00243 \textcolor{keyword}{   -- broadcast iram status to mmi and dgrb}
00244     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_stat} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00245         \textcolor{vhdlchar}{rdata}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00246         \textcolor{vhdlchar}{done}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00247         \textcolor{vhdlchar}{err}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00248         \textcolor{vhdlchar}{err_code}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00249         \textcolor{vhdlchar}{init_done}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00250         \textcolor{vhdlchar}{out_of_mem}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00251         \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00252     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00253 
00254     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_stat};
00255 
00256 \textcolor{keyword}{    -- codvw status signals from dgrb to mmi block}
00257     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_dgrb_mmi} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00258         \textcolor{vhdlchar}{cal_codvw_phase}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00259         \textcolor{vhdlchar}{cal_codvw_size}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00260         \textcolor{vhdlchar}{codvw_trk_shift}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00261         \textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00262     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00263 
00264     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_dgrb_mmi};
00265 
00266 \textcolor{keyword}{    -- signal to id which block is active}
00267     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_active_block} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00268                                     \textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,}
00269                                     \textcolor{vhdlchar}{admin}\textcolor{vhdlchar}{,}
00270                                     \textcolor{vhdlchar}{dgwb}\textcolor{vhdlchar}{,}
00271                                     \textcolor{vhdlchar}{dgrb}\textcolor{vhdlchar}{,}
00272                                     \textcolor{vhdlchar}{proc}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- unused in non-levelling AFI sequencer}
00273                                     \textcolor{vhdlchar}{setup}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- unused in non-levelling AFI sequencer}
00274                                     \textcolor{vhdlchar}{iram}
00275                               \textcolor{vhdlchar}{)};
00276     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{ret\_proc} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_active_block};
00277     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{ret\_dgrb} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_active_block};
00278 
00279 \textcolor{keyword}{    -- control record for dgwb, dgrb, iram and admin blocks:}
00280 
00281 \textcolor{keyword}{    -- the possible commands}
00282     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_cmd_id} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00283                             \textcolor{vhdlchar}{cmd\_idle}\textcolor{vhdlchar}{,}
00284 
00285 \textcolor{keyword}{                            -- initialisation stages}
00286                             \textcolor{vhdlchar}{cmd\_phy\_initialise}\textcolor{vhdlchar}{,}
00287                             \textcolor{vhdlchar}{cmd\_init\_dram}\textcolor{vhdlchar}{,}
00288                             \textcolor{vhdlchar}{cmd\_prog\_cal\_mr}\textcolor{vhdlchar}{,}
00289                             \textcolor{vhdlchar}{cmd\_write\_ihi}\textcolor{vhdlchar}{,}
00290 
00291 \textcolor{keyword}{                            -- calibration stages}
00292                             \textcolor{vhdlchar}{cmd\_write\_btp}\textcolor{vhdlchar}{,}
00293                             \textcolor{vhdlchar}{cmd\_write\_mtp}\textcolor{vhdlchar}{,}
00294                             \textcolor{vhdlchar}{cmd\_read\_mtp}\textcolor{vhdlchar}{,}
00295                             \textcolor{vhdlchar}{cmd\_rrp\_reset}\textcolor{vhdlchar}{,}
00296                             \textcolor{vhdlchar}{cmd\_rrp\_sweep}\textcolor{vhdlchar}{,}
00297                             \textcolor{vhdlchar}{cmd\_rrp\_seek}\textcolor{vhdlchar}{,}
00298                             \textcolor{vhdlchar}{cmd\_rdv}\textcolor{vhdlchar}{,}
00299                             \textcolor{vhdlchar}{cmd\_poa}\textcolor{vhdlchar}{,}
00300                             \textcolor{vhdlchar}{cmd\_was}\textcolor{vhdlchar}{,}
00301 
00302 \textcolor{keyword}{                            -- advertise controller settings and re-configure for customer operation mode.}
00303                             \textcolor{vhdlchar}{cmd\_prep\_adv\_rd\_lat}\textcolor{vhdlchar}{,}
00304                             \textcolor{vhdlchar}{cmd\_prep\_adv\_wr\_lat}\textcolor{vhdlchar}{,}
00305                             \textcolor{vhdlchar}{cmd\_prep\_customer\_mr\_setup}\textcolor{vhdlchar}{,}
00306                             \textcolor{vhdlchar}{cmd\_tr\_due}
00307 
00308                           \textcolor{vhdlchar}{)};
00309 
00310 \textcolor{keyword}{    -- which block should execute each command}
00311     \textcolor{keywordflow}{function} curr_active_block (
00312         ctrl\_cmd\_id : t_ctrl_cmd_id
00313        ) \textcolor{keywordflow}{return}  \textcolor{vhdlchar}{t_ctrl_active_block};
00314 
00315 \textcolor{keyword}{    -- specify command operands as a record}
00316     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_command_op} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00317         \textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_ranks}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- which chip select is being calibrated}
00318         \textcolor{vhdlchar}{single_bit} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                        -- current operation should be single bit}
00319         \textcolor{vhdlchar}{mtp_almt}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{             -- signals mtp alignment to be used for operation}
00320     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00321 
00322     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_command_op};
00323 
00324 \textcolor{keyword}{    -- command request record (sent to each block)}
00325     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_command} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00326         \textcolor{vhdlchar}{command}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_cmd_id};
00327         \textcolor{vhdlchar}{command_op}    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_command_op};
00328         \textcolor{vhdlchar}{command_req}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00329     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00330 
00331     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_command};
00332 
00333 \textcolor{keyword}{    -- a generic status record for each block}
00334     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_stat} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00335         \textcolor{vhdlchar}{command_ack}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00336         \textcolor{vhdlchar}{command_done}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00337         \textcolor{vhdlchar}{command_result} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{vhdlchar}{)};
00338         \textcolor{vhdlchar}{command_err}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00339     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00340 
00341     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_stat};
00342 
00343 \textcolor{keyword}{    -- push interface for dgwb / dgrb blocks (only the dgrb uses this interface at present)}
00344     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_push} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00345         \textcolor{vhdlchar}{iram_done}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00346         \textcolor{vhdlchar}{iram_write}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00347         \textcolor{vhdlchar}{iram_wordnum}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{511};\textcolor{keyword}{        -- acts as an offset to current location (max = 80
       pll steps *2 sweeps and 80 pins)}
00348         \textcolor{vhdlchar}{iram_bitnum}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{31};\textcolor{keyword}{         -- for bitwise packing modes}
00349         \textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- only bit zero used for bitwise packing\_mode}
00350     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00351 
00352     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_push};
00353 
00354 \textcolor{keyword}{    -- control block "master" state machine}
00355     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_master_sm_state} \textcolor{keywordflow}{is}
00356     \textcolor{vhdlchar}{(}
00357         \textcolor{vhdlchar}{s\_reset}\textcolor{vhdlchar}{,}
00358         \textcolor{vhdlchar}{s\_phy\_initialise}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- wait for dll lock and init done flag from iram}
00359         \textcolor{vhdlchar}{s\_init\_dram}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- dram initialisation - reset sequence}
00360         \textcolor{vhdlchar}{s\_prog\_cal\_mr}\textcolor{vhdlchar}{,}\textcolor{keyword}{            -- dram initialisation - programming mode registers (once per chip
       select)}
00361         \textcolor{vhdlchar}{s\_write\_ihi}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- write header information in iRAM}
00362         \textcolor{vhdlchar}{s\_cal}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- check if calibration to be executed}
00363         \textcolor{vhdlchar}{s\_write\_btp}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- write burst training pattern}
00364         \textcolor{vhdlchar}{s\_write\_mtp}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- write more training pattern}
00365         \textcolor{vhdlchar}{s\_read\_mtp}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- read training patterns to find correct alignment for 1100 burst}
00366 \textcolor{keyword}{                                  -- (this is a special case of s\_rrp\_seek with no resych phase setting)}
00367         \textcolor{vhdlchar}{s\_rrp\_reset}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- read resync phase setup - reset initial conditions}
00368         \textcolor{vhdlchar}{s\_rrp\_sweep}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- read resync phase setup - sweep phases per chip select}
00369         \textcolor{vhdlchar}{s\_rrp\_seek}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- read resync phase setup - seek correct phase}
00370         \textcolor{vhdlchar}{s\_rdv}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- read data valid setup}
00371         \textcolor{vhdlchar}{s\_was}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- write datapath setup (ac to write data timing)}
00372         \textcolor{vhdlchar}{s\_adv\_rd\_lat}\textcolor{vhdlchar}{,}\textcolor{keyword}{             -- advertise read latency}
00373         \textcolor{vhdlchar}{s\_adv\_wr\_lat}\textcolor{vhdlchar}{,}\textcolor{keyword}{             -- advertise write latency}
00374         \textcolor{vhdlchar}{s\_poa}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- calibrate the postamble (dqs based capture only)}
00375         \textcolor{vhdlchar}{s\_tracking\_setup}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- perform tracking (1st pass to setup mimic window)}
00376         \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- apply user mode register settings (in admin block)}
00377         \textcolor{vhdlchar}{s\_tracking}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- perform tracking (subsequent passes in user mode)}
00378         \textcolor{vhdlchar}{s\_operational}\textcolor{vhdlchar}{,}\textcolor{keyword}{            -- calibration successful and in user mode}
00379         \textcolor{vhdlchar}{s\_non\_operational}\textcolor{keyword}{         -- calibration unsuccessful and in user mode}
00380     \textcolor{vhdlchar}{)};
00381 
00382 \textcolor{keyword}{    -- record (set in mmi block) to disable calibration states}
00383     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_hl_css_reg} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00384 
00385         \textcolor{vhdlchar}{phy_initialise_dis}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00386         \textcolor{vhdlchar}{init_dram_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00387         \textcolor{vhdlchar}{write_ihi_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00388         \textcolor{vhdlchar}{cal_dis}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00389         \textcolor{vhdlchar}{write_btp_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00390         \textcolor{vhdlchar}{write_mtp_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00391         \textcolor{vhdlchar}{read_mtp_dis}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00392         \textcolor{vhdlchar}{rrp_reset_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00393         \textcolor{vhdlchar}{rrp_sweep_dis}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00394         \textcolor{vhdlchar}{rrp_seek_dis}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00395         \textcolor{vhdlchar}{rdv_dis}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00396         \textcolor{vhdlchar}{poa_dis}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00397         \textcolor{vhdlchar}{was_dis}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00398         \textcolor{vhdlchar}{adv_rd_lat_dis}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00399         \textcolor{vhdlchar}{adv_wr_lat_dis}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00400         \textcolor{vhdlchar}{prep_customer_mr_setup_dis} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00401         \textcolor{vhdlchar}{tracking_dis}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00402     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00403 
00404     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css_reg};
00405 
00406 \textcolor{keyword}{    -- record (set in ctrl block) to identify when a command has been acknowledged}
00407     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_cal_stage_ack_seen} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00408 
00409         \textcolor{vhdlchar}{cal}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00410         \textcolor{vhdlchar}{phy_initialise}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00411         \textcolor{vhdlchar}{init_dram}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00412         \textcolor{vhdlchar}{write_ihi}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00413         \textcolor{vhdlchar}{write_btp}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00414         \textcolor{vhdlchar}{write_mtp}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00415         \textcolor{vhdlchar}{read_mtp}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00416         \textcolor{vhdlchar}{rrp_reset}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00417         \textcolor{vhdlchar}{rrp_sweep}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00418         \textcolor{vhdlchar}{rrp_seek}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00419         \textcolor{vhdlchar}{rdv}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00420         \textcolor{vhdlchar}{poa}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00421         \textcolor{vhdlchar}{was}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00422         \textcolor{vhdlchar}{adv_rd_lat}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00423         \textcolor{vhdlchar}{adv_wr_lat}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00424         \textcolor{vhdlchar}{prep_customer_mr_setup} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00425         \textcolor{vhdlchar}{tracking_setup}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00426     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00427 
00428     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_cal_stage_ack_seen};
00429 
00430 \textcolor{keyword}{    -- ctrl to mmi block interface (calibration status)}
00431     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_mmi} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00432         \textcolor{vhdlchar}{master_state_r}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_master_sm_state};
00433         \textcolor{vhdlchar}{ctrl_calibration_success}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00434         \textcolor{vhdlchar}{ctrl_calibration_fail}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00435         \textcolor{vhdlchar}{ctrl_current_stage_done}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00436         \textcolor{vhdlchar}{ctrl_current_stage}         \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_cmd_id};
00437         \textcolor{vhdlchar}{ctrl_current_active_block}  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_active_block};
00438         \textcolor{vhdlchar}{ctrl_cal_stage_ack_seen}    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_cal_stage_ack_seen};
00439         \textcolor{vhdlchar}{ctrl_err_code}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00440     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00441 
00442     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_mmi};
00443 
00444 \textcolor{keyword}{    -- mmi to ctrl block interface (calibration control signals)}
00445     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mmi_ctrl} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00446         \textcolor{vhdlchar}{hl_css}                   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_hl_css_reg};
00447         \textcolor{vhdlchar}{calibration_start}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00448         \textcolor{vhdlchar}{tracking_period_ms}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{255};
00449         \textcolor{vhdlchar}{tracking_orvd_to_10ms}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00450     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00451 
00452     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_ctrl};
00453 
00454 \textcolor{keyword}{    -- algorithm parameterisation (generated in mmi block)}
00455     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_algm_paramaterisation} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00456          \textcolor{vhdlchar}{num_phases_per_tck_pll} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_pll_steps};
00457          \textcolor{vhdlchar}{nominal_dqs_delay}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
00458          \textcolor{vhdlchar}{pll_360_sweeps}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00459          \textcolor{vhdlchar}{nominal_poa_phase_lead} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
00460          \textcolor{vhdlchar}{maximum_poa_delay}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00461          \textcolor{vhdlchar}{odt_enabled}            \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
00462          \textcolor{vhdlchar}{extend_octrt_by}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00463          \textcolor{vhdlchar}{delay_octrt_by}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00464          \textcolor{vhdlchar}{tracking_period_ms}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{255};
00465     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00466 
00467 \textcolor{keyword}{    -- interface between mmi and pll to control phase shifting}
00468     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mmi_pll_reconfig} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00469         \textcolor{vhdlchar}{pll_phs_shft_phase_sel} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
00470         \textcolor{vhdlchar}{pll_phs_shft_up_wc}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00471         \textcolor{vhdlchar}{pll_phs_shft_dn_wc}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00472     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00473 
00474     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_pll_mmi} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00475         \textcolor{vhdlchar}{pll_busy} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00476         \textcolor{vhdlchar}{err}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00477     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00478 
00479 \textcolor{keyword}{    -- specify the iram configuration this is default}
00480 \textcolor{keyword}{    -- currently always dq\_bitwise packing and a write mode of overwrite\_ram}
00481 
00482     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_packing_mode} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00483                                     \textcolor{vhdlchar}{dq\_bitwise}\textcolor{vhdlchar}{,}
00484                                     \textcolor{vhdlchar}{dq\_wordwise}
00485                                 \textcolor{vhdlchar}{)};
00486 
00487     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_write_mode} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00488                                     \textcolor{vhdlchar}{overwrite\_ram}\textcolor{vhdlchar}{,}
00489                                     \textcolor{vhdlchar}{or\_into\_ram}\textcolor{vhdlchar}{,}
00490                                     \textcolor{vhdlchar}{and\_into\_ram}
00491                               \textcolor{vhdlchar}{)};
00492 
00493     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ctrl_iram} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00494         \textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_packing_mode};
00495         \textcolor{vhdlchar}{write_mode}   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_write_mode};
00496         \textcolor{vhdlchar}{active_block} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_active_block};
00497     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00498 
00499     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_iram};
00500 
00501 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00502 \textcolor{keyword}{--  the following are required for compliance to levelling AFI PHY interface but}
00503 \textcolor{keyword}{--  are non-functional for non-levelling AFI PHY sequencer}
00504 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00505 
00506     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_sc_ctrl_if} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00507         \textcolor{vhdlchar}{read}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00508         \textcolor{vhdlchar}{write}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00509         \textcolor{vhdlchar}{dqs_group_sel}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00510         \textcolor{vhdlchar}{sc_in_group_sel}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00511         \textcolor{vhdlchar}{wdata}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{45} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00512         \textcolor{vhdlchar}{op_type}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00513     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00514 
00515     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_ctrl_if};
00516 
00517     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_sc_stat} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00518         \textcolor{vhdlchar}{rdata}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{45} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00519         \textcolor{vhdlchar}{busy}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00520         \textcolor{vhdlchar}{error_det}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00521         \textcolor{vhdlchar}{err_code}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00522         \textcolor{vhdlchar}{sc_cap}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00523     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00524 
00525     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_stat};
00526 
00527     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_element_to_reconfigure} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00528                                        \textcolor{vhdlchar}{pp\_t9}\textcolor{vhdlchar}{,}
00529                                        \textcolor{vhdlchar}{pp\_t10}\textcolor{vhdlchar}{,}
00530                                        \textcolor{vhdlchar}{pp\_t1}\textcolor{vhdlchar}{,}
00531                                        \textcolor{vhdlchar}{dqslb\_rsc\_phs}\textcolor{vhdlchar}{,}
00532                                        \textcolor{vhdlchar}{dqslb\_poa\_phs\_ofst}\textcolor{vhdlchar}{,}
00533                                        \textcolor{vhdlchar}{dqslb\_dqs\_phs}\textcolor{vhdlchar}{,}
00534                                        \textcolor{vhdlchar}{dqslb\_dq\_phs\_ofst}\textcolor{vhdlchar}{,}
00535                                        \textcolor{vhdlchar}{dqslb\_dq\_1t}\textcolor{vhdlchar}{,}
00536                                        \textcolor{vhdlchar}{dqslb\_dqs\_1t}\textcolor{vhdlchar}{,}
00537                                        \textcolor{vhdlchar}{dqslb\_rsc\_1t}\textcolor{vhdlchar}{,}
00538                                        \textcolor{vhdlchar}{dqslb\_div2\_phs}\textcolor{vhdlchar}{,}
00539                                        \textcolor{vhdlchar}{dqslb\_oct\_t9}\textcolor{vhdlchar}{,}
00540                                        \textcolor{vhdlchar}{dqslb\_oct\_t10}\textcolor{vhdlchar}{,}
00541                                        \textcolor{vhdlchar}{dqslb\_poa\_t7}\textcolor{vhdlchar}{,}
00542                                        \textcolor{vhdlchar}{dqslb\_poa\_t11}\textcolor{vhdlchar}{,}
00543                                        \textcolor{vhdlchar}{dqslb\_dqs\_dly}\textcolor{vhdlchar}{,}
00544                                        \textcolor{vhdlchar}{dqslb\_lvlng\_byps}
00545                                      \textcolor{vhdlchar}{)};
00546 
00547     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_sc_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
00548                         \textcolor{vhdlchar}{DQS\_LB}\textcolor{vhdlchar}{,}
00549                         \textcolor{vhdlchar}{DQS\_DQ\_DM\_PINS}\textcolor{vhdlchar}{,}
00550                         \textcolor{vhdlchar}{DQ\_DM\_PINS}\textcolor{vhdlchar}{,}
00551                         \textcolor{vhdlchar}{dqs\_dqsn\_pins}\textcolor{vhdlchar}{,}
00552                         \textcolor{vhdlchar}{dq\_pin}\textcolor{vhdlchar}{,}
00553                         \textcolor{vhdlchar}{dqs\_pin}\textcolor{vhdlchar}{,}
00554                         \textcolor{vhdlchar}{dm\_pin}\textcolor{vhdlchar}{,}
00555                         \textcolor{vhdlchar}{dq\_pins}
00556                        \textcolor{vhdlchar}{)};
00557 
00558     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_sc_int_ctrl} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00559         \textcolor{vhdlchar}{group_num}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_num_dqs_groups};
00560         \textcolor{vhdlchar}{group_type} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_sc_type};
00561         pin\_num    : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} c\_max\_num\_pins;
00562         \textcolor{vhdlchar}{sc_element} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_element_to_reconfigure};
00563         \textcolor{vhdlchar}{prog_val}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00564         \textcolor{vhdlchar}{ram_set}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00565         \textcolor{vhdlchar}{sc_update}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00566     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00567 
00568     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_int_ctrl};
00569 
00570 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00571 \textcolor{keyword}{-- record and functions for instant on mode}
00572 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00573 
00574 \textcolor{keyword}{    -- ranges on the below are not important because this logic is not synthesised}
00575     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_preset_cal} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
00576         \textcolor{vhdlchar}{codvw_phase}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_pll_steps};\textcolor{keyword}{-- rsc phase}
00577         \textcolor{vhdlchar}{codvw_size}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_pll_steps};\textcolor{keyword}{  -- rsc size (unused but reported)}
00578         \textcolor{vhdlchar}{rlat}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{                             -- advertised read latency ctl\_rlat (in phy
       clock cycles)}
00579         \textcolor{vhdlchar}{rdv_lat}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{                             -- read data valid latency decrements needed
       (in memory clock cycles)}
00580         \textcolor{vhdlchar}{wlat}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{                             -- advertised write latency ctl\_wlat (in phy
       clock cycles)}
00581         \textcolor{vhdlchar}{ac_1t}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                           -- address / command 1t delay setting (HR only)}
00582         \textcolor{vhdlchar}{poa_lat}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{                             -- poa latency decrements needed (in memory
       clock cycles)}
00583     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
00584 
00585 \textcolor{keyword}{    -- the below are hardcoded (do not change)}
00586     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr_default_cl}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
00587     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr2_default_cl}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
00588     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr3_default_cl}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
00589     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr2_default_cwl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00590     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr3_default_cwl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
00591     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr2_default_al}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00592     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr3_default_al}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00593 
00594     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr_default_rl}   \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_ddr_default_cl};
00595     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr2_default_rl}  \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_ddr2_default_cl} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_ddr2_default_al};
00596     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr3_default_rl}  \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_ddr3_default_cl} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_ddr3_default_al};
00597 
00598     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr_default_wl}   \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00599     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr2_default_wl}  \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_ddr2_default_cwl} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_ddr2_default_al};
00600     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ddr3_default_wl}  \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_ddr3_default_cwl} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_ddr3_default_al};
00601 
00602     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_preset_cal};
00603 
00604     \textcolor{keywordflow}{function} setup_instant_on (sim\_time\_red : \textcolor{comment}{natural};
00605                                family\_id    : \textcolor{comment}{natural};
00606                                memory\_type  : \textcolor{comment}{string};
00607                                dwidth\_ratio : \textcolor{comment}{natural};
00608                                pll\_steps    : \textcolor{comment}{natural};
00609                                mr0          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
00610                                mr1          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
00611                                mr2          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_preset_cal};
00612 
00613 
00614 
00615 \textcolor{keyword}{--}
00616 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_record\_pkg};
00617 
00618 \textcolor{keyword}{--}
00619 \textcolor{keywordflow}{package} \textcolor{keywordflow}{body} ddr2_phy_alt_mem_phy_record_pkg \textcolor{keywordflow}{IS}
00620 
00621 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00622 \textcolor{keyword}{--  function implementations for the above declarations}
00623 \textcolor{keyword}{--  these are mainly default conditions for records}
00624 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00625 
00626     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_admin_ctrl} \textcolor{keywordflow}{is}
00627         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_admin_ctrl};
00628 \textcolor{vhdlkeyword}{    begin}
00629         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00630         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00631         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00632         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00633         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00634     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00635 
00636     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_admin_stat} \textcolor{keywordflow}{is}
00637         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_admin_stat};
00638 \textcolor{vhdlkeyword}{    begin}
00639         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00640         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00641         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00642         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00643         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00644     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00645 
00646 
00647     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_ctrl} \textcolor{keywordflow}{is}
00648         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_ctrl};
00649 \textcolor{vhdlkeyword}{    begin}
00650         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{addr}    \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00651         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wdata}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00652         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00653         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00654         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00655     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00656 
00657     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_stat} \textcolor{keywordflow}{is}
00658         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_stat};
00659 \textcolor{vhdlkeyword}{    begin}
00660         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata}            \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00661         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{done}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00662         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00663         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err_code}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00664         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_done}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00665         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{out_of_mem}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00666         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00667         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00668     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00669 
00670     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_dgrb_mmi} \textcolor{keywordflow}{is}
00671         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_dgrb_mmi};
00672 \textcolor{vhdlkeyword}{    begin}
00673         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_phase}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00674         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_size}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00675         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_trk_shift}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00676         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00677         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00678     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00679 
00680     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{ret\_proc} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_active_block} \textcolor{keywordflow}{is}
00681         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_active_block};
00682 \textcolor{vhdlkeyword}{    begin}
00683         \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{proc};
00684         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00685     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00686 
00687     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{ret\_dgrb} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_active_block} \textcolor{keywordflow}{is}
00688         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_active_block};
00689 \textcolor{vhdlkeyword}{    begin}
00690         \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{dgrb};
00691         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00692     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00693 
00694     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_iram} \textcolor{keywordflow}{is}
00695         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_iram};
00696 \textcolor{vhdlkeyword}{    begin}
00697         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{dq\_bitwise};
00698         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{overwrite\_ram};
00699         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{active_block} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{idle};
00700         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00701     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00702 
00703     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_command_op} \textcolor{keywordflow}{is}
00704         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_command_op};
00705 \textcolor{vhdlkeyword}{    begin}
00706         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00707         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{single_bit} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00708         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mtp_almt}   \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00709         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00710     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00711 
00712     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_command} \textcolor{keywordflow}{is}
00713         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_command};
00714 \textcolor{vhdlkeyword}{    begin}
00715         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{cmd\_idle};
00716         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00717         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
00718         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00719     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00720 
00721 \textcolor{keyword}{    -- decode which block is associated with which command}
00722     \textcolor{keywordflow}{function} curr_active_block (
00723         ctrl\_cmd\_id : t_ctrl_cmd_id
00724        ) \textcolor{keywordflow}{return}  t_ctrl_active_block \textcolor{keywordflow}{is}
00725     \textcolor{keywordflow}{begin}
00726         \textcolor{keywordflow}{case} ctrl\_cmd\_id \textcolor{keywordflow}{is}
00727             \textcolor{keywordflow}{when} cmd\_idle                   => \textcolor{keywordflow}{return} idle;
00728             \textcolor{keywordflow}{when} cmd\_phy\_initialise         => \textcolor{keywordflow}{return} idle;
00729             \textcolor{keywordflow}{when} cmd\_init\_dram              => \textcolor{keywordflow}{return} admin;
00730             \textcolor{keywordflow}{when} cmd\_prog\_cal\_mr            => \textcolor{keywordflow}{return} admin;
00731             \textcolor{keywordflow}{when} cmd\_write\_ihi              => \textcolor{keywordflow}{return} iram;
00732             \textcolor{keywordflow}{when} cmd\_write\_btp              => \textcolor{keywordflow}{return} dgwb;
00733             \textcolor{keywordflow}{when} cmd\_write\_mtp              => \textcolor{keywordflow}{return} dgwb;
00734             \textcolor{keywordflow}{when} cmd\_read\_mtp               => \textcolor{keywordflow}{return} dgrb;
00735             \textcolor{keywordflow}{when} cmd\_rrp\_reset              => \textcolor{keywordflow}{return} dgrb;
00736             \textcolor{keywordflow}{when} cmd\_rrp\_sweep              => \textcolor{keywordflow}{return} dgrb;
00737             \textcolor{keywordflow}{when} cmd\_rrp\_seek               => \textcolor{keywordflow}{return} dgrb;
00738             \textcolor{keywordflow}{when} cmd\_rdv                    => \textcolor{keywordflow}{return} dgrb;
00739             \textcolor{keywordflow}{when} cmd\_poa                    => \textcolor{keywordflow}{return} dgrb;
00740             \textcolor{keywordflow}{when} cmd\_was                    => \textcolor{keywordflow}{return} dgwb;
00741             \textcolor{keywordflow}{when} cmd\_prep\_adv\_rd\_lat        => \textcolor{keywordflow}{return} dgrb;
00742             \textcolor{keywordflow}{when} cmd\_prep\_adv\_wr\_lat        => \textcolor{keywordflow}{return} dgrb;
00743             \textcolor{keywordflow}{when} cmd\_prep\_customer\_mr\_setup => \textcolor{keywordflow}{return} admin;
00744             \textcolor{keywordflow}{when} cmd\_tr\_due                 => \textcolor{keywordflow}{return} dgrb;
00745             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}                     => \textcolor{keywordflow}{return} idle;
00746         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00747     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00748 
00749     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_stat} \textcolor{keywordflow}{is}
00750         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_stat};
00751 \textcolor{vhdlkeyword}{    begin}
00752         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00753         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00754         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00755         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00756         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00757     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00758 
00759     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_iram_push} \textcolor{keywordflow}{is}
00760         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_push};
00761 \textcolor{vhdlkeyword}{    begin}
00762         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_done}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00763         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00764         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00765         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_bitnum}   \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00766         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00767         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00768     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00769 
00770     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css_reg} \textcolor{keywordflow}{is}
00771         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output}  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_hl_css_reg};
00772 \textcolor{vhdlkeyword}{    begin}
00773         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{phy_initialise_dis}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00774         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_dram_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00775         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_ihi_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00776         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_dis}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00777         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_btp_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00778         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mtp_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00779         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read_mtp_dis}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00780         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_reset_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00781         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_sweep_dis}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00782         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_seek_dis}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00783         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv_dis}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00784         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa_dis}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00785         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{was_dis}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00786         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_rd_lat_dis}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00787         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_wr_lat_dis}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00788         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{prep_customer_mr_setup_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00789         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_dis}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00790         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00791 
00792     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00793 
00794     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_cal_stage_ack_seen} \textcolor{keywordflow}{is}
00795         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_cal_stage_ack_seen};
00796 \textcolor{vhdlkeyword}{    begin}
00797 
00798        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00799        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{phy_initialise}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00800        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_dram}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00801        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_ihi}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00802        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_btp}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00803        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mtp}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00804        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read_mtp}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00805        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_reset}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00806        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_sweep}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00807        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_seek}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00808        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00809        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00810        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{was}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00811        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_rd_lat}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00812        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_wr_lat}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00813        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{prep_customer_mr_setup} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00814        \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_setup}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00815 
00816        \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00817     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00818 
00819 
00820     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_ctrl} \textcolor{keywordflow}{is}
00821         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_mmi_ctrl};
00822 \textcolor{vhdlkeyword}{    begin}
00823         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}                                  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
00824         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration_start}                       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00825         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_period_ms}                      \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00826         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_orvd_to_10ms}                   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00827         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00828     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00829 
00830 
00831 
00832     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_mmi} \textcolor{keywordflow}{is}
00833         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_mmi};
00834 \textcolor{vhdlkeyword}{    begin}
00835         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{master_state_r}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{s\_reset};
00836         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_success}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00837         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_fail}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00838         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage_done}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00839         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{cmd\_idle};
00840         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_active_block}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{idle};
00841         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_cal_stage_ack_seen}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
00842         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00843         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00844     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00845 
00846 \textcolor{keyword}{-------------------------------------------------------------------------}
00847 \textcolor{keyword}{-- the following are required for compliance to levelling AFI PHY interface but}
00848 \textcolor{keyword}{-- are non-functional for non-levelling AFi PHY sequencer}
00849 \textcolor{keyword}{-------------------------------------------------------------------------}
00850 
00851     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_ctrl_if} \textcolor{keywordflow}{is}
00852         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_sc_ctrl_if};
00853 \textcolor{vhdlkeyword}{    begin}
00854         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read}            \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00855         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write}           \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00856         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{dqs_group_sel}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00857         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{sc_in_group_sel} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00858         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wdata}           \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00859         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{op_type}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00860         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00861     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00862 
00863     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_stat} \textcolor{keywordflow}{is}
00864         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_sc_stat};
00865 \textcolor{vhdlkeyword}{    begin}
00866         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00867         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{busy}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00868         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{error_det} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00869         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err_code}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00870         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{sc_cap}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00871         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00872     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00873 
00874     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_sc_int_ctrl} \textcolor{keywordflow}{is}
00875         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_sc_int_ctrl};
00876 \textcolor{vhdlkeyword}{    begin}
00877         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{group_num}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00878         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{group_type} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{DQ\_PIN};
00879         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pin_num}    \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00880         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{sc_element} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{pp\_t9};
00881         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{prog_val}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00882         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ram_set}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00883         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{sc_update}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00884         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00885     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00886 
00887 \textcolor{keyword}{-- -----------------------------------------------------------------------}
00888 \textcolor{keyword}{-- functions for instant on mode}
00889 \textcolor{keyword}{--}
00890 \textcolor{keyword}{--}
00891 \textcolor{keyword}{-- Guide on how to use:}
00892 \textcolor{keyword}{--}
00893 \textcolor{keyword}{-- The following factors effect the setup of the PHY:}
00894 \textcolor{keyword}{-- - AC Phase - phase at which address/command signals launched wrt PHY clock}
00895 \textcolor{keyword}{--            - this effects the read/write latency}
00896 \textcolor{keyword}{-- - MR settings - CL, CWL, AL}
00897 \textcolor{keyword}{-- - Data rate - HR or FR (DDR/DDR2 only)}
00898 \textcolor{keyword}{-- - Family - datapaths are subtly different for each}
00899 \textcolor{keyword}{-- - Memory type - DDR/DDR2/DDR3 (different latency behaviour - see specs)}
00900 \textcolor{keyword}{--}
00901 \textcolor{keyword}{-- Instant on mode is designed to work for the following subset of the}
00902 \textcolor{keyword}{-- above factors:}
00903 \textcolor{keyword}{-- - AC Phase - out of the box defaults, which is 240 degrees for SIII type}
00904 \textcolor{keyword}{--              families (includes SIV, HCIII, HCIV), else 90 degrees}
00905 \textcolor{keyword}{-- - MR Settings - DDR - CL 3 only}
00906 \textcolor{keyword}{--               - DDR2 - CL 3,4,5,6, AL 0}
00907 \textcolor{keyword}{--               - DDR3 - CL 5,6 CWL 5, AL 0}
00908 \textcolor{keyword}{-- - Data rate - All}
00909 \textcolor{keyword}{-- - Families - All}
00910 \textcolor{keyword}{-- - Memory type - All}
00911 \textcolor{keyword}{--}
00912 \textcolor{keyword}{-- Hints on bespoke setup for parameters outside the above or if the}
00913 \textcolor{keyword}{-- datapath is modified (only for VHDL sim mode):}
00914 \textcolor{keyword}{--}
00915 \textcolor{keyword}{-- Step 1 - Run simulation with REDUCE\_SIM\_TIME mode 2 (FAST)}
00916 \textcolor{keyword}{--}
00917 \textcolor{keyword}{-- Step 2 - From the output log find the following text:}
00918 \textcolor{keyword}{-- # -----------------------------------------------------------------------}
00919 \textcolor{keyword}{-- **** ALTMEMPHY CALIBRATION has completed ****}
00920 \textcolor{keyword}{-- Status:}
00921 \textcolor{keyword}{-- calibration has  : PASSED}
00922 \textcolor{keyword}{-- PHY read latency (ctl\_rlat) is  : 14}
00923 \textcolor{keyword}{-- address/command to PHY write latency (ctl\_wlat) is : 2}
00924 \textcolor{keyword}{-- read resynch phase calibration report:}
00925 \textcolor{keyword}{-- calibrated centre of data valid window phase : 32}
00926 \textcolor{keyword}{-- calibrated centre of data valid window size  : 24}
00927 \textcolor{keyword}{-- chosen address and command 1T delay: no 1T delay}
00928 \textcolor{keyword}{-- poa 'dec' adjustments = 27}
00929 \textcolor{keyword}{-- rdv 'dec' adjustments = 25}
00930 \textcolor{keyword}{-- # -----------------------------------------------------------------------}
00931 \textcolor{keyword}{--}
00932 \textcolor{keyword}{-- Step 3 - Convert the text to bespoke instant on settings at the end of the}
00933 \textcolor{keyword}{--          setup\_instant\_on function using the}
00934 \textcolor{keyword}{--          override\_instant\_on function, note type is t\_preset\_cal}
00935 \textcolor{keyword}{--}
00936 \textcolor{keyword}{-- The mapping is as follows:}
00937 \textcolor{keyword}{--}
00938 \textcolor{keyword}{-- PHY read latency (ctl\_rlat) is  : 14                   => rlat := 14}
00939 \textcolor{keyword}{-- address/command to PHY write latency (ctl\_wlat) is : 2 => wlat := 2}
00940 \textcolor{keyword}{-- read resynch phase calibration report:}
00941 \textcolor{keyword}{-- calibrated centre of data valid window phase : 32      => codvw\_phase := 32}
00942 \textcolor{keyword}{-- calibrated centre of data valid window size  : 24      => codvw\_size  := 24}
00943 \textcolor{keyword}{-- chosen address and command 1T delay: no 1T delay       => ac\_1t := '0'}
00944 \textcolor{keyword}{-- poa 'dec' adjustments = 27                             => poa\_lat := 27}
00945 \textcolor{keyword}{-- rdv 'dec' adjustments = 25                             => rdv\_lat := 25}
00946 \textcolor{keyword}{--}
00947 \textcolor{keyword}{-- Step 4 - Try running in REDUCE\_SIM\_TIME mode 1 (SUPERFAST mode)}
00948 \textcolor{keyword}{--}
00949 \textcolor{keyword}{-- Step 5 - If still fails observe the behaviour of the controller, for the}
00950 \textcolor{keyword}{--          following symptoms:}
00951 \textcolor{keyword}{--    - If first 2 beats of read data lost (POA enable too late) - inc poa\_lat by 1 (poa\_lat is number of
       POA decrements not actual latency)}
00952 \textcolor{keyword}{--    - If last 2 beats of read data lost (POA enable too early) - dec poa\_lat by 1}
00953 \textcolor{keyword}{--    - If ctl\_rdata\_valid misaligned to ctl\_rdata then alter number of RDV adjustments (rdv\_lat)}
00954 \textcolor{keyword}{--    - If write data is not 4-beat aligned (when written into memory) toggle ac\_1t (HR only)}
00955 \textcolor{keyword}{--    - If read data is not 4-beat aligned (but write data is) add 360 degrees to phase
       (PLL\_STEPS\_PER\_CYCLE) mod 2*PLL\_STEPS\_PER\_CYCLE (HR only)}
00956 \textcolor{keyword}{--}
00957 \textcolor{keyword}{-- Step 6 - If the above fails revert to REDUCE\_SIM\_TIME = 2 (FAST) mode}
00958 \textcolor{keyword}{--}
00959 \textcolor{keyword}{-- --------------------------------------------------------------------------}
00960 \textcolor{keyword}{    -- defaults}
00961     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_preset_cal} \textcolor{keywordflow}{is}
00962         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_preset_cal};
00963 \textcolor{vhdlkeyword}{    begin}
00964         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_phase}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00965         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_size}   \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00966         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wlat}         \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00967         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rlat}         \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00968         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv_lat}      \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00969         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ac_1t}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- default on for FR}
00970         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa_lat}      \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
00971         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
00972     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
00973 
00974 \textcolor{keyword}{    -- Functions to extract values from MR}
00975 
00976 \textcolor{keyword}{    -- return cl (for DDR memory 2*cl because of 1/2 cycle latencies)}
00977     \textcolor{keywordflow}{procedure} mr0\_to\_cl (memory\_type : \textcolor{comment}{string};
00978                         mr0         : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
00979                         cl          : \textcolor{keywordflow}{out} \textcolor{comment}{natural};
00980                         half\_cl     : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic}) \textcolor{keywordflow}{is}
00981         \textcolor{keywordflow}{variable} v\_cl : \textcolor{comment}{natural};
00982     \textcolor{keywordflow}{begin}
00983 
00984         half\_cl := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
00985 
00986         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR memories}
00987 
00988 \textcolor{keyword}{            -- returns cl*2 because of 1/2 latencies}
00989             v\_cl := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
00990 
00991 \textcolor{keyword}{            -- integer values of cl}
00992             \textcolor{keywordflow}{if} mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}' \textcolor{keywordflow}{then}
00993                 \textcolor{keywordflow}{assert} v\_cl > \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas latency for DDR memory, should
       be in range 1.5-3"} \textcolor{keywordflow}{severity} failure;
00994             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00995 
00996             \textcolor{keywordflow}{if} mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{then}
00997                 \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{(}v\_cl = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or} v\_cl = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas latency for DDR
       memory, should be in range 1.5-3"} \textcolor{keywordflow}{severity} failure;
00998                 half\_cl := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
00999             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01000 
01001         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR2 memories}
01002 
01003             v\_cl := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
01004 \textcolor{keyword}{            -- sanity checks}
01005             \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{(}v\_cl > \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{and} v\_cl < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas latency for DDR2
       memory, should be in range 2-6 but equals "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_cl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
01006 
01007         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR3 memories}
01008 
01009             v\_cl := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01010 \textcolor{keyword}{            --sanity checks}
01011             \textcolor{keywordflow}{assert} mr0\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}' \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas latency for DDR3 memory, bit a2
       in mr0 is set"}  \textcolor{keywordflow}{severity} failure;
01012             \textcolor{keywordflow}{assert} v\_cl /= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}      \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas latency for DDR3 memory, bits
       a6:4 set to zero"} \textcolor{keywordflow}{severity} failure;
01013 
01014         \textcolor{keywordflow}{else}
01015                 \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"Undefined memory type "} & memory\_type \textcolor{keywordflow}{severity} failure;
01016         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01017 
01018         cl := v\_cl;
01019 
01020     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
01021 
01022     \textcolor{keywordflow}{function} mr1\_to\_al (memory\_type : \textcolor{comment}{string};
01023                         mr1         : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01024                         cl          : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
01025         \textcolor{keywordflow}{variable} al : \textcolor{comment}{natural};
01026     \textcolor{keywordflow}{begin}
01027 
01028         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR memories}
01029 
01030 \textcolor{keyword}{            -- unsupported so return zero}
01031             al := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
01032 
01033         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR2 memories}
01034 
01035             al := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr1\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
01036             \textcolor{keywordflow}{assert} al < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid additive latency for DDR2 memory, should
       be in range 0-5 but equals "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}al\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
01037 
01038         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR3 memories}
01039 
01040             al := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr1\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
01041             \textcolor{keywordflow}{assert} al /= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid additive latency for DDR2 memory, should
       be in range 0-5 but equals "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}al\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
01042 
01043             \textcolor{keywordflow}{if} al /= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- CL-1 or CL-2}
01044                 al := cl - al;
01045             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01046 
01047         \textcolor{keywordflow}{else}
01048                 \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"Undefined memory type "} & memory\_type \textcolor{keywordflow}{severity} failure;
01049         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01050 
01051         \textcolor{keywordflow}{return} al;
01052 
01053     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01054 
01055 \textcolor{keyword}{    -- return cwl}
01056     \textcolor{keywordflow}{function} mr2\_to\_cwl (memory\_type : \textcolor{comment}{string};
01057                          mr2         : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01058                          cl          : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
01059         \textcolor{keywordflow}{variable} cwl : \textcolor{comment}{natural};
01060     \textcolor{keywordflow}{begin}
01061 
01062         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR memories}
01063 
01064             cwl := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01065 
01066         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR2 memories}
01067 
01068             cwl := cl - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01069 
01070         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- DDR3 memories}
01071 
01072             cwl := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mr2\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
01073 \textcolor{keyword}{            --sanity checks}
01074             \textcolor{keywordflow}{assert} cwl < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"invalid cas write latency for DDR3 memory, should
       be in range 5-8 but equals "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}cwl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
01075 
01076         \textcolor{keywordflow}{else}
01077             \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"Undefined memory type "} & memory\_type \textcolor{keywordflow}{severity} failure;
01078         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01079 
01080         \textcolor{keywordflow}{return} cwl;
01081 
01082     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01083 
01084 \textcolor{keyword}{    -- -----------------------------------}
01085 \textcolor{keyword}{    -- Functions to determine which family group}
01086 \textcolor{keyword}{    -- Include any family alias here}
01087 \textcolor{keyword}{    -- -----------------------------------}
01088 
01089     \textcolor{keywordflow}{function} is\_siii(family\_id : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
01090     \textcolor{keywordflow}{begin}
01091         \textcolor{keywordflow}{if} family\_id = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{or} family\_id = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{then}
01092 
01093            \textcolor{keywordflow}{return} true;
01094 
01095         \textcolor{keywordflow}{else}
01096 
01097             \textcolor{keywordflow}{return} false;
01098 
01099         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01100 
01101     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01102 
01103     \textcolor{keywordflow}{function} is\_ciii(family\_id : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
01104     \textcolor{keywordflow}{begin}
01105         \textcolor{keywordflow}{if} family\_id = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01106 
01107            \textcolor{keywordflow}{return} true;
01108 
01109         \textcolor{keywordflow}{else}
01110 
01111             \textcolor{keywordflow}{return} false;
01112 
01113         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01114 
01115     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01116 
01117     \textcolor{keywordflow}{function} is\_aii(family\_id : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
01118     \textcolor{keywordflow}{begin}
01119         \textcolor{keywordflow}{if} family\_id = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
01120 
01121            \textcolor{keywordflow}{return} true;
01122 
01123         \textcolor{keywordflow}{else}
01124 
01125             \textcolor{keywordflow}{return} false;
01126 
01127         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01128 
01129     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01130 
01131     \textcolor{keywordflow}{function} is\_sii(family\_id : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
01132     \textcolor{keywordflow}{begin}
01133         \textcolor{keywordflow}{if} family\_id = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
01134 
01135            \textcolor{keywordflow}{return} true;
01136 
01137         \textcolor{keywordflow}{else}
01138 
01139             \textcolor{keywordflow}{return} false;
01140 
01141         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01142 
01143     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01144 
01145 \textcolor{keyword}{    -- -----------------------------------}
01146 \textcolor{keyword}{    -- Functions to lookup hardcoded values}
01147 \textcolor{keyword}{    -- on per family basis}
01148 \textcolor{keyword}{    -- DDR: CL = 3}
01149 \textcolor{keyword}{    -- DDR2: CL = 6, CWL = 5, AL = 0}
01150 \textcolor{keyword}{    -- DDR3: CL = 6, CWL = 5, AL = 0}
01151 \textcolor{keyword}{    -- -----------------------------------}
01152 
01153 \textcolor{keyword}{    -- default ac phase = 240}
01154     \textcolor{keywordflow}{function} siii\_family\_settings (dwidth\_ratio : \textcolor{comment}{integer};
01155                                    memory\_type  : \textcolor{comment}{string};
01156                                    pll\_steps    : \textcolor{comment}{natural}
01157                                   ) \textcolor{keywordflow}{return} t_preset_cal \textcolor{keywordflow}{is}
01158         \textcolor{keywordflow}{variable} v\_output : t_preset_cal;
01159     \textcolor{keywordflow}{begin}
01160 
01161         v\_output := defaults;
01162 
01163         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CAS = 3}
01164 
01165             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01166                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01167                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01168                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01169                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
01170                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
01171             \textcolor{keywordflow}{else}
01172                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01173                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01174                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01175                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{23};
01176                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
01177                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
01178             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01179 
01180         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- CAS = 6}
01181 
01182             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01183                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01184                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
01185                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
01186                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
01187                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
01188             \textcolor{keywordflow}{else}
01189                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01190                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01191                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
01192                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{21};
01193                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
01194                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{22};
01195             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01196 
01197         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- HR only, CAS = 6}
01198 
01199             v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01200             v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
01201             v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01202             v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{23};
01203             v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
01204             v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
01205 
01206         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01207 
01208 \textcolor{keyword}{        -- adapt settings for ac\_phase (default 240 degrees so leave commented)}
01209 \textcolor{keyword}{        -- if dwidth\_ratio = 2 then}
01210 
01211 \textcolor{keyword}{            -- v\_output.wlat := v\_output.wlat - 1;}
01212 \textcolor{keyword}{            -- v\_output.rlat := v\_output.rlat - 1;}
01213 \textcolor{keyword}{            -- v\_output.rdv\_lat := v\_output.rdv\_lat + 1;}
01214 \textcolor{keyword}{            -- v\_output.poa\_lat := v\_output.poa\_lat + 1;}
01215 
01216 \textcolor{keyword}{        -- else}
01217 
01218 \textcolor{keyword}{            -- v\_output.ac\_1t := not v\_output.ac\_1t;}
01219 
01220 \textcolor{keyword}{        -- end if;}
01221 
01222         v\_output.codvw_size := pll\_steps;
01223 
01224         \textcolor{keywordflow}{return} v\_output;
01225 
01226     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01227 
01228 \textcolor{keyword}{    -- default ac phase = 90}
01229     \textcolor{keywordflow}{function} ciii\_family\_settings (dwidth\_ratio : \textcolor{comment}{integer};
01230                                    memory\_type  : \textcolor{comment}{string};
01231                                    pll\_steps    : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} t_preset_cal \textcolor{keywordflow}{is}
01232         \textcolor{keywordflow}{variable} v\_output : t_preset_cal;
01233     \textcolor{keywordflow}{begin}
01234 
01235         v\_output := defaults;
01236 
01237         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CAS = 3}
01238 
01239             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01240                 v\_output.codvw_phase  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}*pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01241                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01242                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01243                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
01244                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11}; \textcolor{keyword}{--unused}
01245             \textcolor{keywordflow}{else}
01246                 v\_output.codvw_phase  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}*pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01247                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01248                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
01249                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{27};
01250                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01251                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{27}; \textcolor{keyword}{--unused}
01252             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01253 
01254         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CAS = 6}
01255 
01256             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01257                 v\_output.codvw_phase  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}*pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01258                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
01259                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{18};
01260                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
01261                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}; \textcolor{keyword}{--unused}
01262             \textcolor{keywordflow}{else}
01263                 v\_output.codvw_phase  := pll\_steps + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}*pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01264                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01265                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};
01266                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25};
01267                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01268                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25}; \textcolor{keyword}{--unused}
01269             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01270 
01271         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01272 
01273 \textcolor{keyword}{        -- adapt settings for ac\_phase (hardcode for 90 degrees)}
01274         \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01275 
01276             v\_output.wlat := v\_output.wlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01277             v\_output.rlat := v\_output.rlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01278             v\_output.rdv_lat := v\_output.rdv_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01279             v\_output.poa_lat := v\_output.poa_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01280 
01281         \textcolor{keywordflow}{else}
01282 
01283             v\_output.ac_1t := \textcolor{keywordflow}{not} v\_output.ac_1t;
01284 
01285         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01286 
01287         v\_output.codvw_size   := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
01288 
01289         \textcolor{keywordflow}{return} v\_output;
01290 
01291     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01292 
01293 
01294 \textcolor{keyword}{    -- default ac phase = 90}
01295     \textcolor{keywordflow}{function} sii\_family\_settings (dwidth\_ratio : \textcolor{comment}{integer};
01296                                    memory\_type  : \textcolor{comment}{string};
01297                                    pll\_steps    : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} t_preset_cal \textcolor{keywordflow}{is}
01298         \textcolor{keywordflow}{variable} v\_output : t_preset_cal;
01299     \textcolor{keywordflow}{begin}
01300 
01301         v\_output := defaults;
01302 
01303         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CAS = 3}
01304 
01305             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01306                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01307                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01308                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01309                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
01310                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
01311             \textcolor{keywordflow}{else}
01312                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01313                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01314                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
01315                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{27};
01316                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01317                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{22};
01318             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01319 
01320         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
01321 
01322             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01323                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01324                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
01325                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{18};
01326                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
01327                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
01328             \textcolor{keywordflow}{else}
01329                 v\_output.codvw_phase  := pll\_steps + pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01330                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01331                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};
01332                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25};
01333                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01334                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20};
01335             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01336 
01337         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01338 
01339 \textcolor{keyword}{        -- adapt settings for ac\_phase (hardcode for 90 degrees)}
01340         \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01341 
01342             v\_output.wlat := v\_output.wlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01343             v\_output.rlat := v\_output.rlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01344             v\_output.rdv_lat := v\_output.rdv_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01345             v\_output.poa_lat := v\_output.poa_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01346 
01347         \textcolor{keywordflow}{else}
01348 
01349             v\_output.ac_1t := \textcolor{keywordflow}{not} v\_output.ac_1t;
01350 
01351         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01352 
01353         v\_output.codvw_size := pll\_steps;
01354 
01355         \textcolor{keywordflow}{return} v\_output;
01356 
01357     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01358 
01359 \textcolor{keyword}{    -- default ac phase = 90}
01360     \textcolor{keywordflow}{function} aii\_family\_settings (dwidth\_ratio : \textcolor{comment}{integer};
01361                                   memory\_type  : \textcolor{comment}{string};
01362                                   pll\_steps    : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} t_preset_cal \textcolor{keywordflow}{is}
01363         \textcolor{keywordflow}{variable} v\_output : t_preset_cal;
01364     \textcolor{keywordflow}{begin}
01365 
01366         v\_output := defaults;
01367 
01368         \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CAS = 3}
01369 
01370             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01371                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01372                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01373                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
01374                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
01375                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01376             \textcolor{keywordflow}{else}
01377                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01378                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01379                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{13};
01380                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{27};
01381                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01382                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24};
01383             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01384 
01385         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
01386 
01387             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01388                 v\_output.codvw_phase  := pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01389                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
01390                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{19};
01391                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{9};
01392                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
01393             \textcolor{keywordflow}{else}
01394                 v\_output.codvw_phase  := pll\_steps + pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01395                 v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01396                 v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};
01397                 v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25};
01398                 v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01399                 v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{22};
01400             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01401 
01402         \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- HR only, CAS = 6}
01403 
01404             v\_output.codvw_phase  := pll\_steps + pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
01405             v\_output.wlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01406             v\_output.rlat         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{14};
01407             v\_output.rdv_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{25};
01408             v\_output.ac_1t        := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
01409             v\_output.poa_lat      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{22};
01410 
01411         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01412 
01413 \textcolor{keyword}{        -- adapt settings for ac\_phase (hardcode for 90 degrees)}
01414         \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01415 
01416             v\_output.wlat := v\_output.wlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01417             v\_output.rlat := v\_output.rlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01418             v\_output.rdv_lat := v\_output.rdv_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01419             v\_output.poa_lat := v\_output.poa_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01420 
01421         \textcolor{keywordflow}{else}
01422 
01423             v\_output.ac_1t := \textcolor{keywordflow}{not} v\_output.ac_1t;
01424 
01425         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01426 
01427         v\_output.codvw_size := pll\_steps;
01428 
01429         \textcolor{keywordflow}{return} v\_output;
01430 
01431     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01432 
01433 
01434     \textcolor{keywordflow}{function} is\_odd(num : \textcolor{comment}{integer}) \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
01435         \textcolor{keywordflow}{variable} v\_num : \textcolor{comment}{integer};
01436     \textcolor{keywordflow}{begin}
01437         v\_num := num;
01438         \textcolor{keywordflow}{if} v\_num - \textcolor{vhdlchar}{(}v\_num/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}*\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
01439             \textcolor{keywordflow}{return} false;
01440         \textcolor{keywordflow}{else}
01441             \textcolor{keywordflow}{return} true;
01442         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01443     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01444 
01445 \textcolor{keyword}{    ------------------------------------------------}
01446 \textcolor{keyword}{    -- top level function to setup instant on mode}
01447 \textcolor{keyword}{    ------------------------------------------------}
01448 
01449     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{override\_instant\_on} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_preset_cal} \textcolor{keywordflow}{is}
01450         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_preset_cal};
01451 \textcolor{vhdlkeyword}{    begin}
01452 
01453         \textcolor{vhdlchar}{v\_output} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
01454 
01455 \textcolor{keyword}{        -- add in overrides here}
01456 
01457         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_output};
01458 
01459     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01460 
01461     \textcolor{keywordflow}{function} setup_instant_on (sim\_time\_red : \textcolor{comment}{natural};
01462                                family\_id    : \textcolor{comment}{natural};
01463                                memory\_type  : \textcolor{comment}{string};
01464                                dwidth\_ratio : \textcolor{comment}{natural};
01465                                pll\_steps    : \textcolor{comment}{natural};
01466                                mr0          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01467                                mr1          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01468                                mr2          : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} 
      t_preset_cal \textcolor{keywordflow}{is}
01469 
01470         \textcolor{keywordflow}{variable} v\_output : t_preset_cal;
01471 
01472         \textcolor{keywordflow}{variable} v\_cl      : \textcolor{comment}{natural}; \textcolor{keyword}{-- cas latency}
01473         \textcolor{keywordflow}{variable} v\_half\_cl : \textcolor{comment}{std\_logic}; \textcolor{keyword}{-- + 0.5 cycles (DDR only)}
01474         \textcolor{keywordflow}{variable} v\_al      : \textcolor{comment}{natural}; \textcolor{keyword}{-- additive latency (ddr2/ddr3 only)}
01475         \textcolor{keywordflow}{variable} v\_cwl     : \textcolor{comment}{natural}; \textcolor{keyword}{-- cas write latency (ddr3 only)}
01476 
01477         \textcolor{keywordflow}{variable} v\_rl       : \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01478         \textcolor{keywordflow}{variable} v\_wl       : \textcolor{comment}{integer};
01479         \textcolor{keywordflow}{variable} v\_delta\_rl : \textcolor{comment}{integer} \textcolor{keywordflow}{range} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};  \textcolor{keyword}{-- from given defaults}
01480         \textcolor{keywordflow}{variable} v\_delta\_wl : \textcolor{comment}{integer};  \textcolor{keyword}{-- from given defaults}
01481 
01482         \textcolor{keywordflow}{variable} v\_debug : \textcolor{comment}{boolean};
01483 
01484     \textcolor{keywordflow}{begin}
01485 
01486         v\_debug := true;
01487 
01488         v\_output := defaults;
01489 
01490         \textcolor{keywordflow}{if} sim\_time\_red = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- only set if STR equals 1}
01491 
01492 \textcolor{keyword}{            -- ----------------------------------------}
01493 \textcolor{keyword}{            -- extract required parameters from MRs}
01494 \textcolor{keyword}{            -- ----------------------------------------}
01495             mr0\_to\_cl\textcolor{vhdlchar}{(}memory\_type, mr0, v\_cl, v\_half\_cl\textcolor{vhdlchar}{)};
01496             v\_al  := mr1\_to\_al\textcolor{vhdlchar}{(}memory\_type, mr1, v\_cl\textcolor{vhdlchar}{)};
01497             v\_cwl := mr2\_to\_cwl\textcolor{vhdlchar}{(}memory\_type, mr2, v\_cl\textcolor{vhdlchar}{)};
01498 
01499             v\_rl  := v\_cl + v\_al;
01500             v\_wl  := v\_cwl + v\_al;
01501 
01502             \textcolor{keywordflow}{if} v\_debug \textcolor{keywordflow}{then}
01503                 \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"Extracted MR parameters"} & LF &
01504                                               \textcolor{keyword}{"CAS = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_cl\textcolor{vhdlchar}{)} & LF &
01505                                               \textcolor{keyword}{"CWL = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_cwl\textcolor{vhdlchar}{)} & LF &
01506                                               \textcolor{keyword}{"AL  = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_al\textcolor{vhdlchar}{)} & LF;
01507             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01508 
01509 \textcolor{keyword}{            -- ----------------------------------------}
01510 \textcolor{keyword}{            -- apply per family, memory type and dwidth\_ratio static setup}
01511 \textcolor{keyword}{            -- ----------------------------------------}
01512             \textcolor{keywordflow}{if} is\_siii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01513                 v\_output := siii\_family\_settings\textcolor{vhdlchar}{(}dwidth\_ratio, memory\_type, pll\_steps\textcolor{vhdlchar}{)};
01514             \textcolor{keywordflow}{elsif} is\_ciii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01515                 v\_output := ciii\_family\_settings\textcolor{vhdlchar}{(}dwidth\_ratio, memory\_type, pll\_steps\textcolor{vhdlchar}{)};
01516             \textcolor{keywordflow}{elsif} is\_aii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01517                 v\_output := aii\_family\_settings\textcolor{vhdlchar}{(}dwidth\_ratio, memory\_type, pll\_steps\textcolor{vhdlchar}{)};
01518             \textcolor{keywordflow}{elsif} is\_sii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01519                 v\_output := sii\_family\_settings\textcolor{vhdlchar}{(}dwidth\_ratio, memory\_type, pll\_steps\textcolor{vhdlchar}{)};
01520             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01521 
01522 \textcolor{keyword}{            -- ----------------------------------------}
01523 \textcolor{keyword}{            -- correct for different cwl, cl and al settings}
01524 \textcolor{keyword}{            -- ----------------------------------------}
01525 
01526             \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}
01527                 v\_delta\_rl := v\_rl - c_ddr_default_rl;
01528                 v\_delta\_wl := v\_wl - c_ddr_default_wl;
01529             \textcolor{keywordflow}{elsif} memory\_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
01530                 v\_delta\_rl := v\_rl - c_ddr2_default_rl;
01531                 v\_delta\_wl := v\_wl - c_ddr2_default_wl;
01532             \textcolor{keywordflow}{else}\textcolor{keyword}{ -- DDR3}
01533                 v\_delta\_rl := v\_rl - c_ddr3_default_rl;
01534                 v\_delta\_wl := v\_wl - c_ddr3_default_wl;
01535             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01536 
01537             \textcolor{keywordflow}{if} v\_debug \textcolor{keywordflow}{then}
01538                 \textcolor{keywordflow}{report} record_report_prefix & \textcolor{keyword}{"Extracted memory latency (and delta from default)"} & LF &
01539                                               \textcolor{keyword}{"RL = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_rl\textcolor{vhdlchar}{)} & LF &
01540                                               \textcolor{keyword}{"WL = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_wl\textcolor{vhdlchar}{)} & LF &
01541                                               \textcolor{keyword}{"delta RL = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_delta\_rl\textcolor{vhdlchar}{)} & LF &
01542                                               \textcolor{keyword}{"delta WL = "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}v\_delta\_wl\textcolor{vhdlchar}{)} & LF;
01543             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01544 
01545             \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
01546 
01547 \textcolor{keyword}{                -- adjust rdp settings}
01548                 v\_output.rlat    := v\_output.rlat    + v\_delta\_rl;
01549                 v\_output.rdv_lat := v\_output.rdv_lat - v\_delta\_rl;
01550                 v\_output.poa_lat := v\_output.poa_lat - v\_delta\_rl;
01551 
01552 \textcolor{keyword}{                -- adjust wdp settings}
01553                 v\_output.wlat    := v\_output.wlat + v\_delta\_wl;
01554 
01555             \textcolor{keywordflow}{elsif} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
01556 
01557 \textcolor{keyword}{                -- adjust wdp settings}
01558                 v\_output.wlat := v\_output.wlat + v\_delta\_wl/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
01559 
01560                 \textcolor{keywordflow}{if} is\_odd\textcolor{vhdlchar}{(}v\_delta\_wl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- add / sub 1t write latency}
01561 
01562 \textcolor{keyword}{                    -- toggle ac\_1t in all cases}
01563                     v\_output.ac_1t := \textcolor{keywordflow}{not} v\_output.ac_1t;
01564 
01565                     \textcolor{keywordflow}{if} v\_delta\_wl < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- sub 1 from latency}
01566 
01567                         \textcolor{keywordflow}{if} v\_output.ac_1t = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}' \textcolor{keywordflow}{then}\textcolor{keyword}{  -- phy\_clk cc boundary}
01568                             v\_output.wlat := v\_output.wlat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01569                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01570 
01571                     \textcolor{keywordflow}{else}\textcolor{keyword}{ -- add 1 to latency}
01572 
01573                         \textcolor{keywordflow}{if} v\_output.ac_1t = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{then}\textcolor{keyword}{ -- phy\_clk cc boundary}
01574                             v\_output.wlat := v\_output.wlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01575                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01576 
01577                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01578 
01579 \textcolor{keyword}{                    -- update read latency}
01580                     \textcolor{keywordflow}{if} v\_output.ac_1t = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{then}\textcolor{keyword}{  -- added 1t to address/command so inc read\_lat}
01581                         v\_delta\_rl := v\_delta\_rl + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01582                     \textcolor{keywordflow}{else}\textcolor{keyword}{ -- subtracted 1t from address/command so dec read\_lat}
01583                         v\_delta\_rl := v\_delta\_rl - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01584                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01585 
01586                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01587 
01588 
01589 \textcolor{keyword}{                -- adjust rdp settings}
01590                 v\_output.rlat    := v\_output.rlat    + v\_delta\_rl/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
01591 
01592                 v\_output.rdv_lat := v\_output.rdv_lat - v\_delta\_rl;
01593                 v\_output.poa_lat := v\_output.poa_lat - v\_delta\_rl;
01594 
01595                 \textcolor{keywordflow}{if} memory\_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
01596                     \textcolor{keywordflow}{if} is\_odd\textcolor{vhdlchar}{(}v\_delta\_rl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{xor} is\_odd\textcolor{vhdlchar}{(}v\_delta\_wl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01597 
01598                         \textcolor{keywordflow}{if} is\_aii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01599                             v\_output.rdv_lat := v\_output.rdv_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01600                             v\_output.poa_lat := v\_output.poa_lat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01601                         \textcolor{keywordflow}{else}
01602                             v\_output.rdv_lat := v\_output.rdv_lat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01603                             v\_output.poa_lat := v\_output.poa_lat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01604                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01605 
01606                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01607 
01608                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01609 
01610                 \textcolor{keywordflow}{if} is\_odd\textcolor{vhdlchar}{(}v\_delta\_rl\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01611 
01612                     \textcolor{keywordflow}{if} v\_delta\_rl > \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- add 1t}
01613 
01614                         \textcolor{keywordflow}{if} v\_output.codvw_phase < pll\_steps \textcolor{keywordflow}{then}
01615                             v\_output.codvw_phase := v\_output.codvw_phase + pll\_steps;
01616                         \textcolor{keywordflow}{else}
01617                             v\_output.codvw_phase := v\_output.codvw_phase - pll\_steps;
01618                             v\_output.rlat        := v\_output.rlat + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01619                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01620 
01621                     \textcolor{keywordflow}{else}\textcolor{keyword}{ -- subtract 1t}
01622 
01623                         \textcolor{keywordflow}{if} v\_output.codvw_phase < pll\_steps \textcolor{keywordflow}{then}
01624                             v\_output.codvw_phase := v\_output.codvw_phase + pll\_steps;
01625                             v\_output.rlat        := v\_output.rlat - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01626                         \textcolor{keywordflow}{else}
01627                             v\_output.codvw_phase := v\_output.codvw_phase - pll\_steps;
01628                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01629 
01630                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01631 
01632                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01633 
01634             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01635 
01636             \textcolor{keywordflow}{if} v\_half\_cl = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{and} is\_ciii\textcolor{vhdlchar}{(}family\_id\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
01637                 v\_output.codvw_phase := v\_output.codvw_phase - pll\_steps/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
01638             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01639 
01640         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
01641 
01642         \textcolor{keywordflow}{return} v\_output;
01643 
01644     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
01645 
01646 \textcolor{keyword}{    --}
01647 \textcolor{keywordflow}{END} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_record\_pkg};
01648 \textcolor{keyword}{--/* Legal Notice: (C)2006 Altera Corporation. All rights reserved.  Your}
01649 \textcolor{keyword}{--   use of Altera Corporation's design tools, logic functions and other}
01650 \textcolor{keyword}{--   software and tools, and its AMPP partner logic functions, and any}
01651 \textcolor{keyword}{--   output files any of the foregoing (including device programming or}
01652 \textcolor{keyword}{--   simulation files), and any associated documentation or information are}
01653 \textcolor{keyword}{--   expressly subject to the terms and conditions of the Altera Program}
01654 \textcolor{keyword}{--   License Subscription Agreement or other applicable license agreement,}
01655 \textcolor{keyword}{--   including, without limitation, that your use is for the sole purpose}
01656 \textcolor{keyword}{--   of programming logic devices manufactured by Altera and sold by Altera}
01657 \textcolor{keyword}{--   or its authorized distributors.  Please refer to the applicable}
01658 \textcolor{keyword}{--   agreement for further details. */}
01659 
01660 \textcolor{keyword}{--}
01661 
01662 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
01663 \textcolor{keyword}{--  Abstract        : address and command package, shared between all variations of}
01664 \textcolor{keyword}{--                    the AFI sequencer}
01665 \textcolor{keyword}{--                    The address and command package (alt\_mem\_phy\_addr\_cmd\_pkg) is}
01666 \textcolor{keyword}{--                    used to combine DRAM address and command signals in one record}
01667 \textcolor{keyword}{--                    and unify the functions operating on this record.}
01668 \textcolor{keyword}{--}
01669 \textcolor{keyword}{--}
01670 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
01671 
01672 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
01673 \textcolor{vhdlkeyword}{    use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
01674 \textcolor{vhdlkeyword}{    use }ieee.numeric\_std.\textcolor{keywordflow}{all};
01675 
01676 \textcolor{keyword}{--}
01677 \textcolor{keywordflow}{package }ddr2_phy_alt_mem_phy_addr_cmd_pkg \textcolor{keywordflow}{is}
01678 
01679 \textcolor{keyword}{    -- the following are bounds on the maximum range of address and command signals}
01680     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_addr_bits}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
01681     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_ba_bits}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
01682     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_ranks}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
01683     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_mode_reg_bit}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
01684     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_cmds_per_clk}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{  -- quarter rate}
01685 
01686 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
01687 \textcolor{keyword}{--}
01688     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{ac_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (addr\_cmd\_pkg) : "};
01689 
01690 \textcolor{keyword}{-- -------------------------------------------------------------}
01691 \textcolor{keyword}{-- this record represents a single mem\_clk command cycle}
01692 \textcolor{keyword}{-- -------------------------------------------------------------}
01693     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_addr_cmd} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
01694         \textcolor{vhdlchar}{addr}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_addr_bits} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01695         \textcolor{vhdlchar}{ba}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_ba_bits}   \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
01696         \textcolor{vhdlchar}{cas_n} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
01697         \textcolor{vhdlchar}{ras_n} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
01698         \textcolor{vhdlchar}{we_n}  \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
01699         \textcolor{vhdlchar}{cke}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_ranks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{     -- bounded max of 8 ranks}
01700         \textcolor{vhdlchar}{cs_n}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_ranks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{ -- bounded max of 8 ranks}
01701         \textcolor{vhdlchar}{odt}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_max_ranks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{     -- bounded max of 8 ranks}
01702         \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
01703     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_addr_cmd};
01704 
01705 \textcolor{keyword}{-- -------------------------------------------------------------}
01706 \textcolor{keyword}{-- this vector is used to describe the fact that for slower clock domains}
01707 \textcolor{keyword}{-- mutiple commands per clock can be issued and encapsulates all these options in a}
01708 \textcolor{keyword}{-- type which can scale with rate}
01709 \textcolor{keyword}{-- -------------------------------------------------------------}
01710     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_addr_cmd_vector} \textcolor{keywordflow}{is} \textcolor{keywordflow}{array} \textcolor{vhdlchar}{(}\textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{<}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{t_addr_cmd};
01711 
01712 \textcolor{keyword}{-- -------------------------------------------------------------}
01713 \textcolor{keyword}{-- this record is used to define the memory interface type and allow packing and checking}
01714 \textcolor{keyword}{-- (it should be used as a generic to a entity or from a poject level constant)}
01715 \textcolor{keyword}{-- -------------------------------------------------------------}
01716 
01717 \textcolor{keyword}{    -- enumeration for mem\_type}
01718     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mem_type} \textcolor{keywordflow}{is}
01719         \textcolor{vhdlchar}{(}
01720             \textcolor{vhdlchar}{DDR}\textcolor{vhdlchar}{,}
01721             \textcolor{vhdlchar}{DDR2}\textcolor{vhdlchar}{,}
01722             \textcolor{vhdlchar}{DDR3}
01723         \textcolor{vhdlchar}{)};
01724 
01725 \textcolor{keyword}{    -- memory interface configuration parameters}
01726     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_addr_cmd_config_rec} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
01727         \textcolor{vhdlchar}{num_addr_bits} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01728         \textcolor{vhdlchar}{num_ba_bits}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01729         \textcolor{vhdlchar}{num_cs_bits}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01730         \textcolor{vhdlchar}{num_ranks}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01731         \textcolor{vhdlchar}{cmds_per_clk}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_cmds_per_clk};\textcolor{keyword}{  -- commands per clock cycle (equal to
       DWIDTH\_RATIO/2)}
01732         \textcolor{vhdlchar}{mem_type}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_mem_type};
01733     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
01734 
01735 \textcolor{keyword}{-- -----------------------------------}
01736 \textcolor{keyword}{-- the following type is used to switch between signals}
01737 \textcolor{keyword}{-- (for example, in the mask function below)}
01738 \textcolor{keyword}{-- -----------------------------------}
01739     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_addr_cmd_signals} \textcolor{keywordflow}{is}
01740         \textcolor{vhdlchar}{(}
01741            \textcolor{vhdlchar}{addr}\textcolor{vhdlchar}{,}
01742            \textcolor{vhdlchar}{ba}\textcolor{vhdlchar}{,}
01743            \textcolor{vhdlchar}{cas_n}\textcolor{vhdlchar}{,}
01744            \textcolor{vhdlchar}{ras_n}\textcolor{vhdlchar}{,}
01745            \textcolor{vhdlchar}{we_n}\textcolor{vhdlchar}{,}
01746            \textcolor{vhdlchar}{cke}\textcolor{vhdlchar}{,}
01747            \textcolor{vhdlchar}{cs_n}\textcolor{vhdlchar}{,}
01748            \textcolor{vhdlchar}{odt}\textcolor{vhdlchar}{,}
01749            \textcolor{vhdlchar}{rst_n}
01750         \textcolor{vhdlchar}{)};
01751 
01752 \textcolor{keyword}{-- -----------------------------------}
01753 \textcolor{keyword}{-- odt record}
01754 \textcolor{keyword}{-- to hold the odt settings}
01755 \textcolor{keyword}{-- (an odt\_record) per rank (in odt\_array)}
01756 \textcolor{keyword}{-- -----------------------------------}
01757     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_odt_record} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
01758         \textcolor{vhdlchar}{write} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01759         \textcolor{vhdlchar}{read}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
01760     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_odt_record};
01761     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_odt_array} \textcolor{keywordflow}{is} \textcolor{keywordflow}{array} \textcolor{vhdlchar}{(}\textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{<}\textcolor{vhdlchar}{>}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{t_odt_record};
01762 
01763 \textcolor{keyword}{-- -------------------------------------------------------------}
01764 \textcolor{keyword}{-- exposed functions and procedures}
01765 \textcolor{keyword}{--}
01766 \textcolor{keyword}{-- these functions cover the following memory types:}
01767 \textcolor{keyword}{-- DDR3, DDR2, DDR}
01768 \textcolor{keyword}{--}
01769 \textcolor{keyword}{-- and the following operations:}
01770 \textcolor{keyword}{-- MRS, REF, PRE, PREA, ACT,}
01771 \textcolor{keyword}{-- WR, WRS8, WRS4, WRA, WRAS8, WRAS4,}
01772 \textcolor{keyword}{-- RD, RDS8, RDS4, RDA, RDAS8, RDAS4,}
01773 \textcolor{keyword}{--}
01774 \textcolor{keyword}{-- for DDR3 on the fly burst length setting for reads/writes}
01775 \textcolor{keyword}{-- is supported}
01776 \textcolor{keyword}{-- -------------------------------------------------------------}
01777 
01778     \textcolor{keywordflow}{function} defaults               ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec
01779                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01780 
01781     \textcolor{keywordflow}{function} reset                  ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec
01782                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01783 
01784     \textcolor{keywordflow}{function} int_pup_reset          ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec
01785                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01786 
01787     \textcolor{keywordflow}{function} deselect               ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01788                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector
01789                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01790 
01791 -    \textcolor{keywordflow}{function} precharge_all          ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01792                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01793                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01794                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01795 
01796 -    \textcolor{keywordflow}{function} precharge_all          ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01797                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01798                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01799 
01800 --    \textcolor{keywordflow}{function} precharge_bank         ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01801                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01802                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
01803                                       bank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1}
01804                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01805 
01806 ---    \textcolor{keywordflow}{function} activate               ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01807                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01808                                       bank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
01809                                       row                  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
01810                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1}
01811                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01812 
01813 ---    \textcolor{keywordflow}{function} write                  ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01814                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01815                                       bank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
01816                                       col                  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
01817                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
01818                                       op\_length            : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
01819                                       auto\_prech           : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
01820                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01821 
01822 ---    \textcolor{keywordflow}{function} read                   ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01823                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01824                                       bank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
01825                                       col                  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
01826                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
01827                                       op\_length            : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
01828                                       auto\_prech           : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
01829                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01830 
01831 -    \textcolor{keywordflow}{function} refresh                ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01832                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01833                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01834                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01835 
01836 -    \textcolor{keywordflow}{function} self_refresh_entry     ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01837                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01838                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01839                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01840 
01841 -    \textcolor{keywordflow}{function} load_mode              ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01842                                       mode\_register\_num    : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{3};
01843                                       mode\_reg\_value       : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}(
      c_max_mode_reg_bit \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01844                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
01845                                       remap\_addr\_and\_ba    : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
01846                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01847 
01848 -    \textcolor{keywordflow}{function} dll_reset              ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01849                                       mode\_reg\_val         : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector};
01850                                       rank\_num             : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
01851                                       reorder\_addr\_bits    : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
01852                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01853 
01854 -    \textcolor{keywordflow}{function} enter_sr_pd_mode       ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01855                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01856                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01857                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01858 
01859 -    \textcolor{keywordflow}{function} maintain_pd_or_sr      ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01860                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01861                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01862                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01863 
01864 -    \textcolor{keywordflow}{function} exit_sr_pd_mode        ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01865                                       previous             : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01866                                       ranks                : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01867                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01868 
01869 -    \textcolor{keywordflow}{function} ZQCS                   ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01870                                       rank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01871                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01872 
01873 -    \textcolor{keywordflow}{function} ZQCL                   ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01874                                       rank                 : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
01875                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01876 
01877     \textcolor{keywordflow}{function} all_unreversed_ranks   ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01878                                       record\_to\_mask       : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01879                                       mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
01880                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01881 
01882     \textcolor{keywordflow}{function} all_reversed_ranks     ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01883                                       record\_to\_mask       : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
01884                                       mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
01885                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01886     
01887     \textcolor{keywordflow}{function} program_rdimm_register ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
01888                                       control\_word\_addr      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
01889                                       control\_word\_data      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
01890                                     ) \textcolor{keywordflow}{return}                       \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01891 
01892 \textcolor{keyword}{-- -------------------------------------------------------------}
01893 \textcolor{keyword}{-- the following function sets up the odt settings}
01894 \textcolor{keyword}{-- NOTES: currently only supports DDR/DDR2 memories}
01895 \textcolor{keyword}{-- -------------------------------------------------------------}
01896 
01897 \textcolor{keyword}{    -- odt setting as implemented in the altera high-performance controller for ddr2 memories}
01898     \textcolor{keywordflow}{function} set_odt_values (ranks          : \textcolor{comment}{natural};
01899                              ranks\_per\_slot : \textcolor{comment}{natural};
01900                              mem_type      : \textcolor{keywordflow}{in} \textcolor{comment}{string}
01901                             ) \textcolor{keywordflow}{return}          \textcolor{vhdlchar}{t_odt_array};
01902 
01903 \textcolor{keyword}{-- -------------------------------------------------------------}
01904 \textcolor{keyword}{-- the following function enables assignment to the constant config\_rec}
01905 \textcolor{keyword}{-- -------------------------------------------------------------}
01906     \textcolor{keywordflow}{function} set_config_rec ( num_addr_bits     : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01907                               num_ba_bits       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01908                               num_cs_bits       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01909                               num_ranks         : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01910                               dwidth\_ratio      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_cmds_per_clk;
01911                               mem_type          : \textcolor{keywordflow}{in}    \textcolor{comment}{string}
01912                               ) \textcolor{keywordflow}{return}                  \textcolor{vhdlchar}{t_addr_cmd_config_rec};
01913                               
01914 
01915 \textcolor{keyword}{-- The non-levelled sequencer doesn't make a distinction between CS\_WIDTH and NUM\_RANKS. In this case,}
01916 \textcolor{keyword}{-- just set the two to be the same.}
01917     \textcolor{keywordflow}{function} set_config_rec ( num_addr_bits     : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01918                               num_ba_bits       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01919                               num_cs_bits       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural};
01920                               dwidth\_ratio      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_cmds_per_clk;
01921                               mem_type          : \textcolor{keywordflow}{in}    \textcolor{comment}{string}
01922                               ) \textcolor{keywordflow}{return}                  \textcolor{vhdlchar}{t_addr_cmd_config_rec};
01923 
01924 
01925 \textcolor{keyword}{-- -------------------------------------------------------------}
01926 \textcolor{keyword}{-- the following function and procedure unpack address and}
01927 \textcolor{keyword}{-- command signals from the t\_addr\_cmd\_vector format}
01928 \textcolor{keyword}{-- -------------------------------------------------------------}
01929 
01930     \textcolor{keywordflow}{procedure} unpack_addr_cmd_vector( addr\_cmd\_vector : \textcolor{keywordflow}{in} t_addr_cmd_vector;
01931                                       config\_rec      : \textcolor{keywordflow}{in} t_addr_cmd_config_rec;
01932                                       addr            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01933                                       ba              : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01934                                       cas_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01935                                       ras_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01936                                       we_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01937                                       cke             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01938                                       cs_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01939                                       odt             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01940                                       rst_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector});
01941 
01942 
01943     \textcolor{keywordflow}{procedure} unpack_addr_cmd_vector( config\_rec      : \textcolor{keywordflow}{in} t_addr_cmd_config_rec;
01944                                       addr\_cmd\_vector : \textcolor{keywordflow}{in} t_addr_cmd_vector;
01945                                \textcolor{keywordflow}{signal} addr            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01946                                \textcolor{keywordflow}{signal} ba              : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01947                                \textcolor{keywordflow}{signal} cas_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01948                                \textcolor{keywordflow}{signal} ras_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01949                                \textcolor{keywordflow}{signal} we_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01950                                \textcolor{keywordflow}{signal} cke             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01951                                \textcolor{keywordflow}{signal} cs_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01952                                \textcolor{keywordflow}{signal} odt             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
01953                                \textcolor{keywordflow}{signal} rst_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector});
01954 
01955 \textcolor{keyword}{-- -------------------------------------------------------------}
01956 \textcolor{keyword}{-- the following functions perform bit masking to 0 or 1 (as}
01957 \textcolor{keyword}{-- specified by mask\_value) to a chosen address/command signal (signal\_name)}
01958 \textcolor{keyword}{-- across all signal bits or to a selected bit (mask\_bit)}
01959 \textcolor{keyword}{-- -------------------------------------------------------------}
01960 
01961 \textcolor{keyword}{    -- mask all signal bits procedure}
01962     \textcolor{keywordflow}{function} mask  ( config\_rec            : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
01963                      addr\_cmd\_vector       : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
01964                      signal\_name           : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
01965                      mask\_value            : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic}) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01966 
01967     \textcolor{keywordflow}{procedure} mask(        config\_rec      : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
01968                     \textcolor{keywordflow}{signal} addr\_cmd\_vector : \textcolor{keywordflow}{inout} t_addr_cmd_vector;
01969                            signal\_name     : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
01970                            mask\_value      : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic});
01971 
01972 \textcolor{keyword}{    -- mask signal bit (mask\_bit) procedure}
01973     \textcolor{keywordflow}{function} mask  ( config\_rec            : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
01974                      addr\_cmd\_vector       : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
01975                      signal\_name           : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
01976                      mask\_value            : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
01977                      mask\_bit              : \textcolor{keywordflow}{in}    \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_addr_cmd_vector};
01978 
01979 \textcolor{keyword}{--}
01980 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_addr\_cmd\_pkg};
01981 
01982 
01983 \textcolor{keyword}{--}
01984 \textcolor{keywordflow}{package} \textcolor{keywordflow}{body} ddr2_phy_alt_mem_phy_addr_cmd_pkg \textcolor{keywordflow}{IS}
01985 
01986 \textcolor{keyword}{-- -------------------------------------------------------------}
01987 \textcolor{keyword}{-- Basic functions for a single command}
01988 \textcolor{keyword}{-- -------------------------------------------------------------}
01989 
01990 \textcolor{keyword}{    -- -------------------------------------------------------------}
01991 \textcolor{keyword}{    -- defaults the bus                   no JEDEC abbreviated name}
01992 \textcolor{keyword}{    -- -------------------------------------------------------------}
01993     \textcolor{keywordflow}{function} defaults ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec
01994                       ) \textcolor{keywordflow}{return}             t_addr_cmd
01995     \textcolor{keywordflow}{is}
01996         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
01997     \textcolor{keywordflow}{begin}
01998 
01999         v\_retval.addr  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02000         v\_retval.ba    := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02001         v\_retval.cas_n := false;
02002         v\_retval.ras_n := false;
02003         v\_retval.we_n  := false;
02004         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02005         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02006         v\_retval.odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02007         v\_retval.rst_n := false;
02008 
02009         \textcolor{keywordflow}{return} v\_retval;
02010 
02011     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02012 
02013 \textcolor{keyword}{    -- -------------------------------------------------------------}
02014 \textcolor{keyword}{    -- resets the addr/cmd signal         (Same as default with cke and rst\_n 0 )}
02015 \textcolor{keyword}{    -- -------------------------------------------------------------}
02016     \textcolor{keywordflow}{function} reset    ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec
02017                       ) \textcolor{keywordflow}{return}             t_addr_cmd
02018     \textcolor{keywordflow}{is}
02019         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02020     \textcolor{keywordflow}{begin}
02021 
02022         v\_retval       := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02023         v\_retval.cke   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02024         \textcolor{keywordflow}{if} config\_rec.mem_type = DDR3 \textcolor{keywordflow}{then}
02025             v\_retval.rst_n := true;
02026         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02027         \textcolor{keywordflow}{return} v\_retval;
02028 
02029     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02030 
02031 \textcolor{keyword}{    -- -------------------------------------------------------------}
02032 \textcolor{keyword}{    -- issues deselect (command)         JEDEC abbreviated name: DES}
02033 \textcolor{keyword}{    -- -------------------------------------------------------------}
02034     \textcolor{keywordflow}{function} deselect ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02035                         previous   : \textcolor{keywordflow}{in}    t_addr_cmd
02036                       ) \textcolor{keywordflow}{return}             t_addr_cmd
02037     \textcolor{keywordflow}{is}
02038         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02039     \textcolor{keywordflow}{begin}
02040 
02041         v\_retval := previous;
02042 
02043         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02044         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02045         v\_retval.rst_n := false;
02046 
02047         \textcolor{keywordflow}{return} v\_retval;
02048 
02049     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02050 
02051 \textcolor{keyword}{    -- -------------------------------------------------------------}
02052 \textcolor{keyword}{    -- issues a precharge all command     JEDEC abbreviated name: PREA}
02053 \textcolor{keyword}{    -- -------------------------------------------------------------}
02054 -    \textcolor{keywordflow}{function} precharge_all( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02055                             previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02056                             ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02057                           ) \textcolor{keywordflow}{return}             t_addr_cmd
02058     \textcolor{keywordflow}{is}
02059         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02060         \textcolor{keywordflow}{variable} v\_addr     : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(} c_max_addr_bits -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02061     \textcolor{keywordflow}{begin}
02062 
02063         v\_retval       := previous;
02064 
02065         v\_addr         := to\_unsigned\textcolor{vhdlchar}{(}previous.addr, c_max_addr_bits\textcolor{vhdlchar}{)};
02066         v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)}     := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'; \textcolor{keyword}{-- set AP bit high}
02067         v\_retval.addr  := to\_integer\textcolor{vhdlchar}{(}v\_addr\textcolor{vhdlchar}{)};
02068 
02069         v\_retval.ras_n := true;
02070         v\_retval.cas_n := false;
02071         v\_retval.we_n  := true;
02072         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02073         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02074         v\_retval.rst_n := false;
02075 
02076         \textcolor{keywordflow}{return} v\_retval;
02077 
02078     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02079 
02080 \textcolor{keyword}{    -- -------------------------------------------------------------}
02081 \textcolor{keyword}{    -- precharge (close) a bank           JEDEC abbreviated name: PRE}
02082 \textcolor{keyword}{    -- -------------------------------------------------------------}
02083 --    \textcolor{keywordflow}{function} precharge_bank( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02084                              previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02085                              ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02086                              bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1}
02087                            ) \textcolor{keywordflow}{return}             t_addr_cmd
02088     \textcolor{keywordflow}{is}
02089         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02090         \textcolor{keywordflow}{variable} v\_addr     : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(} c_max_addr_bits -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02091     \textcolor{keywordflow}{begin}
02092 
02093         v\_retval       := previous;
02094 
02095         v\_addr         := to\_unsigned\textcolor{vhdlchar}{(}previous.addr, c_max_addr_bits\textcolor{vhdlchar}{)};
02096         v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)}     := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'; \textcolor{keyword}{-- set AP bit low}
02097         v\_retval.addr  := to\_integer\textcolor{vhdlchar}{(}v\_addr\textcolor{vhdlchar}{)};
02098 
02099         v\_retval.ba    := bank;
02100 
02101         v\_retval.ras_n := true;
02102         v\_retval.cas_n := false;
02103         v\_retval.we_n  := true;
02104         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} - ranks;
02105         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02106         v\_retval.rst_n := false;
02107 
02108         \textcolor{keywordflow}{return} v\_retval;
02109 
02110     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02111 
02112 
02113 \textcolor{keyword}{    -- -------------------------------------------------------------}
02114 \textcolor{keyword}{    -- Issues a activate (open row)       JEDEC abbreviated name: ACT}
02115 \textcolor{keyword}{    -- -------------------------------------------------------------}
02116 ---    \textcolor{keywordflow}{function} activate (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02117                        previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02118                        bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits  \textcolor{vhdllogic}{1};
02119                        row        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits  \textcolor{vhdllogic}{1};
02120                        ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1}
02121                       ) \textcolor{keywordflow}{return}            t_addr_cmd
02122     \textcolor{keywordflow}{is}
02123         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd;
02124     \textcolor{keywordflow}{begin}
02125 
02126         v\_retval.addr  := row;
02127         v\_retval.ba    := bank;
02128         v\_retval.cas_n := false;
02129         v\_retval.ras_n := true;
02130         v\_retval.we_n  := false;
02131         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02132         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02133         v\_retval.odt   := previous.odt;
02134         v\_retval.rst_n := false;
02135 
02136         \textcolor{keywordflow}{return} v\_retval;
02137 
02138     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02139 
02140 
02141 \textcolor{keyword}{    -- -------------------------------------------------------------}
02142 \textcolor{keyword}{    -- issues a write command     JEDEC abbreviated name:WR,   WRA}
02143 \textcolor{keyword}{    --                                                   WRS4, WRAS4}
02144 \textcolor{keyword}{    --                                                   WRS8, WRAS8}
02145 \textcolor{keyword}{    -- has the ability to support:}
02146 \textcolor{keyword}{    --   DDR3:}
02147 \textcolor{keyword}{    --      BL4, BL8, fixed BL}
02148 \textcolor{keyword}{    --      Auto Precharge (AP)}
02149 \textcolor{keyword}{    --   DDR2, DDR:}
02150 \textcolor{keyword}{    --      fixed BL}
02151 \textcolor{keyword}{    --      Auto Precharge (AP)}
02152 \textcolor{keyword}{    -- -------------------------------------------------------------}
02153 ---    \textcolor{keywordflow}{function} write    (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02154                        previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02155                        bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
02156                        col        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
02157                        ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02158                        op\_length  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
02159                        auto\_prech : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02160                       ) \textcolor{keywordflow}{return}            t_addr_cmd
02161     \textcolor{keywordflow}{is}
02162         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02163         \textcolor{keywordflow}{variable} v\_addr     : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}c_max_addr_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02164     \textcolor{keywordflow}{begin}
02165 
02166 \textcolor{keyword}{        -- calculate correct address signal}
02167         v\_addr := to\_unsigned\textcolor{vhdlchar}{(}col, c_max_addr_bits\textcolor{vhdlchar}{)};
02168 
02169 \textcolor{keyword}{        -- note pin A10 is used for AP, therfore shift the value from A10 onto A11.}
02170         v\_retval.addr  := to\_integer\textcolor{vhdlchar}{(}v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02171 
02172         \textcolor{keywordflow}{if} v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{then}
02173             v\_retval.addr := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
02174         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02175 
02176         \textcolor{keywordflow}{if} auto\_prech = true \textcolor{keywordflow}{then}\textcolor{keyword}{  -- set AP bit (A10)}
02177             v\_retval.addr := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
02178         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02179 
02180         \textcolor{keywordflow}{if} config\_rec.mem_type = DDR3 \textcolor{keywordflow}{then}
02181 
02182             \textcolor{keywordflow}{if}    op\_length = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- set BL\_OTF sel bit (A12)}
02183                 v\_retval.addr  := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
02184             \textcolor{keywordflow}{elsif} op\_length = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
02185                 \textcolor{keywordflow}{null};
02186             \textcolor{keywordflow}{else}
02187                 \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"DDR3 DRAM only supports writes of burst length 4 or 8, the
       requested length was: "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}op\_length\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
02188             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02189 
02190         \textcolor{keywordflow}{elsif} config\_rec.mem_type = DDR2 \textcolor{keywordflow}{or} config\_rec.mem_type = DDR \textcolor{keywordflow}{then}
02191 
02192            \textcolor{keywordflow}{null};
02193 
02194         \textcolor{keywordflow}{else}
02195             \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"only DDR memories are supported for memory writes"} \textcolor{keywordflow}{severity} failure;
02196         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02197 
02198 \textcolor{keyword}{        -- set a/c signal assignments for write}
02199         v\_retval.ba    := bank;
02200         v\_retval.cas_n := true;
02201         v\_retval.ras_n := false;
02202         v\_retval.we_n  := true;
02203         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02204         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02205         v\_retval.odt   := ranks;
02206         v\_retval.rst_n := false;
02207 
02208         \textcolor{keywordflow}{return} v\_retval;
02209 
02210     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02211 
02212 \textcolor{keyword}{    -- -------------------------------------------------------------}
02213 \textcolor{keyword}{    -- issues a read command    JEDEC abbreviated name: RD,   RDA}
02214 \textcolor{keyword}{    --                                                  RDS4, RDAS4}
02215 \textcolor{keyword}{    --                                                  RDS8, RDAS8}
02216 \textcolor{keyword}{    -- has the ability to support:}
02217 \textcolor{keyword}{    --   DDR3:}
02218 \textcolor{keyword}{    --      BL4, BL8, fixed BL}
02219 \textcolor{keyword}{    --      Auto Precharge (AP)}
02220 \textcolor{keyword}{    --   DDR2, DDR:}
02221 \textcolor{keyword}{    --      fixed BL, Auto Precharge (AP)}
02222 \textcolor{keyword}{    -- -------------------------------------------------------------}
02223 ---    \textcolor{keywordflow}{function} read     (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02224                        previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02225                        bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
02226                        col        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
02227                        ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02228                        op\_length  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
02229                        auto\_prech : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02230                       ) \textcolor{keywordflow}{return}            t_addr_cmd
02231     \textcolor{keywordflow}{is}
02232         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02233         \textcolor{keywordflow}{variable} v\_addr     : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}c_max_addr_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02234     \textcolor{keywordflow}{begin}
02235 
02236 \textcolor{keyword}{        -- calculate correct address signal}
02237         v\_addr := to\_unsigned\textcolor{vhdlchar}{(}col, c_max_addr_bits\textcolor{vhdlchar}{)};
02238 
02239 \textcolor{keyword}{        -- note pin A10 is used for AP, therfore shift the value from A10 onto A11.}
02240         v\_retval.addr  := to\_integer\textcolor{vhdlchar}{(}v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02241 
02242         \textcolor{keywordflow}{if} v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}' \textcolor{keywordflow}{then}
02243             v\_retval.addr := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11};
02244         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02245 
02246         \textcolor{keywordflow}{if} auto\_prech = true \textcolor{keywordflow}{then}\textcolor{keyword}{  -- set AP bit (A10)}
02247             v\_retval.addr := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
02248         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02249 
02250         \textcolor{keywordflow}{if} config\_rec.mem_type = DDR3 \textcolor{keywordflow}{then}
02251 
02252             \textcolor{keywordflow}{if}    op\_length = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- set BL\_OTF sel bit (A12)}
02253                 v\_retval.addr  := v\_retval.addr + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
02254             \textcolor{keywordflow}{elsif} op\_length = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
02255                 \textcolor{keywordflow}{null};
02256             \textcolor{keywordflow}{else}
02257                 \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"DDR3 DRAM only supports reads of burst length 4 or 8"} \textcolor{keywordflow}{severity} 
      failure;
02258             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02259 
02260         \textcolor{keywordflow}{elsif} config\_rec.mem_type = DDR2 \textcolor{keywordflow}{or} config\_rec.mem_type = DDR \textcolor{keywordflow}{then}
02261 
02262            \textcolor{keywordflow}{null};
02263 
02264         \textcolor{keywordflow}{else}
02265             \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"only DDR memories are supported for memory reads"} \textcolor{keywordflow}{severity} failure;
02266         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02267 
02268 \textcolor{keyword}{        -- set a/c signals for read command}
02269         v\_retval.ba    := bank;
02270         v\_retval.cas_n := true;
02271         v\_retval.ras_n := false;
02272         v\_retval.we_n  := false;
02273         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02274         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02275         v\_retval.odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02276         v\_retval.rst_n := false;
02277         \textcolor{keywordflow}{return} v\_retval;
02278 
02279     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02280 
02281 \textcolor{keyword}{    -- -------------------------------------------------------------}
02282 \textcolor{keyword}{    -- issues a refresh command           JEDEC abbreviated name: REF}
02283 \textcolor{keyword}{    -- -------------------------------------------------------------}
02284 -    \textcolor{keywordflow}{function} refresh (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02285                       previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02286                       ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02287                      )
02288                      \textcolor{keywordflow}{return}              t_addr_cmd
02289     \textcolor{keywordflow}{is}
02290         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02291     \textcolor{keywordflow}{begin}
02292 
02293         v\_retval := previous;
02294 
02295         v\_retval.cas_n := true;
02296         v\_retval.ras_n := true;
02297         v\_retval.we_n  := false;
02298         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02299         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02300         v\_retval.rst_n := false;
02301 
02302 \textcolor{keyword}{        -- addr, BA and ODT are don't care therfore leave as previous value}
02303 
02304         \textcolor{keywordflow}{return} v\_retval;
02305 
02306     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02307 
02308 
02309 \textcolor{keyword}{    -- -------------------------------------------------------------}
02310 \textcolor{keyword}{    -- issues a mode register set command JEDEC abbreviated name: MRS}
02311 \textcolor{keyword}{    -- -------------------------------------------------------------}
02312 -    \textcolor{keywordflow}{function} load_mode ( config\_rec        : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02313                          mode\_register\_num : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{3};
02314                          mode\_reg\_value    : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}(
      c_max_mode_reg_bit \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
02315                          ranks             : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02316                          remap\_addr\_and\_ba : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02317                        ) \textcolor{keywordflow}{return}                    t_addr_cmd
02318     \textcolor{keywordflow}{is}
02319         \textcolor{keywordflow}{variable} v\_retval     : t_addr_cmd;
02320         \textcolor{keywordflow}{variable} v\_addr\_remap : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}c_max_mode_reg_bit \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02321     \textcolor{keywordflow}{begin}
02322 
02323         v\_retval.cas_n := true;
02324         v\_retval.ras_n := true;
02325         v\_retval.we_n  := true;
02326         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02327         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02328         v\_retval.odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02329         v\_retval.rst_n := false;
02330 
02331         v\_retval.ba    := mode\_register\_num;
02332         v\_retval.addr  := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mode\_reg\_value\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02333 
02334         \textcolor{keywordflow}{if} remap\_addr\_and\_ba = true \textcolor{keywordflow}{then}
02335             v\_addr\_remap             := \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}mode\_reg\_value\textcolor{vhdlchar}{)};
02336             v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} := v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} & v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)};
02337             v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)} := v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)} & v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)};
02338             v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} := v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} & v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)};
02339 
02340             v\_retval.addr            := to\_integer\textcolor{vhdlchar}{(}v\_addr\_remap\textcolor{vhdlchar}{)};
02341 
02342             v\_addr\_remap             := to\_unsigned\textcolor{vhdlchar}{(}mode\_register\_num, 
      c_max_mode_reg_bit + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02343             v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} & v\_addr\_remap\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02344 
02345             v\_retval.ba              := to\_integer\textcolor{vhdlchar}{(}v\_addr\_remap\textcolor{vhdlchar}{)};
02346 
02347         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02348 
02349         \textcolor{keywordflow}{return} v\_retval;
02350 
02351     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02352 
02353 
02354 \textcolor{keyword}{    -- -------------------------------------------------------------}
02355 \textcolor{keyword}{    -- maintains SR or PD mode on slected ranks.}
02356 \textcolor{keyword}{    -- -------------------------------------------------------------}
02357 -    \textcolor{keywordflow}{function} maintain_pd_or_sr  (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02358                                  previous   : \textcolor{keywordflow}{in}    t_addr_cmd;
02359                                  ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02360                                 )
02361                                 \textcolor{keywordflow}{return}              t_addr_cmd
02362     \textcolor{keywordflow}{is}
02363         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02364     \textcolor{keywordflow}{begin}
02365         v\_retval     := previous;
02366         v\_retval.cke := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - ranks;
02367         \textcolor{keywordflow}{return} v\_retval;
02368     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02369 
02370 
02371 \textcolor{keyword}{    -- -------------------------------------------------------------}
02372 \textcolor{keyword}{    -- issues a ZQ cal (short)          JEDEC abbreviated name: ZQCS}
02373 \textcolor{keyword}{    -- NOTE - can only be issued to a single RANK at a time.}
02374 \textcolor{keyword}{    -- -------------------------------------------------------------}
02375 -    \textcolor{keywordflow}{function} ZQCS (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02376                    rank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02377                   )
02378                   \textcolor{keywordflow}{return}              t_addr_cmd
02379     \textcolor{keywordflow}{is}
02380         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02381     \textcolor{keywordflow}{begin}
02382 
02383 
02384         v\_retval.cas_n := false;
02385         v\_retval.ras_n := false;
02386         v\_retval.we_n  := true;
02387         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02388         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - rank;
02389         v\_retval.rst_n := false;
02390 
02391         v\_retval.addr  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}; \textcolor{keyword}{-- clear bit 10}
02392         v\_retval.ba    := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02393         v\_retval.odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02394         \textcolor{keywordflow}{return} v\_retval;
02395 
02396     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02397 
02398 
02399 
02400 \textcolor{keyword}{    -- -------------------------------------------------------------}
02401 \textcolor{keyword}{    -- issues a ZQ cal (long)           JEDEC abbreviated name: ZQCL}
02402 \textcolor{keyword}{    -- NOTE - can only be issued to a single RANK at a time.}
02403 \textcolor{keyword}{    -- -------------------------------------------------------------}
02404 -    \textcolor{keywordflow}{function} ZQCL (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02405                    rank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02406                   )
02407                   \textcolor{keywordflow}{return}              t_addr_cmd
02408     \textcolor{keywordflow}{is}
02409         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd;
02410     \textcolor{keywordflow}{begin}
02411 
02412         v\_retval.cas_n := false;
02413         v\_retval.ras_n := false;
02414         v\_retval.we_n  := true;
02415         v\_retval.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02416         v\_retval.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} - rank;
02417         v\_retval.rst_n := false;
02418 
02419         v\_retval.addr  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1024}; \textcolor{keyword}{-- set bit 10}
02420         v\_retval.ba    := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02421         v\_retval.odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02422         \textcolor{keywordflow}{return} v\_retval;
02423 
02424     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02425 
02426 
02427 \textcolor{keyword}{-- -------------------------------------------------------------}
02428 \textcolor{keyword}{-- functions acting on all clock cycles from whatever rate}
02429 \textcolor{keyword}{--  in halfrate clock domain issues 1 command per clock}
02430 \textcolor{keyword}{--  in quarter rate issues 1 command per clock}
02431 \textcolor{keyword}{--     In the above cases they will be correctly aligned using the}
02432 \textcolor{keyword}{--       ALTMEMPHY 2T and 4T SDC}
02433 \textcolor{keyword}{-- -------------------------------------------------------------}
02434 
02435 \textcolor{keyword}{    -- -------------------------------------------------------------}
02436 \textcolor{keyword}{    -- defaults the bus                   no JEDEC abbreviated name}
02437 \textcolor{keyword}{    -- -------------------------------------------------------------}
02438     \textcolor{keywordflow}{function} defaults (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec
02439                       ) \textcolor{keywordflow}{return}            t_addr_cmd_vector
02440     \textcolor{keywordflow}{is}
02441         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02442     \textcolor{keywordflow}{begin}
02443 
02444         v\_retval := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02445 
02446         \textcolor{keywordflow}{return} v\_retval;
02447 
02448     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02449 
02450 \textcolor{keyword}{    -- -------------------------------------------------------------}
02451 \textcolor{keyword}{    -- resets the addr/cmd signal         (same as default with cke 0)}
02452 \textcolor{keyword}{    -- -------------------------------------------------------------}
02453     \textcolor{keywordflow}{function} reset    (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec
02454                       ) \textcolor{keywordflow}{return}            t_addr_cmd_vector
02455     \textcolor{keywordflow}{is}
02456         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02457     \textcolor{keywordflow}{begin}
02458 
02459         v\_retval := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => reset\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02460 
02461         \textcolor{keywordflow}{return} v\_retval;
02462 
02463     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02464 
02465     \textcolor{keywordflow}{function} int_pup_reset (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec
02466                       ) \textcolor{keywordflow}{return}            t_addr_cmd_vector
02467     \textcolor{keywordflow}{is}
02468         \textcolor{keywordflow}{variable} v\_addr\_cmd\_config\_rst : t_addr_cmd_config_rec;
02469     \textcolor{keywordflow}{begin}
02470 
02471         v\_addr\_cmd\_config\_rst           := config\_rec;
02472         v\_addr\_cmd\_config\_rst.num_ranks := c_max_ranks;
02473 
02474         \textcolor{keywordflow}{return} reset\textcolor{vhdlchar}{(}v\_addr\_cmd\_config\_rst\textcolor{vhdlchar}{)};
02475 
02476     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02477 
02478 \textcolor{keyword}{    -- -------------------------------------------------------------}
02479 \textcolor{keyword}{    -- issues a deselect command          JEDEC abbreviated name: DES}
02480 \textcolor{keyword}{    -- -------------------------------------------------------------}
02481     \textcolor{keywordflow}{function} deselect ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02482                         previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector
02483                       ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02484     \textcolor{keywordflow}{is}
02485         \textcolor{keywordflow}{alias}    a\_previous : t_addr_cmd_vector\textcolor{vhdlchar}{(}previous'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is} previous;
02486         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}a\_previous'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
02487     \textcolor{keywordflow}{begin}
02488 
02489         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} a\_previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02490             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)} := deselect\textcolor{vhdlchar}{(}config\_rec, a\_previous\textcolor{vhdlchar}{(}a\_previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02491         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02492 
02493         \textcolor{keywordflow}{return} v\_retval;
02494 
02495     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02496 
02497 \textcolor{keyword}{    -- -------------------------------------------------------------}
02498 \textcolor{keyword}{    -- issues a precharge all command     JEDEC abbreviated name: PREA}
02499 \textcolor{keyword}{    -- -------------------------------------------------------------}
02500 -    \textcolor{keywordflow}{function} precharge_all ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02501                              previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02502                              ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02503                            ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02504     \textcolor{keywordflow}{is}
02505         \textcolor{keywordflow}{alias}    a\_previous : t_addr_cmd_vector\textcolor{vhdlchar}{(}previous'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is} previous;
02506         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02507     \textcolor{keywordflow}{begin}
02508 
02509         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in}  a\_previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02510 
02511             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}  := precharge\_all\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}a\_previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, ranks\textcolor{vhdlchar}{)};
02512 
02513 \textcolor{keyword}{            -- use dwidth\_ratio/2 as in FR = 0 , HR = 1, and in future QR = 2 tCK setup + 1 tCK hold}
02514             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02515                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02516             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02517 
02518         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02519 
02520         \textcolor{keywordflow}{return} v\_retval;
02521 
02522     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02523 
02524 \textcolor{keyword}{    -- -------------------------------------------------------------}
02525 \textcolor{keyword}{    -- precharge (close) a bank           JEDEC abbreviated name: PRE}
02526 \textcolor{keyword}{    -- -------------------------------------------------------------}
02527 --    \textcolor{keywordflow}{function} precharge_bank ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02528                               previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02529                               ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02530                               bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1}
02531                             ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02532     \textcolor{keywordflow}{is}
02533         \textcolor{keywordflow}{alias}    a\_previous : t_addr_cmd_vector\textcolor{vhdlchar}{(}previous'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is} previous;
02534         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02535     \textcolor{keywordflow}{begin}
02536 
02537         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in}  a\_previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02538 
02539             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}  := precharge\_bank\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}a\_previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, ranks, bank\textcolor{vhdlchar}{)};
02540 
02541 \textcolor{keyword}{            -- use dwidth\_ratio/2 as in FR = 0 , HR = 1, and in future QR = 2 tCK setup + 1 tCK hold}
02542             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02543                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02544             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02545 
02546         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02547 
02548         \textcolor{keywordflow}{return} v\_retval;
02549 
02550     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02551 
02552 \textcolor{keyword}{    -- -------------------------------------------------------------}
02553 \textcolor{keyword}{    -- issues a activate (open row)       JEDEC abbreviated name: ACT}
02554 \textcolor{keyword}{    -- -------------------------------------------------------------}
02555 ---    \textcolor{keywordflow}{function} activate ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02556                         previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02557                         bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
02558                         row        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
02559                         ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1}
02560                       ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02561     \textcolor{keywordflow}{is}
02562         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02563     \textcolor{keywordflow}{begin}
02564 
02565         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02566             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}  := activate\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, bank, row, ranks\textcolor{vhdlchar}{)};
02567 
02568 \textcolor{keyword}{            -- use dwidth\_ratio/2 as in FR = 0 , HR = 1, and in future QR = 2 tCK setup + 1 tCK hold}
02569             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02570                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02571             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02572 
02573         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02574 
02575         \textcolor{keywordflow}{return} v\_retval;
02576 
02577     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02578 
02579 \textcolor{keyword}{    -- -------------------------------------------------------------}
02580 \textcolor{keyword}{    -- issues a write command     JEDEC abbreviated name:WR,   WRA}
02581 \textcolor{keyword}{    --                                                   WRS4, WRAS4}
02582 \textcolor{keyword}{    --                                                   WRS8, WRAS8}
02583 \textcolor{keyword}{    --}
02584 \textcolor{keyword}{    -- has the ability to support:}
02585 \textcolor{keyword}{    --   DDR3:}
02586 \textcolor{keyword}{    --      BL4, BL8, fixed BL}
02587 \textcolor{keyword}{    --      Auto Precharge (AP)}
02588 \textcolor{keyword}{    --   DDR2, DDR:}
02589 \textcolor{keyword}{    --      fixed BL}
02590 \textcolor{keyword}{    --      Auto Precharge (AP)}
02591 \textcolor{keyword}{    -- -------------------------------------------------------------}
02592 ---    \textcolor{keywordflow}{function} write ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02593                      previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02594                      bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
02595                      col        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
02596                      ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
02597                      op\_length  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
02598                      auto\_prech : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02599                    ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02600     \textcolor{keywordflow}{is}
02601         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02602     \textcolor{keywordflow}{begin}
02603 
02604         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02605             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}  := write\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, bank, col, ranks, op\_length, 
      auto\_prech\textcolor{vhdlchar}{)};
02606 
02607 \textcolor{keyword}{            -- use dwidth\_ratio/2 as in FR = 0 , HR = 1, and in future QR = 2 tCK setup + 1 tCK hold}
02608             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02609                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02610             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02611 
02612         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02613 
02614         \textcolor{keywordflow}{return} v\_retval;
02615 
02616     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02617 
02618 \textcolor{keyword}{    -- -------------------------------------------------------------}
02619 \textcolor{keyword}{    -- issues a read command    JEDEC abbreviated name: RD,   RDA}
02620 \textcolor{keyword}{    --                                                  RDS4, RDAS4}
02621 \textcolor{keyword}{    --                                                  RDS8, RDAS8}
02622 \textcolor{keyword}{    -- has the ability to support:}
02623 \textcolor{keyword}{    --   DDR3:}
02624 \textcolor{keyword}{    --      BL4, BL8, fixed BL}
02625 \textcolor{keyword}{    --      Auto Precharge (AP)}
02626 \textcolor{keyword}{    --   DDR2, DDR:}
02627 \textcolor{keyword}{    --      fixed BL, Auto Precharge (AP)}
02628 \textcolor{keyword}{    -- -------------------------------------------------------------}
02629 ---    \textcolor{keywordflow}{function} read  ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02630                      previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02631                      bank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ba\_bits \textcolor{vhdllogic}{1};
02632                      col        : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_addr\_bits \textcolor{vhdllogic}{1};
02633                      ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
02634                      op\_length  : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{8};
02635                      auto\_prech : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02636                    ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02637     \textcolor{keywordflow}{is}
02638         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02639     \textcolor{keywordflow}{begin}
02640 
02641         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02642             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}  := read\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, bank, col, ranks, op\_length, 
      auto\_prech\textcolor{vhdlchar}{)};
02643 
02644 \textcolor{keyword}{            -- use dwidth\_ratio/2 as in FR = 0 , HR = 1, and in future QR = 2 tCK setup + 1 tCK hold}
02645             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02646                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02647             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02648 
02649         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02650 
02651         \textcolor{keywordflow}{return} v\_retval;
02652 
02653     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02654 
02655 \textcolor{keyword}{    -- -------------------------------------------------------------}
02656 \textcolor{keyword}{    -- issues a refresh command           JEDEC abbreviated name: REF}
02657 \textcolor{keyword}{    -- -------------------------------------------------------------}
02658 -    \textcolor{keywordflow}{function} refresh (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02659                       previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02660                       ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02661                      )\textcolor{keywordflow}{return}             t_addr_cmd_vector
02662     \textcolor{keywordflow}{is}
02663         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02664     \textcolor{keywordflow}{begin}
02665 
02666         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} previous'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02667             v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)} := refresh\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}previous'\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)}, ranks\textcolor{vhdlchar}{)};
02668 
02669             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02670                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02671             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02672 
02673         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02674 
02675         \textcolor{keywordflow}{return} v\_retval;
02676 
02677     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02678 
02679 
02680 \textcolor{keyword}{    -- -------------------------------------------------------------}
02681 \textcolor{keyword}{    -- issues a self\_refresh\_entry command  JEDEC abbreviated name: SRE}
02682 \textcolor{keyword}{    -- -------------------------------------------------------------}
02683 -    \textcolor{keywordflow}{function} self_refresh_entry (config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02684                                  previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02685                                  ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02686                                 )\textcolor{keywordflow}{return}             t_addr_cmd_vector
02687     \textcolor{keywordflow}{is}
02688         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02689     \textcolor{keywordflow}{begin}
02690         v\_retval := enter\_sr\_pd\_mode\textcolor{vhdlchar}{(}config\_rec, refresh\textcolor{vhdlchar}{(}config\_rec, previous, ranks\textcolor{vhdlchar}{)}, ranks\textcolor{vhdlchar}{)};
02691         \textcolor{keywordflow}{return} v\_retval;
02692     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02693 
02694 
02695 
02696 \textcolor{keyword}{    -- -------------------------------------------------------------}
02697 \textcolor{keyword}{    -- issues a self\_refresh exit or power\_down exit command}
02698 \textcolor{keyword}{    --  JEDEC abbreviated names: SRX, PDX}
02699 \textcolor{keyword}{    -- -------------------------------------------------------------}
02700 -    \textcolor{keywordflow}{function} exit_sr_pd_mode    ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02701                                   previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02702                                   ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02703                                 ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02704     \textcolor{keywordflow}{is}
02705         \textcolor{keywordflow}{variable} v\_retval          : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.
      cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02706         \textcolor{keywordflow}{variable} v\_mask\_workings   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_ranks -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02707         \textcolor{keywordflow}{variable} v\_mask\_workings\_b : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_ranks -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02708     \textcolor{keywordflow}{begin}
02709 
02710         v\_retval := maintain\_pd\_or\_sr\textcolor{vhdlchar}{(}config\_rec, previous, ranks\textcolor{vhdlchar}{)};
02711         v\_mask\_workings\_b := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}ranks, config\_rec.
      num_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02712 
02713         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
02714 
02715             v\_mask\_workings   := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cke, config\_rec.
      num_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02716 
02717             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} v\_mask\_workings\_b'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02718                 v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} := v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} v\_mask\_workings\_b\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)};
02719             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02720 
02721             \textcolor{keywordflow}{if} rate >= config\_rec.cmds_per_clk / \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}\textcolor{keyword}{    -- maintain command but clear CS of subsequenct
       command slots}
02722                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cke  := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_mask\_workings\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};  \textcolor{keyword}{-- almost irrelevant. but
       optimises logic slightly for Quater rate}
02723             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02724         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02725 
02726         \textcolor{keywordflow}{return} v\_retval;
02727 
02728     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02729 
02730 
02731 \textcolor{keyword}{    -- -------------------------------------------------------------}
02732 \textcolor{keyword}{    -- cause the selected ranks to enter Self-refresh or Powerdown mode}
02733 \textcolor{keyword}{    --  JEDEC abbreviated names: PDE,}
02734 \textcolor{keyword}{    --                           SRE  (if a refresh is concurrently issued to the same ranks)}
02735 \textcolor{keyword}{    -- -------------------------------------------------------------}
02736 -    \textcolor{keywordflow}{function} enter_sr_pd_mode   ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02737                                   previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02738                                   ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02739                                 ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02740     \textcolor{keywordflow}{is}
02741         \textcolor{keywordflow}{variable} v\_retval          : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.
      cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02742         \textcolor{keywordflow}{variable} v\_mask\_workings   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_ranks -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02743         \textcolor{keywordflow}{variable} v\_mask\_workings\_b : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_ranks -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02744     \textcolor{keywordflow}{begin}
02745 
02746         v\_retval          := previous;
02747         v\_mask\_workings\_b := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}ranks, config\_rec.
      num_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02748 
02749         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
02750 
02751             \textcolor{keywordflow}{if} rate >= config\_rec.cmds_per_clk / \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}\textcolor{keyword}{    -- maintain command but clear CS of subsequenct
       command slots}
02752                 v\_mask\_workings   := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.
      cke, config\_rec.num_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02753 
02754                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} v\_mask\_workings\_b'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02755                     v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} := v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} v\_mask\_workings\_b\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)};
02756                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02757 
02758                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cke  := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_mask\_workings\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};  \textcolor{keyword}{-- almost irrelevant. but
       optimises logic slightly for Quater rate}
02759 
02760             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02761 
02762         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02763 
02764         \textcolor{keywordflow}{return} v\_retval;
02765 
02766     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02767 
02768 
02769 \textcolor{keyword}{    -- -------------------------------------------------------------}
02770 \textcolor{keyword}{    -- Issues a mode register set command   JEDEC abbreviated name: MRS}
02771 \textcolor{keyword}{    -- -------------------------------------------------------------}
02772 -    \textcolor{keywordflow}{function} load_mode ( config\_rec        : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02773                          mode\_register\_num : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{3};
02774                          mode\_reg\_value    : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}(
      c_max_mode_reg_bit \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
02775                          ranks             : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1};
02776                          remap\_addr\_and\_ba : \textcolor{keywordflow}{in}    \textcolor{comment}{boolean}
02777                        ) \textcolor{keywordflow}{return}                    t_addr_cmd_vector
02778     \textcolor{keywordflow}{is}
02779         \textcolor{keywordflow}{variable} v\_retval     : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02780     \textcolor{keywordflow}{begin}
02781 
02782         v\_retval := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => load\_mode\textcolor{vhdlchar}{(}config\_rec, mode\_register\_num, mode\_reg\_value, ranks, 
      remap\_addr\_and\_ba\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02783 
02784         \textcolor{keywordflow}{for} rate \textcolor{keywordflow}{in} v\_retval'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02785             \textcolor{keywordflow}{if} rate /= config\_rec.cmds_per_clk/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
02786                 v\_retval\textcolor{vhdlchar}{(}rate\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02787             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02788         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02789 
02790         \textcolor{keywordflow}{return} v\_retval;
02791 
02792     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02793 
02794 
02795 \textcolor{keyword}{    -- -------------------------------------------------------------}
02796 \textcolor{keyword}{    -- maintains SR or PD mode on slected ranks.}
02797 \textcolor{keyword}{    --    NOTE: does not affect previous command}
02798 \textcolor{keyword}{    -- -------------------------------------------------------------}
02799 -    \textcolor{keywordflow}{function} maintain_pd_or_sr  ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02800                                   previous   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
02801                                   ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02802                                 ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02803     \textcolor{keywordflow}{is}
02804         \textcolor{keywordflow}{variable} v\_retval   : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02805     \textcolor{keywordflow}{begin}
02806 
02807         \textcolor{keywordflow}{for} command \textcolor{keywordflow}{in} v\_retval'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02808             v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)} := maintain\_pd\_or\_sr\textcolor{vhdlchar}{(}config\_rec, previous\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)}, ranks\textcolor{vhdlchar}{)};
02809         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02810         \textcolor{keywordflow}{return} v\_retval;
02811     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02812 
02813 
02814 \textcolor{keyword}{    -- -------------------------------------------------------------}
02815 \textcolor{keyword}{    -- issues a ZQ cal (long)           JEDEC abbreviated name: ZQCL}
02816 \textcolor{keyword}{    -- NOTE - can only be issued to a single RANK ata a time.}
02817 \textcolor{keyword}{    -- -------------------------------------------------------------}
02818 -    \textcolor{keywordflow}{function} ZQCL ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02819                     rank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02820                   ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02821     \textcolor{keywordflow}{is}
02822         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02823     \textcolor{keywordflow}{begin}
02824 
02825         \textcolor{keywordflow}{for} command \textcolor{keywordflow}{in} v\_retval'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02826             v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)} := ZQCL\textcolor{vhdlchar}{(}config\_rec, rank\textcolor{vhdlchar}{)};
02827             \textcolor{keywordflow}{if} command * \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} /= config\_rec.cmds_per_clk \textcolor{keywordflow}{then}
02828                 v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02829             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02830         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02831 
02832         \textcolor{keywordflow}{return} v\_retval;
02833 
02834     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02835 
02836 \textcolor{keyword}{    -- -------------------------------------------------------------}
02837 \textcolor{keyword}{    -- issues a ZQ cal (short)          JEDEC abbreviated name: ZQCS}
02838 \textcolor{keyword}{    -- NOTE - can only be issued to a single RANK ata a time.}
02839 \textcolor{keyword}{    -- -------------------------------------------------------------}
02840 -    \textcolor{keywordflow}{function} ZQCS ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02841                     rank       : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02842                   ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02843     \textcolor{keywordflow}{is}
02844         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02845     \textcolor{keywordflow}{begin}
02846 
02847         \textcolor{keywordflow}{for} command \textcolor{keywordflow}{in} v\_retval'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02848             v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)} := ZQCS\textcolor{vhdlchar}{(}config\_rec, rank\textcolor{vhdlchar}{)};
02849             \textcolor{keywordflow}{if} command * \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} /= config\_rec.cmds_per_clk \textcolor{keywordflow}{then}
02850                 v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
02851             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
02852         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02853 
02854         \textcolor{keywordflow}{return} v\_retval;
02855 
02856     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02857 
02858 
02859 \textcolor{keyword}{-- ----------------------}
02860 \textcolor{keyword}{-- Additional Rank manipulation functions (main use DDR3)}
02861 \textcolor{keyword}{-- -------------}
02862 
02863 \textcolor{keyword}{    -- -----------------------------------}
02864 \textcolor{keyword}{    -- set the chip select for a group of ranks}
02865 \textcolor{keyword}{    -- -----------------------------------}
02866     \textcolor{keywordflow}{function} all_reversed_ranks    ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02867                                      record\_to\_mask       : \textcolor{keywordflow}{in}    t_addr_cmd;
02868                                      mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
02869                                    ) \textcolor{keywordflow}{return}                       t_addr_cmd
02870     \textcolor{keywordflow}{is}
02871         \textcolor{keywordflow}{variable} v\_retval        : t_addr_cmd;
02872         \textcolor{keywordflow}{variable} v\_mask\_workings : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_cs_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02873     \textcolor{keywordflow}{begin}
02874         v\_retval        := record\_to\_mask;
02875         v\_mask\_workings := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}record\_to\_mask.cs_n, config\_rec.
      num_cs_bits\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02876 
02877         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} mem\_ac\_swapped\_ranks'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02878             v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)}:= v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} mem\_ac\_swapped\_ranks\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)};
02879         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02880 
02881         v\_retval.cs_n   := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_mask\_workings\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02882         \textcolor{keywordflow}{return} v\_retval;
02883     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02884 
02885 \textcolor{keyword}{    -- -----------------------------------}
02886 \textcolor{keyword}{    -- inverse of the above}
02887 \textcolor{keyword}{    -- -----------------------------------}
02888     \textcolor{keywordflow}{function} all_unreversed_ranks  ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02889                                      record\_to\_mask       : \textcolor{keywordflow}{in}    t_addr_cmd;
02890                                      mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
02891                                    ) \textcolor{keywordflow}{return}                       t_addr_cmd
02892     \textcolor{keywordflow}{is}
02893         \textcolor{keywordflow}{variable} v\_retval        : t_addr_cmd;
02894         \textcolor{keywordflow}{variable} v\_mask\_workings : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_cs_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02895     \textcolor{keywordflow}{begin}
02896         v\_retval        := record\_to\_mask;
02897         v\_mask\_workings := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}record\_to\_mask.cs_n, config\_rec.
      num_cs_bits\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02898 
02899         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} mem\_ac\_swapped\_ranks'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02900             v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)}:= v\_mask\_workings\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} mem\_ac\_swapped\_ranks\textcolor{vhdlchar}{(}i\textcolor{vhdlchar}{)};
02901         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02902 
02903         v\_retval.cs_n := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_mask\_workings\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02904         \textcolor{keywordflow}{return} v\_retval;
02905     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02906 
02907 \textcolor{keyword}{    -- -----------------------------------}
02908 \textcolor{keyword}{    -- set the chip select for a group of ranks in a way which handles diffrent rates}
02909 \textcolor{keyword}{    -- -----------------------------------}
02910     \textcolor{keywordflow}{function} all_unreversed_ranks   ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02911                                       record\_to\_mask       : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
02912                                       mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
02913                                     ) \textcolor{keywordflow}{return}                       
      t_addr_cmd_vector
02914     \textcolor{keywordflow}{is}
02915         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02916     \textcolor{keywordflow}{begin}
02917 
02918         \textcolor{keywordflow}{for} command \textcolor{keywordflow}{in} record\_to\_mask'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02919             v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)} := all\_unreversed\_ranks\textcolor{vhdlchar}{(}config\_rec, record\_to\_mask\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)}, 
      mem\_ac\_swapped\_ranks\textcolor{vhdlchar}{)};
02920         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02921 
02922         \textcolor{keywordflow}{return} v\_retval;
02923 
02924     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02925 
02926 \textcolor{keyword}{    -- -----------------------------------}
02927 \textcolor{keyword}{    -- inverse of the above handling ranks}
02928 \textcolor{keyword}{    -- -----------------------------------}
02929     \textcolor{keywordflow}{function} all_reversed_ranks     ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02930                                       record\_to\_mask       : \textcolor{keywordflow}{in}    
      t_addr_cmd_vector;
02931                                       mem\_ac\_swapped\_ranks : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
02932                                     ) \textcolor{keywordflow}{return}                       
      t_addr_cmd_vector
02933     \textcolor{keywordflow}{is}
02934         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02935     \textcolor{keywordflow}{begin}
02936 
02937         \textcolor{keywordflow}{for} command \textcolor{keywordflow}{in} record\_to\_mask'\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
02938             v\_retval\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)} := all\_reversed\_ranks\textcolor{vhdlchar}{(}config\_rec, record\_to\_mask\textcolor{vhdlchar}{(}command\textcolor{vhdlchar}{)}, 
      mem\_ac\_swapped\_ranks\textcolor{vhdlchar}{)};
02939         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
02940 
02941         \textcolor{keywordflow}{return} v\_retval;
02942 
02943     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02944     
02945 \textcolor{keyword}{    -- --------------------------------------------------}
02946 \textcolor{keyword}{    -- Program a single control word onto RDIMM.}
02947 \textcolor{keyword}{    -- This is accomplished rather goofily by asserting all chip selects}
02948 \textcolor{keyword}{    -- and then writing out both the addr/data of the word onto the addr/ba bus}
02949 \textcolor{keyword}{    -- --------------------------------------------------}
02950     
02951     \textcolor{keywordflow}{function} program_rdimm_register ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02952                                       control\_word\_addr      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
02953                                       control\_word\_data      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
02954                                     ) \textcolor{keywordflow}{return}                       t_addr_cmd
02955     \textcolor{keywordflow}{is}
02956         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd;
02957         \textcolor{keywordflow}{variable} ba : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02958         \textcolor{keywordflow}{variable} addr : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02959     \textcolor{keywordflow}{begin}
02960             v\_retval := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02961             v\_retval.cs_n := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
02962       ba := control\_word\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} & control\_word\_data\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} & control\_word\_data\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
02963             v\_retval.ba := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ba\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02964             addr := control\_word\_data\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} & control\_word\_data\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} & control\_word\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} &
02965                              control\_word\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} & control\_word\_addr\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
02966             v\_retval.addr := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}addr\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};        
02967             \textcolor{keywordflow}{return} v\_retval;
02968         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02969         
02970         \textcolor{keywordflow}{function} program_rdimm_register ( config\_rec           : \textcolor{keywordflow}{in}    
      t_addr_cmd_config_rec;
02971                                       control\_word\_addr      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
02972                                       control\_word\_data      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
02973                                     ) \textcolor{keywordflow}{return}                       
      t_addr_cmd_vector
02974     \textcolor{keywordflow}{is}
02975         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
02976     \textcolor{keywordflow}{begin}
02977         v\_retval := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => program\_rdimm\_register\textcolor{vhdlchar}{(}config\_rec, control\_word\_addr, control\_word\_data\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
02978         \textcolor{keywordflow}{return} v\_retval;
02979     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02980 \textcolor{keyword}{-- --------------------------------------------------}
02981 \textcolor{keyword}{-- overloaded functions, to simplify use, or provide simplified functionality}
02982 \textcolor{keyword}{-- --------------------------------------------------}
02983 
02984 \textcolor{keyword}{    -- ----------------------------------------------------}
02985 \textcolor{keyword}{    -- Precharge all, defaulting all bits.}
02986 \textcolor{keyword}{    -- ----------------------------------------------------}
02987 -    \textcolor{keywordflow}{function} precharge_all ( config\_rec : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
02988                              ranks      : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks \textcolor{vhdllogic}{1}
02989                            ) \textcolor{keywordflow}{return}             t_addr_cmd_vector
02990     \textcolor{keywordflow}{is}
02991         \textcolor{keywordflow}{variable} v\_retval : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := defaults\textcolor{vhdlchar}{(}config\_rec\textcolor{vhdlchar}{)};
02992     \textcolor{keywordflow}{begin}
02993 
02994         v\_retval := precharge\_all\textcolor{vhdlchar}{(}config\_rec, v\_retval, ranks\textcolor{vhdlchar}{)};
02995 
02996         \textcolor{keywordflow}{return} v\_retval;
02997 
02998     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
02999 
03000 
03001 \textcolor{keyword}{    -- ----------------------------------------------------}
03002 \textcolor{keyword}{    -- perform DLL reset through mode registers}
03003 \textcolor{keyword}{    -- ----------------------------------------------------}
03004 -    \textcolor{keywordflow}{function} dll_reset (  config\_rec        : \textcolor{keywordflow}{in} t_addr_cmd_config_rec;
03005                           mode\_reg\_val      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
03006                           rank\_num          : \textcolor{keywordflow}{in} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} 2**c\_max\_ranks  \textcolor{vhdllogic}{1};
03007                           reorder\_addr\_bits : \textcolor{keywordflow}{in} \textcolor{comment}{boolean}
03008                          ) \textcolor{keywordflow}{return} t_addr_cmd_vector \textcolor{keywordflow}{is}
03009         \textcolor{keywordflow}{variable} int\_mode\_reg : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}mode\_reg\_val'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
03010         \textcolor{keywordflow}{variable} output       : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03011     \textcolor{keywordflow}{begin}
03012         int\_mode\_reg    := mode\_reg\_val;
03013         int\_mode\_reg\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';   \textcolor{keyword}{-- set DLL reset bit.}
03014         output          := load\_mode\textcolor{vhdlchar}{(}config\_rec, \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}, int\_mode\_reg, rank\_num, reorder\_addr\_bits\textcolor{vhdlchar}{)};
03015         \textcolor{keywordflow}{return} output;
03016     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03017 
03018 
03019 \textcolor{keyword}{-- -------------------------------------------------------------}
03020 \textcolor{keyword}{-- package configuration functions}
03021 \textcolor{keyword}{-- -------------------------------------------------------------}
03022 
03023 \textcolor{keyword}{    -- -------------------------------------------------------------}
03024 \textcolor{keyword}{    -- the following function sets up the odt settings}
03025 \textcolor{keyword}{    -- NOTES: supports DDR/DDR2/DDR3 SDRAM memories}
03026 \textcolor{keyword}{    -- -------------------------------------------------------------}
03027     \textcolor{keywordflow}{function} set_odt_values (ranks          : \textcolor{comment}{natural};
03028                              ranks\_per\_slot : \textcolor{comment}{natural};
03029                              mem_type       : \textcolor{keywordflow}{in} \textcolor{comment}{string}
03030                             ) \textcolor{keywordflow}{return} t_odt_array \textcolor{keywordflow}{is}
03031 
03032     \textcolor{keywordflow}{variable} v\_num\_slots  : \textcolor{comment}{natural};
03033     \textcolor{keywordflow}{variable} v\_cs         : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
03034     \textcolor{keywordflow}{variable} v\_odt\_values : t_odt_array\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03035     \textcolor{keywordflow}{variable} v\_cs\_addr    : \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03036 
03037     \textcolor{keywordflow}{begin}
03038 
03039         \textcolor{keywordflow}{if} mem_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}
03040 
03041 \textcolor{keyword}{            -- ODT not supported for DDR memory so set default off}
03042             \textcolor{keywordflow}{for} v\_cs \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03043                 v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03044                 v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.read  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03045             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03046 
03047         \textcolor{keywordflow}{elsif} mem_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
03048 
03049 \textcolor{keyword}{            -- odt setting as implemented in the altera high-performance controller for ddr2 memories}
03050             \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{(}ranks \textcolor{keywordflow}{rem} ranks\_per\_slot = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"number of ranks per slot must
       be a multiple of number of ranks"} \textcolor{keywordflow}{severity} failure;
03051             v\_num\_slots := ranks/ranks\_per\_slot;
03052 
03053             \textcolor{keywordflow}{if} v\_num\_slots = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
03054 \textcolor{keyword}{                -- special condition for 1 slot (i.e. DIMM) (2^n, n=0,1,2,... ranks only)}
03055 \textcolor{keyword}{                -- set odt on one chip for writes and no odt for reads}
03056                 \textcolor{keywordflow}{for} v\_cs \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03057                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**v\_cs;  \textcolor{keyword}{-- on on the rank being written to}
03058                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.read  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03059                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03060             \textcolor{keywordflow}{else}
03061 \textcolor{keyword}{                -- if > 1 slot, set 1 odt enable on neighbouring slot for read and write}
03062 \textcolor{keyword}{                -- as an example consider the below for 4 slots with 2 ranks per slot}
03063 \textcolor{keyword}{                -- access to CS[0] or CS[1], enable ODT[2] or ODT[3]}
03064 \textcolor{keyword}{                -- access to CS[2] or CS[3], enable ODT[0] or ODT[1]}
03065 \textcolor{keyword}{                -- access to CS[4] or CS[5], enable ODT[6] or ODT[7]}
03066 \textcolor{keyword}{                -- access to CS[6] or CS[7], enable ODT[4] or ODT[5]}
03067 
03068 \textcolor{keyword}{                -- the logic below implements the above for varying ranks and ranks\_per slot}
03069 \textcolor{keyword}{                -- under the condition that ranks/ranks\_per\_slot is integer}
03070                 \textcolor{keywordflow}{for} v\_cs \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03071                     v\_cs\_addr                    := to\_unsigned\textcolor{vhdlchar}{(}v\_cs, ranks\textcolor{vhdlchar}{)};
03072                     v\_cs\_addr\textcolor{vhdlchar}{(}ranks\_per\_slot-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}  := \textcolor{keywordflow}{not} v\_cs\_addr\textcolor{vhdlchar}{(}ranks\_per\_slot-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03073                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write     := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**to\_integer\textcolor{vhdlchar}{(}v\_cs\_addr\textcolor{vhdlchar}{)};
03074                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.read      := v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write;
03075                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03076 
03077             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03078 
03079         \textcolor{keywordflow}{elsif} mem_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
03080 
03081             \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{(}ranks \textcolor{keywordflow}{rem} ranks\_per\_slot = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"number of ranks per slot must
       be a multiple of number of ranks"} \textcolor{keywordflow}{severity} failure;
03082             v\_num\_slots := ranks/ranks\_per\_slot;
03083 
03084             \textcolor{keywordflow}{if} v\_num\_slots = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
03085 \textcolor{keyword}{                -- special condition for 1 slot (i.e. DIMM) (2^n, n=0,1,2,... ranks only)}
03086 \textcolor{keyword}{                -- set odt on one chip for writes and no odt for reads}
03087                 \textcolor{keywordflow}{for} v\_cs \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03088                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**v\_cs;  \textcolor{keyword}{-- on on the rank being written to}
03089                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.read  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03090                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03091             \textcolor{keywordflow}{else}
03092 \textcolor{keyword}{                -- if > 1 slot, set 1 odt enable on neighbouring slot for read and write}
03093 \textcolor{keyword}{                -- as an example consider the below for 4 slots with 2 ranks per slot}
03094 \textcolor{keyword}{                -- access to CS[0] or CS[1], enable ODT[2] or ODT[3]}
03095 \textcolor{keyword}{                -- access to CS[2] or CS[3], enable ODT[0] or ODT[1]}
03096 \textcolor{keyword}{                -- access to CS[4] or CS[5], enable ODT[6] or ODT[7]}
03097 \textcolor{keyword}{                -- access to CS[6] or CS[7], enable ODT[4] or ODT[5]}
03098 
03099 \textcolor{keyword}{                -- the logic below implements the above for varying ranks and ranks\_per slot}
03100 \textcolor{keyword}{                -- under the condition that ranks/ranks\_per\_slot is integer}
03101                 \textcolor{keywordflow}{for} v\_cs \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} ranks-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03102                     v\_cs\_addr                    := to\_unsigned\textcolor{vhdlchar}{(}v\_cs, ranks\textcolor{vhdlchar}{)};
03103                     v\_cs\_addr\textcolor{vhdlchar}{(}ranks\_per\_slot-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}  := \textcolor{keywordflow}{not} v\_cs\_addr\textcolor{vhdlchar}{(}ranks\_per\_slot-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03104                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.write     := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**to\_integer\textcolor{vhdlchar}{(}v\_cs\_addr\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)};  \textcolor{keyword}{-- turn on a
       neighbouring slots cs and current rank being written to}
03105                     v\_odt\_values\textcolor{vhdlchar}{(}v\_cs\textcolor{vhdlchar}{)}.read      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**to\_integer\textcolor{vhdlchar}{(}v\_cs\_addr\textcolor{vhdlchar}{)};
03106                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03107 
03108             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03109 
03110        \textcolor{keywordflow}{else}
03111             \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"unknown mem\_type specified in the set\_odt\_values function in
       addr\_cmd\_pkg package"} \textcolor{keywordflow}{severity} failure;
03112         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03113 
03114         \textcolor{keywordflow}{return} v\_odt\_values;
03115 
03116     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03117 
03118 
03119 
03120 \textcolor{keyword}{    -- -----------------------------------------------------------}
03121 \textcolor{keyword}{    -- set constant values to config\_rec}
03122 \textcolor{keyword}{    -- ----------------------------------------------------------}
03123     \textcolor{keywordflow}{function} set_config_rec ( num_addr_bits : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03124                               num_ba_bits   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03125                               num_cs_bits   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03126                               num_ranks     : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03127                               dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_cmds_per_clk;
03128                               mem_type      : \textcolor{keywordflow}{in} \textcolor{comment}{string}
03129                             ) \textcolor{keywordflow}{return}             t_addr_cmd_config_rec
03130     \textcolor{keywordflow}{is}
03131         \textcolor{keywordflow}{variable} v\_config\_rec : t_addr_cmd_config_rec;
03132     \textcolor{keywordflow}{begin}
03133 
03134         v\_config\_rec.num_addr_bits := num_addr_bits;
03135         v\_config\_rec.num_ba_bits   := num_ba_bits;
03136         v\_config\_rec.num_cs_bits   := num_cs_bits;
03137         v\_config\_rec.num_ranks     := num_ranks;
03138         v\_config\_rec.cmds_per_clk  := dwidth\_ratio/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
03139 
03140         \textcolor{keywordflow}{if} mem_type = \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}
03141             v\_config\_rec.mem_type := DDR;
03142         \textcolor{keywordflow}{elsif} mem_type = \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
03143             v\_config\_rec.mem_type := DDR2;
03144         \textcolor{keywordflow}{elsif} mem_type = \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
03145             v\_config\_rec.mem_type := DDR3;
03146         \textcolor{keywordflow}{else}
03147             \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"unknown mem\_type specified in the set\_config\_rec function in
       addr\_cmd\_pkg package"} \textcolor{keywordflow}{severity} failure;
03148         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03149 
03150         \textcolor{keywordflow}{return} v\_config\_rec;
03151 
03152     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03153     
03154 \textcolor{keyword}{-- The non-levelled sequencer doesn't make a distinction between CS\_WIDTH and NUM\_RANKS. In this case,}
03155 \textcolor{keyword}{-- just set the two to be the same.}
03156     \textcolor{keywordflow}{function} set_config_rec ( num_addr_bits : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03157                               num_ba_bits   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03158                               num_cs_bits   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03159                               dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_cmds_per_clk;
03160                               mem_type      : \textcolor{keywordflow}{in} \textcolor{comment}{string}
03161                             ) \textcolor{keywordflow}{return}             t_addr_cmd_config_rec
03162     \textcolor{keywordflow}{is}
03163     \textcolor{keywordflow}{begin}
03164 
03165         \textcolor{keywordflow}{return} set\_config\_rec\textcolor{vhdlchar}{(}num_addr_bits, num_ba_bits, num_cs_bits, 
      num_cs_bits, dwidth\_ratio, mem_type\textcolor{vhdlchar}{)};
03166 
03167     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03168 \textcolor{keyword}{-- -----------------------------------------------------------}
03169 \textcolor{keyword}{-- unpack and pack address and command signals from and to t\_addr\_cmd\_vector}
03170 \textcolor{keyword}{-- -----------------------------------------------------------}
03171 
03172 \textcolor{keyword}{    -- -------------------------------------------------------------}
03173 \textcolor{keyword}{    -- convert from t\_addr\_cmd\_vector to expanded addr/cmd signals}
03174 \textcolor{keyword}{    -- -------------------------------------------------------------}
03175 
03176     \textcolor{keywordflow}{procedure} unpack_addr_cmd_vector( addr\_cmd\_vector : \textcolor{keywordflow}{in} t_addr_cmd_vector;
03177                                       config\_rec      : \textcolor{keywordflow}{in} t_addr_cmd_config_rec;
03178                                       addr            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03179                                       ba              : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03180                                       cas_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03181                                       ras_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03182                                       we_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03183                                       cke             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03184                                       cs_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03185                                       odt             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03186                                       rst_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}
03187                                     )
03188     \textcolor{keywordflow}{is}
03189         \textcolor{keywordflow}{variable} v\_mem\_if\_ranks : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**c_max_ranks - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
03190         \textcolor{keywordflow}{variable} v\_vec\_len      : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
03191 
03192         \textcolor{keywordflow}{variable} v\_addr  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_addr_bits - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03193         \textcolor{keywordflow}{variable} v\_ba    : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ba_bits   - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03194         \textcolor{keywordflow}{variable} v\_odt   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ranks     - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03195         \textcolor{keywordflow}{variable} v\_cs\_n  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_cs_bits   - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03196         \textcolor{keywordflow}{variable} v\_cke   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ranks     - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03197         \textcolor{keywordflow}{variable} v\_cas\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{
      )};
03198         \textcolor{keywordflow}{variable} v\_ras\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{
      )};
03199         \textcolor{keywordflow}{variable} v\_we\_n  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{
      )};
03200         \textcolor{keywordflow}{variable} v\_rst\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{
      )};
03201 
03202     \textcolor{keywordflow}{begin}
03203 
03204         v\_vec\_len := config\_rec.cmds_per_clk;
03205         v\_mem\_if\_ranks := config\_rec.num_ranks;
03206 
03207         \textcolor{keywordflow}{for} v\_i \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} v\_vec\_len-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03208 
03209             \textcolor{keywordflow}{assert} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.addr < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_addr_bits \textcolor{keywordflow}{report} 
      ac_report_prefix &
03210                    \textcolor{keyword}{"value of addr exceeds range of number of address bits in unpack\_addr\_cmd\_vector
       procedure"}    \textcolor{keywordflow}{severity} failure;
03211             \textcolor{keywordflow}{assert} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba   < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_ba_bits   \textcolor{keywordflow}{report} 
      ac_report_prefix &
03212                    \textcolor{keyword}{"value of ba exceeds range of number of bank address bits in unpack\_addr\_cmd\_vector
       procedure"} \textcolor{keywordflow}{severity} failure;
03213             \textcolor{keywordflow}{assert} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.odt  < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**v\_mem\_if\_ranks \textcolor{keywordflow}{report} 
      ac_report_prefix &
03214                    \textcolor{keyword}{"value of odt exceeds range of number of ranks in unpack\_addr\_cmd\_vector procedure"}     
             \textcolor{keywordflow}{severity} failure;
03215             \textcolor{keywordflow}{assert} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cs_n < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_cs_bits \textcolor{keywordflow}{report} 
      ac_report_prefix &
03216                    \textcolor{keyword}{"value of cs\_n exceeds range of number of ranks in unpack\_addr\_cmd\_vector procedure"}    
             \textcolor{keywordflow}{severity} failure;
03217             \textcolor{keywordflow}{assert} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cke  < \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**v\_mem\_if\_ranks \textcolor{keywordflow}{report} 
      ac_report_prefix &
03218                    \textcolor{keyword}{"value of cke exceeds range of number of ranks in unpack\_addr\_cmd\_vector procedure"}     
             \textcolor{keywordflow}{severity} failure;
03219 
03220             v\_addr\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_i+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}*config\_rec.num_addr_bits - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} v\_i*config\_rec.
      num_addr_bits\textcolor{vhdlchar}{)} := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.addr,config\_rec.
      num_addr_bits\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03221             v\_ba\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_i+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}*config\_rec.num_ba_bits     - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} v\_i*config\_rec.
      num_ba_bits\textcolor{vhdlchar}{)}   := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba,config\_rec.
      num_ba_bits\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03222             v\_cke\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_i+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}*v\_mem\_if\_ranks            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} v\_i*v\_mem\_if\_ranks\textcolor{vhdlchar}{)}           := \textcolor{comment}{
      std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cke,v\_mem\_if\_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03223             v\_cs\_n\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_i+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}*config\_rec.num_cs_bits   - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} v\_i*config\_rec.
      num_cs_bits\textcolor{vhdlchar}{)}   := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cs_n,config\_rec.
      num_cs_bits\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03224             v\_odt\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_i+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}*v\_mem\_if\_ranks            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} v\_i*v\_mem\_if\_ranks\textcolor{vhdlchar}{)}           := \textcolor{comment}{
      std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.odt,v\_mem\_if\_ranks\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03225 
03226             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cas_n\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_cas\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'; \textcolor{keywordflow}{else} v\_cas\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03227             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ras_n\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_ras\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'; \textcolor{keywordflow}{else} v\_ras\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03228             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.we_n\textcolor{vhdlchar}{)}  \textcolor{keywordflow}{then}  v\_we\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'; \textcolor{keywordflow}{else}  v\_we\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03229             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.rst_n\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_rst\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'; \textcolor{keywordflow}{else} v\_rst\_n\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)} := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03230 
03231         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03232 
03233         addr  := v\_addr;
03234         ba    := v\_ba;
03235         cke   := v\_cke;
03236         cs_n  := v\_cs\_n;
03237         odt   := v\_odt;
03238         cas_n := v\_cas\_n;
03239         ras_n := v\_ras\_n;
03240         we_n  := v\_we\_n;
03241         rst_n := v\_rst\_n;
03242 
03243     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
03244 
03245 
03246     \textcolor{keywordflow}{procedure} unpack_addr_cmd_vector( config\_rec      : \textcolor{keywordflow}{in} t_addr_cmd_config_rec;
03247                                       addr\_cmd\_vector : \textcolor{keywordflow}{in} t_addr_cmd_vector;
03248                                \textcolor{keywordflow}{signal} addr            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03249                                \textcolor{keywordflow}{signal} ba              : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03250                                \textcolor{keywordflow}{signal} cas_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03251                                \textcolor{keywordflow}{signal} ras_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03252                                \textcolor{keywordflow}{signal} we_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03253                                \textcolor{keywordflow}{signal} cke             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03254                                \textcolor{keywordflow}{signal} cs_n            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03255                                \textcolor{keywordflow}{signal} odt             : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector};
03256                                \textcolor{keywordflow}{signal} rst_n           : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}
03257                                     )
03258     \textcolor{keywordflow}{is}
03259         \textcolor{keywordflow}{variable} v\_mem\_if\_ranks : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**c_max_ranks - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
03260         \textcolor{keywordflow}{variable} v\_vec\_len      : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
03261         \textcolor{keywordflow}{variable} v\_seq\_ac\_addr  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_addr_bits - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03262         \textcolor{keywordflow}{variable} v\_seq\_ac\_ba    : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ba_bits   - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03263         \textcolor{keywordflow}{variable} v\_seq\_ac\_cas\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{
      downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03264         \textcolor{keywordflow}{variable} v\_seq\_ac\_ras\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{
      downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03265         \textcolor{keywordflow}{variable} v\_seq\_ac\_we\_n  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{
      downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03266         \textcolor{keywordflow}{variable} v\_seq\_ac\_cke   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ranks     - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03267         \textcolor{keywordflow}{variable} v\_seq\_ac\_cs\_n  : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_cs_bits   - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03268         \textcolor{keywordflow}{variable} v\_seq\_ac\_odt   : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk * config\_rec.
      num_ranks     - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03269         \textcolor{keywordflow}{variable} v\_seq\_ac\_rst\_n : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.cmds_per_clk                            - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{
      downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03270 
03271     \textcolor{keywordflow}{begin}
03272 
03273         unpack\_addr\_cmd\_vector \textcolor{vhdlchar}{(}
03274             addr\_cmd\_vector,
03275             config\_rec,
03276             v\_seq\_ac\_addr,
03277             v\_seq\_ac\_ba,
03278             v\_seq\_ac\_cas\_n,
03279             v\_seq\_ac\_ras\_n,
03280             v\_seq\_ac\_we\_n,
03281             v\_seq\_ac\_cke,
03282             v\_seq\_ac\_cs\_n,
03283             v\_seq\_ac\_odt,
03284             v\_seq\_ac\_rst\_n\textcolor{vhdlchar}{)};
03285 
03286         addr  <= v\_seq\_ac\_addr;
03287         ba    <= v\_seq\_ac\_ba;
03288         cas_n <= v\_seq\_ac\_cas\_n;
03289         ras_n <= v\_seq\_ac\_ras\_n;
03290         we_n  <= v\_seq\_ac\_we\_n;
03291         cke   <= v\_seq\_ac\_cke;
03292         cs_n  <= v\_seq\_ac\_cs\_n;
03293         odt   <= v\_seq\_ac\_odt;
03294         rst_n <= v\_seq\_ac\_rst\_n;
03295 
03296     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
03297 
03298 \textcolor{keyword}{-- -----------------------------------------------------------}
03299 \textcolor{keyword}{-- function to mask each bit of signal signal\_name in addr\_cmd\_}
03300 \textcolor{keyword}{-- -----------------------------------------------------------}
03301 \textcolor{keyword}{    -- -----------------------------------------------------------}
03302 \textcolor{keyword}{    -- function to mask each bit of signal signal\_name in addr\_cmd\_vector with mask\_value}
03303 \textcolor{keyword}{    -- -----------------------------------------------------------}
03304     \textcolor{keywordflow}{function} mask ( config\_rec         : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
03305                     addr\_cmd\_vector    : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
03306                     signal\_name        : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
03307                     mask\_value         : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic}
03308                   ) \textcolor{keywordflow}{return} t_addr_cmd_vector
03309     \textcolor{keywordflow}{is}
03310         \textcolor{keywordflow}{variable} v\_i : \textcolor{comment}{integer};
03311     \textcolor{keywordflow}{variable} v\_addr\_cmd\_vector :  t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03312     \textcolor{keywordflow}{begin}
03313 
03314         v\_addr\_cmd\_vector := addr\_cmd\_vector;
03315 
03316         \textcolor{keywordflow}{for} v\_i \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}config\_rec.cmds_per_clk\textcolor{vhdlchar}{)}-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03317 
03318             \textcolor{keywordflow}{case} signal\_name \textcolor{keywordflow}{is}
03319 
03320                 \textcolor{keywordflow}{when} addr  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      addr  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.addr  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.
      num_addr_bits\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03321                 \textcolor{keywordflow}{when} ba    => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      ba    := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba    := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ba_bits\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};   \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03322                 \textcolor{keywordflow}{when} cas_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cas_n := true; \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cas_n := false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03323                 \textcolor{keywordflow}{when} ras_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      ras_n := true; \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ras_n := false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03324                 \textcolor{keywordflow}{when} we_n  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      we_n  := true; \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.we_n  := false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03325                 \textcolor{keywordflow}{when} cke   => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cke   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cke   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03326                 \textcolor{keywordflow}{when} cs_n  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cs_n  := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cs_n  := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};      \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03327                 \textcolor{keywordflow}{when} odt   => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      odt   := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.odt   := \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03328                 \textcolor{keywordflow}{when} rst_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      rst_n := true; \textcolor{keywordflow}{else} v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.rst_n := false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03329 
03330                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} => \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"bit masking not supported for the given signal
       name"} \textcolor{keywordflow}{severity} failure;
03331 
03332             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
03333 
03334         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03335 
03336         \textcolor{keywordflow}{return} v\_addr\_cmd\_vector;
03337 
03338     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03339 
03340 \textcolor{keyword}{    -- -----------------------------------------------------------}
03341 \textcolor{keyword}{    -- procedure to mask each bit of signal signal\_name in addr\_cmd\_vector with mask\_value}
03342 \textcolor{keyword}{    -- -----------------------------------------------------------}
03343     \textcolor{keywordflow}{procedure} mask(        config\_rec      : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
03344                     \textcolor{keywordflow}{signal} addr\_cmd\_vector : \textcolor{keywordflow}{inout} t_addr_cmd_vector;
03345                            signal\_name     : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
03346                            mask\_value      : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic}
03347                   )
03348     \textcolor{keywordflow}{is}
03349         \textcolor{keywordflow}{variable} v\_i : \textcolor{comment}{integer};
03350     \textcolor{keywordflow}{begin}
03351 
03352         \textcolor{keywordflow}{for} v\_i \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}config\_rec.cmds_per_clk\textcolor{vhdlchar}{)}-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03353 
03354             \textcolor{keywordflow}{case} signal\_name \textcolor{keywordflow}{is}
03355 
03356                 \textcolor{keywordflow}{when} addr  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      addr  <= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.addr  <= \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_addr_bits\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}; \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03357                 \textcolor{keywordflow}{when} ba    => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba    <= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} 
      addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba    <= \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} ** config\_rec.num_ba_bits\textcolor{vhdlchar}{)} - \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};   \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03358                 \textcolor{keywordflow}{when} cas_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cas_n <= true; \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cas_n <= false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03359                 \textcolor{keywordflow}{when} ras_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      ras_n <= true; \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ras_n <= false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03360                 \textcolor{keywordflow}{when} we_n  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      we_n  <= true; \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.we_n  <= false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03361                 \textcolor{keywordflow}{when} cke   => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cke   <= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cke   <= \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03362                 \textcolor{keywordflow}{when} cs_n  => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      cs_n  <= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.cs_n  <= \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_cs_bits\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03363                 \textcolor{keywordflow}{when} odt   => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      odt   <= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};    \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.odt   <= \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}**config\_rec.num_ranks\textcolor{vhdlchar}{)} -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03364                 \textcolor{keywordflow}{when} rst_n => \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mask\_value = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      rst_n <= true; \textcolor{keywordflow}{else} addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.rst_n <= false;                               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03365 
03366                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} => \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"masking not supported for the given signal name"} \textcolor{keywordflow}{
      severity} failure;
03367 
03368             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
03369 
03370         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03371 
03372     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
03373 
03374 
03375 \textcolor{keyword}{    -- -----------------------------------------------------------}
03376 \textcolor{keyword}{    -- function to mask a given bit (mask\_bit) of signal signal\_name in addr\_cmd\_vector with mask\_value}
03377 \textcolor{keyword}{    -- -----------------------------------------------------------}
03378     \textcolor{keywordflow}{function} mask  ( config\_rec        : \textcolor{keywordflow}{in}    t_addr_cmd_config_rec;
03379                      addr\_cmd\_vector   : \textcolor{keywordflow}{in}    t_addr_cmd_vector;
03380                      signal\_name       : \textcolor{keywordflow}{in}    t_addr_cmd_signals;
03381                      mask\_value        : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
03382                      mask\_bit          : \textcolor{keywordflow}{in}    \textcolor{comment}{natural}
03383                    ) \textcolor{keywordflow}{return} t_addr_cmd_vector
03384     \textcolor{keywordflow}{is}
03385         \textcolor{keywordflow}{variable} v\_i       : \textcolor{comment}{integer};
03386         \textcolor{keywordflow}{variable} v\_addr    : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_addr_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; \textcolor{keyword}{-- v\_addr is bit vector
       of address}
03387         \textcolor{keywordflow}{variable} v\_ba      : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}config\_rec.num_ba_bits-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; \textcolor{keyword}{-- v\_addr is bit vector
       of bank address}
03388         \textcolor{keywordflow}{variable} v\_vec\_len : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
03389     \textcolor{keywordflow}{variable} v\_addr\_cmd\_vector : t_addr_cmd_vector\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} config\_rec.cmds_per_clk -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
03390     \textcolor{keywordflow}{begin}
03391 
03392         v\_addr\_cmd\_vector := addr\_cmd\_vector;
03393         v\_vec\_len         := config\_rec.cmds_per_clk;
03394 
03395         \textcolor{keywordflow}{for} v\_i \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} v\_vec\_len-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
03396 
03397             \textcolor{keywordflow}{case} signal\_name \textcolor{keywordflow}{is}
03398 
03399                 \textcolor{keywordflow}{when} addr =>
03400                     v\_addr                      := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      addr,v\_addr'\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03401                     v\_addr\textcolor{vhdlchar}{(}mask\_bit\textcolor{vhdlchar}{)}            := mask\_value;
03402                     v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.addr := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_addr\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03403 
03404                 \textcolor{keywordflow}{when} ba =>
03405                     v\_ba                        := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.
      ba,v\_ba'\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03406                     v\_ba\textcolor{vhdlchar}{(}mask\_bit\textcolor{vhdlchar}{)}              := mask\_value;
03407                     v\_addr\_cmd\_vector\textcolor{vhdlchar}{(}v\_i\textcolor{vhdlchar}{)}.ba   := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}v\_ba\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
03408 
03409                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} =>
03410                     \textcolor{keywordflow}{report} ac_report_prefix & \textcolor{keyword}{"bit masking not supported for the given signal name"} \textcolor{keywordflow}{
      severity} failure;
03411 
03412             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
03413 
03414         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03415 
03416         \textcolor{keywordflow}{return} v\_addr\_cmd\_vector;
03417 
03418     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03419 
03420 \textcolor{keyword}{--}
03421 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_addr\_cmd\_pkg};
03422 
03423 \textcolor{keyword}{--}
03424 
03425 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
03426 \textcolor{keyword}{--  Abstract        : iram addressing package for the non-levelling AFI PHY sequencer}
03427 \textcolor{keyword}{--                    The iram address package (alt\_mem\_phy\_iram\_addr\_pkg) is}
03428 \textcolor{keyword}{--                    used to define the base addresses used for iram writes}
03429 \textcolor{keyword}{--                    during calibration.}
03430 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
03431 
03432 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
03433 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
03434 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
03435 
03436 \textcolor{keyword}{--}
03437 \textcolor{keywordflow}{package }ddr2_phy_alt_mem_phy_iram_addr_pkg \textcolor{keywordflow}{IS}
03438 
03439     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ihi_size}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
03440 
03441     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_base_hdr_addresses} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03442         \textcolor{vhdlchar}{base_hdr}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
03443         \textcolor{vhdlchar}{rrp}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
03444         \textcolor{vhdlchar}{safe_dummy}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
03445         \textcolor{vhdlchar}{required_addr_bits} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
03446     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03447 
03448     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_base_hdr_addresses};
03449 
03450     \textcolor{keywordflow}{function} rrp_pll_phase_mult (dwidth\_ratio : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03451                                  dqs\_capture  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03452                                 )
03453                                 \textcolor{keywordflow}{return} \textcolor{comment}{natural};
03454 
03455     \textcolor{keywordflow}{function} iram_wd_for_full_rrp ( dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03456                                     pll\_phases    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03457                                     dq\_pins       : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03458                                     dqs\_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03459                                   )
03460                                   \textcolor{keywordflow}{return} \textcolor{comment}{natural};
03461 
03462     \textcolor{keywordflow}{function} iram_wd_for_one_pin_rrp ( dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03463                                        pll\_phases    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03464                                        dq\_pins       : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03465                                        dqs\_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03466                                      )
03467                                      \textcolor{keywordflow}{return} \textcolor{comment}{natural};
03468 
03469     \textcolor{keywordflow}{function} calc_iram_addresses ( dwidth\_ratio : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03470                                    pll\_phases   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03471                                    dq\_pins      : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03472                                    num\_ranks    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03473                                    dqs\_capture  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03474                                  )
03475                                  \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_base_hdr_addresses};
03476 
03477 \textcolor{keyword}{--}
03478 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_iram\_addr\_pkg};
03479 
03480 \textcolor{keyword}{--}
03481 \textcolor{keywordflow}{package} \textcolor{keywordflow}{body} ddr2_phy_alt_mem_phy_iram_addr_pkg \textcolor{keywordflow}{IS}
03482 
03483 \textcolor{keyword}{    -- set some safe default values}
03484     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_base_hdr_addresses} \textcolor{keywordflow}{is}
03485         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_base_hdr_addresses};
03486 \textcolor{vhdlkeyword}{    begin}
03487         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{base_hdr}           \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03488         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp}                \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03489         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{safe_dummy}         \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03490         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{required_addr_bits} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
03491         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
03492     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03493 
03494 \textcolor{keyword}{    -- this function determines now many times the PLL phases are swept through per pin}
03495 \textcolor{keyword}{    -- i.e. an n * 360 degree phase sweep}
03496     \textcolor{keywordflow}{function} rrp_pll_phase_mult (dwidth\_ratio : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03497                                  dqs\_capture  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03498                                 )
03499                                 \textcolor{keywordflow}{return} \textcolor{comment}{natural}
03500     \textcolor{keywordflow}{is}
03501         \textcolor{keywordflow}{variable} v\_output : \textcolor{comment}{natural};
03502     \textcolor{keywordflow}{begin}
03503 
03504         \textcolor{keywordflow}{if} dwidth\_ratio = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{and} dqs\_capture = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
03505 
03506             v\_output := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};  \textcolor{keyword}{-- if dqs\_capture then a 720 degree sweep needed in FR}
03507 
03508         \textcolor{keywordflow}{else}
03509 
03510             v\_output := \textcolor{vhdlchar}{(}dwidth\_ratio/\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
03511 
03512         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
03513 
03514         \textcolor{keywordflow}{return} v\_output;
03515 
03516     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03517 
03518 \textcolor{keyword}{    -- function to calculate how many words are required for a rrp sweep over all pins}
03519     \textcolor{keywordflow}{function} iram_wd_for_full_rrp ( dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03520                                     pll\_phases    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03521                                     dq\_pins       : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03522                                     dqs\_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03523                                   )
03524                                   \textcolor{keywordflow}{return} \textcolor{comment}{natural}
03525     \textcolor{keywordflow}{is}
03526         \textcolor{keywordflow}{variable} v\_output    : \textcolor{comment}{natural};
03527         \textcolor{keywordflow}{variable} v\_phase\_mul : \textcolor{comment}{natural};
03528     \textcolor{keywordflow}{begin}
03529 \textcolor{keyword}{        -- determine the n * 360 degrees of sweep required}
03530         v\_phase\_mul := rrp\_pll\_phase\_mult\textcolor{vhdlchar}{(}dwidth\_ratio, dqs\_capture\textcolor{vhdlchar}{)};
03531 
03532 \textcolor{keyword}{        -- calculate output size}
03533         v\_output := dq\_pins * \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_phase\_mul * pll\_phases\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}\textcolor{vhdlchar}{)} / \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)};
03534 
03535         \textcolor{keywordflow}{return} v\_output;
03536 
03537     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03538 
03539 \textcolor{keyword}{    -- function to calculate how many words are required for a rrp sweep over all pins}
03540     \textcolor{keywordflow}{function} iram_wd_for_one_pin_rrp ( dwidth\_ratio  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03541                                        pll\_phases    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03542                                        dq\_pins       : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03543                                        dqs\_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03544                                      )
03545                                      \textcolor{keywordflow}{return} \textcolor{comment}{natural}
03546     \textcolor{keywordflow}{is}
03547         \textcolor{keywordflow}{variable} v\_output : \textcolor{comment}{natural};
03548         \textcolor{keywordflow}{variable} v\_phase\_mul : \textcolor{comment}{natural};
03549     \textcolor{keywordflow}{begin}
03550 \textcolor{keyword}{        -- determine the n * 360 degrees of sweep required}
03551         v\_phase\_mul := rrp\_pll\_phase\_mult\textcolor{vhdlchar}{(}dwidth\_ratio, dqs\_capture\textcolor{vhdlchar}{)};
03552 
03553 \textcolor{keyword}{        -- calculate output size}
03554         v\_output := \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}v\_phase\_mul * pll\_phases\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}\textcolor{vhdlchar}{)} / \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
03555 
03556         \textcolor{keywordflow}{return} v\_output;
03557 
03558     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03559 
03560 \textcolor{keyword}{    -- return iram addresses}
03561     \textcolor{keywordflow}{function} calc_iram_addresses ( dwidth\_ratio : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03562                                    pll\_phases   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03563                                    dq\_pins      : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03564                                    num\_ranks    : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03565                                    dqs\_capture  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03566                                  )
03567                                  \textcolor{keywordflow}{return} t_base_hdr_addresses
03568     \textcolor{keywordflow}{is}
03569         \textcolor{keywordflow}{variable} working               : t_base_hdr_addresses;
03570         \textcolor{keywordflow}{variable} temp                  : \textcolor{comment}{natural};
03571 
03572         \textcolor{keywordflow}{variable} v\_required\_words      : \textcolor{comment}{natural};
03573 
03574     \textcolor{keywordflow}{begin}
03575 
03576         working.base_hdr               := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03577         working.rrp                    := working.base_hdr + c_ihi_size;
03578 
03579 \textcolor{keyword}{        -- work out required number of address bits}
03580 
03581 \textcolor{keyword}{        -- + for 1 full rrp calibration}
03582         v\_required\_words               := iram\_wd\_for\_full\_rrp\textcolor{vhdlchar}{(}dwidth\_ratio, pll\_phases, dq\_pins, 
      dqs\_capture\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}; \textcolor{keyword}{-- +2 for header + footer}
03583 
03584 \textcolor{keyword}{        -- * loop per cs}
03585         v\_required\_words               := v\_required\_words * num\_ranks;
03586 
03587 \textcolor{keyword}{        -- + for 1 rrp\_seek result}
03588         v\_required\_words               := v\_required\_words + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}; \textcolor{keyword}{-- 1 header, 1 word result, 1 footer}
03589 
03590 \textcolor{keyword}{        -- + 2 mtp\_almt passes}
03591         v\_required\_words               := v\_required\_words + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} * \textcolor{vhdlchar}{(}iram\_wd\_for\_one\_pin\_rrp\textcolor{vhdlchar}{(}dwidth\_ratio, 
      pll\_phases, dq\_pins, dqs\_capture\textcolor{vhdlchar}{)} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
03592 
03593 \textcolor{keyword}{        -- + for 2 read\_mtp result calculation}
03594         v\_required\_words               := v\_required\_words + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}*\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}; \textcolor{keyword}{-- 1 header, 1 word result, 1 footer}
03595 
03596 \textcolor{keyword}{        -- * possible dwidth\_ratio/2 iterations for different ac\_nt settings}
03597         v\_required\_words               := v\_required\_words * \textcolor{vhdlchar}{(}dwidth\_ratio / \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
03598 
03599         working.safe_dummy             := working.rrp + v\_required\_words;
03600 
03601         temp                           := working.safe_dummy;
03602         working.required_addr_bits     := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
03603 
03604         \textcolor{keywordflow}{while} \textcolor{vhdlchar}{(}temp >= \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{loop}
03605             working.required_addr_bits := working.required_addr_bits + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
03606             temp                       := temp /\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
03607         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
03608 
03609         \textcolor{keywordflow}{return} working;
03610 
03611     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function} calc\_iram\_addresses;
03612 
03613 \textcolor{keyword}{--}
03614 \textcolor{keywordflow}{END} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_iram\_addr\_pkg};
03615 \textcolor{keyword}{--}
03616 
03617 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
03618 \textcolor{keyword}{--  Abstract        : register package for the non-levelling AFI PHY sequencer}
03619 \textcolor{keyword}{--                    The registers package (alt\_mem\_phy\_regs\_pkg) is used to}
03620 \textcolor{keyword}{--                    combine the definition of the registers for the mmi status}
03621 \textcolor{keyword}{--                    registers and functions/procedures applied to the registers}
03622 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
03623 
03624 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
03625 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
03626 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
03627 
03628 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
03629 
03630 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
03631 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
03632 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
03633 \textcolor{keyword}{--}
03634 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
03635 
03636 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
03637 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
03638 \textcolor{keyword}{-- instances generics are used)}
03639 \textcolor{keyword}{--}
03640 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
03641 
03642 \textcolor{keyword}{--}
03643 \textcolor{keywordflow}{package }ddr2_phy_alt_mem_phy_regs_pkg \textcolor{keywordflow}{is}
03644 
03645 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
03646 \textcolor{keyword}{--}
03647     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{regs_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (register package) : "};
03648 
03649 \textcolor{keyword}{-- ---------------------------------------------------------------}
03650 \textcolor{keyword}{-- register declarations with associated functions of:}
03651 \textcolor{keyword}{-- default     - assign default values}
03652 \textcolor{keyword}{-- write       - write data into the reg (from avalon i/f)}
03653 \textcolor{keyword}{-- read        - read data from the reg (sent to the avalon i/f)}
03654 \textcolor{keyword}{-- write\_clear - clear reg to all zeros}
03655 \textcolor{keyword}{-- ---------------------------------------------------------------}
03656 
03657 \textcolor{keyword}{    -- TYPE DECLARATIONS}
03658 
03659 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03660 \textcolor{keyword}{    -- Read Only Registers}
03661 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03662 
03663 \textcolor{keyword}{    -- cal\_status}
03664     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_cal_status} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03665         \textcolor{vhdlchar}{iram_addr_width}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03666         \textcolor{vhdlchar}{out_of_mem}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03667         \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03668         \textcolor{vhdlchar}{cal_fail}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03669         \textcolor{vhdlchar}{cal_success}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03670         \textcolor{vhdlchar}{ctrl_err_code}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03671         \textcolor{vhdlchar}{trefi_failure}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03672         \textcolor{vhdlchar}{int_ac_1t}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03673         \textcolor{vhdlchar}{dqs_capture}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03674         \textcolor{vhdlchar}{iram_present}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03675         \textcolor{vhdlchar}{active_block}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03676         \textcolor{vhdlchar}{current_stage}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03677     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03678 
03679 \textcolor{keyword}{    -- codvw status}
03680     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_codvw_status} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03681         \textcolor{vhdlchar}{cal_codvw_phase}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}  \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03682         \textcolor{vhdlchar}{cal_codvw_size}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}  \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03683         \textcolor{vhdlchar}{codvw_trk_shift}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03684         \textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03685     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_codvw_status};
03686 
03687 \textcolor{keyword}{    -- test status report}
03688     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_test_status} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03689         \textcolor{vhdlchar}{ack_seen}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_hl_ccs_num_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03690         \textcolor{vhdlchar}{pll_mmi_err} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03691         \textcolor{vhdlchar}{pll_busy}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03692     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03693 
03694 \textcolor{keyword}{    -- define all the read only registers :}
03695     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ro_regs} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03696         \textcolor{vhdlchar}{cal_status}    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_cal_status};
03697         \textcolor{vhdlchar}{codvw_status}  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_codvw_status};
03698         \textcolor{vhdlchar}{test_status}   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_test_status};
03699     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03700 
03701 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03702 \textcolor{keyword}{    -- Read / Write Registers}
03703 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03704 
03705 \textcolor{keyword}{    -- Calibration control register}
03706     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_hl_css} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03707         \textcolor{vhdlchar}{hl_css}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_hl_ccs_num_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03708         \textcolor{vhdlchar}{cal_start}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03709     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_hl_css};
03710 
03711 \textcolor{keyword}{    -- Mode register A}
03712     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mr_register_a} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03713         \textcolor{vhdlchar}{mr0} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_mode_reg_index} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03714         \textcolor{vhdlchar}{mr1} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_mode_reg_index} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03715     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_mr_register_a};
03716 
03717 \textcolor{keyword}{    -- Mode register B}
03718     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mr_register_b} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03719         \textcolor{vhdlchar}{mr2} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_mode_reg_index} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03720         \textcolor{vhdlchar}{mr3} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_mode_reg_index} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03721     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record} \textcolor{vhdlchar}{t_mr_register_b};
03722 
03723 \textcolor{keyword}{    -- algorithm parameterisation register}
03724     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_parameterisation_reg_a} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03725         \textcolor{vhdlchar}{nominal_poa_phase_lead} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03726         \textcolor{vhdlchar}{maximum_poa_delay}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03727         \textcolor{vhdlchar}{num_phases_per_tck_pll} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03728         \textcolor{vhdlchar}{pll_360_sweeps}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03729         \textcolor{vhdlchar}{nominal_dqs_delay}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03730         \textcolor{vhdlchar}{extend_octrt_by}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03731         \textcolor{vhdlchar}{delay_octrt_by}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03732     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03733 
03734 \textcolor{keyword}{    -- test signal register}
03735     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_if_test_reg} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03736         \textcolor{vhdlchar}{pll_phs_shft_phase_sel}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
03737         \textcolor{vhdlchar}{pll_phs_shft_up_wc}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03738         \textcolor{vhdlchar}{pll_phs_shft_dn_wc}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03739         \textcolor{vhdlchar}{ac_1t_toggle}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                     -- unused}
03740         \textcolor{vhdlchar}{tracking_period_ms}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- 0 = as fast as possible approx in ms}
03741         \textcolor{vhdlchar}{tracking_units_are_10us} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
03742     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03743 
03744 \textcolor{keyword}{    -- define all the read/write registers}
03745     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_rw_regs} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03746         \textcolor{vhdlchar}{mr_reg_a}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_mr_register_a};
03747         \textcolor{vhdlchar}{mr_reg_b}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_mr_register_b};
03748         \textcolor{vhdlchar}{rw_hl_css}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_hl_css};
03749         \textcolor{vhdlchar}{rw_param_reg}   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_parameterisation_reg_a};
03750         \textcolor{vhdlchar}{rw_if_test}     \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_if_test_reg};
03751     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03752 
03753 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03754 \textcolor{keyword}{    -- Group all registers}
03755 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03756 
03757     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_mmi_regs} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
03758         \textcolor{vhdlchar}{rw_regs}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_rw_regs};
03759         \textcolor{vhdlchar}{ro_regs}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ro_regs};
03760         enable\_writes : \textcolor{comment}{std\_logic};
03761     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
03762 
03763 
03764 \textcolor{keyword}{    -- FUNCTION DECLARATIONS}
03765 
03766 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03767 \textcolor{keyword}{    -- Read Only Registers}
03768 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03769 
03770 \textcolor{keyword}{    -- cal\_status}
03771     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_cal_status};
03772     \textcolor{keywordflow}{function} defaults   ( ctrl\_mmi      : \textcolor{keywordflow}{in} t_ctrl_mmi;
03773                           USE\_IRAM      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
03774                           dqs_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03775                           int_ac_1t     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
03776                           trefi_failure : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
03777                           iram\_status   : \textcolor{keywordflow}{in} t_iram_stat;
03778                           IRAM\_AWIDTH   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03779                         ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_cal_status};
03780 
03781     \textcolor{keywordflow}{function} read (reg : t_cal_status) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03782 
03783 \textcolor{keyword}{    -- codvw status}
03784     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_codvw_status};
03785     \textcolor{keywordflow}{function} defaults ( dgrb\_mmi : t_dgrb_mmi
03786                       ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_codvw_status};
03787 
03788     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_codvw_status) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03789 
03790 
03791 \textcolor{keyword}{    -- test status report}
03792 
03793     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_test_status};
03794 
03795     \textcolor{keywordflow}{function} defaults   ( ctrl\_mmi     : \textcolor{keywordflow}{in} t_ctrl_mmi;
03796                           pll\_mmi      : \textcolor{keywordflow}{in} t_pll_mmi;
03797                           rw_if_test   : t_if_test_reg
03798                         ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_test_status};
03799 
03800     \textcolor{keywordflow}{function} read       (reg : t_test_status) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03801 
03802 \textcolor{keyword}{    -- define all the read only registers}
03803 
03804     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ro_regs};
03805 
03806     \textcolor{keywordflow}{function} defaults (dgrb\_mmi        : t_dgrb_mmi;
03807                        ctrl\_mmi        : t_ctrl_mmi;
03808                        pll\_mmi         : t_pll_mmi;
03809                        rw_if_test      : t_if_test_reg;
03810                        USE\_IRAM        : \textcolor{comment}{std\_logic};
03811                        dqs_capture     : \textcolor{comment}{natural};
03812                        int_ac_1t       : \textcolor{comment}{std\_logic};
03813                        trefi_failure   : \textcolor{comment}{std\_logic};
03814                        iram\_status     : t_iram_stat;
03815                        IRAM\_AWIDTH     : \textcolor{comment}{natural}
03816                       ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ro_regs};
03817 
03818 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03819 \textcolor{keyword}{    -- Read / Write Registers}
03820 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>}
03821 
03822 \textcolor{keyword}{    -- Calibration control register}
03823 \textcolor{keyword}{    -- high level calibration stage set register comprises a bit vector for}
03824 \textcolor{keyword}{    -- the calibration stage coding and the 1 control bit.}
03825 
03826     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css};
03827     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css};
03828     \textcolor{keywordflow}{function} read  (reg : \textcolor{keywordflow}{in} t_hl_css)                        \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03829     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} reg : \textcolor{keywordflow}{inout} t_hl_css);
03830 
03831 \textcolor{keyword}{    -- Mode register A}
03832 \textcolor{keyword}{    -- mode registers 0 and 1 (mr and emr1)}
03833 
03834     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_a};
03835     \textcolor{keywordflow}{function} defaults ( mr0     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector};
03836                         mr1     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
03837                        ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_a};
03838 
03839     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_mr_register_a};
03840     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_mr_register_a) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03841 
03842 \textcolor{keyword}{    -- Mode register B}
03843 \textcolor{keyword}{    -- mode registers 2 and 3 (emr2 and emr3) - not present in ddr DRAM}
03844 
03845     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_b};
03846     \textcolor{keywordflow}{function} defaults ( mr2     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector};
03847                         mr3     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
03848                        ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_b};
03849 
03850     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_mr_register_b};
03851     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_mr_register_b) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03852 
03853 \textcolor{keyword}{    -- algorithm parameterisation register}
03854 
03855     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_parameterisation_reg_a};
03856     \textcolor{keywordflow}{function} defaults ( NOM\_DQS\_PHASE\_SETTING   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03857                         PLL\_STEPS\_PER\_CYCLE     : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03858                         pll_360_sweeps          : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03859                       ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_parameterisation_reg_a};
03860     \textcolor{keywordflow}{function} read ( reg : \textcolor{keywordflow}{in} t_parameterisation_reg_a) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03861     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_parameterisation_reg_a};
03862 
03863 \textcolor{keyword}{    -- test signal register}
03864 
03865     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_if_test_reg};
03866     \textcolor{keywordflow}{function} defaults ( TRACKING\_INTERVAL\_IN\_MS : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03867                       ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_if_test_reg};
03868     \textcolor{keywordflow}{function} read ( reg : \textcolor{keywordflow}{in} t_if_test_reg) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03869     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_if_test_reg};
03870     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} reg : \textcolor{keywordflow}{inout} t_if_test_reg);
03871 
03872 
03873 \textcolor{keyword}{    -- define all the read/write registers}
03874 
03875     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_rw_regs};
03876 
03877 -    \textcolor{keywordflow}{function} defaults(
03878                         mr0                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
03879                         mr1                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
03880                         mr2                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
03881                         mr3                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
03882                         NOM\_DQS\_PHASE\_SETTING   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03883                         PLL\_STEPS\_PER\_CYCLE     : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03884                         pll_360_sweeps          : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03885                         TRACKING\_INTERVAL\_IN\_MS : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03886                         C\_HL\_STAGE\_ENABLE       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(c\_hl\_ccs\_num\_stages1 \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
03887                       )\textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_rw_regs};
03888 
03889     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} regs    : \textcolor{keywordflow}{inout} t_rw_regs);
03890 
03891 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03892 \textcolor{keyword}{    -- Group all registers}
03893 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03894 
03895     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_regs};
03896 
03897     \textcolor{keywordflow}{function} v_read       (mmi\_regs : \textcolor{keywordflow}{in} t_mmi_regs;
03898                            address  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03899                           ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03900 
03901     \textcolor{keywordflow}{function} read         (\textcolor{keywordflow}{signal} mmi\_regs : \textcolor{keywordflow}{in} t_mmi_regs;
03902                                   address  : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
03903                           ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03904 
03905     \textcolor{keywordflow}{procedure} write       (mmi\_regs : \textcolor{keywordflow}{inout} t_mmi_regs;
03906                            address  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
03907                            wdata    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}));
03908 
03909 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03910 \textcolor{keyword}{    -- functions to communicate register settings to other sequencer blocks}
03911 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03912     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_pll_reconfig};
03913     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_admin_ctrl};
03914     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_ctrl};
03915 
03916     \textcolor{keywordflow}{function} pack_record ( ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_algm_paramaterisation};
03917 
03918 
03919 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03920 \textcolor{keyword}{    -- helper functions}
03921 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>}
03922 
03923     \textcolor{keywordflow}{function} to_t_hl_css_reg (hl_css    : t_hl_css ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css_reg};
03924 
03925     \textcolor{keywordflow}{function} pack_ack_seen ( cal\_stage\_ack\_seen : \textcolor{keywordflow}{in} t_cal_stage_ack_seen
03926                            ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03927 
03928 \textcolor{keyword}{    -- encoding of stage and active block for register setting}
03929     \textcolor{keywordflow}{function} encode_current_stage (ctrl\_cmd\_id  : t_ctrl_cmd_id)       \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03930     \textcolor{keywordflow}{function} encode_active_block  (active_block : t_ctrl_active_block) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector};
03931 
03932 \textcolor{keyword}{--}
03933 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_regs\_pkg};
03934 
03935 \textcolor{keyword}{--}
03936 \textcolor{keywordflow}{package} \textcolor{keywordflow}{body} ddr2_phy_alt_mem_phy_regs_pkg \textcolor{keywordflow}{is}
03937 
03938 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>}
03939 \textcolor{keyword}{    -- Read Only Registers}
03940 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>}
03941 
03942 \textcolor{keyword}{-- ---------------------------------------------------------------}
03943 \textcolor{keyword}{-- CODVW status report}
03944 \textcolor{keyword}{-- ---------------------------------------------------------------}
03945 
03946     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_codvw_status} \textcolor{keywordflow}{is}
03947         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_codvw_status};
03948 \textcolor{vhdlkeyword}{    begin}
03949         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_phase}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03950         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_size}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03951         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_trk_shift}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03952         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03953         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
03954     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03955 
03956     \textcolor{keywordflow}{function} defaults ( dgrb\_mmi : t_dgrb_mmi
03957                       ) \textcolor{keywordflow}{return} t_codvw_status \textcolor{keywordflow}{is}
03958         \textcolor{keywordflow}{variable} temp: t_codvw_status;
03959     \textcolor{keywordflow}{begin}
03960         temp                   := defaults;
03961         temp.cal_codvw_phase   := dgrb\_mmi.cal_codvw_phase;
03962         temp.cal_codvw_size    := dgrb\_mmi.cal_codvw_size;
03963         temp.codvw_trk_shift   := dgrb\_mmi.codvw_trk_shift;
03964         temp.codvw_grt_one_dvw := dgrb\_mmi.codvw_grt_one_dvw;
03965         \textcolor{keywordflow}{return} temp;
03966     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03967 
03968     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_codvw_status) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
03969         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
03970     \textcolor{keywordflow}{begin}
03971         temp               := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
03972         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24}\textcolor{vhdlchar}{)} := reg.cal_codvw_phase;
03973         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} := reg.cal_codvw_size;
03974         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}  := reg.codvw_trk_shift;
03975         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}            := reg.codvw_grt_one_dvw;
03976         \textcolor{keywordflow}{return} temp;
03977     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
03978 
03979 \textcolor{keyword}{-- ---------------------------------------------------------------}
03980 \textcolor{keyword}{-- Calibration status report}
03981 \textcolor{keyword}{-- ---------------------------------------------------------------}
03982 
03983     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_cal_status} \textcolor{keywordflow}{is}
03984         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_cal_status};
03985 \textcolor{vhdlkeyword}{    begin}
03986         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_addr_width}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03987         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{out_of_mem}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03988         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03989         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_fail}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03990         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_success}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03991         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03992         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{trefi_failure}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03993         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{int_ac_1t}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03994         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{dqs_capture}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03995         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_present}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
03996         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{active_block}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03997         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_stage}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
03998         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
03999     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04000 
04001     \textcolor{keywordflow}{function} defaults   ( ctrl\_mmi      : \textcolor{keywordflow}{in} t_ctrl_mmi;
04002                           USE\_IRAM      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
04003                           dqs_capture   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04004                           int_ac_1t     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
04005                           trefi_failure : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
04006                           iram\_status   : \textcolor{keywordflow}{in} t_iram_stat;
04007                           IRAM\_AWIDTH   : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
04008                         ) \textcolor{keywordflow}{return} t_cal_status \textcolor{keywordflow}{is}
04009         \textcolor{keywordflow}{variable} temp : t_cal_status;
04010     \textcolor{keywordflow}{begin}
04011         temp                  := defaults;
04012         temp.iram_addr_width  := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}IRAM\_AWIDTH, temp.
      iram_addr_width'\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04013         temp.out_of_mem       := iram\_status.out_of_mem;
04014         temp.contested_access := iram\_status.contested_access;
04015         temp.cal_fail         := ctrl\_mmi.ctrl_calibration_fail;
04016         temp.cal_success      := ctrl\_mmi.ctrl_calibration_success;
04017         temp.ctrl_err_code    := ctrl\_mmi.ctrl_err_code;
04018         temp.trefi_failure    := trefi_failure;
04019         temp.int_ac_1t        := int_ac_1t;
04020 
04021         \textcolor{keywordflow}{if} dqs_capture = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
04022             temp.dqs_capture      := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
04023         \textcolor{keywordflow}{elsif} dqs_capture = \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
04024             temp.dqs_capture      := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04025         \textcolor{keywordflow}{else}
04026             \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{" invalid value for dqs\_capture constant of "} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}
      dqs_capture\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
04027         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04028 
04029         temp.iram_present     := USE\_IRAM;
04030         temp.active_block     := encode\_active\_block\textcolor{vhdlchar}{(}ctrl\_mmi.
      ctrl_current_active_block\textcolor{vhdlchar}{)};
04031         temp.current_stage    := encode\_current\_stage\textcolor{vhdlchar}{(}ctrl\_mmi.
      ctrl_current_stage\textcolor{vhdlchar}{)};
04032         \textcolor{keywordflow}{return} temp;
04033     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04034 
04035 \textcolor{keyword}{    -- read for mmi status register}
04036     \textcolor{keywordflow}{function} read       ( reg : t_cal_status
04037                         ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04038         \textcolor{keywordflow}{variable} output : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04039     \textcolor{keywordflow}{begin}
04040 
04041         output               := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04042         output\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := reg.current_stage;
04043         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} := reg.active_block;
04044         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}\textcolor{vhdlchar}{)}           := reg.iram_present;
04045         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{13}\textcolor{vhdlchar}{)}           := reg.dqs_capture;
04046         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{14}\textcolor{vhdlchar}{)}           := reg.int_ac_1t;
04047         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15}\textcolor{vhdlchar}{)}           := reg.trefi_failure;
04048         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} := reg.ctrl_err_code;
04049         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{24}\textcolor{vhdlchar}{)}           := reg.cal_success;
04050         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{25}\textcolor{vhdlchar}{)}           := reg.cal_fail;
04051         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{26}\textcolor{vhdlchar}{)}           := reg.contested_access;
04052         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{27}\textcolor{vhdlchar}{)}           := reg.out_of_mem;
04053         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{28}\textcolor{vhdlchar}{)} := reg.iram_addr_width;
04054 
04055         \textcolor{keywordflow}{return} output;
04056     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04057 
04058 \textcolor{keyword}{-- ---------------------------------------------------------------}
04059 \textcolor{keyword}{-- Test status report}
04060 \textcolor{keyword}{-- ---------------------------------------------------------------}
04061 
04062     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_test_status} \textcolor{keywordflow}{is}
04063         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_test_status};
04064 \textcolor{vhdlkeyword}{    begin}
04065         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ack_seen}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04066         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_mmi_err}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04067         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_busy}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04068         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04069     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04070 
04071     \textcolor{keywordflow}{function} defaults   ( ctrl\_mmi     : \textcolor{keywordflow}{in} t_ctrl_mmi;
04072                           pll\_mmi      : \textcolor{keywordflow}{in} t_pll_mmi;
04073                           rw_if_test   : t_if_test_reg
04074                         ) \textcolor{keywordflow}{return} t_test_status \textcolor{keywordflow}{is}
04075         \textcolor{keywordflow}{variable} temp : t_test_status;
04076     \textcolor{keywordflow}{begin}
04077         temp             := defaults;
04078         temp.ack_seen    := pack\_ack\_seen\textcolor{vhdlchar}{(}ctrl\_mmi.ctrl_cal_stage_ack_seen\textcolor{vhdlchar}{)};
04079         temp.pll_mmi_err := pll\_mmi.err;
04080         temp.pll_busy    := pll\_mmi.pll_busy \textcolor{keywordflow}{or} rw_if_test.pll_phs_shft_up_wc \textcolor{keywordflow}{or} 
      rw_if_test.pll_phs_shft_dn_wc;
04081         \textcolor{keywordflow}{return} temp;
04082     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04083 
04084 \textcolor{keyword}{    -- read for mmi status register}
04085     \textcolor{keywordflow}{function} read       ( reg : t_test_status
04086                         ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04087         \textcolor{keywordflow}{variable} output : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04088     \textcolor{keywordflow}{begin}
04089 
04090         output                                   := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04091         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}-c_hl_ccs_num_stages\textcolor{vhdlchar}{)} := reg.ack_seen;
04092         output\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}                     := reg.pll_mmi_err;
04093         output\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}                                := reg.pll_busy;
04094 
04095         \textcolor{keywordflow}{return} output;
04096     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04097 
04098 \textcolor{keyword}{-------------------------------------------------}
04099 \textcolor{keyword}{-- FOR ALL RO REGS:}
04100 \textcolor{keyword}{-------------------------------------------------}
04101 
04102     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ro_regs} \textcolor{keywordflow}{is}
04103         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ro_regs};
04104 \textcolor{vhdlkeyword}{    begin}
04105         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_status}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04106         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04107         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04108     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04109 
04110     \textcolor{keywordflow}{function} defaults (dgrb\_mmi        : t_dgrb_mmi;
04111                        ctrl\_mmi        : t_ctrl_mmi;
04112                        pll\_mmi         : t_pll_mmi;
04113                        rw_if_test      : t_if_test_reg;
04114                        USE\_IRAM        : \textcolor{comment}{std\_logic};
04115                        dqs_capture     : \textcolor{comment}{natural};
04116                        int_ac_1t       : \textcolor{comment}{std\_logic};
04117                        trefi_failure   : \textcolor{comment}{std\_logic};
04118                        iram\_status     : t_iram_stat;
04119                        IRAM\_AWIDTH     : \textcolor{comment}{natural}
04120                       ) \textcolor{keywordflow}{return} t_ro_regs \textcolor{keywordflow}{is}
04121         \textcolor{keywordflow}{variable} output : t_ro_regs;
04122     \textcolor{keywordflow}{begin}
04123         output              := defaults;
04124         output.cal_status   := defaults\textcolor{vhdlchar}{(}ctrl\_mmi, USE\_IRAM, dqs_capture, 
      int_ac_1t, trefi_failure, iram\_status, IRAM\_AWIDTH\textcolor{vhdlchar}{)};
04125         output.codvw_status := defaults\textcolor{vhdlchar}{(}dgrb\_mmi\textcolor{vhdlchar}{)};
04126         output.test_status  := defaults\textcolor{vhdlchar}{(}ctrl\_mmi, pll\_mmi, rw_if_test\textcolor{vhdlchar}{)};
04127         \textcolor{keywordflow}{return} output;
04128     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04129 
04130 
04131 \textcolor{keyword}{-- >>>>>>>>>>>>>>>>>>>>>>>>}
04132 \textcolor{keyword}{-- Read / Write registers}
04133 \textcolor{keyword}{-- >>>>>>>>>>>>>>>>>>>>>>>>}
04134 
04135 \textcolor{keyword}{-- ---------------------------------------------------------------}
04136 \textcolor{keyword}{-- mode register set A}
04137 \textcolor{keyword}{-- ---------------------------------------------------------------}
04138     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_a} \textcolor{keywordflow}{is}
04139         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:}\textcolor{vhdlchar}{t_mr_register_a};
04140 \textcolor{vhdlkeyword}{    begin}
04141         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04142         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04143         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04144     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04145 
04146 \textcolor{keyword}{    -- apply default mode register settings to register}
04147     \textcolor{keywordflow}{function} defaults ( mr0     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector};
04148                         mr1     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
04149                       ) \textcolor{keywordflow}{return} t_mr_register_a \textcolor{keywordflow}{is}
04150         \textcolor{keywordflow}{variable} temp :t_mr_register_a;
04151     \textcolor{keywordflow}{begin}
04152         temp     := defaults;
04153         temp.mr0 := mr0\textcolor{vhdlchar}{(}temp.mr0'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
04154         temp.mr1 := mr1\textcolor{vhdlchar}{(}temp.mr1'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
04155         \textcolor{keywordflow}{return} temp;
04156     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04157 
04158     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} 
      t_mr_register_a \textcolor{keywordflow}{is}
04159         \textcolor{keywordflow}{variable} temp :t_mr_register_a;
04160     \textcolor{keywordflow}{begin}
04161         temp.mr0 := wdata\_in\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}     \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04162         temp.mr1 := wdata\_in\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
04163         \textcolor{keywordflow}{return} temp;
04164     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04165 
04166     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_mr_register_a) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04167         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04168     \textcolor{keywordflow}{begin}
04169         temp\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}      \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := reg.mr0;
04170         temp\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} := reg.mr1;
04171         \textcolor{keywordflow}{return} temp;
04172     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04173 
04174 \textcolor{keyword}{-- ---------------------------------------------------------------}
04175 \textcolor{keyword}{-- mode register set B}
04176 \textcolor{keyword}{-- ---------------------------------------------------------------}
04177     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mr_register_b} \textcolor{keywordflow}{is}
04178         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:}\textcolor{vhdlchar}{t_mr_register_b};
04179 \textcolor{vhdlkeyword}{    begin}
04180         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04181         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04182         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04183     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04184 
04185 \textcolor{keyword}{    -- apply default mode register settings to register}
04186     \textcolor{keywordflow}{function} defaults ( mr2     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector};
04187                         mr3     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}
04188                        ) \textcolor{keywordflow}{return} t_mr_register_b \textcolor{keywordflow}{is}
04189         \textcolor{keywordflow}{variable} temp :t_mr_register_b;
04190     \textcolor{keywordflow}{begin}
04191         temp     := defaults;
04192         temp.mr2 := mr2\textcolor{vhdlchar}{(}temp.mr2'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
04193         temp.mr3 := mr3\textcolor{vhdlchar}{(}temp.mr3'\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
04194         \textcolor{keywordflow}{return} temp;
04195     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04196 
04197     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} 
      t_mr_register_b \textcolor{keywordflow}{is}
04198         \textcolor{keywordflow}{variable} temp :t_mr_register_b;
04199     \textcolor{keywordflow}{begin}
04200         temp.mr2 := wdata\_in\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}      \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04201         temp.mr3 := wdata\_in\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
04202         \textcolor{keywordflow}{return} temp;
04203     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04204 
04205     \textcolor{keywordflow}{function} read (reg : \textcolor{keywordflow}{in} t_mr_register_b) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04206         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04207     \textcolor{keywordflow}{begin}
04208         temp\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}      \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := reg.mr2;
04209         temp\textcolor{vhdlchar}{(}c_max_mode_reg_index -\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} := reg.mr3;
04210         \textcolor{keywordflow}{return} temp;
04211     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04212 
04213 
04214 \textcolor{keyword}{-- ---------------------------------------------------------------}
04215 \textcolor{keyword}{-- HL CSS (high level calibration state status)}
04216 \textcolor{keyword}{-- ---------------------------------------------------------------}
04217     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_hl_css} \textcolor{keywordflow}{is}
04218         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_hl_css};
04219 \textcolor{vhdlkeyword}{    begin}
04220         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04221         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_start}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04222         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04223     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04224 
04225 -    \textcolor{keywordflow}{function} defaults ( C\_HL\_STAGE\_ENABLE : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(c\_hl\_ccs\_num\_stages1 \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
04226                       ) \textcolor{keywordflow}{return} t_hl_css \textcolor{keywordflow}{is}
04227         \textcolor{keywordflow}{variable} temp: t_hl_css;
04228     \textcolor{keywordflow}{begin}
04229         temp        := defaults;
04230         temp.hl_css := temp.hl_css \textcolor{keywordflow}{OR} C\_HL\_STAGE\_ENABLE;
04231         \textcolor{keywordflow}{return} temp;
04232     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04233 
04234     \textcolor{keywordflow}{function} read ( reg : \textcolor{keywordflow}{in} t_hl_css) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04235         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04236     \textcolor{keywordflow}{begin}
04237         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{30} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{30}-c_hl_ccs_num_stages+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} := reg.hl_css;
04238         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}                                  := reg.cal_start;
04239         \textcolor{keywordflow}{return} temp;
04240     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04241 
04242     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}) )\textcolor{keywordflow}{return} t_hl_css \textcolor{keywordflow}{is}
04243        \textcolor{keywordflow}{variable} reg : t_hl_css;
04244     \textcolor{keywordflow}{begin}
04245         reg.hl_css             := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{30} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{30}-c_hl_ccs_num_stages+\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
04246         reg.cal_start          := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04247         \textcolor{keywordflow}{return} reg;
04248     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04249 
04250     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} reg : \textcolor{keywordflow}{inout} t_hl_css) \textcolor{keywordflow}{is}
04251     \textcolor{keywordflow}{begin}
04252         reg.cal_start <= '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04253     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
04254 
04255 \textcolor{keyword}{-- ---------------------------------------------------------------}
04256 \textcolor{keyword}{-- paramaterisation of sequencer through Avalon interface}
04257 \textcolor{keyword}{-- ---------------------------------------------------------------}
04258     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_parameterisation_reg_a} \textcolor{keywordflow}{is}
04259         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_parameterisation_reg_a};
04260 \textcolor{vhdlkeyword}{    begin}
04261         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{nominal_poa_phase_lead}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04262         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{maximum_poa_delay}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04263         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_360_sweeps}          \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"0000"};
04264         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{num_phases_per_tck_pll}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"0011"};
04265         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{nominal_dqs_delay}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04266         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{extend_octrt_by}         \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"0100"};
04267         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{delay_octrt_by}          \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"0000"};
04268         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04269     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04270 
04271 \textcolor{keyword}{    -- reset the paramterisation reg to given values}
04272     \textcolor{keywordflow}{function} defaults ( NOM\_DQS\_PHASE\_SETTING   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04273                         PLL\_STEPS\_PER\_CYCLE     : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04274                         pll_360_sweeps          : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
04275                       ) \textcolor{keywordflow}{return} t_parameterisation_reg_a \textcolor{keywordflow}{is}
04276         \textcolor{keywordflow}{variable} temp: t_parameterisation_reg_a;
04277     \textcolor{keywordflow}{begin}
04278         temp                        := defaults;
04279         temp.num_phases_per_tck_pll := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}PLL\_STEPS\_PER\_CYCLE /\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} , temp.
      num_phases_per_tck_pll'\textcolor{vhdlkeyword}{high} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04280         temp.pll_360_sweeps         := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}
      pll_360_sweeps         , temp.pll_360_sweeps'\textcolor{vhdlkeyword}{high} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}         \textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04281         temp.nominal_dqs_delay      := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}NOM\_DQS\_PHASE\_SETTING  , temp.
      nominal_dqs_delay'\textcolor{vhdlkeyword}{high} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}      \textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04282         temp.extend_octrt_by        := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}                      , temp.
      extend_octrt_by'\textcolor{vhdlkeyword}{high} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}        \textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04283         temp.delay_octrt_by         := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}                      , temp.
      delay_octrt_by'\textcolor{vhdlkeyword}{high} + \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}         \textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04284         \textcolor{keywordflow}{return} temp;
04285     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04286 
04287     \textcolor{keywordflow}{function} read ( reg : \textcolor{keywordflow}{in} t_parameterisation_reg_a) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04288         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04289     \textcolor{keywordflow}{begin}
04290         temp\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := reg.pll_360_sweeps;
04291         temp\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)} := reg.num_phases_per_tck_pll;
04292         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} := reg.nominal_dqs_delay;
04293         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{19} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} := reg.nominal_poa_phase_lead;
04294         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20}\textcolor{vhdlchar}{)} := reg.maximum_poa_delay;
04295         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{27} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24}\textcolor{vhdlchar}{)} := reg.extend_octrt_by;
04296         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{28}\textcolor{vhdlchar}{)} := reg.delay_octrt_by;
04297         \textcolor{keywordflow}{return} temp;
04298     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04299 
04300     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} 
      t_parameterisation_reg_a \textcolor{keywordflow}{is}
04301         \textcolor{keywordflow}{variable} reg : t_parameterisation_reg_a;
04302     \textcolor{keywordflow}{begin}
04303         reg.pll_360_sweeps         := wdata\_in\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04304         reg.num_phases_per_tck_pll := wdata\_in\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)};
04305         reg.nominal_dqs_delay      := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)};
04306         reg.nominal_poa_phase_lead := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{19} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
04307         reg.maximum_poa_delay      := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{23} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{20}\textcolor{vhdlchar}{)};
04308         reg.extend_octrt_by        := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{27} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{24}\textcolor{vhdlchar}{)};
04309         reg.delay_octrt_by         := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{28}\textcolor{vhdlchar}{)};
04310         \textcolor{keywordflow}{return} reg;
04311     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04312 
04313 \textcolor{keyword}{-- ---------------------------------------------------------------}
04314 \textcolor{keyword}{-- t\_if\_test\_reg - additional test support register}
04315 \textcolor{keyword}{-- ---------------------------------------------------------------}
04316     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_if_test_reg} \textcolor{keywordflow}{is}
04317         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_if_test_reg};
04318 \textcolor{vhdlkeyword}{    begin}
04319         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_phs_shft_phase_sel}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
04320         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_phs_shft_up_wc}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04321         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll_phs_shft_dn_wc}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04322         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ac_1t_toggle}            \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04323         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_period_ms}      \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"10000000"};\textcolor{keyword}{ -- 127 ms interval}
04324         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_units_are_10us} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04325         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04326     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04327 
04328 \textcolor{keyword}{    -- reset the paramterisation reg to given values}
04329     \textcolor{keywordflow}{function} defaults ( TRACKING\_INTERVAL\_IN\_MS : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
04330                       ) \textcolor{keywordflow}{return} t_if_test_reg \textcolor{keywordflow}{is}
04331         \textcolor{keywordflow}{variable} temp: t_if_test_reg;
04332     \textcolor{keywordflow}{begin}
04333         temp := defaults;
04334         temp.tracking_period_ms      := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}TRACKING\_INTERVAL\_IN\_MS, temp.
      tracking_period_ms'\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04335         \textcolor{keywordflow}{return} temp;
04336     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04337 
04338     \textcolor{keywordflow}{function} read ( reg : \textcolor{keywordflow}{in} t_if_test_reg) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04339         \textcolor{keywordflow}{variable} temp : \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04340     \textcolor{keywordflow}{begin}
04341         temp\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} := \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}to\_unsigned\textcolor{vhdlchar}{(}reg.
      pll_phs_shft_phase_sel,\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04342         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}            := reg.pll_phs_shft_up_wc;
04343         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)}            := reg.pll_phs_shft_dn_wc;
04344         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)}           := reg.ac_1t_toggle;
04345         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} := reg.tracking_period_ms;
04346         temp\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{20}\textcolor{vhdlchar}{)}           := reg.tracking_units_are_10us;
04347         \textcolor{keywordflow}{return} temp;
04348     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04349 
04350     \textcolor{keywordflow}{function} write (wdata\_in : \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{return} 
      t_if_test_reg \textcolor{keywordflow}{is}
04351         \textcolor{keywordflow}{variable} reg : t_if_test_reg;
04352     \textcolor{keywordflow}{begin}
04353         reg.pll_phs_shft_phase_sel  := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}wdata\_in\textcolor{vhdlchar}{(} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04354         reg.pll_phs_shft_up_wc      := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)};
04355         reg.pll_phs_shft_dn_wc      := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5}\textcolor{vhdlchar}{)};
04356         reg.ac_1t_toggle            := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)};
04357         reg.tracking_period_ms      := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)};
04358         reg.tracking_units_are_10us := wdata\_in\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{20}\textcolor{vhdlchar}{)};
04359         \textcolor{keywordflow}{return} reg;
04360     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04361 
04362     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} reg : \textcolor{keywordflow}{inout} t_if_test_reg) \textcolor{keywordflow}{is}
04363     \textcolor{keywordflow}{begin}
04364         reg.ac_1t_toggle       <= '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04365         reg.pll_phs_shft_up_wc <= '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04366         reg.pll_phs_shft_dn_wc <= '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04367     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
04368 
04369 \textcolor{keyword}{-- ---------------------------------------------------------------}
04370 \textcolor{keyword}{-- RW Regs, record of read/write register records (to simplify handling)}
04371 \textcolor{keyword}{-- ---------------------------------------------------------------}
04372     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_rw_regs} \textcolor{keywordflow}{is}
04373         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{temp} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_rw_regs};
04374 \textcolor{vhdlkeyword}{    begin}
04375         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr_reg_a}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04376         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr_reg_b}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04377         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw_hl_css}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04378         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw_param_reg} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04379         \textcolor{vhdlchar}{temp}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw_if_test}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04380         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{temp};
04381     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04382 
04383 -    \textcolor{keywordflow}{function} defaults(
04384                        mr0                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
04385                        mr1                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
04386                        mr2                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
04387                        mr3                     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
04388                        NOM\_DQS\_PHASE\_SETTING   : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04389                        PLL\_STEPS\_PER\_CYCLE     : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04390                        pll_360_sweeps          : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04391                        TRACKING\_INTERVAL\_IN\_MS : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04392                        C\_HL\_STAGE\_ENABLE       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(c\_hl\_ccs\_num\_stages1 \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
04393                       )\textcolor{keywordflow}{return} t_rw_regs \textcolor{keywordflow}{is}
04394         \textcolor{keywordflow}{variable} temp : t_rw_regs;
04395     \textcolor{keywordflow}{begin}
04396         temp              := defaults;
04397         temp.mr_reg_a     := defaults\textcolor{vhdlchar}{(}mr0, mr1\textcolor{vhdlchar}{)};
04398         temp.mr_reg_b     := defaults\textcolor{vhdlchar}{(}mr2, mr3\textcolor{vhdlchar}{)};
04399         temp.rw_param_reg := defaults\textcolor{vhdlchar}{(}NOM\_DQS\_PHASE\_SETTING,
04400                                       PLL\_STEPS\_PER\_CYCLE,
04401                                       pll_360_sweeps\textcolor{vhdlchar}{)};
04402         temp.rw_if_test   := defaults\textcolor{vhdlchar}{(}TRACKING\_INTERVAL\_IN\_MS\textcolor{vhdlchar}{)};
04403         temp.rw_hl_css    := defaults\textcolor{vhdlchar}{(}C\_HL\_STAGE\_ENABLE\textcolor{vhdlchar}{)};
04404         \textcolor{keywordflow}{return} temp;
04405     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04406 
04407     \textcolor{keywordflow}{procedure} write_clear (\textcolor{keywordflow}{signal} regs : \textcolor{keywordflow}{inout} t_rw_regs) \textcolor{keywordflow}{is}
04408     \textcolor{keywordflow}{begin}
04409         write\_clear\textcolor{vhdlchar}{(}regs.rw_if_test\textcolor{vhdlchar}{)};
04410         write\_clear\textcolor{vhdlchar}{(}regs.rw_hl_css\textcolor{vhdlchar}{)};
04411     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
04412 
04413 
04414 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04415 \textcolor{keyword}{    -- All mmi registers:}
04416 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04417 
04418     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_mmi_regs} \textcolor{keywordflow}{is}
04419         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mmi\_regs} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_mmi_regs};
04420 \textcolor{vhdlkeyword}{    begin}
04421         \textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw_regs}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04422         \textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ro_regs}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04423         \textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{enable_writes} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04424         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_mmi\_regs};
04425     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04426 
04427     \textcolor{keywordflow}{function} v_read       (mmi\_regs     : \textcolor{keywordflow}{in} t_mmi_regs;
04428                            address      : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
04429                           ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04430         \textcolor{keywordflow}{variable} output : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04431     \textcolor{keywordflow}{begin}
04432 
04433         output := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04434 
04435         \textcolor{keywordflow}{case} address \textcolor{keywordflow}{is}
04436 
04437 \textcolor{keyword}{            -- status register}
04438             \textcolor{keywordflow}{when}  c_regofst_cal_status     => output := read \textcolor{vhdlchar}{(}mmi\_regs.ro_regs.
      cal_status\textcolor{vhdlchar}{)};
04439 
04440 \textcolor{keyword}{            -- debug access register}
04441             \textcolor{keywordflow}{when}  c_regofst_debug_access   =>
04442                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}mmi\_regs.enable_writes = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
04443                     output := c_mmi_access_codeword;
04444                 \textcolor{keywordflow}{else}
04445                     output := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04446                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04447 
04448 \textcolor{keyword}{            -- test i/f to check which stages have acknowledged a command and pll checks}
04449             \textcolor{keywordflow}{when} c_regofst_test_status     => output := read\textcolor{vhdlchar}{(}mmi\_regs.ro_regs.
      test_status\textcolor{vhdlchar}{)};
04450 
04451 \textcolor{keyword}{            -- mode registers}
04452             \textcolor{keywordflow}{when} c_regofst_mr_register_a   => output := read\textcolor{vhdlchar}{(}mmi\_regs.rw_regs.
      mr_reg_a\textcolor{vhdlchar}{)};
04453             \textcolor{keywordflow}{when} c_regofst_mr_register_b   => output := read\textcolor{vhdlchar}{(}mmi\_regs.rw_regs.
      mr_reg_b\textcolor{vhdlchar}{)};
04454 
04455 \textcolor{keyword}{            -- codvw r/o status register}
04456             \textcolor{keywordflow}{when} c_regofst_codvw_status    => output := read\textcolor{vhdlchar}{(}mmi\_regs.ro_regs.
      codvw_status\textcolor{vhdlchar}{)};
04457 
04458 \textcolor{keyword}{            -- read/write registers}
04459             \textcolor{keywordflow}{when}  c_regofst_hl_css         => output := read\textcolor{vhdlchar}{(}mmi\_regs.rw_regs.
      rw_hl_css\textcolor{vhdlchar}{)};
04460             \textcolor{keywordflow}{when}  c_regofst_if_param       => output := read\textcolor{vhdlchar}{(}mmi\_regs.rw_regs.
      rw_param_reg\textcolor{vhdlchar}{)};
04461             \textcolor{keywordflow}{when}  c_regofst_if_test        => output := read\textcolor{vhdlchar}{(}mmi\_regs.rw_regs.
      rw_if_test\textcolor{vhdlchar}{)};
04462 
04463             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}                    => \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{"MMI registers detected an
       attempt to read to non-existant register location"} \textcolor{keywordflow}{severity} warning;
04464 \textcolor{keyword}{                                                                            -- set illegal addr interrupt.}
04465         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04466 
04467         \textcolor{keywordflow}{return} output;
04468 
04469     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04470 
04471 
04472     \textcolor{keywordflow}{function} read         (\textcolor{keywordflow}{signal} mmi\_regs       : \textcolor{keywordflow}{in} t_mmi_regs;
04473                                   address        : \textcolor{keywordflow}{in} \textcolor{comment}{natural}
04474                           ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04475         \textcolor{keywordflow}{variable} output     : \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04476         \textcolor{keywordflow}{variable} v\_mmi\_regs : t_mmi_regs;
04477     \textcolor{keywordflow}{begin}
04478         v\_mmi\_regs := mmi\_regs;
04479         output     := v\_read\textcolor{vhdlchar}{(}v\_mmi\_regs, address\textcolor{vhdlchar}{)};
04480         \textcolor{keywordflow}{return} output;
04481     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04482 
04483     \textcolor{keywordflow}{procedure} write       (mmi\_regs : \textcolor{keywordflow}{inout} t_mmi_regs;
04484                            address  : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
04485                            wdata    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})) \textcolor{keywordflow}{is}
04486 
04487     \textcolor{keywordflow}{begin}
04488 
04489 \textcolor{keyword}{        -- intercept writes to codeword.  This needs to be set for iRAM access :}
04490         \textcolor{keywordflow}{if} address = c_regofst_debug_access \textcolor{keywordflow}{then}
04491             \textcolor{keywordflow}{if} wdata = c_mmi_access_codeword \textcolor{keywordflow}{then}
04492                 mmi\_regs.enable_writes := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}';
04493             \textcolor{keywordflow}{else}
04494                 mmi\_regs.enable_writes := '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}';
04495             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04496 
04497         \textcolor{keywordflow}{else} 
04498 
04499             \textcolor{keywordflow}{case} address \textcolor{keywordflow}{is}
04500 
04501 \textcolor{keyword}{                -- read only registers}
04502                 \textcolor{keywordflow}{when}  c_regofst_cal_status |
04503                       c_regofst_codvw_status |
04504                       c_regofst_test_status =>
04505 
04506                       \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{"MMI registers detected an attempt to write to read only
       register number"} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}address\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
04507 
04508 \textcolor{keyword}{                -- read/write registers}
04509                 \textcolor{keywordflow}{when} c_regofst_mr_register_a  => mmi\_regs.rw_regs.mr_reg_a     := 
      write\textcolor{vhdlchar}{(}wdata\textcolor{vhdlchar}{)};
04510                 \textcolor{keywordflow}{when} c_regofst_mr_register_b  => mmi\_regs.rw_regs.mr_reg_b     := 
      write\textcolor{vhdlchar}{(}wdata\textcolor{vhdlchar}{)};
04511                 \textcolor{keywordflow}{when} c_regofst_hl_css         => mmi\_regs.rw_regs.rw_hl_css    := 
      write\textcolor{vhdlchar}{(}wdata\textcolor{vhdlchar}{)};
04512                 \textcolor{keywordflow}{when} c_regofst_if_param       => mmi\_regs.rw_regs.rw_param_reg := 
      write\textcolor{vhdlchar}{(}wdata\textcolor{vhdlchar}{)};
04513                 \textcolor{keywordflow}{when} c_regofst_if_test        => mmi\_regs.rw_regs.rw_if_test   := 
      write\textcolor{vhdlchar}{(}wdata\textcolor{vhdlchar}{)};
04514 
04515                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}  => \textcolor{keyword}{-- set illegal addr interrupt.}
04516 
04517                     \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{"MMI registers detected an attempt to write to non existant
       register, with expected number"} & \textcolor{comment}{integer}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}address\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} failure;
04518 
04519             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04520 
04521         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04522 
04523     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
04524 
04525 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04526 \textcolor{keyword}{    -- the following functions enable register data to be communicated to other sequencer blocks}
04527 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04528 
04529     \textcolor{keywordflow}{function} pack_record ( ip\_regs : t_rw_regs
04530                          ) \textcolor{keywordflow}{return} t_algm_paramaterisation \textcolor{keywordflow}{is}
04531         \textcolor{keywordflow}{variable} output : t_algm_paramaterisation;
04532     \textcolor{keywordflow}{begin}
04533 \textcolor{keyword}{        -- default assignments}
04534         output.num_phases_per_tck_pll := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
04535         output.pll_360_sweeps         := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
04536         output.nominal_dqs_delay      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
04537         output.nominal_poa_phase_lead := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
04538         output.maximum_poa_delay      := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
04539         output.odt_enabled            := false;
04540 
04541         output.num_phases_per_tck_pll := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.
      rw_param_reg.num_phases_per_tck_pll\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} * \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
04542 
04543         \textcolor{keywordflow}{case} ip\_regs.rw_param_reg.nominal_dqs_delay      \textcolor{keywordflow}{is}
04544             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"010"} => output.nominal_dqs_delay := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
04545             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"001"} => output.nominal_dqs_delay := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
04546             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"000"} => output.nominal_dqs_delay := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
04547             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"011"} => output.nominal_dqs_delay := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
04548             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} => \textcolor{keywordflow}{report} regs_report_prefix &
04549                                   \textcolor{keyword}{"there is a unsupported number of DQS taps ("} &
04550                                   \textcolor{comment}{natural}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.
      rw_param_reg.nominal_dqs_delay\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} &
04551                                   \textcolor{keyword}{") being advertised as the standard value"} \textcolor{keywordflow}{severity} error;
04552         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04553 
04554        \textcolor{keywordflow}{case} ip\_regs.rw_param_reg.nominal_poa_phase_lead  \textcolor{keywordflow}{is}
04555             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"0001"} => output.nominal_poa_phase_lead := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
04556             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"0010"} => output.nominal_poa_phase_lead := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
04557             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"0011"} => output.nominal_poa_phase_lead := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
04558             \textcolor{keywordflow}{when} \textcolor{vhdllogic}{"0000"} => output.nominal_poa_phase_lead := \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
04559             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} => \textcolor{keywordflow}{report} regs_report_prefix &
04560                                   \textcolor{keyword}{"there is an unsupported nominal postamble phase lead paramater set ("} &
04561                                   \textcolor{comment}{natural}'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.
      rw_param_reg.nominal_poa_phase_lead\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} &
04562                                   \textcolor{keyword}{")"} \textcolor{keywordflow}{severity} error;
04563        \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04564 
04565        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}    \textcolor{vhdlchar}{(}ip\_regs.mr_reg_a.mr1\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'\textcolor{vhdlchar}{)}
04566             \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}ip\_regs.mr_reg_a.mr1\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'\textcolor{vhdlchar}{)}
04567             \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}ip\_regs.mr_reg_a.mr1\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9}\textcolor{vhdlchar}{)} = '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}'\textcolor{vhdlchar}{)}
04568           \textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
04569           output.odt_enabled            := true;
04570        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04571 
04572        output.pll_360_sweeps     := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_param_reg.
      pll_360_sweeps\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04573        output.maximum_poa_delay  := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_param_reg.
      maximum_poa_delay\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04574        output.extend_octrt_by    := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_param_reg.
      extend_octrt_by\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04575        output.delay_octrt_by     := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_param_reg.
      delay_octrt_by\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04576        output.tracking_period_ms := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_if_test.
      tracking_period_ms\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04577         \textcolor{keywordflow}{return} output;
04578     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04579 
04580 
04581     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} t_mmi_pll_reconfig \textcolor{keywordflow}{is}
04582         \textcolor{keywordflow}{variable} output : t_mmi_pll_reconfig;
04583     \textcolor{keywordflow}{begin}
04584         output.pll_phs_shft_phase_sel := ip\_regs.rw_if_test.
      pll_phs_shft_phase_sel;
04585         output.pll_phs_shft_up_wc     := ip\_regs.rw_if_test.pll_phs_shft_up_wc;
04586         output.pll_phs_shft_dn_wc     := ip\_regs.rw_if_test.pll_phs_shft_dn_wc;
04587         \textcolor{keywordflow}{return} output;
04588     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04589 
04590 
04591     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} t_admin_ctrl \textcolor{keywordflow}{is}
04592         \textcolor{keywordflow}{variable} output : t_admin_ctrl := defaults;
04593     \textcolor{keywordflow}{begin}
04594         output.mr0          := ip\_regs.mr_reg_a.mr0;
04595         output.mr1          := ip\_regs.mr_reg_a.mr1;
04596         output.mr2          := ip\_regs.mr_reg_b.mr2;
04597         output.mr3          := ip\_regs.mr_reg_b.mr3;
04598         \textcolor{keywordflow}{return} output;
04599     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04600 
04601     \textcolor{keywordflow}{function} pack_record (ip\_regs : t_rw_regs) \textcolor{keywordflow}{return} t_mmi_ctrl \textcolor{keywordflow}{is}
04602         \textcolor{keywordflow}{variable} output : t_mmi_ctrl := defaults;
04603     \textcolor{keywordflow}{begin}
04604         output.hl_css                := to\_t\_hl\_css\_reg \textcolor{vhdlchar}{(}ip\_regs.rw_hl_css\textcolor{vhdlchar}{)};
04605         output.calibration_start     := ip\_regs.rw_hl_css.cal_start;
04606         output.tracking_period_ms    := to\_integer\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}ip\_regs.rw_if_test.
      tracking_period_ms\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04607         output.tracking_orvd_to_10ms := ip\_regs.rw_if_test.
      tracking_units_are_10us;
04608         \textcolor{keywordflow}{return} output;
04609     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04610 
04611 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04612 \textcolor{keyword}{    -- Helper functions :}
04613 \textcolor{keyword}{    -- >>>>>>>>>>>>>>>>>>>>>>>>>>}
04614 
04615     \textcolor{keywordflow}{function} to_t_hl_css_reg (hl_css    : t_hl_css
04616                          ) \textcolor{keywordflow}{return} t_hl_css_reg \textcolor{keywordflow}{is}
04617         \textcolor{keywordflow}{variable} output : t_hl_css_reg := defaults;
04618     \textcolor{keywordflow}{begin}
04619 
04620         output.phy_initialise_dis           := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_phy_initialise_dis_bit\textcolor{vhdlchar}{)};
04621         output.init_dram_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_init_dram_dis_bit\textcolor{vhdlchar}{)};
04622         output.write_ihi_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_write_ihi_dis_bit\textcolor{vhdlchar}{)};
04623         output.cal_dis                      := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_cal_dis_bit\textcolor{vhdlchar}{)};
04624         output.write_btp_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_write_btp_dis_bit\textcolor{vhdlchar}{)};
04625         output.write_mtp_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_write_mtp_dis_bit\textcolor{vhdlchar}{)};
04626         output.read_mtp_dis                 := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_read_mtp_dis_bit\textcolor{vhdlchar}{)};
04627         output.rrp_reset_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_rrp_reset_dis_bit\textcolor{vhdlchar}{)};
04628         output.rrp_sweep_dis                := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_rrp_sweep_dis_bit\textcolor{vhdlchar}{)};
04629         output.rrp_seek_dis                 := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_rrp_seek_dis_bit\textcolor{vhdlchar}{)};
04630         output.rdv_dis                      := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_rdv_dis_bit\textcolor{vhdlchar}{)};
04631         output.poa_dis                      := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_poa_dis_bit\textcolor{vhdlchar}{)};
04632         output.was_dis                      := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_was_dis_bit\textcolor{vhdlchar}{)};
04633         output.adv_rd_lat_dis               := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_adv_rd_lat_dis_bit\textcolor{vhdlchar}{)};
04634         output.adv_wr_lat_dis               := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_adv_wr_lat_dis_bit\textcolor{vhdlchar}{)};
04635         output.prep_customer_mr_setup_dis   := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_prep_customer_mr_setup_dis_bit\textcolor{vhdlchar}{)};
04636         output.tracking_dis                 := hl_css.hl_css\textcolor{vhdlchar}{(}
      c_hl_css_reg_tracking_dis_bit\textcolor{vhdlchar}{)};
04637         \textcolor{keywordflow}{return} output;
04638     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04639 
04640 \textcolor{keyword}{    -- pack the ack seen record element into a std\_logic\_vector}
04641     \textcolor{keywordflow}{function} pack_ack_seen ( cal\_stage\_ack\_seen : \textcolor{keywordflow}{in} t_cal_stage_ack_seen
04642                         )    \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
04643         \textcolor{keywordflow}{variable} v\_output: \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}c_hl_ccs_num_stages-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04644         \textcolor{keywordflow}{variable} v\_start : \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} c_hl_ccs_num_stages-\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
04645     \textcolor{keywordflow}{begin}
04646         v\_output := \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} => '\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}'\textcolor{vhdlchar}{)};
04647 
04648         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_cal_dis_bit                   \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      cal;
04649         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_phy_initialise_dis_bit        \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      phy_initialise;
04650         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_init_dram_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      init_dram;
04651         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_write_ihi_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      write_ihi;
04652         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_write_btp_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      write_btp;
04653         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_write_mtp_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      write_mtp;
04654         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_read_mtp_dis_bit              \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      read_mtp;
04655         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_rrp_reset_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      rrp_reset;
04656         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_rrp_sweep_dis_bit             \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      rrp_sweep;
04657         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_rrp_seek_dis_bit              \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      rrp_seek;
04658         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_rdv_dis_bit                   \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      rdv;
04659         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_poa_dis_bit                   \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      poa;
04660         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_was_dis_bit                   \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      was;
04661         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_adv_rd_lat_dis_bit            \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      adv_rd_lat;
04662         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_adv_wr_lat_dis_bit            \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      adv_wr_lat;
04663         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_prep_customer_mr_setup_dis_bit\textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      prep_customer_mr_setup;
04664         v\_output\textcolor{vhdlchar}{(}c_hl_css_reg_tracking_dis_bit              \textcolor{vhdlchar}{)} := cal\_stage\_ack\_seen.
      tracking_setup;
04665 
04666         \textcolor{keywordflow}{return} v\_output;
04667 
04668     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04669 
04670 \textcolor{keyword}{    -- reg encoding of current stage}
04671     \textcolor{keywordflow}{function} encode_current_stage (ctrl\_cmd\_id    : t_ctrl_cmd_id
04672                          ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector}  \textcolor{keywordflow}{is}
04673         \textcolor{keywordflow}{variable} output :  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04674     \textcolor{keywordflow}{begin}
04675 
04676        \textcolor{keywordflow}{case} ctrl\_cmd\_id \textcolor{keywordflow}{is}
04677 
04678            \textcolor{keywordflow}{when} cmd\_idle                         => output := X"00";
04679            \textcolor{keywordflow}{when} cmd\_phy\_initialise               => output := X"01";
04680            \textcolor{keywordflow}{when} cmd\_init\_dram |
04681                 cmd\_prog\_cal\_mr                  => output := X"02";
04682            \textcolor{keywordflow}{when} cmd\_write\_ihi                    => output := X"03";
04683            \textcolor{keywordflow}{when} cmd\_write\_btp                    => output := X"04";
04684            \textcolor{keywordflow}{when} cmd\_write\_mtp                    => output := X"05";
04685            \textcolor{keywordflow}{when} cmd\_read\_mtp                     => output := X"06";
04686            \textcolor{keywordflow}{when} cmd\_rrp\_reset                    => output := X"07";
04687            \textcolor{keywordflow}{when} cmd\_rrp\_sweep                    => output := X"08";
04688            \textcolor{keywordflow}{when} cmd\_rrp\_seek                     => output := X"09";
04689            \textcolor{keywordflow}{when} cmd\_rdv                          => output := X"0A";
04690            \textcolor{keywordflow}{when} cmd\_poa                          => output := X"0B";
04691            \textcolor{keywordflow}{when} cmd\_was                          => output := X"0C";
04692            \textcolor{keywordflow}{when} cmd\_prep\_adv\_rd\_lat              => output := X"0D";
04693            \textcolor{keywordflow}{when} cmd\_prep\_adv\_wr\_lat              => output := X"0E";
04694            \textcolor{keywordflow}{when} cmd\_prep\_customer\_mr\_setup       => output := X"0F";
04695            \textcolor{keywordflow}{when} cmd\_tr\_due                       => output := X"10";
04696 
04697            \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} =>
04698                  \textcolor{keywordflow}{null};
04699                  \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{"unknown cal command ("} & 
      t_ctrl_cmd_id'\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}ctrl\_cmd\_id\textcolor{vhdlchar}{)} & \textcolor{keyword}{") seen in encode\_current\_stage function"} \textcolor{keywordflow}{severity} failure;
04700 
04701         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04702 
04703         \textcolor{keywordflow}{return} output;
04704 
04705     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04706 
04707 \textcolor{keyword}{    -- reg encoding of current active block}
04708     \textcolor{keywordflow}{function} encode_active_block (active_block    : t_ctrl_active_block
04709                          ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector}  \textcolor{keywordflow}{is}
04710         \textcolor{keywordflow}{variable} output :  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04711     \textcolor{keywordflow}{begin}
04712 
04713        \textcolor{keywordflow}{case} active_block \textcolor{keywordflow}{is}
04714 
04715            \textcolor{keywordflow}{when} idle   => output := X"0";
04716            \textcolor{keywordflow}{when} admin  => output := X"1";
04717            \textcolor{keywordflow}{when} dgwb   => output := X"2";
04718            \textcolor{keywordflow}{when} dgrb   => output := X"3";
04719            \textcolor{keywordflow}{when} proc   => output := X"4";
04720            \textcolor{keywordflow}{when} setup  => output := X"5";
04721            \textcolor{keywordflow}{when} iram   => output := X"6";
04722 
04723            \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} =>
04724                  output := X"7";
04725                  \textcolor{keywordflow}{report} regs_report_prefix & \textcolor{keyword}{"unknown active\_block seen in encode\_active\_block function"} \textcolor{keywordflow}{
      severity} failure;
04726 
04727         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
04728 
04729         \textcolor{keywordflow}{return} output;
04730 
04731     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04732 
04733 \textcolor{keyword}{--}
04734 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{ddr2\_phy\_alt\_mem\_phy\_regs\_pkg};
04735 \textcolor{keyword}{--}
04736 
04737 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
04738 \textcolor{keyword}{--  Abstract        : mmi block for the non-levelling AFI PHY sequencer}
04739 \textcolor{keyword}{--                    This is an optional block with an Avalon interface and status}
04740 \textcolor{keyword}{--                    register instantiations to enhance the debug capabilities of}
04741 \textcolor{keyword}{--                    the sequencer. The format of the block is:}
04742 \textcolor{keyword}{--                    a) an Avalon interface which supports different avalon and}
04743 \textcolor{keyword}{--                       sequencer clock sources}
04744 \textcolor{keyword}{--                    b) mmi status registers (which hold information about the}
04745 \textcolor{keyword}{--                       successof the calibration)}
04746 \textcolor{keyword}{--                    c) a read interface to the iram to enable debug through the}
04747 \textcolor{keyword}{--                       avalon interface.}
04748 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
04749 
04750 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
04751 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
04752 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
04753 
04754 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
04755 
04756 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
04757 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
04758 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
04759 \textcolor{keyword}{--}
04760 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
04761 
04762 \textcolor{keyword}{--}
04763 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_mmi \textcolor{keywordflow}{is}
04764     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
04765 \textcolor{keyword}{        -- physical interface width definitions}
04766         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04767         \textcolor{vhdlchar}{MEM_IF_DWIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04768         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04769         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04770         \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04771         \textcolor{vhdlchar}{DWIDTH_RATIO}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04772         \textcolor{vhdlchar}{CLOCK_INDEX_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04773         \textcolor{vhdlchar}{MEM_IF_CLK_PAIR_COUNT}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04774         \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04775         \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04776         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04777         \textcolor{vhdlchar}{ADV_LAT_WIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04778         \textcolor{vhdlchar}{RESYNCHRONISE_AVALON_DBG}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04779         \textcolor{vhdlchar}{AV_IF_ADDR_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04780         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
04781 
04782 \textcolor{keyword}{        -- setup / algorithm information}
04783         \textcolor{vhdlchar}{NOM_DQS_PHASE_SETTING}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04784         \textcolor{vhdlchar}{SCAN_CLK_DIVIDE_BY}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04785         \textcolor{vhdlchar}{RDP_ADDR_WIDTH}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04786         \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04787         \textcolor{vhdlchar}{IOE_PHASES_PER_TCK}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04788         \textcolor{vhdlchar}{IOE_DELAYS_PER_PHS}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04789         \textcolor{vhdlchar}{MEM_IF_CLK_PS}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04790 
04791 \textcolor{keyword}{        -- initial mode register settings}
04792         \textcolor{vhdlchar}{PHY_DEF_MR_1ST}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04793         \textcolor{vhdlchar}{PHY_DEF_MR_2ND}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04794         \textcolor{vhdlchar}{PHY_DEF_MR_3RD}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04795         \textcolor{vhdlchar}{PHY_DEF_MR_4TH}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04796 
04797         \textcolor{vhdlchar}{PRESET_RLAT}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{  -- read latency preset value}
04798         \textcolor{vhdlchar}{CAPABILITIES}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{  -- sequencer capabilities flags}
04799 
04800         \textcolor{vhdlchar}{USE_IRAM}                       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- RFU}
04801 
04802         \textcolor{vhdlchar}{IRAM_AWIDTH}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04803         \textcolor{vhdlchar}{TRACKING_INTERVAL_IN_MS}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
04804 
04805         \textcolor{vhdlchar}{READ_LAT_WIDTH}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
04806     \textcolor{vhdlchar}{)};
04807     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
04808 \textcolor{keyword}{        -- clk / reset}
04809         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04810         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04811 
04812 \textcolor{keyword}{        --synchronous Avalon debug interface  (internally re-synchronised to input clock)}
04813         \textcolor{vhdlchar}{dbg_seq_clk}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04814         \textcolor{vhdlchar}{dbg_seq_rst_n}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04815         \textcolor{vhdlchar}{dbg_seq_addr}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{AV_IF_ADDR_WIDTH} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04816         \textcolor{vhdlchar}{dbg_seq_wr}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04817         \textcolor{vhdlchar}{dbg_seq_rd}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04818         \textcolor{vhdlchar}{dbg_seq_cs}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04819         \textcolor{vhdlchar}{dbg_seq_wr_data}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04820         \textcolor{vhdlchar}{seq_dbg_rd_data}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04821         \textcolor{vhdlchar}{seq_dbg_waitrequest}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
04822 
04823 \textcolor{keyword}{        -- mmi to admin interface}
04824         regs\_admin\_ctrl                : \textcolor{keywordflow}{out}  t\_admin\_ctrl;
04825         \textcolor{vhdlchar}{admin_regs_status}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}   \textcolor{vhdlchar}{t_admin_stat};
04826         \textcolor{vhdlchar}{trefi_failure}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04827 
04828 \textcolor{keyword}{        -- mmi to iram interface}
04829         \textcolor{vhdlchar}{mmi_iram}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}  \textcolor{vhdlchar}{t_iram_ctrl};
04830         \textcolor{vhdlchar}{mmi_iram_enable_writes}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}  \textcolor{comment}{std\_logic};
04831 
04832         \textcolor{vhdlchar}{iram_status}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}   \textcolor{vhdlchar}{t_iram_stat};
04833 
04834 \textcolor{keyword}{        -- mmi to control interface}
04835         \textcolor{vhdlchar}{mmi_ctrl}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_mmi_ctrl};
04836         \textcolor{vhdlchar}{ctrl_mmi}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_mmi};
04837         \textcolor{vhdlchar}{int_ac_1t}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
04838         \textcolor{vhdlchar}{invert_ac_1t}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
04839 
04840 \textcolor{keyword}{        -- global parameterisation record}
04841         \textcolor{vhdlchar}{parameterisation_rec}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_algm_paramaterisation};
04842 
04843 \textcolor{keyword}{        -- mmi pll interface}
04844         \textcolor{vhdlchar}{pll_mmi}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_pll_mmi};
04845         \textcolor{vhdlchar}{mmi_pll}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_mmi_pll_reconfig};
04846 
04847 \textcolor{keyword}{        -- codvw status signals}
04848         \textcolor{vhdlchar}{dgrb_mmi}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_dgrb_mmi}
04849     \textcolor{vhdlchar}{)};
04850 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
04851 
04852 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
04853 
04854 \textcolor{keyword}{-- The registers package (alt\_mem\_phy\_regs\_pkg) is used to combine the definition of the}
04855 \textcolor{keyword}{-- registers for the mmi status registers and functions/procedures applied to the registers}
04856 \textcolor{keyword}{--}
04857 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_regs_pkg.\textcolor{keywordflow}{all};
04858 
04859 \textcolor{keyword}{-- The iram address package (alt\_mem\_phy\_iram\_addr\_pkg) is used to define the base addresses used}
04860 \textcolor{keyword}{-- for iram writes during calibration}
04861 \textcolor{keyword}{--}
04862 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_iram_addr_pkg.\textcolor{keywordflow}{all};
04863 
04864 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
04865 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
04866 \textcolor{keyword}{-- instances generics are used)}
04867 \textcolor{keyword}{--}
04868 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
04869 
04870 \textcolor{keyword}{--}
04871 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_mmi IS
04872 
04873 \textcolor{keyword}{    -- maximum function}
04874     \textcolor{keywordflow}{function} max (a, b : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
04875 \textcolor{vhdlkeyword}{    begin}
04876         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{a} \textcolor{vhdlchar}{>} \textcolor{vhdlchar}{b} \textcolor{keywordflow}{then}
04877             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{a};
04878         \textcolor{keywordflow}{else}
04879             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{b};
04880         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04881     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
04882 
04883 \textcolor{keyword}{-- -------------------------------------------}
04884 \textcolor{keyword}{-- constant definitions}
04885 \textcolor{keyword}{-- -------------------------------------------}
04886 
04887     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_360_sweeps}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rrp\_pll\_phase\_mult}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}\textcolor{vhdlchar}{)};
04888 
04889     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_response_lat}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                       \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
04890     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_codeword}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c\_mmi\_access\_codeword};
04891     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_int_iram_start_size}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{max}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      IRAM_AWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)};
04892 
04893 \textcolor{keyword}{    -- enable for ctrl state machine states}
04894     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_slv_hl_stage_enable}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}                    \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{CAPABILITIES}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
04895     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_stage_enable}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_ccs\_num\_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{
      c_slv_hl_stage_enable}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_ccs\_num\_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04896 
04897 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
04898 \textcolor{keyword}{--}
04899     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{mmi_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (mmi) : "};
04900 
04901 \textcolor{keyword}{-- --------------------------------------------}
04902 \textcolor{keyword}{-- internal signals}
04903 \textcolor{keyword}{-- --------------------------------------------}
04904 
04905 \textcolor{keyword}{    -- internal clock domain register interface signals}
04906     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_wdata}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}                 \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04907     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_rdata}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}                 \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04908     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_address}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{AV_IF_ADDR_WIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
04909     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_read}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04910     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_cs}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04911     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_write}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04912     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{waitreq_int}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04913 
04914 \textcolor{keyword}{    -- register storage}
04915 \textcolor{keyword}{    -- contains:}
04916 \textcolor{keyword}{       --  read only (ro\_regs)}
04917 \textcolor{keyword}{       -- read/write (rw\_regs)}
04918 \textcolor{keyword}{       -- enable\_writes flag}
04919     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_regs}                   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_mmi\_regs} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
04920     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_rw_regs_initialised}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04921 
04922 \textcolor{keyword}{    -- this counter ensures that the mmi waits for c\_response\_lat clocks before}
04923 \textcolor{keyword}{    -- responding to a new Avalon request}
04924     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{waitreq_count}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{15};
04925     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{waitreq_count_is_zero}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04926 
04927 \textcolor{keyword}{    -- register error signals}
04928     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ac_1t_r}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04929     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{trefi_failure_r}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04930 
04931 \textcolor{keyword}{    -- iram ready - calibration complete and USE\_IRAM high}
04932     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_ready}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04933 
04934 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
04935 
04936 \textcolor{keyword}{   -- the following signals are reserved for future use}
04937     \textcolor{vhdlchar}{invert_ac_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04938 
04939 
04940 \textcolor{keyword}{-- --------------------------------------------------------------}
04941 \textcolor{keyword}{-- generate for synchronous avalon interface}
04942 \textcolor{keyword}{-- --------------------------------------------------------------}
04943     \textcolor{vhdlchar}{simply\_registered\_avalon} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{RESYNCHRONISE_AVALON_DBG} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{generate}
04944 \textcolor{vhdlkeyword}{    begin}
04945 
04946         \textcolor{keywordflow}{process} (rst_n, clk)
04947 \textcolor{vhdlkeyword}{        begin}
04948             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
04949                 \textcolor{vhdlchar}{int_wdata}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04950                 \textcolor{vhdlchar}{int_address}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
04951                 \textcolor{vhdlchar}{int_read}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04952                 \textcolor{vhdlchar}{int_write}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04953                 \textcolor{vhdlchar}{int_cs}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
04954             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
04955                 \textcolor{vhdlchar}{int_wdata}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_wr_data};
04956                 \textcolor{vhdlchar}{int_address}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_addr};
04957                 \textcolor{vhdlchar}{int_read}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_rd};
04958                 \textcolor{vhdlchar}{int_write}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_wr};
04959                 \textcolor{vhdlchar}{int_cs}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_cs};
04960             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
04961         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
04962 
04963         \textcolor{vhdlchar}{seq_dbg_rd_data}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_rdata};
04964         \textcolor{vhdlchar}{seq_dbg_waitrequest} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{waitreq_int} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dbg_seq_rd} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{dbg_seq_wr}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      dbg_seq_cs};
04965 
04966     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate} \textcolor{vhdlchar}{simply\_registered\_avalon};
04967 
04968 \textcolor{keyword}{-- --------------------------------------------------------------}
04969 \textcolor{keyword}{-- clock domain crossing for asynchronous mmi interface}
04970 \textcolor{keyword}{-- --------------------------------------------------------------}
04971     \textcolor{vhdlchar}{re\_synchronise\_avalon} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{RESYNCHRONISE_AVALON_DBG} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{generate}
04972 
04973 \textcolor{keyword}{        --clock domain crossing signals}
04974         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04975         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_ack}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04976         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04977         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_ack}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04978         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_rd_data}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dbg_seq_wr_data}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
04979 
04980         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_ack_t}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04981         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_ack_2t}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04982         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_ack_3t}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04983         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_t}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04984         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_2t}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04985         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_cmd_done_3t}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04986 
04987         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_t}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04988         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_2t}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04989         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_3t}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04990         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_ack_t}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04991         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_ack_2t}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04992         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ccd_new_cmd_ack_3t}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04993 
04994         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cmd_pending}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04995 
04996         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_clk_waitreq_int} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
04997 
04998 \textcolor{vhdlkeyword}{    begin}
04999 
05000         \textcolor{keywordflow}{process} (rst_n, clk)
05001 \textcolor{vhdlkeyword}{        begin}
05002             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05003                 \textcolor{vhdlchar}{int_wdata}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05004                 \textcolor{vhdlchar}{int_address}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05005                 \textcolor{vhdlchar}{int_read}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05006                 \textcolor{vhdlchar}{int_write}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05007                 \textcolor{vhdlchar}{int_cs}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05008                 \textcolor{vhdlchar}{ccd_new_cmd_ack}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05009                 \textcolor{vhdlchar}{ccd_new_cmd_t}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05010                 \textcolor{vhdlchar}{ccd_new_cmd_2t}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05011                 \textcolor{vhdlchar}{ccd_new_cmd_3t}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05012             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05013 
05014                 \textcolor{vhdlchar}{ccd_new_cmd_t}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd};
05015                 \textcolor{vhdlchar}{ccd_new_cmd_2t}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd_t};
05016                 \textcolor{vhdlchar}{ccd_new_cmd_3t}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd_2t};
05017 
05018                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ccd_new_cmd_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_new_cmd_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05019                     \textcolor{vhdlchar}{int_wdata}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_wr_data};
05020                     \textcolor{vhdlchar}{int_address}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_addr};
05021                     \textcolor{vhdlchar}{int_read}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_rd};
05022                     \textcolor{vhdlchar}{int_write}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dbg_seq_wr};
05023                     \textcolor{vhdlchar}{int_cs}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05024                     \textcolor{vhdlchar}{ccd_new_cmd_ack}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05025 
05026                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ccd_new_cmd_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_new_cmd_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05027                     \textcolor{vhdlchar}{ccd_new_cmd_ack}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05028                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05029 
05030                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{int_cs} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{waitreq_int}\textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05031                     \textcolor{vhdlchar}{int_cs}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05032                     \textcolor{vhdlchar}{int_read}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05033                     \textcolor{vhdlchar}{int_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05034                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05035             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05036 
05037         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05038 
05039 \textcolor{keyword}{        -- process to generate new cmd}
05040         \textcolor{keywordflow}{process} (dbg_seq_rst_n, dbg_seq_clk)
05041 \textcolor{vhdlkeyword}{        begin}
05042             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dbg_seq_rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05043                 \textcolor{vhdlchar}{ccd_new_cmd}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05044                 \textcolor{vhdlchar}{ccd_new_cmd_ack_t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05045                 \textcolor{vhdlchar}{ccd_new_cmd_ack_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05046                 \textcolor{vhdlchar}{ccd_new_cmd_ack_3t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05047                 \textcolor{vhdlchar}{cmd_pending}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05048             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dbg_seq_clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05049 
05050                 \textcolor{vhdlchar}{ccd_new_cmd_ack_t}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd_ack};
05051                 \textcolor{vhdlchar}{ccd_new_cmd_ack_2t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd_ack_t};
05052                 \textcolor{vhdlchar}{ccd_new_cmd_ack_3t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_new_cmd_ack_2t};
05053 
05054                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ccd_new_cmd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dbg_seq_cs} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}  \textcolor{keywordflow}{and} \textcolor{vhdlchar}{cmd_pending} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05055                     \textcolor{vhdlchar}{ccd_new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05056                     \textcolor{vhdlchar}{cmd_pending} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05057                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ccd_new_cmd_ack_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_new_cmd_ack_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05058                     \textcolor{vhdlchar}{ccd_new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05059                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05060 
05061 \textcolor{keyword}{                -- use falling edge of cmd\_done}
05062                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cmd_pending} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_cmd_done_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      ccd_cmd_done_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05063                     \textcolor{vhdlchar}{cmd_pending} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05064                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05065             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05066         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05067 
05068 
05069 \textcolor{keyword}{        -- process to take read data back and transfer it across the clock domains}
05070         \textcolor{keywordflow}{process} (rst_n, clk)
05071 \textcolor{vhdlkeyword}{        begin}
05072             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05073                 \textcolor{vhdlchar}{ccd_cmd_done}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05074                 \textcolor{vhdlchar}{ccd_rd_data}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05075                 \textcolor{vhdlchar}{ccd_cmd_done_ack_3t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05076                 \textcolor{vhdlchar}{ccd_cmd_done_ack_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05077                 \textcolor{vhdlchar}{ccd_cmd_done_ack_t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05078 
05079             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05080 
05081                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ccd_cmd_done_ack_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_cmd_done_ack_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05082                     \textcolor{vhdlchar}{ccd_cmd_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05083                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{waitreq_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05084                     \textcolor{vhdlchar}{ccd_cmd_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05085                     \textcolor{vhdlchar}{ccd_rd_data}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_rdata};
05086                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05087 
05088                 \textcolor{vhdlchar}{ccd_cmd_done_ack_3t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done_ack_2t};
05089                 \textcolor{vhdlchar}{ccd_cmd_done_ack_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done_ack_t};
05090                 \textcolor{vhdlchar}{ccd_cmd_done_ack_t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done_ack};
05091             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05092         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05093 
05094 
05095         \textcolor{keywordflow}{process} (dbg_seq_rst_n, dbg_seq_clk)
05096 \textcolor{vhdlkeyword}{        begin}
05097             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dbg_seq_rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05098                 \textcolor{vhdlchar}{ccd_cmd_done_ack}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05099                 \textcolor{vhdlchar}{ccd_cmd_done_3t}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05100                 \textcolor{vhdlchar}{ccd_cmd_done_2t}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05101                 \textcolor{vhdlchar}{ccd_cmd_done_t}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05102                 \textcolor{vhdlchar}{seq_dbg_rd_data}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05103                 \textcolor{vhdlchar}{seq_clk_waitreq_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05104 
05105             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dbg_seq_clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05106                 \textcolor{vhdlchar}{seq_clk_waitreq_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05107 
05108                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ccd_cmd_done_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_cmd_done_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05109                     \textcolor{vhdlchar}{seq_clk_waitreq_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05110                     \textcolor{vhdlchar}{ccd_cmd_done_ack}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05111                     \textcolor{vhdlchar}{seq_dbg_rd_data}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_rd_data};\textcolor{keyword}{  -- if read}
05112                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ccd_cmd_done_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ccd_cmd_done_3t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05113                     \textcolor{vhdlchar}{ccd_cmd_done_ack}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05114                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05115 
05116                 \textcolor{vhdlchar}{ccd_cmd_done_3t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done_2t};
05117                 \textcolor{vhdlchar}{ccd_cmd_done_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done_t};
05118                 \textcolor{vhdlchar}{ccd_cmd_done_t}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ccd_cmd_done};
05119             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05120         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05121 
05122         \textcolor{vhdlchar}{seq_dbg_waitrequest} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_clk_waitreq_int} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dbg_seq_rd} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{dbg_seq_wr}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      dbg_seq_cs};
05123 
05124     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate} \textcolor{vhdlchar}{re\_synchronise\_avalon};
05125 
05126 
05127 \textcolor{keyword}{    -- register some inputs for speed.}
05128     \textcolor{keywordflow}{process} (rst_n, clk)
05129 \textcolor{vhdlkeyword}{    begin}
05130         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05131             \textcolor{vhdlchar}{int_ac_1t_r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05132             \textcolor{vhdlchar}{trefi_failure_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05133         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05134             \textcolor{vhdlchar}{int_ac_1t_r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ac_1t};
05135             \textcolor{vhdlchar}{trefi_failure_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{trefi_failure};
05136         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05137     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05138 
05139 \textcolor{keyword}{    -- mmi not able to write to iram in current instance of mmi block}
05140     \textcolor{vhdlchar}{mmi_iram_enable_writes} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05141 
05142 \textcolor{keyword}{    -- check if iram ready}
05143     \textcolor{keywordflow}{process} (rst_n, clk)
05144 \textcolor{vhdlkeyword}{    begin}
05145         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05146             \textcolor{vhdlchar}{iram_ready} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05147         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05148             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{USE_IRAM} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05149                 \textcolor{vhdlchar}{iram_ready} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05150             \textcolor{keywordflow}{else}
05151                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_success} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctrl_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_calibration_fail} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05152                     \textcolor{vhdlchar}{iram_ready} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05153                 \textcolor{keywordflow}{else}
05154                     \textcolor{vhdlchar}{iram_ready} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05155                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05156             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05157         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05158     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05159 
05160 \textcolor{keyword}{-- --------------------------------------------------------------}
05161 \textcolor{keyword}{--  single registered process for mmi access.}
05162 \textcolor{keyword}{-- --------------------------------------------------------------}
05163     \textcolor{keywordflow}{process} (rst_n, clk)
05164         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mmi\_regs} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_mmi\_regs};
05165 \textcolor{vhdlkeyword}{    begin}
05166         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05167 
05168             \textcolor{vhdlchar}{mmi_regs}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
05169             \textcolor{vhdlchar}{mmi_rw_regs_initialised} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05170 
05171 \textcolor{keyword}{            -- this register records whether the c\_codeword has been written to address 0x0001}
05172 \textcolor{keyword}{            -- once it has, then other writes are accepted.}
05173             \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{enable\_writes} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05174 
05175             \textcolor{vhdlchar}{int_rdata}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05176             \textcolor{vhdlchar}{waitreq_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05177 
05178 \textcolor{keyword}{            -- clear wait request counter}
05179             \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05180             \textcolor{vhdlchar}{waitreq_count_is_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05181 
05182 \textcolor{keyword}{            -- iram interface defaults}
05183             \textcolor{vhdlchar}{mmi_iram} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
05184 
05185         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05186 \textcolor{keyword}{            -- default assignment}
05187             \textcolor{vhdlchar}{waitreq_int} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05188 
05189             \textcolor{vhdlchar}{write\_clear}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
05190 
05191 \textcolor{keyword}{            -- only initialise rw\_regs once after hard reset}
05192             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_rw_regs_initialised} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05193 
05194                 \textcolor{vhdlchar}{mmi_rw_regs_initialised} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05195 
05196 \textcolor{keyword}{                --reset all read/write regs and read path ouput registers and apply default MRS Settings.}
05197                 \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{PHY_DEF_MR_1ST}\textcolor{vhdlchar}{,}
05198                                              \textcolor{vhdlchar}{PHY_DEF_MR_2ND}\textcolor{vhdlchar}{,}
05199                                              \textcolor{vhdlchar}{PHY_DEF_MR_3RD}\textcolor{vhdlchar}{,}
05200                                              \textcolor{vhdlchar}{PHY_DEF_MR_4TH}\textcolor{vhdlchar}{,}
05201                                              \textcolor{vhdlchar}{NOM_DQS_PHASE_SETTING}\textcolor{vhdlchar}{,}
05202                                              \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,}
05203                                              \textcolor{vhdlchar}{c_pll_360_sweeps}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- number of times 360 degrees is swept}
05204                                              \textcolor{vhdlchar}{TRACKING_INTERVAL_IN_MS}\textcolor{vhdlchar}{,}
05205                                              \textcolor{vhdlchar}{c_hl_stage_enable}\textcolor{vhdlchar}{)};
05206 
05207             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05208 
05209 \textcolor{keyword}{            -- bit packing input data structures into the ro\_regs structure, for reading}
05210             \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ro\_regs}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{,}
05211                                           \textcolor{vhdlchar}{ctrl_mmi}\textcolor{vhdlchar}{,}
05212                                           \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{,}
05213                                           \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_if\_test}\textcolor{vhdlchar}{,}
05214                                           \textcolor{vhdlchar}{USE_IRAM}\textcolor{vhdlchar}{,}
05215                                           \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}\textcolor{vhdlchar}{,}
05216                                           \textcolor{vhdlchar}{int_ac_1t_r}\textcolor{vhdlchar}{,}
05217                                           \textcolor{vhdlchar}{trefi_failure_r}\textcolor{vhdlchar}{,}
05218                                           \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{,}
05219                                           \textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{)};
05220 
05221 \textcolor{keyword}{            -- write has priority over read}
05222             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{int_write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{int_cs} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{waitreq_count_is_zero} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      waitreq_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05223 
05224 \textcolor{keyword}{                -- mmi local register write}
05225                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
05226 
05227                     \textcolor{vhdlchar}{v\_mmi\_regs} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_regs};
05228 
05229                     \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      int_wdata}\textcolor{vhdlchar}{)};
05230 
05231                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{enable\_writes} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05232                         \textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_hl\_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_hl_stage_enable} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{v\_mmi\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      rw\_hl\_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css};
05233                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05234 
05235                     \textcolor{vhdlchar}{mmi_regs} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_mmi\_regs};
05236 
05237 \textcolor{keyword}{                    -- handshake for safe transactions}
05238                     \textcolor{vhdlchar}{waitreq_int}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05239                     \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_response_lat};
05240 
05241 \textcolor{keyword}{                -- iram write just handshake back (no write supported)}
05242                 \textcolor{keywordflow}{else}
05243 
05244                     \textcolor{vhdlchar}{waitreq_int}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05245                     \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_response_lat};
05246 
05247                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05248 
05249             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{int_read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{int_cs} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{waitreq_count_is_zero} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      waitreq_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05250 
05251 \textcolor{keyword}{                -- mmi local register read}
05252                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
05253 
05254                     \textcolor{vhdlchar}{int_rdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
05255 
05256                     \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_response_lat};
05257                     \textcolor{vhdlchar}{waitreq_int}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- acknowledge read command regardless.}
05258 
05259 
05260 \textcolor{keyword}{                -- iram being addressed}
05261                 \textcolor{keywordflow}{elsif}     \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{
      c_int_iram_start_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}
05262                       \textcolor{keywordflow}{and} \textcolor{vhdlchar}{iram_ready} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}
05263                       \textcolor{keywordflow}{then}
05264                     \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05265                     \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_address}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      IRAM_AWIDTH} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
05266 
05267                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05268                         \textcolor{vhdlchar}{waitreq_int}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05269                         \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05270                         \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_response_lat};
05271                         \textcolor{vhdlchar}{int_rdata}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata};
05272                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05273 
05274                 \textcolor{keywordflow}{else}\textcolor{keyword}{ -- respond and keep the interface from hanging}
05275                     \textcolor{vhdlchar}{int_rdata}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{keyword}{"DEADBEEF"};
05276                     \textcolor{vhdlchar}{waitreq_int}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05277                     \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_response_lat};
05278 
05279                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05280 
05281             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
05282                 \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
05283 
05284 \textcolor{keyword}{                -- if performing a write, set back to defaults.  If not, default anyway}
05285                 \textcolor{vhdlchar}{mmi_iram} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
05286 
05287             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05288 
05289             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{waitreq_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
05290                 \textcolor{vhdlchar}{waitreq_count_is_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{   -- as it will be next clock cycle}
05291             \textcolor{keywordflow}{else}
05292                 \textcolor{vhdlchar}{waitreq_count_is_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05293             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05294 
05295 \textcolor{keyword}{            -- supply iram read data when ready}
05296             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05297                 \textcolor{vhdlchar}{int_rdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata};
05298             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05299 
05300         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05301 
05302     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05303 
05304 \textcolor{keyword}{    -- pack the registers into the output data structures}
05305     regs\_admin\_ctrl                  <= pack\_record(mmi\_regs.rw\_regs);
05306     \textcolor{vhdlchar}{parameterisation_rec}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
05307     \textcolor{vhdlchar}{mmi_pll}                          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
05308     \textcolor{vhdlchar}{mmi_ctrl}                         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
05309 
05310 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
05311 \textcolor{keyword}{--}
05312 
05313 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
05314 \textcolor{keyword}{--  Abstract        : admin block for the non-levelling AFI PHY sequencer}
05315 \textcolor{keyword}{--                    The admin block supports the autonomy of the sequencer from}
05316 \textcolor{keyword}{--                    the memory interface controller. In this task admin handles}
05317 \textcolor{keyword}{--                    memory initialisation (incl. the setting of mode registers)}
05318 \textcolor{keyword}{--                    and memory refresh, bank activation and pre-charge commands}
05319 \textcolor{keyword}{--                    (during memory interface calibration). Once calibration is}
05320 \textcolor{keyword}{--                    complete admin is 'idle' and control of the memory device is}
05321 \textcolor{keyword}{--                    passed to the users chosen memory interface controller. The}
05322 \textcolor{keyword}{--                    supported memory types are exclusively DDR, DDR2 and DDR3.}
05323 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
05324 
05325 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
05326 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
05327 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
05328 
05329 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
05330 
05331 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
05332 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
05333 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
05334 \textcolor{keyword}{--}
05335 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
05336 
05337 \textcolor{keyword}{-- The address and command package (alt\_mem\_phy\_addr\_cmd\_pkg) is used to combine DRAM address}
05338 \textcolor{keyword}{-- and command signals in one record and unify the functions operating on this record.}
05339 \textcolor{keyword}{--}
05340 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_addr_cmd_pkg.\textcolor{keywordflow}{all};
05341 
05342 \textcolor{keyword}{--}
05343 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_admin \textcolor{keywordflow}{is}
05344     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
05345 \textcolor{keyword}{        -- physical interface width definitions}
05346         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05347         \textcolor{vhdlchar}{MEM_IF_DWIDTH}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05348         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05349         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05350         \textcolor{vhdlchar}{DWIDTH_RATIO}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05351         \textcolor{vhdlchar}{CLOCK_INDEX_WIDTH}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05352         \textcolor{vhdlchar}{MEM_IF_CLK_PAIR_COUNT} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05353         \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05354         \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05355         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05356         \textcolor{vhdlchar}{ADV_LAT_WIDTH}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05357         \textcolor{vhdlchar}{MEM_IF_DQSN_EN}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05358         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}        \textcolor{vhdlchar}{:} \textcolor{comment}{string};
05359 
05360 \textcolor{keyword}{        -- calibration address information}
05361         \textcolor{vhdlchar}{MEM_IF_CAL_BANK}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- Bank to which calibration data is written}
05362         \textcolor{vhdlchar}{MEM_IF_CAL_BASE_ROW}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05363 
05364         \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05365         \textcolor{vhdlchar}{NON_OP_EVAL_MD}              \textcolor{vhdlchar}{:} \textcolor{comment}{string};\textcolor{keyword}{  -- non\_operational evaluation mode (used when
       GENERATE\_ADDITIONAL\_DBG\_RTL = 1)}
05366 
05367 \textcolor{keyword}{        -- timing parameters}
05368         \textcolor{vhdlchar}{MEM_IF_CLK_PS}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
05369         \textcolor{vhdlchar}{TINIT_TCK}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{  -- initial delay}
05370         \textcolor{vhdlchar}{TINIT_RST}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural}\textcolor{keyword}{   -- used for DDR3 device support}
05371     \textcolor{vhdlchar}{)};
05372     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
05373 \textcolor{keyword}{        -- clk / reset}
05374         \textcolor{vhdlchar}{clk}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic};
05375         \textcolor{vhdlchar}{rst_n}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic};
05376 
05377 \textcolor{keyword}{        -- the 2 signals below are unused for non-levelled sequencer (maintained for equivalent interface
       to levelled sequencer)}
05378         \textcolor{vhdlchar}{mem_ac_swapped_ranks}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}                     \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
05379         \textcolor{vhdlchar}{ctl_cal_byte_lanes}    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}  \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
05380 
05381 \textcolor{keyword}{        -- addr/cmd interface}
05382         \textcolor{vhdlchar}{seq_ac}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
05383         \textcolor{vhdlchar}{seq_ac_sel}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
05384 
05385 \textcolor{keyword}{        -- determined from MR settings}
05386         enable\_odt            : \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
05387 
05388 \textcolor{keyword}{        -- interface to the mmi block}
05389         regs\_admin\_ctrl\_rec   : \textcolor{keywordflow}{in}  t\_admin\_ctrl;
05390         \textcolor{vhdlchar}{admin_regs_status_rec} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{vhdlchar}{t_admin_stat};
05391         \textcolor{vhdlchar}{trefi_failure}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
05392 
05393 \textcolor{keyword}{        -- interface to the ctrl block}
05394         \textcolor{vhdlchar}{ctrl_admin}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{vhdlchar}{t_ctrl_command};
05395         \textcolor{vhdlchar}{admin_ctrl}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{vhdlchar}{t_ctrl_stat};
05396 
05397 \textcolor{keyword}{        -- interface with dgrb/dgwb blocks}
05398         \textcolor{vhdlchar}{ac_access_req}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic};
05399         \textcolor{vhdlchar}{ac_access_gnt}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
05400 
05401 \textcolor{keyword}{        -- calibration status signals (from ctrl block)}
05402         \textcolor{vhdlchar}{cal_fail}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic};
05403         \textcolor{vhdlchar}{cal_success}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}  \textcolor{comment}{std\_logic};
05404 
05405 \textcolor{keyword}{        -- recalibrate request issued}
05406         \textcolor{vhdlchar}{ctl_recalibrate_req}   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
05407 
05408     \textcolor{vhdlchar}{)};
05409 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
05410 
05411 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
05412 
05413 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
05414 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
05415 \textcolor{keyword}{-- instances generics are used)}
05416 \textcolor{keyword}{--}
05417 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
05418 
05419 \textcolor{keyword}{--}
05420 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_admin is
05421 
05422     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_mode_reg_index}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12};
05423 
05424 \textcolor{keyword}{    -- timing below is safe for range 80-400MHz operation - taken from worst case DDR2 (JEDEC JESD79-2E) /
       DDR3 (JESD79-3B)}
05425 \textcolor{keyword}{    -- Note: timings account for worst case use for both full rate and half rate ALTMEMPHY interfaces}
05426     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_init_prech_delay}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{162};\textcolor{keyword}{  -- precharge delay (360ns = tRFC+10ns) (TXPR
       for DDR3)}
05427     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_trp_in_clks}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{    -- set equal to trp / tck (trp = 15ns)}
05428     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_tmrd_in_clks}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{    -- maximum 4 clock cycles (DDR3)}
05429     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_tmod_in_clks}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{    -- ODT update from MRS command (tmod = 12ns
       (DDR2))}
05430 
05431     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_trrd_min_in_clks}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{    -- minimum clk cycles between bank activate
       cmds (10ns)}
05432     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_trcd_min_in_clks}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{    -- minimum bank activate to read/write cmd
       (15ns)}
05433 
05434 \textcolor{keyword}{        -- the 2 constants below are parameterised to MEM\_IF\_CLK\_PS due to the large range of possible
       clock frequency}
05435     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_trfc_min_in_clks}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{350000}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{MEM_IF_CLK_PS}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};\textcolor{keyword}{  -- refresh-refresh timing (worst case trfc = 350 ns (DDR3))}
05436     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_trefi_min_in_clks}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3900000}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{MEM_IF_CLK_PS}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};\textcolor{keyword}{ -- average refresh interval worst case trefi = 3.9 us (industrial grade devices)}
05437 
05438     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_num_stacked_refreshes} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{   -- max no. of stacked refreshes allowed}
05439     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_wait_value}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};\textcolor{keyword}{   -- delay before moving from s\_idle to
       s\_refresh\_state}
05440 
05441 \textcolor{keyword}{    -- DDR3 specific:}
05442     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_zq_init_duration_clks}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{514};\textcolor{keyword}{  -- full rate (worst case) cycle count for tZQCL
       init}
05443     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_tzqcs}                     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{66};\textcolor{keyword}{   -- number of full rate clock cycles}
05444 
05445 \textcolor{keyword}{    -- below is a record which is used to parameterise the address and command signals (addr\_cmd) used in
       this block}
05446     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_seq_addr_cmd_config}       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_config_rec} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_config\_rec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_ADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
05447 
05448 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
05449 \textcolor{keyword}{--}
05450     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{admin_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (admin) : "};
05451 
05452 \textcolor{keyword}{    -- state type for admin\_state (main state machine of admin block)}
05453     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_admin_state} \textcolor{keywordflow}{is}
05454     \textcolor{vhdlchar}{(}
05455         \textcolor{vhdlchar}{s\_reset}\textcolor{vhdlchar}{,}\textcolor{keyword}{                -- reset state}
05456         \textcolor{vhdlchar}{s\_run\_init\_seq}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- run the initialisation sequence (up to but not including MR setting)}
05457         \textcolor{vhdlchar}{s\_program\_cal\_mrs}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- program the mode registers ready for calibration (this is the user
       settings}
05458 \textcolor{keyword}{                                -- with some overloads and extra init functionality)}
05459 
05460         \textcolor{vhdlchar}{s\_idle}\textcolor{vhdlchar}{,}\textcolor{keyword}{                 -- idle (i.e. maintaining refresh to max)}
05461 
05462         \textcolor{vhdlchar}{s\_topup\_refresh}\textcolor{vhdlchar}{,}\textcolor{keyword}{        -- make sure refreshes are maxed out before going on.}
05463         \textcolor{vhdlchar}{s\_topup\_refresh\_done}\textcolor{vhdlchar}{,}\textcolor{keyword}{   -- wait for tRFC after refresh command}
05464 
05465         \textcolor{vhdlchar}{s\_zq\_cal\_short}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- ZQCAL short command (issued prior to activate) - DDR3 only}
05466 
05467         \textcolor{vhdlchar}{s\_access\_act}\textcolor{vhdlchar}{,}\textcolor{keyword}{           -- activate}
05468         \textcolor{vhdlchar}{s\_access}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- dgrb, dgwb accesses,}
05469         \textcolor{vhdlchar}{s\_access\_precharge}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- precharge all memory banks}
05470 
05471         \textcolor{vhdlchar}{s\_prog\_user\_mrs}\textcolor{vhdlchar}{,}\textcolor{keyword}{        -- program user mode register settings}
05472 
05473         \textcolor{vhdlchar}{s\_dummy\_wait}\textcolor{vhdlchar}{,}\textcolor{keyword}{           -- wait before going to s\_refresh state}
05474         \textcolor{vhdlchar}{s\_refresh}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- issue a memory refresh command}
05475         \textcolor{vhdlchar}{s\_refresh\_done}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- wait for trfc after refresh command}
05476         \textcolor{vhdlchar}{s\_non\_operational}\textcolor{keyword}{       -- special debug state to toggle interface if calibration fails}
05477     \textcolor{vhdlchar}{)};
05478 
05479     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_admin_state};\textcolor{keyword}{ -- admin block state machine}
05480 
05481 \textcolor{keyword}{    -- state type for ac\_state}
05482     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ac_state}  \textcolor{keywordflow}{is}
05483     \textcolor{vhdlchar}{(}   \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{,}
05484         \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{,}
05485         \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{,}
05486         \textcolor{vhdlchar}{s\_3} \textcolor{vhdlchar}{,}
05487         \textcolor{vhdlchar}{s\_4} \textcolor{vhdlchar}{,}
05488         \textcolor{vhdlchar}{s\_5} \textcolor{vhdlchar}{,}
05489         \textcolor{vhdlchar}{s\_6} \textcolor{vhdlchar}{,}
05490         \textcolor{vhdlchar}{s\_7} \textcolor{vhdlchar}{,}
05491         \textcolor{vhdlchar}{s\_8} \textcolor{vhdlchar}{,}
05492         \textcolor{vhdlchar}{s\_9} \textcolor{vhdlchar}{,}
05493         \textcolor{vhdlchar}{s\_10}\textcolor{vhdlchar}{,}
05494         \textcolor{vhdlchar}{s\_11}\textcolor{vhdlchar}{,}
05495         \textcolor{vhdlchar}{s\_12}\textcolor{vhdlchar}{,}
05496         \textcolor{vhdlchar}{s\_13}\textcolor{vhdlchar}{,}
05497         \textcolor{vhdlchar}{s\_14}\textcolor{vhdlchar}{)};
05498 
05499 \textcolor{keyword}{    -- enforce one-hot fsm encoding}
05500     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{syn_encoding} \textcolor{vhdlchar}{:} \textcolor{comment}{string};
05501     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{syn_encoding} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{t_ac_state} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{TYPE} \textcolor{keywordflow}{is} \textcolor{keyword}{"one-hot"};
05502 
05503     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ac_state}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ac_state};\textcolor{keyword}{                   -- state machine for sub-states of
       t\_admin\_state states}
05504 
05505     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{stage_counter}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{18} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- counter to support memory timing
       delays}
05506     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{stage_counter_zero}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
05507 
05508     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{addr_cmd}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- internal copy of output
       DRAM addr/cmd signals}
05509 
05510     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mem_init_complete}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- signifies memory initialisation is complete}
05511     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cal_complete}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- calibration complete (equals: cal\_success OR cal\_fail)}
05512 
05513     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_mr0}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- an internal copy of
       mode register settings}
05514     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_mr1}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
05515     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_mr2}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
05516     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_mr3}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
05517 
05518     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{refresh_count}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{c_trefi_min_in_clks} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{            -- determine
       when refresh is due}
05519     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{refresh_due}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                             -- need to do a
       refresh now}
05520     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{refresh_done}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                             -- pulse when
       refresh complete}
05521     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{num_stacked_refreshes}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{
      c_max_num_stacked_refreshes} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{    -- can stack upto 8 refreshes (for DDR2)}
05522     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{refreshes_maxed}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                             -- signal
       refreshes are maxed out}
05523     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{initial_refresh_issued} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                             -- to start the
       refresh counter off}
05524 
05525     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_rec}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_command};
05526 \textcolor{keyword}{    -- last state logic}
05527     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{command_started}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{    -- provides a pulse when admin starts processing a
       command}
05528     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{command_done}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{    -- provides a pulse when admin completes processing a
       command is completed}
05529     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{finished_state}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{    -- finished current t\_admin\_state state}
05530 
05531     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{admin_req_extended}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                               -- keep requests for this
       block asserted until it is an ack is asserted}
05532     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_cs}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- which chip select being
       programmed at this instance}
05533     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{per_cs_init_seen}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
05534 
05535 \textcolor{keyword}{    -- some signals to enable non\_operational debug (optimised away if GENERATE\_ADDITIONAL\_DBG\_RTL = 0)}
05536     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{nop_toggle_signal}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_signals};
05537     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{nop_toggle_pin}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- track which pin in a
       signal to toggle}
05538     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{nop_toggle_value}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
05539 
05540 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
05541 
05542 \textcolor{keyword}{-- concurrent assignment of internal addr\_cmd to output port seq\_ac}
05543     \textcolor{keywordflow}{process} (addr_cmd)
05544 \textcolor{vhdlkeyword}{    begin}
05545         \textcolor{vhdlchar}{seq_ac}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{addr_cmd};
05546     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05547 
05548 \textcolor{keyword}{-- generate calibration complete signal}
05549    \textcolor{keywordflow}{process} (cal_success, cal_fail)
05550 \textcolor{vhdlkeyword}{   begin}
05551        \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cal_success} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{cal_fail};
05552    \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05553 
05554 \textcolor{keyword}{   -- register the control command record}
05555     \textcolor{keywordflow}{process} (clk, rst_n)
05556 \textcolor{vhdlkeyword}{    begin}
05557         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05558             \textcolor{vhdlchar}{ctrl_rec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
05559         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05560             \textcolor{vhdlchar}{ctrl_rec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_admin};
05561         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05562     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05563 
05564 \textcolor{keyword}{-- extend the admin block request until ack is asserted}
05565     \textcolor{keywordflow}{process} (clk, rst_n)
05566 \textcolor{vhdlkeyword}{    begin}
05567         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05568             \textcolor{vhdlchar}{admin_req_extended} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05569         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05570             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{admin}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05571                 \textcolor{vhdlchar}{admin_req_extended} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05572             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- this is effectively a copy of command\_ack generation}
05573                 \textcolor{vhdlchar}{admin_req_extended} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05574             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05575         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05576     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05577 
05578 \textcolor{keyword}{-- generate the current\_cs signal to track which cs accessed by PHY at any instance}
05579     \textcolor{keywordflow}{process} (clk, rst_n)
05580 \textcolor{vhdlkeyword}{    begin}
05581         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05582             \textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05583         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05584             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05585                 \textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs};
05586             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05587         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05588     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05589 
05590 
05591 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
05592 \textcolor{keyword}{--  refresh logic: DDR/DDR2/DDR3 allows upto 8 refreshes to be "stacked" or queued up.}
05593 \textcolor{keyword}{--  In the idle state, will ensure refreshes are issued when necessary. Then,}
05594 \textcolor{keyword}{--  when an access\_request is received, 7 topup refreshes will be done to max out}
05595 \textcolor{keyword}{--  the number of queued refreshes. That way, we know we have the maximum time}
05596 \textcolor{keyword}{--  available before another refresh is due.}
05597 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
05598 
05599 \textcolor{keyword}{-- initial\_refresh\_issued flag: used to sync refresh\_count}
05600     \textcolor{keywordflow}{process} (clk, rst_n)
05601 \textcolor{vhdlkeyword}{    begin}
05602         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05603             \textcolor{vhdlchar}{initial_refresh_issued} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05604         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05605             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05606                 \textcolor{vhdlchar}{initial_refresh_issued} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05607             \textcolor{keywordflow}{else}
05608                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_refresh\_done} \textcolor{keywordflow}{or}
05609                    \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_topup\_refresh\_done} \textcolor{keywordflow}{then}
05610                     \textcolor{vhdlchar}{initial_refresh_issued} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05611                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05612             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05613         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05614     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05615 
05616 \textcolor{keyword}{-- refresh timer: used to work out when a refresh is due}
05617     \textcolor{keywordflow}{process} (clk, rst_n)
05618 \textcolor{vhdlkeyword}{    begin}
05619         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05620             \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trefi_min_in_clks};
05621         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05622             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05623                 \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trefi_min_in_clks};
05624             \textcolor{keywordflow}{else}
05625                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{or}
05626                   \textcolor{vhdlchar}{initial_refresh_issued} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or}
05627                   \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{refresh_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- if refresh issued when already
       maxed}
05628                     \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trefi_min_in_clks};
05629                 \textcolor{keywordflow}{else}
05630                     \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
05631                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05632             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05633         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05634     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05635 
05636 \textcolor{keyword}{-- refresh\_due generation: 1 cycle pulse to indicate that c\_trefi\_min\_in\_clks has elapsed, and}
05637 \textcolor{keyword}{-- therefore a refresh is due}
05638     \textcolor{keywordflow}{process} (clk, rst_n)
05639 \textcolor{vhdlkeyword}{    begin}
05640       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05641           \textcolor{vhdlchar}{refresh_due}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05642       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05643           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refresh_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05644               \textcolor{vhdlchar}{refresh_due} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05645           \textcolor{keywordflow}{else}
05646               \textcolor{vhdlchar}{refresh_due} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05647           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05648       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05649     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05650 
05651 
05652 \textcolor{keyword}{-- counter to keep track of number of refreshes "stacked". NB: Up to 8}
05653 \textcolor{keyword}{-- refreshes can be stacked.}
05654     \textcolor{keywordflow}{process} (clk, rst_n)
05655 \textcolor{vhdlkeyword}{    begin}
05656         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05657             \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05658             \textcolor{vhdlchar}{trefi_failure} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- default no trefi failure}
05659 
05660         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05661 
05662             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset} \textcolor{keywordflow}{then}
05663                 \textcolor{vhdlchar}{trefi_failure} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- default no trefi failure (in restart)}
05664             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05665 
05666             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05667                 \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05668             \textcolor{keywordflow}{else}
05669                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refresh_due} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
05670                     \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
05671                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{refresh_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{
      c_max_num_stacked_refreshes} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
05672                     \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
05673                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05674 
05675 \textcolor{keyword}{                -- debug message if stacked refreshes are depleted and refresh is due}
05676                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refresh_due} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      initial_refresh_issued} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05677                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"error refresh is due and num\_stacked\_refreshes is zero"} \textcolor{keywordflow}{
      severity} \textcolor{vhdlchar}{error};
05678                     \textcolor{vhdlchar}{trefi_failure} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- persist}
05679                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05680             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05681 
05682         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05683     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05684 
05685 \textcolor{keyword}{-- generate signal to state if refreshes are maxed out}
05686     \textcolor{keywordflow}{process} (clk, rst_n)
05687 \textcolor{vhdlkeyword}{    begin}
05688         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05689 
05690             \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05691 
05692         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05693 
05694             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{num_stacked_refreshes} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{c_max_num_stacked_refreshes} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
05695                 \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05696             \textcolor{keywordflow}{else}
05697                 \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05698             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05699 
05700         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05701 
05702     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05703 
05704 \textcolor{keyword}{-- ----------------------------------------------------}
05705 \textcolor{keyword}{--  Mode register selection}
05706 \textcolor{keyword}{-- -----------------------------------------------------}
05707 
05708     \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0};
05709     \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1};
05710     \textcolor{vhdlchar}{int_mr2}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2};
05711     \textcolor{vhdlchar}{int_mr3}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3};
05712 
05713 \textcolor{keyword}{-- -------------------------------------------------------}
05714 \textcolor{keyword}{-- State machine}
05715 \textcolor{keyword}{-- -------------------------------------------------------}
05716     \textcolor{keywordflow}{process}(rst_n, clk)
05717 \textcolor{vhdlkeyword}{    begin}
05718         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05719             \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
05720             \textcolor{vhdlchar}{command_done}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05721             \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05722 
05723         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05724 
05725 \textcolor{keyword}{            -- Last state logic}
05726             \textcolor{vhdlchar}{command_done}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05727             \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05728 
05729             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
05730 
05731                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{|}
05732                      \textcolor{vhdlchar}{s\_non\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05733 
05734                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_init\_dram} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{admin_req_extended} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05735                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_run\_init\_seq};
05736                         \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05737                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05738 
05739                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_run\_init\_seq} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05740 
05741                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05742                           \textcolor{vhdlchar}{state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05743                           \textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05744                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05745 
05746                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_program\_cal\_mrs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05747 
05748                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05749                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mem_init_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- only refresh if all
       ranks initialised}
05750                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_topup\_refresh};
05751                         \textcolor{keywordflow}{else}
05752                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05753                        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05754                        \textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05755                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05756 
05757                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05758 
05759                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05760                         \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_topup\_refresh};
05761 
05762                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_init\_dram} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      admin_req_extended} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- start initialisation sequence}
05763                         \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_run\_init\_seq};
05764                         \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05765 
05766                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_prog\_cal\_mr} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      admin_req_extended} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- program mode registers (used for >1 chip select)}
05767                         \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_program\_cal\_mrs};
05768                         \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05769 
05770 \textcolor{keyword}{                    -- always enter s\_prog\_user\_mrs via topup refresh}
05771                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_prep\_customer\_mr\_setup} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      admin_req_extended} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05772                         \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=}  \textcolor{vhdlchar}{s\_topup\_refresh};
05773 
05774                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mem_init_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- only refresh once all
       ranks initialised}
05775                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_dummy\_wait};
05776                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05777 
05778                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_dummy\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05779 
05780                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05781                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_refresh};
05782                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05783 
05784                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_topup\_refresh} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05785 
05786                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05787                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_topup\_refresh\_done};
05788                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05789 
05790                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_topup\_refresh\_done} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05791 
05792                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- to ensure trfc is not violated}
05793                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05794                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_topup\_refresh};
05795 
05796                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_prep\_customer\_mr\_setup} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      admin_req_extended} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05797                             \textcolor{vhdlchar}{state}           \textcolor{vhdlchar}{<=}  \textcolor{vhdlchar}{s\_prog\_user\_mrs};
05798                             \textcolor{vhdlchar}{command_started} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05799 
05800                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05801 
05802                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
05803                                 \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_zq\_cal\_short};
05804                             \textcolor{keywordflow}{else}
05805                                 \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_access\_act};
05806                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05807 
05808                         \textcolor{keywordflow}{else}
05809                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05810                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05811                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05812 
05813                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_zq\_cal\_short} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- DDR3 only}
05814 
05815                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05816                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_access\_act};
05817                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05818 
05819                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_access\_act} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05820 
05821                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05822                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_access};
05823                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05824 
05825                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_access} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05826 
05827                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05828                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_access\_precharge};
05829                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05830 
05831                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_access\_precharge} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05832 
05833 \textcolor{keyword}{                    -- ensure precharge all timer has elapsed.}
05834                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05835                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05836                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05837 
05838                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prog\_user\_mrs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05839 
05840                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05841                         \textcolor{vhdlchar}{state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05842                         \textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05843                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05844 
05845                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_refresh} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05846 
05847                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05848                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_refresh\_done};
05849                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05850 
05851                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_refresh\_done} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05852 
05853                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- to ensure trfc is not violated}
05854                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{refreshes_maxed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05855                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_refresh};
05856                         \textcolor{keywordflow}{else}
05857                             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05858                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05859                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05860 
05861                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05862 
05863                     \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
05864 
05865             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
05866 
05867             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05868                 \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
05869                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{cal_success} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05870                     \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_non\_operational};\textcolor{keyword}{ -- if calibration failed and debug enabled then toggle pins
       in pre-defined pattern}
05871                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05872             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05873 
05874 \textcolor{keyword}{            -- if recalibrating then put admin in reset state to}
05875 \textcolor{keyword}{            -- avoid issuing refresh commands when not needed}
05876             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05877                 \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
05878             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05879 
05880         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05881     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05882 
05883 \textcolor{keyword}{-- --------------------------------------------------}
05884 \textcolor{keyword}{-- process to generate initialisation complete}
05885 \textcolor{keyword}{-- --------------------------------------------------}
05886     \textcolor{keywordflow}{process} (rst_n, clk)
05887 
05888 \textcolor{vhdlkeyword}{    begin}
05889         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05890 
05891             \textcolor{vhdlchar}{mem_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05892 
05893         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05894 
05895             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{per_cs_init_seen}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
05896                 \textcolor{vhdlchar}{mem_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05897             \textcolor{keywordflow}{else}
05898                 \textcolor{vhdlchar}{mem_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05899             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05900 
05901         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05902 
05903     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
05904 
05905 \textcolor{keyword}{-- --------------------------------------------------}
05906 \textcolor{keyword}{-- process to generate addr/cmd.}
05907 \textcolor{keyword}{-- --------------------------------------------------}
05908     \textcolor{keywordflow}{process}(rst_n, clk)
05909 
05910         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mr\_overload} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{regs_admin_ctrl_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
05911 
05912 \textcolor{keyword}{        -- required for non\_operational state only}
05913         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_nop\_ac\_0}    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
05914         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_nop\_ac\_1}    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
05915 
05916 \textcolor{vhdlkeyword}{    begin}
05917         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05918 
05919             \textcolor{vhdlchar}{ac_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
05920             \textcolor{vhdlchar}{stage_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05921             \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05922             \textcolor{vhdlchar}{finished_state}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05923             \textcolor{vhdlchar}{seq_ac_sel}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05924             \textcolor{vhdlchar}{refresh_done}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05925             \textcolor{vhdlchar}{per_cs_init_seen}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
05926 
05927             \textcolor{vhdlchar}{addr_cmd}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int\_pup\_reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
05928 
05929             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
05930                 \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{addr};
05931                 \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05932                 \textcolor{vhdlchar}{nop_toggle_value}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05933             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05934 
05935         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05936 
05937             \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05938             \textcolor{vhdlchar}{refresh_done}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05939 
05940 
05941 \textcolor{keyword}{            -- address / command path control}
05942 \textcolor{keyword}{            -- if seq\_ac\_sel = 1 then sequencer has control of a/c}
05943 \textcolor{keyword}{            -- if seq\_ac\_sel = 0 then memory controller has control of a/c}
05944             \textcolor{vhdlchar}{seq_ac_sel}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05945 
05946             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05947 
05948                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_success} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or}
05949                    \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- hand over interface if cal successful or no
       debug enabled}
05950 
05951                     \textcolor{vhdlchar}{seq_ac_sel}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05952 
05953                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05954             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05955 
05956 \textcolor{keyword}{            -- if recalibration request then take control of a/c path}
05957             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
05958 
05959                 \textcolor{vhdlchar}{seq_ac_sel} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05960 
05961             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05962 
05963             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset} \textcolor{keywordflow}{then}
05964 
05965                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
05966                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
05967 
05968             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_run\_init\_seq} \textcolor{keywordflow}{and}
05969                   \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{keywordflow}{then}
05970 
05971                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
05972                                           \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{             -- previous value}
05973 
05974             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05975 
05976             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
05977                 \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
05978             \textcolor{keywordflow}{else}
05979                 \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05980             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
05981 
05982             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_reset} \textcolor{keywordflow}{then}
05983                 \textcolor{vhdlchar}{stage_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
05984             \textcolor{keywordflow}{else}
05985                 \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
05986                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
05987 
05988                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_run\_init\_seq} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05989 
05990                         \textcolor{vhdlchar}{per_cs_init_seen}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- per cs test}
05991 
05992                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
05993 
05994                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
05995 
05996 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage c}
05997                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{s\_9} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
05998                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{t_ac_state}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{succ}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ac_state}\textcolor{vhdlchar}{)};
05999                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{TINIT_TCK}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06000                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{maintain\_pd\_or\_sr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
06001                                                                        \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}
06002                                                                        \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
06003 
06004 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage d}
06005                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_10}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06006                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_11};
06007                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_init_prech_delay};
06008                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
06009                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{             -- previous value}
06010 
06011                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_11}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06012                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06013                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06014                                     \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06015 \textcolor{keyword}{                                -- finish sequence by going into s\_program\_cal\_mrs state}
06016 
06017                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06018                                     \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06019                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06020 
06021                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR3 specific initialisation sequence}
06022 
06023                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06024 
06025                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06026                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06027                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{TINIT_RST} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06028                                     \textcolor{vhdlchar}{addr_cmd}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
06029 
06030                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{s\_10} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06031                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{t_ac_state}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{succ}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ac_state}\textcolor{vhdlchar}{)};
06032                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{TINIT_TCK}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06033                                     \textcolor{vhdlchar}{addr_cmd}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{maintain\_pd\_or\_sr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
06034                                                                         \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}
06035                                                                         \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
06036 
06037                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_11}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06038                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_12};
06039                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_init_prech_delay};
06040                                     \textcolor{vhdlchar}{addr_cmd}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};
06041 
06042                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_12}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06043                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06044                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06045                                     \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06046 \textcolor{keyword}{                                -- finish sequence by going into s\_program\_cal\_mrs state}
06047 
06048                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06049                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06050 
06051                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06052 
06053                         \textcolor{keywordflow}{else}
06054 
06055                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported memory type specified"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{error}
      ;
06056 
06057                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06058 \textcolor{keyword}{                        -- end of initialisation sequence}
06059 
06060                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_program\_cal\_mrs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06061 
06062                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR2 style mode register settings}
06063                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06064                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06065                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06066                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06067                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06068                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                               --
       previous value}
06069 
06070 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage d}
06071                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06072                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06073                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06074                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06075                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                     --
       rank}
06076 
06077 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage e}
06078                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06079                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_3};
06080                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06081                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06082                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      --
       mode register number}
06083                                                                \textcolor{vhdlchar}{int_mr2}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06084                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       rank}
06085                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 --
       remap address and bank address}
06086 
06087 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage f}
06088                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_3} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06089                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_4};
06090                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06091                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06092                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      --
       mode register number}
06093                                                                \textcolor{vhdlchar}{int_mr3}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06094                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       rank}
06095                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 --
       remap address and bank address}
06096 
06097 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage g}
06098                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_4} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06099                                     \textcolor{vhdlchar}{ac_state}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_5};
06100                                     \textcolor{vhdlchar}{stage_counter}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06101                                     \textcolor{vhdlchar}{v\_mr\_overload}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06102                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{    -- override DLL enable}
06103                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"000"};\textcolor{keyword}{  -- required in JESD79-2E (but not
       in JESD79-2B)}
06104                                     \textcolor{vhdlchar}{addr_cmd}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06105                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              
          -- mode register number}
06106                                                                            \textcolor{vhdlchar}{v\_mr\_overload} \textcolor{vhdlchar}{,}\textcolor{keyword}{                 
          -- mode register value}
06107                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                      -- rank}
06108                                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                         
          -- remap address and bank address}
06109 
06110 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage h}
06111                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_5} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06112                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_6};
06113                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmod_in_clks};
06114                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dll\_reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06115                                                                \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06116                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       rank}
06117                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 --
       remap address and bank address}
06118 
06119 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage i}
06120                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_6} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06121                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_7};
06122                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06123                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06124                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{           -- rank(s)}
06125 
06126 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage j}
06127                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_7} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06128                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_8};
06129                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trfc_min_in_clks};
06130                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- configuration}
06131                                                              \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                 --
       previous value}
06132                                                              \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                           --
       rank}
06133 
06134 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage j - second refresh}
06135                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_8} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06136                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_9};
06137                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trfc_min_in_clks};
06138                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- configuration}
06139                                                              \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                 --
       previous value}
06140                                                              \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                           --
       rank}
06141 
06142 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage k}
06143                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_9} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06144                                     \textcolor{vhdlchar}{ac_state}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_10};
06145                                     \textcolor{vhdlchar}{stage_counter}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06146 
06147                                     \textcolor{vhdlchar}{v\_mr\_overload}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdllogic}{"010"};\textcolor{keyword}{   -- override to burst length 4}
06148                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{                                             
       -- required in JESD79-2E}
06149                                     \textcolor{vhdlchar}{addr_cmd}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06150                                                                   \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                     
       -- mode register number}
06151                                                                   \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{,}\textcolor{keyword}{                         
       -- mode register value}
06152                                                                   \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                         
       -- rank}
06153                                                                   \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                
       -- remap address and bank address}
06154 
06155 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage l - wait 200 cycles}
06156                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_10} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06157                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_11};
06158                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{200};
06159                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06160                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                               --
       previous value}
06161 
06162 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage l - OCD default}
06163                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_11} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06164                                     \textcolor{vhdlchar}{ac_state}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_12};
06165                                     \textcolor{vhdlchar}{stage_counter}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06166                                     \textcolor{vhdlchar}{v\_mr\_overload}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06167                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"111"};\textcolor{keyword}{ -- OCD calibration default (i.e.
       OCD unused)}
06168                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{   -- override for DLL enable}
06169                                     \textcolor{vhdlchar}{addr_cmd}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- configuration}
06170                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       mode register number}
06171                                                                            \textcolor{vhdlchar}{v\_mr\_overload} \textcolor{vhdlchar}{,}\textcolor{keyword}{             --
       mode register value}
06172                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- rank}
06173                                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                     --
       remap address and bank address}
06174 
06175 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage l - OCD cal exit}
06176                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_12}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06177                                     \textcolor{vhdlchar}{ac_state}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_13};
06178                                     \textcolor{vhdlchar}{stage_counter}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmod_in_clks};
06179                                     \textcolor{vhdlchar}{v\_mr\_overload}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06180                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"000"};\textcolor{keyword}{ -- OCD calibration exit}
06181                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{   -- override for DLL enable}
06182                                     \textcolor{vhdlchar}{addr_cmd}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- configuration}
06183                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       mode register number}
06184                                                                            \textcolor{vhdlchar}{v\_mr\_overload} \textcolor{vhdlchar}{,}\textcolor{keyword}{             --
       mode register value}
06185                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- rank}
06186                                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                     --
       remap address and bank address}
06187 
06188                                     \textcolor{vhdlchar}{per_cs_init_seen}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06189 
06190 \textcolor{keyword}{                                -- JEDEC (JESD79-2E) stage m - cal finished}
06191                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_13}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06192                                     \textcolor{vhdlchar}{ac_state}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06193                                     \textcolor{vhdlchar}{stage_counter}     \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06194                                     \textcolor{vhdlchar}{finished_state}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06195 
06196                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06197                                     \textcolor{keywordflow}{null};
06198                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06199 
06200                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- DDR style mode register setting following
       JEDEC (JESD79E)}
06201 
06202                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06203                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06204                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06205                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06206                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06207                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                               --
       previous value}
06208 
06209                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06210                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06211                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06212                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06213                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                     --
       rank(s)}
06214 
06215                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06216                                     \textcolor{vhdlchar}{ac_state}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_3};
06217                                     \textcolor{vhdlchar}{stage_counter}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06218                                     \textcolor{vhdlchar}{v\_mr\_overload}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06219                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- override DLL enable}
06220                                     \textcolor{vhdlchar}{addr_cmd}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06221                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                  --
       mode register number}
06222                                                                    \textcolor{vhdlchar}{v\_mr\_overload} \textcolor{vhdlchar}{,}\textcolor{keyword}{                     --
       mode register value}
06223                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                      --
       rank}
06224                                                                    \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                             --
       remap address and bank address}
06225 
06226                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_3} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06227                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_4};
06228                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmod_in_clks};
06229                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dll\_reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06230                                                                \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06231                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       rank}
06232                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 --
       remap address and bank address}
06233 
06234                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_4} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06235                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_5};
06236                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06237                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06238                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{           -- rank(s)}
06239 
06240                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_5} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06241                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_6};
06242                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trfc_min_in_clks};
06243                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- configuration}
06244                                                              \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                 --
       previous value}
06245                                                              \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                           --
       rank}
06246 
06247                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_6} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06248                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_7};
06249                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trfc_min_in_clks};
06250                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- configuration}
06251                                                              \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                 --
       previous value}
06252                                                              \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                           --
       rank}
06253 
06254                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_7} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06255                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_8};
06256                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06257 
06258                                     \textcolor{vhdlchar}{v\_mr\_overload}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdllogic}{"010"};\textcolor{keyword}{   -- override to burst length 4}
06259 
06260                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- configuration}
06261                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      --
       mode register number}
06262                                                                \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       mode register value}
06263                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          --
       rank}
06264                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 --
       remap address and bank address}
06265 
06266                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_8} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06267                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_9};
06268                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{200};
06269                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06270                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                               --
       previous value}
06271 
06272                                     \textcolor{vhdlchar}{per_cs_init_seen}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06273 
06274                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_9} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06275                                     \textcolor{vhdlchar}{ac_state}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06276                                     \textcolor{vhdlchar}{stage_counter}     \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06277                                     \textcolor{vhdlchar}{finished_state}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06278 
06279                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06280                                     \textcolor{keywordflow}{null};
06281                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06282 
06283                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
06284 
06285                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06286 
06287                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06288                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06289                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06290                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                    -- configuration}
06291                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                --
       previous value}
06292 
06293                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06294                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06295                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06296                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06297                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                       --
       mode register number}
06298                                                                \textcolor{vhdlchar}{int_mr2}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- mode register value}
06299                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           --
       rank}
06300                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                  --
       remap address and bank address}
06301 
06302                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06303                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_3};
06304                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06305                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- configuration}
06306                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                       --
       mode register number}
06307                                                                \textcolor{vhdlchar}{int_mr3}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- mode register value}
06308                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           --
       rank}
06309                                                                \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                  --
       remap address and bank address}
06310 
06311                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_3}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06312                                     \textcolor{vhdlchar}{ac_state}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_4};
06313                                     \textcolor{vhdlchar}{stage_counter}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06314 
06315                                     \textcolor{vhdlchar}{v\_mr\_overload}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06316                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- Override for DLL enable}
06317                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- output buffer enable.}
06318                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- Disable Write levelling}
06319 
06320                                     \textcolor{vhdlchar}{addr_cmd}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- configuration}
06321                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                   --
       mode register number}
06322                                                                    \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{,}\textcolor{keyword}{                       --
       mode register value}
06323                                                                    \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                       --
       rank}
06324                                                                    \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                              --
       remap address and bank address}
06325 
06326                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_4}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06327                                     \textcolor{vhdlchar}{ac_state}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_5};
06328                                     \textcolor{vhdlchar}{stage_counter}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmod_in_clks};
06329 
06330                                     \textcolor{vhdlchar}{v\_mr\_overload}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06331 
06332                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"01"};\textcolor{keyword}{ -- override to on the fly burst
       length choice}
06333                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7}\textcolor{vhdlchar}{)}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- test mode not enabled}
06334                                     \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- DLL reset}
06335 
06336                                     \textcolor{vhdlchar}{addr_cmd}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{       -- configuration}
06337                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           --
       mode register number}
06338                                                                            \textcolor{vhdlchar}{v\_mr\_overload}\textcolor{vhdlchar}{,}\textcolor{keyword}{               --
       mode register value}
06339                                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{               -- rank}
06340                                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                      --
       remap address and bank address}
06341 
06342 
06343                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_5}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06344                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_6};
06345                                     \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_zq_init_duration_clks};
06346                                     \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ZQCL}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        --
       configuration}
06347                                                           \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                               --
       rank}
06348 
06349                                     \textcolor{vhdlchar}{per_cs_init_seen}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06350 
06351                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_6}          \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06352                                     \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06353                                     \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06354                                     \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06355 
06356                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06357                                     \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06358 
06359                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06360 
06361                         \textcolor{keywordflow}{else}
06362 
06363                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported memory type specified"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{error}
      ;
06364 
06365                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06366 
06367 \textcolor{keyword}{                        -- end of s\_program\_cal\_mrs case}
06368 
06369                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prog\_user\_mrs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06370 
06371                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06372                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06373                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06374                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06375                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   --
       configuration}
06376                                                               \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                           --
       previous value}
06377 
06378                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06379 
06380                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- for DDR memory skip MR2/3 because not
       present}
06381                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_4};
06382                                 \textcolor{keywordflow}{else}\textcolor{keyword}{                           -- for DDR2/DDR3 all MRs programmed}
06383                                     \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06384                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06385 
06386                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06387                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- configuration}
06388                                                                \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{           -- rank(s)}
06389 
06390                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06391                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_3};
06392                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06393                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  --
       configuration}
06394                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      -- mode
       register number}
06395                                                            \textcolor{vhdlchar}{int_mr2}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06396                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
06397                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 -- remap
       address and bank address}
06398 
06399                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_3} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06400                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_4};
06401                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06402                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  --
       configuration}
06403                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      -- mode
       register number}
06404                                                            \textcolor{vhdlchar}{int_mr3}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06405                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
06406                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 -- remap
       address and bank address}
06407 
06408                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_mr3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
06409                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" mode register 3 is expected to have a
       value of 0 but has a value of : "} \textcolor{vhdlchar}{&}
06410                                                                  \textcolor{comment}{integer}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      int_mr3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
06411                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06412 
06413                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_4} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06414                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_5};
06415                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmrd_in_clks};
06416                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  --
       configuration}
06417                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      -- mode
       register number}
06418                                                            \textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06419                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
06420                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 -- remap
       address and bank address}
06421 
06422                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQSN_EN} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{int_mr1}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{10}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
06423                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"mode register and generic conflict:"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF}
       \textcolor{vhdlchar}{&}
06424                                                                  \textcolor{keyword}{"* generic MEM\_IF\_DQSN\_EN is set to
       'disable' DQSN"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
06425                                                                  \textcolor{keyword}{"* user mode register MEM\_IF\_MR1 bit 10 is
       set to 'enable' DQSN"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
06426                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06427 
06428                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_5} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06429                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_6};
06430                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tmod_in_clks};
06431                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{load\_mode}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  --
       configuration}
06432                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      -- mode
       register number}
06433                                                            \textcolor{vhdlchar}{int_mr0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_max_mode_reg_index} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- mode register value}
06434                                                            \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
06435                                                            \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 -- remap
       address and bank address}
06436 
06437                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_6} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06438                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_7};
06439                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06440 
06441                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_7} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06442                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06443                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06444                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06445 
06446                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06447                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06448 
06449                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06450 
06451 \textcolor{keyword}{                        -- end of s\_prog\_user\_mr case}
06452 
06453                      \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_access\_precharge} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06454 
06455                          \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06456                              \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06457                                  \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06458                                  \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};
06459                                  \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                      --
       configuration}
06460                                                            \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                  --
       previous value}
06461 
06462                              \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06463                                  \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06464                                  \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trp_in_clks};
06465                                  \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{precharge\_all}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                 -- configuration}
06466                                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{              -- rank(s)}
06467 
06468                              \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06469                                  \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06470                                  \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06471                                  \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06472 
06473                              \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06474                                  \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06475                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06476 
06477                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_topup\_refresh} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_refresh} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06478 
06479                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06480                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06481                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06482                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06483 
06484                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06485                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06486                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06487                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{refresh}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        --
       configuration}
06488                                                          \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                     --
       previous value}
06489                                                          \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{                     --
       rank}
06490 
06491                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06492                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06493                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06494                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06495 
06496                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06497                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06498                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06499 
06500                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_topup\_refresh\_done} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_refresh\_done} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06501 
06502                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06503                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06504                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06505                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trfc_min_in_clks};
06506                                 \textcolor{vhdlchar}{refresh_done}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{      -- ensure trfc not violated}
06507                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06508                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06509                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06510                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06511 
06512                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06513                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06514                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06515 
06516                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_zq\_cal\_short}     \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06517 
06518                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06519                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06520                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06521                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06522 
06523                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06524                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06525                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_tzqcs};
06526                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ZQCS}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  --
       configuration}
06527                                                       \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                         -- all ranks}
06528 
06529                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06530                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06531                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06532                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06533 
06534                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06535                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06536 
06537                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06538 
06539                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_access\_act} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06540 
06541                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06542                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06543                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06544                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trrd_min_in_clks};
06545 
06546                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06547                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_2};
06548                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_trcd_min_in_clks};
06549                                 \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{activate}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                       --
       configuration}
06550                                                           \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                    --
       previous value}
06551                                                           \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                             --
       bank}
06552                                                           \textcolor{vhdlchar}{MEM_IF_CAL_BASE_ROW}\textcolor{vhdlchar}{,}\textcolor{keyword}{                         --
       row address}
06553                                                           \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)};\textcolor{keyword}{                              --
       rank}
06554 
06555                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_2} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06556                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06557                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06558                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06559 
06560                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06561                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06562                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06563 
06564 \textcolor{keyword}{                    -- counter to delay transition from s\_idle to s\_refresh - this is to ensure a refresh
       command is not sent}
06565 \textcolor{keyword}{                    -- just as we enter operational state (could cause a trfc violation)}
06566                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_dummy\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06567 
06568                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ac_state} \textcolor{keywordflow}{is}
06569                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_0} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06570                                 \textcolor{vhdlchar}{ac_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_1};
06571                                 \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_wait_value};
06572 
06573                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_1} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06574                                 \textcolor{vhdlchar}{ac_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06575                                 \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06576                                 \textcolor{vhdlchar}{finished_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06577 
06578                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06579                                 \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06580                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06581 
06582                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06583 
06584                         \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06585 
06586 \textcolor{keyword}{                        -- default some s\_non\_operational signals}
06587                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
06588                             \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{addr};
06589                             \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
06590                             \textcolor{vhdlchar}{nop_toggle_value}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
06591                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06592 
06593                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- if failed then output a recognised pattern to the memory
       (Only executes if GENERATE\_ADDITIONAL\_DBG\_RTL set)}
06594 
06595                         \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                               --
       configuration}
06596                                                   \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                           --
       previous value}
06597 
06598                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{NON_OP_EVAL_MD} \textcolor{vhdlchar}{=} \textcolor{keyword}{"PIN\_FINDER"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- toggle pins in turn for 200 memory clk
       cycles}
06599 
06600                             \textcolor{vhdlchar}{stage_counter}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{200}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- 200 mem\_clk cycles}
06601 
06602                             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{keywordflow}{is}
06603 
06604                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{addr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06605 
06606                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06607                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_pin}\textcolor{vhdlchar}{)};
06608 
06609                                     \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06610 
06611                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06612                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_pin} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
06613                                             \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ba};
06614                                             \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
06615                                         \textcolor{keywordflow}{else}
06616                                             \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{nop_toggle_pin} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06617                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06618                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06619 
06620                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ba} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06621 
06622                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ba}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06623                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ba}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_pin}\textcolor{vhdlchar}{)};
06624 
06625                                     \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06626 
06627                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06628                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_pin} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_BANKADDR_WIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
06629                                             \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cas_n};
06630                                             \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
06631                                         \textcolor{keywordflow}{else}
06632                                             \textcolor{vhdlchar}{nop_toggle_pin}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{nop_toggle_pin} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06633                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06634                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06635 
06636                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cas_n} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06637 
06638                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{cas_n}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06639 
06640                                     \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06641 
06642                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06643                                         \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ras_n};
06644                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06645 
06646                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ras_n} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06647 
06648                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ras_n}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06649 
06650                                     \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06651 
06652                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06653                                         \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{we_n};
06654                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06655 
06656                                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{we_n} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06657 
06658                                     \textcolor{vhdlchar}{addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      addr_cmd}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{we_n}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06659 
06660                                     \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06661 
06662                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06663                                         \textcolor{vhdlchar}{nop_toggle_signal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{addr};
06664                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06665 
06666                                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06667 
06668                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" an attempt to toggle a non addr/cmd pin
       detected"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
06669 
06670                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06671 
06672                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{NON_OP_EVAL_MD} \textcolor{vhdlchar}{=} \textcolor{keyword}{"SI\_EVALUATOR"} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- toggle all addr/cmd pins at fmax}
06673 
06674                             \textcolor{vhdlchar}{stage_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{  -- every mem\_clk cycle}
06675                             \textcolor{vhdlchar}{stage_counter_zero} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06676 
06677                             \textcolor{vhdlchar}{v\_nop\_ac\_0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}   \textcolor{vhdlchar}{
      addr}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06678                             \textcolor{vhdlchar}{v\_nop\_ac\_0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      ba}\textcolor{vhdlchar}{,}    \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06679                             \textcolor{vhdlchar}{v\_nop\_ac\_0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      we_n}\textcolor{vhdlchar}{,}  \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06680                             \textcolor{vhdlchar}{v\_nop\_ac\_0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      ras_n}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06681                             \textcolor{vhdlchar}{v\_nop\_ac\_0} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      cas_n}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06682 
06683                             \textcolor{vhdlchar}{v\_nop\_ac\_1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{,}   \textcolor{vhdlchar}{
      addr}\textcolor{vhdlchar}{,}  \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06684                             \textcolor{vhdlchar}{v\_nop\_ac\_1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      ba}\textcolor{vhdlchar}{,}    \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06685                             \textcolor{vhdlchar}{v\_nop\_ac\_1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      we_n}\textcolor{vhdlchar}{,}  \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06686                             \textcolor{vhdlchar}{v\_nop\_ac\_1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      ras_n}\textcolor{vhdlchar}{,} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06687                             \textcolor{vhdlchar}{v\_nop\_ac\_1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_nop\_ac\_1}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      cas_n}\textcolor{vhdlchar}{,} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value}\textcolor{vhdlchar}{)};
06688 
06689                             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
06690                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
06691                                     \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_nop\_ac\_0}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)};
06692                                 \textcolor{keywordflow}{else}
06693                                     \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_nop\_ac\_1}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)};
06694                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06695                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
06696 
06697                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
06698                                 \textcolor{vhdlchar}{nop_toggle_value} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{nop_toggle_value};
06699                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06700 
06701                         \textcolor{keywordflow}{else}
06702 
06703                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{admin_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unknown non-operational evaluation mode "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      NON_OP_EVAL_MD} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
06704 
06705                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06706 
06707                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
06708 
06709                         \textcolor{vhdlchar}{addr_cmd}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{                               --
       configuration}
06710                                                   \textcolor{vhdlchar}{addr_cmd}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                           --
       previous value}
06711                         \textcolor{vhdlchar}{stage_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06712                         \textcolor{vhdlchar}{ac_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_0};
06713 
06714                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
06715             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06716 
06717         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06718     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
06719 
06720 \textcolor{keyword}{-- -------------------------------------------------------------------}
06721 \textcolor{keyword}{-- output packing of mode register settings and enabling of ODT}
06722 \textcolor{keyword}{-- -------------------------------------------------------------------}
06723     \textcolor{keywordflow}{process} (int_mr0, int_mr1, int_mr2, int_mr3, mem_init_complete)
06724 \textcolor{vhdlkeyword}{    begin}
06725         \textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_mr0};
06726         \textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_mr1};
06727         \textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_mr2};
06728         \textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_mr3};
06729         \textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mem_init_complete};
06730         enable\_odt                      <= int\_mr1(\textcolor{vhdllogic}{2}) \textcolor{keywordflow}{or} int\_mr1(\textcolor{vhdllogic}{6}); -- \textcolor{keywordflow}{if} ODT enabled \textcolor{keywordflow}{in} MR settings (i.e.
       MR1 bits \textcolor{vhdllogic}{2} \textcolor{keywordflow}{or} \textcolor{vhdllogic}{6} /= \textcolor{vhdllogic}{0})
06731     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
06732 
06733 \textcolor{keyword}{-- --------------------------------------------------------------------------------}
06734 \textcolor{keyword}{-- generation of handshake signals with ctrl, dgrb and dgwb blocks (this includes}
06735 \textcolor{keyword}{-- command ack, command done for ctrl and access grant for dgrb/dgwb)}
06736 \textcolor{keyword}{-- --------------------------------------------------------------------------------}
06737     \textcolor{keywordflow}{process} (rst_n, clk)
06738 \textcolor{vhdlkeyword}{    begin}
06739         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06740 
06741             \textcolor{vhdlchar}{admin_ctrl}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
06742             \textcolor{vhdlchar}{ac_access_gnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
06743 
06744         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
06745 
06746             \textcolor{vhdlchar}{admin_ctrl}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
06747             \textcolor{vhdlchar}{ac_access_gnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
06748 
06749             \textcolor{vhdlchar}{admin_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{command_started};
06750             \textcolor{vhdlchar}{admin_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{command_done};
06751 
06752             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_access} \textcolor{keywordflow}{then}
06753                 \textcolor{vhdlchar}{ac_access_gnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
06754             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06755 
06756         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06757 
06758     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
06759 
06760 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
06761 \textcolor{keyword}{--}
06762 
06763 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
06764 \textcolor{keyword}{--  Abstract        : inferred ram for the non-levelling AFI PHY sequencer}
06765 \textcolor{keyword}{--                    The inferred ram is used in the iram block to store}
06766 \textcolor{keyword}{--                    debug information about the sequencer. It is variable in}
06767 \textcolor{keyword}{--                    size based on the IRAM\_AWIDTH generic and is of size}
06768 \textcolor{keyword}{--                    32 * (2 ** IRAM\_ADDR\_WIDTH) bits}
06769 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
06770 
06771 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
06772 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
06773 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
06774 
06775 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
06776 
06777 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
06778 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
06779 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
06780 \textcolor{keyword}{--}
06781 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
06782 
06783 \textcolor{keyword}{--}
06784 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_iram_ram \textcolor{keywordflow}{IS}
06785     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
06786         \textcolor{vhdlchar}{IRAM_AWIDTH}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
06787    \textcolor{vhdlchar}{)};
06788     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
06789         \textcolor{vhdlchar}{clk}              \textcolor{vhdlchar}{:}  \textcolor{keywordflow}{in}   \textcolor{comment}{std\_logic};
06790         \textcolor{vhdlchar}{rst_n}            \textcolor{vhdlchar}{:}  \textcolor{keywordflow}{in}   \textcolor{comment}{std\_logic};
06791 
06792 \textcolor{keyword}{        -- ram ports}
06793         \textcolor{vhdlchar}{addr}             \textcolor{vhdlchar}{:}  \textcolor{keywordflow}{in}   \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06794         \textcolor{vhdlchar}{wdata}            \textcolor{vhdlchar}{:}  \textcolor{keywordflow}{in}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06795         \textcolor{vhdlchar}{write}            \textcolor{vhdlchar}{:}  \textcolor{keywordflow}{in}   \textcolor{comment}{std\_logic};
06796         \textcolor{vhdlchar}{rdata}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}
06797     \textcolor{vhdlchar}{)};
06798 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
06799 
06800 \textcolor{keyword}{--}
06801 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_iram_ram is
06802 
06803 \textcolor{keyword}{-- infer ram}
06804 
06805     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_ram_address} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{IRAM_AWIDTH} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06806 
06807 \textcolor{keyword}{    -- registered ram signals}
06808     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{addr_r}  \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06809     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{wdata_r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06810     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{write_r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
06811     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rdata_r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06812 
06813 \textcolor{keyword}{    -- ram storage array}
06814     \textcolor{keywordflow}{type}   \textcolor{vhdlchar}{t_iram} \textcolor{keywordflow}{is} \textcolor{keywordflow}{array} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_ram_address}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{of} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06815     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_ram}            \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram};
06816     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{altera_attribute} \textcolor{vhdlchar}{:} \textcolor{comment}{string};
06817     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{altera_attribute} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{iram_ram} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{signal} \textcolor{keywordflow}{is} \textcolor{keyword}{"-name ADD\_PASS\_THROUGH\_LOGIC\_TO\_INFERRED\_RAMS "}\textcolor{keyword}{
      "OFF"}\textcolor{keyword}{""};
06818 
06819 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
06820 
06821 \textcolor{keyword}{    -- inferred ram instance - standard ram logic}
06822     \textcolor{keywordflow}{process} (clk, rst_n)
06823 \textcolor{vhdlkeyword}{    begin}
06824         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06825             \textcolor{vhdlchar}{rdata_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06826 
06827         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
06828             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{write_r} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06829                 \textcolor{vhdlchar}{iram_ram}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{addr_r}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wdata_r};
06830             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06831 
06832             \textcolor{vhdlchar}{rdata_r}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_ram}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{addr_r}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
06833         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06834 
06835     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
06836 
06837 \textcolor{keyword}{    -- register i/o for speed}
06838     \textcolor{keywordflow}{process} (clk, rst_n)
06839 \textcolor{vhdlkeyword}{    begin}
06840         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
06841 
06842             \textcolor{vhdlchar}{rdata}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06843             \textcolor{vhdlchar}{write_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
06844             \textcolor{vhdlchar}{addr_r}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06845             \textcolor{vhdlchar}{wdata_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
06846 
06847         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
06848 
06849             \textcolor{vhdlchar}{rdata}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdata_r};
06850             \textcolor{vhdlchar}{write_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write};
06851             \textcolor{vhdlchar}{addr_r}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{addr};
06852             \textcolor{vhdlchar}{wdata_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wdata};
06853 
06854         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
06855     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
06856 
06857 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
06858 \textcolor{keyword}{--}
06859 
06860 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
06861 \textcolor{keyword}{--  Abstract        : iram block for the non-levelling AFI PHY sequencer}
06862 \textcolor{keyword}{--                    This block is an optional storage of debug information for}
06863 \textcolor{keyword}{--                    the sequencer. In the current form the iram stores header}
06864 \textcolor{keyword}{--                    information about the arrangement of the sequencer and pass/}
06865 \textcolor{keyword}{--                    fail information for per-delay/phase/pin sweeps for the}
06866 \textcolor{keyword}{--                    read resynch phase calibration stage. Support for debug of}
06867 \textcolor{keyword}{--                    additional commands can be added at a later date}
06868 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
06869 
06870 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
06871 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
06872 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
06873 
06874 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
06875 
06876 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
06877 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
06878 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
06879 \textcolor{keyword}{--}
06880 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
06881 
06882 \textcolor{keyword}{-- The altmemphy iram ram (alt\_mem\_phy\_iram\_ram) is an inferred ram memory to implement the debug}
06883 \textcolor{keyword}{-- iram ram block}
06884 \textcolor{keyword}{--}
06885 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_iram\_ram};
06886 
06887 \textcolor{keyword}{--}
06888 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_iram \textcolor{keywordflow}{is}
06889     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
06890 \textcolor{keyword}{        -- physical interface width definitions}
06891         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
06892         \textcolor{vhdlchar}{FAMILYGROUP_ID}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06893         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06894         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06895         \textcolor{vhdlchar}{MEM_IF_DWIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06896         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06897         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06898         \textcolor{vhdlchar}{IRAM_AWIDTH}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06899         \textcolor{vhdlchar}{REFRESH_COUNT_INIT}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06900         \textcolor{vhdlchar}{PRESET_RLAT}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06901         \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06902         \textcolor{vhdlchar}{CAPABILITIES}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
06903         \textcolor{vhdlchar}{IP_BUILDNUM}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
06904    \textcolor{vhdlchar}{)};
06905     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
06906 \textcolor{keyword}{        -- clk / reset}
06907         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
06908         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
06909 
06910 \textcolor{keyword}{        -- read interface from mmi block:}
06911         \textcolor{vhdlchar}{mmi_iram}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_iram_ctrl};
06912         \textcolor{vhdlchar}{mmi_iram_enable_writes}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
06913 
06914 \textcolor{keyword}{        --iram status signal (includes read data from iram)}
06915         \textcolor{vhdlchar}{iram_status}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_iram_stat};
06916         \textcolor{vhdlchar}{iram_push_done}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
06917 
06918 \textcolor{keyword}{        -- from ctrl block}
06919         \textcolor{vhdlchar}{ctrl_iram}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_command};
06920 
06921 \textcolor{keyword}{        -- from dgrb block}
06922         \textcolor{vhdlchar}{dgrb_iram}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_iram_push};
06923 
06924 \textcolor{keyword}{        -- from admin block}
06925         \textcolor{vhdlchar}{admin_regs_status_rec}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_admin_stat};
06926 
06927 \textcolor{keyword}{        -- current write position in the iram}
06928         \textcolor{vhdlchar}{ctrl_idib_top}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      IRAM_AWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06929 
06930         \textcolor{vhdlchar}{ctrl_iram_push}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_iram};
06931 
06932 \textcolor{keyword}{        -- the following signals are unused and reserved for future use}
06933         \textcolor{vhdlchar}{dgwb_iram}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_iram_push}
06934     \textcolor{vhdlchar}{)};
06935 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
06936 
06937 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
06938 
06939 \textcolor{keyword}{-- The registers package (alt\_mem\_phy\_regs\_pkg) is used to combine the definition of the}
06940 \textcolor{keyword}{-- registers for the mmi status registers and functions/procedures applied to the registers}
06941 \textcolor{keyword}{--}
06942 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_regs_pkg.\textcolor{keywordflow}{all};
06943 
06944 \textcolor{keyword}{--}
06945 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_iram is
06946 
06947 \textcolor{keyword}{-- -------------------------------------------}
06948 \textcolor{keyword}{-- IHI fields}
06949 \textcolor{keyword}{-- -------------------------------------------}
06950 
06951 \textcolor{keyword}{    -- memory type , Quartus Build No., Quartus release, sequencer architecture version :}
06952     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{memtype}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06953     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{ihi_self_description}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06954 
06955     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{ihi_self_description_extra} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06956 
06957 \textcolor{keyword}{    -- for iram address generation:}
06958     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{curr_iram_offset}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*} \textcolor{vhdlchar}{IRAM_AWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
06959 
06960 \textcolor{keyword}{    -- set read latency for iram\_rdata\_valid signal control:}
06961     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_iram_rlat}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};\textcolor{keyword}{ -- iram read latency (increment if read pipelining
       added}
06962 
06963 \textcolor{keyword}{    -- for rdata valid generation:}
06964     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{read_valid_ctr}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_iram_rlat};
06965     \textcolor{keywordflow}{signal}   \textcolor{vhdlchar}{iram_addr_r}            \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
06966 
06967     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ihi_phys_if_desc}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DM_WIDTH}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
06968     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ihi_timing_info}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{X}\textcolor{keyword}{"DEADDEAD"};
06969 
06970     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ihi_ctrl_ss_word2}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      PRESET_RLAT}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"0000"}\textcolor{vhdlchar}{)};
06971 
06972 \textcolor{keyword}{    -- IDIB header codes}
06973     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_idib_header_code0}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"4A"};
06974     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_idib_footer_code}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"5A"};
06975 
06976 \textcolor{keyword}{    -- encoded Quartus version}
06977 \textcolor{keyword}{    -- constant c\_quartus\_version : natural := 0;  -- Quartus 7.2}
06978 \textcolor{keyword}{    -- constant c\_quartus\_version : natural := 1;  -- Quartus 8.0}
06979 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 2;  -- Quartus 8.1}
06980 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 3;  -- Quartus 9.0}
06981 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 4;  -- Quartus 9.0sp2}
06982 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 5;  -- Quartus 9.1}
06983 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 6;  -- Quartus 9.1sp1?}
06984 \textcolor{keyword}{    --constant c\_quartus\_version  : natural := 7;  -- Quartus 9.1sp2?}
06985     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_quartus_version}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};\textcolor{keyword}{  -- Quartus 10.0}
06986 \textcolor{keyword}{    -- constant c\_quartus\_version : natural := 114;   -- reserved}
06987 
06988 \textcolor{keyword}{    -- allow for different variants for debug i/f}
06989     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_dbg_if_version}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
06990 
06991 \textcolor{keyword}{    -- sequencer type 1 for levelling, 2 for non-levelling}
06992     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_sequencer_type}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
06993 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
06994 \textcolor{keyword}{--}
06995     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{iram_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (iram) : "};
06996 
06997 \textcolor{keyword}{-- -------------------------------------------}
06998 \textcolor{keyword}{-- signal and type declarations}
06999 \textcolor{keyword}{-- -------------------------------------------}
07000 
07001     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_iram_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{s\_reset}\textcolor{vhdlchar}{,}\textcolor{keyword}{                 -- system reset}
07002                            \textcolor{vhdlchar}{s\_pre\_init\_ram}\textcolor{vhdlchar}{,}\textcolor{keyword}{          -- identify pre-initialisation}
07003                            \textcolor{vhdlchar}{s\_init\_ram}\textcolor{vhdlchar}{,}\textcolor{keyword}{              -- zero all locations}
07004                            \textcolor{vhdlchar}{s\_idle}\textcolor{vhdlchar}{,}\textcolor{keyword}{                  -- default state}
07005                            \textcolor{vhdlchar}{s\_word\_access\_ram}\textcolor{vhdlchar}{,}\textcolor{keyword}{       -- mmi access to the iram (post-calibration)}
07006                            \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- sample read data from RAM}
07007                            \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata\_r}\textcolor{vhdlchar}{,}\textcolor{keyword}{-- register the sampling of data from RAM (to improve
       timing)}
07008                            \textcolor{vhdlchar}{s\_word\_complete}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- finalise iram ram write}
07009                            \textcolor{vhdlchar}{s\_idib\_header\_write}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- when starting a command}
07010                            \textcolor{vhdlchar}{s\_idib\_header\_inc\_addr}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- address increment}
07011                            \textcolor{vhdlchar}{s\_idib\_footer\_write}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- unique footer to indicate end of data}
07012                            \textcolor{vhdlchar}{s\_cal\_data\_read}\textcolor{vhdlchar}{,}\textcolor{keyword}{         -- read RAM location (read occurs continuously from
       idle state)}
07013                            \textcolor{vhdlchar}{s\_cal\_data\_read\_r}\textcolor{vhdlchar}{,}
07014                            \textcolor{vhdlchar}{s\_cal\_data\_modify}\textcolor{vhdlchar}{,}\textcolor{keyword}{       -- modify RAM location (read occurs continuously)}
07015                            \textcolor{vhdlchar}{s\_cal\_data\_write}\textcolor{vhdlchar}{,}\textcolor{keyword}{        -- write modified value back to RAM}
07016                            \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr}\textcolor{vhdlchar}{,}\textcolor{keyword}{   -- from 0 to 6 writing iram header info}
07017                            \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr}\textcolor{vhdlchar}{,}
07018                            \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr}\textcolor{vhdlchar}{,}
07019                            \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr}\textcolor{vhdlchar}{,}
07020                            \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr}\textcolor{vhdlchar}{,}
07021                            \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr}\textcolor{vhdlchar}{,}
07022                            \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr}\textcolor{vhdlchar}{,}
07023                            \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr}\textcolor{keyword}{-- end writing iram header info}
07024                            \textcolor{vhdlchar}{)};
07025 
07026     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{state}              \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_state};
07027 
07028     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{contested_access}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07029     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{idib_header_count}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07030 
07031 \textcolor{keyword}{    -- register a new cmd request}
07032     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{new_cmd}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07033     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cmd_processed}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07034 
07035 \textcolor{keyword}{    -- signals to control dgrb writes}
07036     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_modified_data} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{          -- scratchpad memory for
       read-modify-write}
07037 
07038 \textcolor{keyword}{-- -------------------------------------------}
07039 \textcolor{keyword}{-- physical ram connections}
07040 \textcolor{keyword}{-- -------------------------------------------}
07041 
07042 \textcolor{keyword}{-- Note that the iram\_addr here is created IRAM\_AWIDTH downto 0, and not}
07043 \textcolor{keyword}{-- IRAM\_AWIDTH-1 downto 0.  This means that the MSB is outside the addressable}
07044 \textcolor{keyword}{-- area of the RAM.  The purpose of this is that this shall be our memory}
07045 \textcolor{keyword}{-- overflow bit. It shall be directly connected to the iram\_out\_of\_memory flag}
07046 
07047 \textcolor{keyword}{    -- 32-bit interface port (read and write)}
07048     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_addr}   \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07049     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_wdata}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07050     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_rdata}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07051     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_write}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07052 
07053 \textcolor{keyword}{    -- signal generated external to the iram to say when read data is valid}
07054     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07055 
07056 \textcolor{keyword}{    -- The FSM owns local storage that is loaded with the wdata/addr from the}
07057 \textcolor{keyword}{    -- requesting sub-block, which is then fed to the iram's wdata/addr in turn}
07058 \textcolor{keyword}{    -- until all data has gone across}
07059     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{fsm_read}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07060 
07061 \textcolor{keyword}{-- -------------------------------------------}
07062 \textcolor{keyword}{-- multiplexed push data}
07063 \textcolor{keyword}{-- -------------------------------------------}
07064     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_done}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                     -- unused}
07065     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07066     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pending_push}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                     -- push data to RAM}
07067     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_wordnum}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{511};
07068     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_bitnum}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{31};
07069 
07070 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
07071 
07072 \textcolor{keyword}{-- -------------------------------------------}
07073 \textcolor{keyword}{-- iram ram instantiation}
07074 \textcolor{keyword}{-- -------------------------------------------}
07075 \textcolor{keyword}{-- Note that the IRAM\_AWIDTH is the physical number of address bits that the RAM has.}
07076 \textcolor{keyword}{-- However, for out of range access detection purposes, an additional bit is added to}
07077 \textcolor{keyword}{-- the various address signals. The iRAM does not register any of its inputs as the addr,}
07078 \textcolor{keyword}{-- wdata etc are registered directly before being driven to it.}
07079 
07080 \textcolor{keyword}{-- The dgrb accesses are of format read-modify-write to a single bit of a 32-bit word, the}
07081 \textcolor{keyword}{-- mmi reads and header writes are in 32-bit words}
07082 
07083 \textcolor{keyword}{    --}
07084     ram : \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_iram_ram
07085         \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (
07086         IRAM_AWIDTH => IRAM_AWIDTH
07087     \textcolor{vhdlchar}{)}
07088     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map} (
07089         clk   => clk,
07090         rst_n => rst_n,
07091         addr  => iram_addr\textcolor{vhdlchar}{(}IRAM_AWIDTH-\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)},
07092         wdata => iram_wdata,
07093         write => iram_write,
07094         rdata => iram_rdata
07095     \textcolor{vhdlchar}{)};
07096 
07097 \textcolor{keyword}{-- -------------------------------------------}
07098 \textcolor{keyword}{-- IHI fields}
07099 \textcolor{keyword}{-- asynchronously}
07100 \textcolor{keyword}{-- -------------------------------------------}
07101 
07102 \textcolor{keyword}{    -- this field identifies the type of memory}
07103     \textcolor{vhdlchar}{memtype} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"03"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=}  \textcolor{keyword}{"DDR3"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
07104                \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"02"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=}  \textcolor{keyword}{"DDR2"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
07105                \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"01"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=}   \textcolor{keyword}{"DDR"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
07106                \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"10"} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"QDRII"}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{else}
07107                \textcolor{vhdlchar}{X}\textcolor{vhdllogic}{"00"} ;
07108 
07109 \textcolor{keyword}{    -- this field indentifies the gross level description of the sequencer}
07110     \textcolor{vhdlchar}{ihi_self_description} \textcolor{vhdlchar}{<=}   \textcolor{vhdlchar}{memtype}
07111                             \textcolor{vhdlchar}{&} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IP_BUILDNUM}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}
07112                             \textcolor{vhdlchar}{&} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_quartus_version}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}
07113                             \textcolor{vhdlchar}{&} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_dbg_if_version}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07114 
07115 \textcolor{keyword}{    -- some extra information for the debug gui - sequencer type and familygroup}
07116     \textcolor{vhdlchar}{ihi_self_description_extra} \textcolor{vhdlchar}{<=}       \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      FAMILYGROUP_ID}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}
07117                                     \textcolor{vhdlchar}{&}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_sequencer_type}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}
07118                                     \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"000000"};
07119 
07120 
07121 \textcolor{keyword}{-- -------------------------------------------}
07122 \textcolor{keyword}{-- check for contested memory accesses}
07123 \textcolor{keyword}{-- -------------------------------------------}
07124 
07125     \textcolor{keywordflow}{process}(clk,rst_n)
07126 \textcolor{vhdlkeyword}{    begin}
07127         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07128             \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07129         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07130             \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07131 
07132             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{pending_push} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07133                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"contested memory accesses to the iram"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07134                 \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07135             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07136 
07137 \textcolor{keyword}{            -- sanity checks}
07138             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07139                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"mmi writes to the iram unsupported for non-levelling AFI PHY
       sequencer"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07140             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07141             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgwb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07142                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"dgwb writes to the iram unsupported for non-levelling AFI PHY
       sequencer"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07143             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07144         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07145     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07146 
07147 \textcolor{keyword}{-- -------------------------------------------}
07148 \textcolor{keyword}{-- mux push data and associated signals}
07149 \textcolor{keyword}{-- note: single bit taken for iram\_pushdata because 1-bit read-modify-write to}
07150 \textcolor{keyword}{--       a 32-bit word in the ram. This interface style is maintained for future}
07151 \textcolor{keyword}{--       scalability / wider application of the iram block.}
07152 \textcolor{keyword}{-- -------------------------------------------}
07153 
07154     \textcolor{keywordflow}{process}(clk,rst_n)
07155 \textcolor{vhdlkeyword}{    begin}
07156 
07157         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07158 
07159             \textcolor{vhdlchar}{iram_done}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07160             \textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07161             \textcolor{vhdlchar}{pending_push}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07162             \textcolor{vhdlchar}{iram_wordnum}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
07163             \textcolor{vhdlchar}{iram_bitnum}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
07164 
07165         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07166 
07167             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}
07168 
07169                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{dgrb} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07170                     \textcolor{vhdlchar}{iram_done}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_done};
07171                     \textcolor{vhdlchar}{iram_pushdata}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata};
07172                     \textcolor{vhdlchar}{pending_push}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write};
07173                     \textcolor{vhdlchar}{iram_wordnum}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum};
07174                     \textcolor{vhdlchar}{iram_bitnum}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_bitnum};
07175 
07176                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{ -- default dgrb}
07177                     \textcolor{vhdlchar}{iram_done}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_done};
07178                     \textcolor{vhdlchar}{iram_pushdata}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata};
07179                     \textcolor{vhdlchar}{pending_push}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write};
07180                     \textcolor{vhdlchar}{iram_wordnum}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum};
07181                     \textcolor{vhdlchar}{iram_bitnum}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_bitnum};
07182 
07183                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07184         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07185 
07186     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07187 
07188 \textcolor{keyword}{-- -------------------------------------------}
07189 \textcolor{keyword}{-- generate write signal for the ram}
07190 \textcolor{keyword}{-- -------------------------------------------}
07191 
07192     \textcolor{keywordflow}{process}(clk, rst_n)
07193 \textcolor{vhdlkeyword}{    begin}
07194 
07195         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07196             \textcolor{vhdlchar}{iram_write}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07197 
07198         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07199 
07200             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
07201 
07202             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07203                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07204 
07205             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_pre\_init\_ram} \textcolor{vhdlchar}{|}
07206                  \textcolor{vhdlchar}{s\_init\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07207                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07208 
07209             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr} \textcolor{vhdlchar}{|}
07210                  \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr} \textcolor{vhdlchar}{|}
07211                  \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr} \textcolor{vhdlchar}{|}
07212                  \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr} \textcolor{vhdlchar}{|}
07213                  \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr} \textcolor{vhdlchar}{|}
07214                  \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr} \textcolor{vhdlchar}{|}
07215                  \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr} \textcolor{vhdlchar}{|}
07216                  \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07217                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07218 
07219             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07220                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07221 
07222             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_footer\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07223                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07224 
07225             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07226                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07227 
07228             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07229                 \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- default}
07230 
07231             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07232 
07233         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07234 
07235     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07236 
07237 \textcolor{keyword}{-- -------------------------------------------}
07238 \textcolor{keyword}{-- generate wdata for the ram}
07239 \textcolor{keyword}{-- -------------------------------------------}
07240 
07241     \textcolor{keywordflow}{process}(clk, rst_n)
07242     \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_current\_cs}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07243     \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mtp\_alignment} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07244     \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_single\_bit}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07245 
07246 \textcolor{vhdlkeyword}{    begin}
07247 
07248         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07249             \textcolor{vhdlchar}{iram_wdata}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07250 
07251         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07252 
07253             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
07254 
07255                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_pre\_init\_ram} \textcolor{vhdlchar}{|}
07256                      \textcolor{vhdlchar}{s\_init\_ram}     \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07257                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07258 
07259                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07260                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ihi_self_description};
07261 
07262                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07263                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ihi_phys_if_desc};
07264 
07265                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07266                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ihi_timing_info};
07267 
07268                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07269                     \textcolor{vhdlchar}{iram_wdata}                                                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07270                     \textcolor{vhdlchar}{iram_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0};
07271                     \textcolor{vhdlchar}{iram_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr1};
07272 
07273                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07274                     \textcolor{vhdlchar}{iram_wdata}                                                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07275                     \textcolor{vhdlchar}{iram_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2};
07276                     \textcolor{vhdlchar}{iram_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr3};
07277 
07278                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07279                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ihi_ctrl_ss_word2};
07280 
07281                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07282                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- tbd write the occupancy
       at end of cal}
07283 
07284                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07285                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ihi_self_description_extra};
07286 
07287                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_write}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07288 
07289 \textcolor{keyword}{                    -- encode command\_op for current operation}
07290                     \textcolor{vhdlchar}{v\_current\_cs}    \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07291                     \textcolor{vhdlchar}{v\_mtp\_alignment} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mtp_almt}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07292                     \textcolor{vhdlchar}{v\_single\_bit}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{single_bit};
07293 
07294                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{encode\_current\_stage}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- which command being executed
       (currently this should only be cmd\_rrp\_sweep (8 bits)}
07295                                                              \textcolor{vhdlchar}{v\_current\_cs} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- which chip select being
       processed (4 bits)}
07296                                                           \textcolor{vhdlchar}{v\_mtp\_alignment} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- currently used MTP alignment
       (1 bit)}
07297                                                              \textcolor{vhdlchar}{v\_single\_bit} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- is single bit calibration
       selected (1 bit) - used during MTP alignment}
07298                                                                      \textcolor{vhdllogic}{"00"} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- RFU}
07299                                                         \textcolor{vhdlchar}{idib_header_count} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- unique ID to how many
       headers have been written (8 bits)}
07300                                                        \textcolor{vhdlchar}{c_idib_header_code0};\textcolor{keyword}{ -- unique ID for headers (8
       bits)}
07301 
07302                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_footer\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07303 
07304                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_idib_footer_code} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{c_idib_footer_code} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      c_idib_footer_code} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{c_idib_footer_code};
07305 
07306                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_modify}     \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07307 
07308 \textcolor{keyword}{                    -- default don't overwrite}
07309                     \textcolor{vhdlchar}{iram_modified_data} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_rdata};
07310 
07311 \textcolor{keyword}{                    -- update iram data based on packing and write modes}
07312                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{dq\_bitwise} \textcolor{keywordflow}{then}
07313 
07314                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode} \textcolor{keywordflow}{is}
07315                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{overwrite\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07316                                 \textcolor{vhdlchar}{iram_modified_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_bitnum}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07317                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{or\_into\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07318                                 \textcolor{vhdlchar}{iram_modified_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_bitnum}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{
      iram_rdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07319                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{and\_into\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07320                                 \textcolor{vhdlchar}{iram_modified_data}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_bitnum}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      iram_rdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07321                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07322                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unidentified write mode of "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      t_iram_write_mode}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
07323                                        \textcolor{keyword}{" specified when generating iram write data"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07324                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07325 
07326                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{dq\_wordwise} \textcolor{keywordflow}{then}
07327 
07328                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode} \textcolor{keywordflow}{is}
07329                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{overwrite\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07330                                 \textcolor{vhdlchar}{iram_modified_data} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata};
07331                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{or\_into\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07332                                 \textcolor{vhdlchar}{iram_modified_data} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{
      iram_rdata};
07333                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{and\_into\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07334                                 \textcolor{vhdlchar}{iram_modified_data} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_pushdata} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      iram_rdata};
07335                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07336                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unidentified write mode of "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      t_iram_write_mode}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
07337                                        \textcolor{keyword}{" specified when generating iram write data"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07338                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07339                     \textcolor{keywordflow}{else}
07340                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{iram_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unidentified packing mode of "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      t_iram_packing_mode}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
07341                                \textcolor{keyword}{" specified when generating iram write data"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07342                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07343 
07344 
07345                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_write}      \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07346                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_modified_data};
07347 
07348                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}                \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07349                     \textcolor{vhdlchar}{iram_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07350 
07351             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07352 
07353         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07354 
07355     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07356 
07357 \textcolor{keyword}{-- -------------------------------------------}
07358 \textcolor{keyword}{-- generate addr for the ram}
07359 \textcolor{keyword}{-- -------------------------------------------}
07360 
07361     \textcolor{keywordflow}{process}(clk, rst_n)
07362 \textcolor{vhdlkeyword}{    begin}
07363 
07364        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07365           \textcolor{vhdlchar}{iram_addr}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07366           \textcolor{vhdlchar}{curr_iram_offset}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
07367 
07368        \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07369 
07370            \textcolor{keywordflow}{case} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}
07371 
07372                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07373                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- pre-set mmi read location address}
07374 
07375                        \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{addr}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      IRAM_AWIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- Pad MSB}
07376 
07377                    \textcolor{keywordflow}{else}\textcolor{keyword}{  -- default get next push data location from iram}
07378 
07379                        \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_iram_offset} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{iram_wordnum}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      IRAM_AWIDTH}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
07380 
07381                    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07382 
07383                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_word\_access\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07384 
07385 \textcolor{keyword}{                   -- calculate the address}
07386                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- mmi access}
07387                        \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{addr}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      IRAM_AWIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- Pad MSB}
07388                    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07389 
07390 
07391                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07392                    \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07393 
07394 \textcolor{keyword}{               -- increment address for IHI word writes :}
07395                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr} \textcolor{vhdlchar}{|}
07396                     \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr} \textcolor{vhdlchar}{|}
07397                     \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr} \textcolor{vhdlchar}{|}
07398                     \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr} \textcolor{vhdlchar}{|}
07399                     \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr} \textcolor{vhdlchar}{|}
07400                     \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr} \textcolor{vhdlchar}{|}
07401                     \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07402                    \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=}  \textcolor{vhdlchar}{iram_addr} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07403 
07404                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07405                    \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_idib_top}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- Always write header at
       idib\_top location}
07406 
07407                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_footer\_write} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07408                    \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_iram_offset} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{iram_wordnum}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      IRAM_AWIDTH}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- active block communicates where to put the footer with done signal}
07409 
07410                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_inc\_addr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07411                    \textcolor{vhdlchar}{iram_addr}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_addr} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07412                    \textcolor{vhdlchar}{curr_iram_offset} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{iram_addr}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07413 
07414                \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07415 
07416                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07417                        \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- this prevents erroneous out-of-mem flag after
       initialisation}
07418                    \textcolor{keywordflow}{else}
07419                        \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_addr} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07420                    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07421 
07422                \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07423                    \textcolor{vhdlchar}{iram_addr}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_addr};
07424 
07425            \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07426 
07427        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07428 
07429     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07430 
07431 \textcolor{keyword}{-- -------------------------------------------}
07432 \textcolor{keyword}{-- generate new cmd signal to register the command\_req signal}
07433 \textcolor{keyword}{-- -------------------------------------------}
07434 
07435     \textcolor{keywordflow}{process}(clk, rst_n)
07436 \textcolor{vhdlkeyword}{    begin}
07437 
07438         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07439             \textcolor{vhdlchar}{new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07440 
07441         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07442 
07443             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07444 
07445                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
07446 
07447                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_sweep} \textcolor{vhdlchar}{|}\textcolor{keyword}{  -- only prompt new\_cmd for commands we wish to write headers for}
07448                          \textcolor{vhdlchar}{cmd\_rrp\_seek}  \textcolor{vhdlchar}{|}
07449                          \textcolor{vhdlchar}{cmd\_read\_mtp}  \textcolor{vhdlchar}{|}
07450                          \textcolor{vhdlchar}{cmd\_write\_ihi} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07451 
07452                         \textcolor{vhdlchar}{new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07453 
07454                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07455 
07456                         \textcolor{vhdlchar}{new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07457 
07458                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07459 
07460             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07461 
07462             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cmd_processed} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07463                 \textcolor{vhdlchar}{new_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07464             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07465 
07466         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07467     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07468 
07469 \textcolor{keyword}{-- -------------------------------------------}
07470 \textcolor{keyword}{-- generate read valid signal which takes account of pipelining of reads}
07471 \textcolor{keyword}{-- -------------------------------------------}
07472 
07473     \textcolor{keywordflow}{process}(clk, rst_n)
07474 \textcolor{vhdlkeyword}{    begin}
07475 
07476         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07477             \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07478             \textcolor{vhdlchar}{read_valid_ctr}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
07479             \textcolor{vhdlchar}{iram_addr_r}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07480 
07481         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07482 
07483             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{read_valid_ctr} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{c_iram_rlat} \textcolor{keywordflow}{then}
07484                 \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07485                 \textcolor{vhdlchar}{read_valid_ctr}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read_valid_ctr} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07486             \textcolor{keywordflow}{else}
07487                 \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07488             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07489 
07490             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_addr}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_addr_r}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}
07491                \textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07492                 \textcolor{vhdlchar}{read_valid_ctr}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
07493                 \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07494             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07495 
07496 \textcolor{keyword}{            -- register iram address}
07497             \textcolor{vhdlchar}{iram_addr_r}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_addr};
07498 
07499         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07500     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07501 
07502 
07503 \textcolor{keyword}{-- -------------------------------------------}
07504 \textcolor{keyword}{-- state machine}
07505 \textcolor{keyword}{-- -------------------------------------------}
07506 
07507     \textcolor{keywordflow}{process}(clk, rst_n)
07508 \textcolor{vhdlkeyword}{    begin}
07509 
07510         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07511            \textcolor{vhdlchar}{state}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
07512            \textcolor{vhdlchar}{cmd_processed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07513 
07514         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07515 
07516             \textcolor{vhdlchar}{cmd_processed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07517 
07518             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
07519 
07520                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07521                     \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_pre\_init\_ram};
07522 
07523                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_pre\_init\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07524                     \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_init\_ram};
07525 
07526 \textcolor{keyword}{                -- remain in the init\_ram state until all the ram locations have been zero'ed}
07527                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_ram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07528 
07529                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07530                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
07531                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07532 
07533 \textcolor{keyword}{                -- default state after reset}
07534                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
07535 
07536                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pending_push} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07537 
07538                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal\_data\_read};
07539 
07540                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{iram_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07541 
07542                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idib\_footer\_write};
07543 
07544                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{new_cmd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07545 
07546                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
07547 
07548                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_sweep} \textcolor{vhdlchar}{|}
07549                                  \textcolor{vhdlchar}{cmd\_rrp\_seek}  \textcolor{vhdlchar}{|}
07550                                  \textcolor{vhdlchar}{cmd\_read\_mtp}     \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idib\_header\_write};
07551 
07552                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_write\_ihi}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr};
07553 
07554                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}           \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{state};
07555 
07556                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07557 
07558                         \textcolor{vhdlchar}{cmd_processed} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07559 
07560                     \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07561 
07562                         \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_access\_ram};
07563 
07564                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07565 
07566 \textcolor{keyword}{                -- mmi read accesses}
07567                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_word\_access\_ram}            \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata};
07568                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata}       \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata\_r};
07569 
07570                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_word\_fetch\_ram\_rdata\_r}     \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07571                                                          \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_complete};
07572                                                      \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07573 
07574                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_word\_complete}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- return to idle when
       iram\_rdata stable}
07575                                                          \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
07576                                                      \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07577 
07578 \textcolor{keyword}{                -- header write (currently only for cmp\_rrp stage)}
07579                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_write}          \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idib\_header\_inc\_addr};
07580                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_header\_inc\_addr}       \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};\textcolor{keyword}{  -- return to idle to wait for push}
07581 
07582                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idib\_footer\_write}          \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_complete};
07583 
07584 \textcolor{keyword}{                -- push data accesses (only used by the dgrb block at present)}
07585                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_read}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal\_data\_read\_r};
07586 
07587                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_read\_r}            \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_rdata_valid} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07588                                                          \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal\_data\_modify};
07589                                                      \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07590 
07591                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_modify}            \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal\_data\_write};
07592                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal\_data\_write}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_word\_complete};
07593 
07594 \textcolor{keyword}{                -- IHI Header write accesses}
07595                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word0\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr};
07596                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word1\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr};
07597                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word2\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr};
07598                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word3\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr};
07599                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word4\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr};
07600                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word5\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr};
07601                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word6\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr};
07602                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
07603 
07604                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{state};
07605 
07606             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
07607 
07608         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07609 
07610     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07611 
07612 \textcolor{keyword}{-- -------------------------------------------}
07613 \textcolor{keyword}{-- drive read data and responses back.}
07614 \textcolor{keyword}{-- -------------------------------------------}
07615 
07616     \textcolor{keywordflow}{process}(clk, rst_n)
07617 \textcolor{vhdlkeyword}{    begin}
07618 
07619         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07620             \textcolor{vhdlchar}{iram_status}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
07621             \textcolor{vhdlchar}{iram_push_done}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07622             \textcolor{vhdlchar}{idib_header_count}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07623             \textcolor{vhdlchar}{fsm_read}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07624 
07625         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07626 
07627 \textcolor{keyword}{            -- defaults}
07628             \textcolor{vhdlchar}{iram_status}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
07629             \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{done}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07630             \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07631             \textcolor{vhdlchar}{iram_push_done}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07632 
07633 
07634             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_init\_ram} \textcolor{keywordflow}{then}
07635                 \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{out_of_mem} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07636             \textcolor{keywordflow}{else}
07637                 \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{out_of_mem} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{IRAM_AWIDTH}\textcolor{vhdlchar}{)};
07638             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07639 
07640 \textcolor{keyword}{            -- register read flag for 32 bit accesses}
07641             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{then}
07642 
07643                 \textcolor{vhdlchar}{fsm_read}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read};
07644 
07645             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07646 
07647             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_word\_complete} \textcolor{keywordflow}{then}
07648 
07649                 \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{done}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07650 
07651                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{fsm_read} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07652                     \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_rdata};
07653                 \textcolor{keywordflow}{else}
07654                     \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
07655                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07656 
07657             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07658 
07659 \textcolor{keyword}{            -- if another access is ever presented while the FSM is busy, set the contested flag}
07660             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
07661                 \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{contested_access} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07662             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07663 
07664 \textcolor{keyword}{            -- set (and keep set) the iram\_init\_done output once initialisation of the RAM is complete}
07665             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_init\_ram}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_pre\_init\_ram}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_reset}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
07666                 \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07667             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07668 
07669             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_ihi\_header\_word7\_wr} \textcolor{keywordflow}{then}
07670                 \textcolor{vhdlchar}{iram_push_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07671             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07672 
07673 \textcolor{keyword}{            -- if completing push or footer write then acknowledge}
07674             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_cal\_data\_modify} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idib\_footer\_write} \textcolor{keywordflow}{then}
07675                 \textcolor{vhdlchar}{iram_push_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07676             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07677 
07678 \textcolor{keyword}{            -- increment IDIB header count each time a header is written}
07679             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idib\_header\_write} \textcolor{keywordflow}{then}
07680                 \textcolor{vhdlchar}{idib_header_count} \textcolor{vhdlchar}{<=}  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      idib_header_count}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{idib_header_count}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07681             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07682 
07683         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07684 
07685     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
07686 
07687 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
07688 \textcolor{keyword}{--}
07689 
07690 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
07691 \textcolor{keyword}{--  Abstract        : data gatherer (read bias) [dgrb] block for the non-levelling}
07692 \textcolor{keyword}{--                    AFI PHY sequencer}
07693 \textcolor{keyword}{--                    This block handles all calibration commands which require}
07694 \textcolor{keyword}{--                    memory read operations.}
07695 \textcolor{keyword}{--}
07696 \textcolor{keyword}{--            These include:}
07697 \textcolor{keyword}{--                    Resync phase calibration - sweep of phases, calculation of}
07698 \textcolor{keyword}{--                                             result and optional storage to iram}
07699 \textcolor{keyword}{--                    Postamble calibration - clock cycle calibration of the postamble}
07700 \textcolor{keyword}{--                                            enable signal}
07701 \textcolor{keyword}{--                    Read data valid signal alignment}
07702 \textcolor{keyword}{--                    Calculation of advertised read and write latencies}
07703 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
07704 
07705 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
07706 \textcolor{vhdlkeyword}{    use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
07707 \textcolor{vhdlkeyword}{    use }ieee.numeric\_std.\textcolor{keywordflow}{all};
07708 
07709 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
07710 
07711 
07712 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
07713 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
07714 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
07715 \textcolor{keyword}{--}
07716 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
07717 
07718 \textcolor{keyword}{-- The address and command package (alt\_mem\_phy\_addr\_cmd\_pkg) is used to combine DRAM address}
07719 \textcolor{keyword}{-- and command signals in one record and unify the functions operating on this record.}
07720 \textcolor{keyword}{--}
07721 \textcolor{vhdlkeyword}{   use }work.ddr2_phy_alt_mem_phy_addr_cmd_pkg.\textcolor{keywordflow}{all};
07722 
07723 \textcolor{keyword}{-- The iram address package (alt\_mem\_phy\_iram\_addr\_pkg) is used to define the base addresses used}
07724 \textcolor{keyword}{-- for iram writes during calibration}
07725 \textcolor{keyword}{--}
07726 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_iram_addr_pkg.\textcolor{keywordflow}{all};
07727 
07728 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
07729 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
07730 \textcolor{keyword}{-- instances generics are used)}
07731 \textcolor{keyword}{--}
07732 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
07733 
07734 \textcolor{keyword}{--}
07735 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_dgrb \textcolor{keywordflow}{is}
07736     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
07737         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07738         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07739         \textcolor{vhdlchar}{MEM_IF_DWIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07740         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07741         \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07742         \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07743         \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07744         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07745         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
07746 
07747         \textcolor{vhdlchar}{ADV_LAT_WIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07748 
07749         \textcolor{vhdlchar}{CLOCK_INDEX_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07750 
07751         \textcolor{vhdlchar}{DWIDTH_RATIO}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07752         \textcolor{vhdlchar}{PRESET_RLAT}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07753 
07754         \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- number of PLL phase steps per PHY clock cycle}
07755 
07756         \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07757         \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07758 
07759         \textcolor{vhdlchar}{PRESET_CODVW_PHASE}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07760         \textcolor{vhdlchar}{PRESET_CODVW_SIZE}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07761 
07762 \textcolor{keyword}{        -- base column address to which calibration data is written}
07763 \textcolor{keyword}{        -- memory at MEM\_IF\_CAL\_BASE\_COL - MEM\_IF\_CAL\_BASE\_COL + C\_CAL\_DATA\_LEN - 1}
07764 \textcolor{keyword}{        -- is assumed to contain the proper data}
07765         \textcolor{vhdlchar}{MEM_IF_CAL_BANK}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- bank to which calibration data is written}
07766         \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07767         \textcolor{vhdlchar}{EN_OCT}                         \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
07768     \textcolor{vhdlchar}{)};
07769     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
07770 \textcolor{keyword}{        -- clk / reset}
07771         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07772         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07773 
07774 \textcolor{keyword}{        -- control interface}
07775         \textcolor{vhdlchar}{dgrb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_ctrl_stat};
07776         \textcolor{vhdlchar}{ctrl_dgrb}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_command};
07777         \textcolor{vhdlchar}{parameterisation_rec}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_algm_paramaterisation};
07778 
07779 \textcolor{keyword}{        -- PLL reconfig interface}
07780         \textcolor{vhdlchar}{phs_shft_busy}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07781         \textcolor{vhdlchar}{seq_pll_inc_dec_n}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07782         \textcolor{vhdlchar}{seq_pll_select}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{DOWNTO} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07783         \textcolor{vhdlchar}{seq_pll_start_reconfig}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07784         \textcolor{vhdlchar}{pll_resync_clk_index}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- PLL phase used to select resync clock}
07785         \textcolor{vhdlchar}{pll_measure_clk_index}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- PLL phase used to select mimic / aka measure clock}
07786 
07787 \textcolor{keyword}{        -- iram 'push' interface}
07788         \textcolor{vhdlchar}{dgrb_iram}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_iram_push};
07789         \textcolor{vhdlchar}{iram_push_done}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07790 
07791 \textcolor{keyword}{        -- addr/cmd output for write commands}
07792         \textcolor{vhdlchar}{dgrb_ac}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
07793 
07794 \textcolor{keyword}{        -- admin block req/gnt interface}
07795         \textcolor{vhdlchar}{dgrb_ac_access_req}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07796         \textcolor{vhdlchar}{dgrb_ac_access_gnt}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07797 
07798 \textcolor{keyword}{        -- RDV latency controls}
07799         \textcolor{vhdlchar}{seq_rdata_valid_lat_inc}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07800         \textcolor{vhdlchar}{seq_rdata_valid_lat_dec}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07801 
07802 \textcolor{keyword}{        -- POA latency controls}
07803         \textcolor{vhdlchar}{seq_poa_lat_dec_1x}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07804         \textcolor{vhdlchar}{seq_poa_lat_inc_1x}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07805 
07806 \textcolor{keyword}{        -- read datapath interface}
07807         \textcolor{vhdlchar}{rdata_valid}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07808         \textcolor{vhdlchar}{rdata}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07809         \textcolor{vhdlchar}{doing_rd}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07810         \textcolor{vhdlchar}{rd_lat}                         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07811 
07812 \textcolor{keyword}{        -- advertised write latency}
07813         \textcolor{vhdlchar}{wd_lat}                         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07814 
07815 \textcolor{keyword}{        -- OCT control}
07816         \textcolor{vhdlchar}{seq_oct_value}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07817         \textcolor{vhdlchar}{dgrb_wdp_ovride}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07818 
07819 \textcolor{keyword}{        -- mimic path interface}
07820         \textcolor{vhdlchar}{seq_mmc_start}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07821         \textcolor{vhdlchar}{mmc_seq_done}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07822         \textcolor{vhdlchar}{mmc_seq_value}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
07823 
07824 \textcolor{keyword}{        -- calibration byte lane select (reserved for future use - RFU)}
07825         \textcolor{vhdlchar}{ctl_cal_byte_lanes}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}  \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07826 
07827 \textcolor{keyword}{        -- odt settings per chip select}
07828         \textcolor{vhdlchar}{odt_settings}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_odt_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
07829 
07830 \textcolor{keyword}{        -- signal to identify if a/c nt setting is correct (set after wr\_lat calculation)}
07831 \textcolor{keyword}{        -- NOTE: labelled nt for future scalability to quarter rate interfaces}
07832         \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
07833 
07834 \textcolor{keyword}{        -- status signals on calibrated cdvw}
07835         \textcolor{vhdlchar}{dgrb_mmi}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_dgrb_mmi}
07836     \textcolor{vhdlchar}{)};
07837 
07838 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
07839 
07840 \textcolor{keyword}{--}
07841 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_dgrb is
07842 
07843 \textcolor{keyword}{-- ------------------------------------------------------------------}
07844 \textcolor{keyword}{--  constant declarations}
07845 \textcolor{keyword}{-- ------------------------------------------------------------------}
07846 
07847     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_seq_addr_cmd_config}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_config_rec} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_config\_rec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_ADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
07848 
07849 \textcolor{keyword}{    -- command/result length}
07850     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_command_result_len}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
07851 
07852 \textcolor{keyword}{    -- burst characteristics and latency characteristics}
07853     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_read_lat}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{rd_lat}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- maximum read latency in phy
       clock-cycles}
07854 
07855 \textcolor{keyword}{    -- training pattern characteristics}
07856     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_mtp_len}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16};
07857     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_mtp}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_cal_mtp_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"30F5"};
07858     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_mtp_t}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_mtp_len} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{
      DWIDTH_RATIO};\textcolor{keyword}{ -- number of phy-clk cycles required to read BTP}
07859 
07860 \textcolor{keyword}{    -- read/write latency defaults}
07861     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_default_rd_lat_slv}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_default_rd_lat}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ADV_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07862     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_default_wd_lat_slv}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_default_wr_lat}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ADV_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
07863 
07864 \textcolor{keyword}{    -- tracking reporting parameters}
07865     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_rsc_drift_in_phases}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{127};\textcolor{keyword}{  -- this must be a value of < 2^10 - 1 because
       of the range of signal codvw\_trk\_shift}
07866 
07867 
07868 \textcolor{keyword}{    -- Returns '1' when boolean b is True; '0' otherwise.}
07869     \textcolor{keywordflow}{function} active_high(b : \textcolor{keywordflow}{in} \textcolor{comment}{boolean}) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic} \textcolor{keywordflow}{is}
07870         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
07871 \textcolor{vhdlkeyword}{    begin}
07872         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{b} \textcolor{keywordflow}{then}
07873             \textcolor{vhdlchar}{r} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07874         \textcolor{keywordflow}{else}
07875             \textcolor{vhdlchar}{r} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
07876         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07877 
07878         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{r};
07879     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
07880 
07881 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
07882 \textcolor{keyword}{--}
07883     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{dgrb_report_prefix}        \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (dgrb) : "};
07884 
07885 \textcolor{keyword}{    -- Return the number of clock periods the resync clock should sweep.}
07886 \textcolor{keyword}{    --}
07887 \textcolor{keyword}{    -- On half-rate systems and in DQS-capture based systems a 720}
07888 \textcolor{keyword}{    -- to guarantee the resync window can be properly observed.}
07889     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{rsc\_sweep\_clk\_periods} \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
07890         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_num\_periods} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
07891 \textcolor{vhdlkeyword}{    begin}
07892         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
07893             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- families which use DQS capture require a 720 degree sweep
       for FR to show a window}
07894                 \textcolor{vhdlchar}{v\_num\_periods} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
07895             \textcolor{keywordflow}{else}
07896                 \textcolor{vhdlchar}{v\_num\_periods} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
07897             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07898         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
07899             \textcolor{vhdlchar}{v\_num\_periods} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
07900         \textcolor{keywordflow}{else}
07901             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported DWIDTH\_RATIO."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
07902         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
07903 
07904         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_num\_periods};
07905     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
07906 
07907 
07908 \textcolor{keyword}{    -- window for PLL sweep}
07909     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_phase_shifts}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rsc\_sweep\_clk\_periods}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE};
07910 
07911     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_phs_inc}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
07912     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_phs_dec}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic} \textcolor{vhdlchar}{:=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{c_pll_phs_inc};
07913 
07914 \textcolor{keyword}{-- ------------------------------------------------------------------}
07915 \textcolor{keyword}{--  type declarations}
07916 \textcolor{keyword}{-- ------------------------------------------------------------------}
07917 
07918 \textcolor{keyword}{    -- dgrb main state machine}
07919     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_dgrb_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
07920 \textcolor{keyword}{        -- idle state}
07921         \textcolor{vhdlchar}{s\_idle}\textcolor{vhdlchar}{,}
07922 \textcolor{keyword}{        -- request access to memory address/command bus from the admin block}
07923         \textcolor{vhdlchar}{s\_wait\_admin}\textcolor{vhdlchar}{,}
07924 \textcolor{keyword}{        -- relinquish address/command bus access}
07925         \textcolor{vhdlchar}{s\_release\_admin}\textcolor{vhdlchar}{,}
07926 \textcolor{keyword}{        -- wind back resync phase to a 'zero' point}
07927         \textcolor{vhdlchar}{s\_reset\_cdvw}\textcolor{vhdlchar}{,}
07928 \textcolor{keyword}{        -- perform resync phase sweep (used for MTP alignment checking and actual RRP sweep)}
07929         \textcolor{vhdlchar}{s\_test\_phases}\textcolor{vhdlchar}{,}
07930 \textcolor{keyword}{        -- processing to when checking MTP alignment}
07931         \textcolor{vhdlchar}{s\_read\_mtp}\textcolor{vhdlchar}{,}
07932 \textcolor{keyword}{        -- processing for RRP (read resync phase) sweep}
07933         \textcolor{vhdlchar}{s\_seek\_cdvw}\textcolor{vhdlchar}{,}
07934 \textcolor{keyword}{        -- clock cycle alignment of read data valid signal}
07935         \textcolor{vhdlchar}{s\_rdata\_valid\_align}\textcolor{vhdlchar}{,}
07936 \textcolor{keyword}{        -- calculate advertised read latency}
07937         \textcolor{vhdlchar}{s\_adv\_rd\_lat\_setup}\textcolor{vhdlchar}{,}
07938         \textcolor{vhdlchar}{s\_adv\_rd\_lat}\textcolor{vhdlchar}{,}
07939 \textcolor{keyword}{        -- calculate advertised write latency}
07940         \textcolor{vhdlchar}{s\_adv\_wd\_lat}\textcolor{vhdlchar}{,}
07941 \textcolor{keyword}{        -- postamble clock cycle calibration}
07942         \textcolor{vhdlchar}{s\_poa\_cal}\textcolor{vhdlchar}{,}
07943 \textcolor{keyword}{        -- tracking - setup and periodic update}
07944         \textcolor{vhdlchar}{s\_track}
07945     \textcolor{vhdlchar}{)};
07946 
07947 \textcolor{keyword}{    -- dgrb slave state machine for addr/cmd signals}
07948     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_ac_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
07949 \textcolor{keyword}{        -- idle state}
07950         \textcolor{vhdlchar}{s\_ac\_idle}\textcolor{vhdlchar}{,}
07951 \textcolor{keyword}{        -- wait X cycles (issuing NOP command) to flush address/command and DQ buses}
07952         \textcolor{vhdlchar}{s\_ac\_relax}\textcolor{vhdlchar}{,}
07953 \textcolor{keyword}{        -- read MTP pattern}
07954         \textcolor{vhdlchar}{s\_ac\_read\_mtp}\textcolor{vhdlchar}{,}
07955 \textcolor{keyword}{        -- read pattern for read data valid alignment}
07956         \textcolor{vhdlchar}{s\_ac\_read\_rdv}\textcolor{vhdlchar}{,}
07957 \textcolor{keyword}{        -- read pattern for POA calibration}
07958         \textcolor{vhdlchar}{s\_ac\_read\_poa\_mtp}\textcolor{vhdlchar}{,}
07959 \textcolor{keyword}{        -- read pattern to calculate advertised write latency}
07960         \textcolor{vhdlchar}{s\_ac\_read\_wd\_lat}
07961     \textcolor{vhdlchar}{)};
07962 
07963 \textcolor{keyword}{    -- dgrb slave state machine for read resync phase calibration}
07964     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_resync_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
07965 \textcolor{keyword}{        -- idle state}
07966         \textcolor{vhdlchar}{s\_rsc\_idle}\textcolor{vhdlchar}{,}
07967 \textcolor{keyword}{        -- shift resync phase by one}
07968         \textcolor{vhdlchar}{s\_rsc\_next\_phase}\textcolor{vhdlchar}{,}
07969 \textcolor{keyword}{        -- start test sequence for current pin and current phase}
07970         \textcolor{vhdlchar}{s\_rsc\_test\_phase}\textcolor{vhdlchar}{,}
07971 \textcolor{keyword}{        -- flush the read datapath}
07972         \textcolor{vhdlchar}{s\_rsc\_wait\_for\_idle\_dimm}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- wait until no longer driving}
07973         \textcolor{vhdlchar}{s\_rsc\_flush\_datapath}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- flush a/c path}
07974 \textcolor{keyword}{        -- sample DQ data to test phase}
07975         \textcolor{vhdlchar}{s\_rsc\_test\_dq}\textcolor{vhdlchar}{,}
07976 \textcolor{keyword}{        -- reset rsc phase to a zero position}
07977         \textcolor{vhdlchar}{s\_rsc\_reset\_cdvw}\textcolor{vhdlchar}{,}
07978         \textcolor{vhdlchar}{s\_rsc\_rewind\_phase}\textcolor{vhdlchar}{,}
07979 \textcolor{keyword}{        -- calculate the centre of resync window}
07980         \textcolor{vhdlchar}{s\_rsc\_cdvw\_calc}\textcolor{vhdlchar}{,}
07981         \textcolor{vhdlchar}{s\_rsc\_cdvw\_wait}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- wait for calc result}
07982 \textcolor{keyword}{        -- set rsc clock phase to centre of data valid window}
07983         \textcolor{vhdlchar}{s\_rsc\_seek\_cdvw}\textcolor{vhdlchar}{,}
07984 \textcolor{keyword}{        -- wait until all results written to iram}
07985         \textcolor{vhdlchar}{s\_rsc\_wait\_iram}\textcolor{keyword}{  -- only entered if GENERATE\_ADDITIONAL\_DBG\_RTL = 1}
07986     \textcolor{vhdlchar}{)};
07987 
07988 \textcolor{keyword}{    -- record definitions for window processing}
07989     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_win_processing_status} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{calculating}\textcolor{vhdlchar}{,}
07990                                       \textcolor{vhdlchar}{valid\_result}\textcolor{vhdlchar}{,}
07991                                       \textcolor{vhdlchar}{no\_invalid\_phases}\textcolor{vhdlchar}{,}
07992                                       \textcolor{vhdlchar}{multiple\_equal\_windows}\textcolor{vhdlchar}{,}
07993                                       \textcolor{vhdlchar}{no\_valid\_phases}
07994                                     \textcolor{vhdlchar}{)};
07995 
07996     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_window_processing} \textcolor{keywordflow}{is} \textcolor{keywordflow}{record}
07997         \textcolor{vhdlchar}{working_window}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}  \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
07998         \textcolor{vhdlchar}{first_good_edge}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{             -- pointer to first
       detected good edge}
07999         \textcolor{vhdlchar}{current_window_start}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08000         \textcolor{vhdlchar}{current_window_size}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08001         \textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08002         \textcolor{vhdlchar}{largest_window_start}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08003         \textcolor{vhdlchar}{largest_window_size}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08004         \textcolor{vhdlchar}{largest_window_centre} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08005         \textcolor{vhdlchar}{current_bit}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08006         \textcolor{vhdlchar}{window_centre_update}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08007         \textcolor{vhdlchar}{last_bit_value}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08008         \textcolor{vhdlchar}{valid_phase_seen}      \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
08009         \textcolor{vhdlchar}{invalid_phase_seen}    \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
08010         \textcolor{vhdlchar}{first_cycle}           \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
08011         \textcolor{vhdlchar}{multiple_eq_windows}   \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
08012         \textcolor{vhdlchar}{found_a_good_edge}     \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
08013         \textcolor{vhdlchar}{status}                \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_win_processing_status};
08014         \textcolor{vhdlchar}{windows_seen}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08015     \textcolor{keywordflow}{end} \textcolor{keywordflow}{record};
08016 
08017 \textcolor{keyword}{-- ------------------------------------------------------------------}
08018 \textcolor{keyword}{--  function and procedure definitions}
08019 \textcolor{keyword}{-- ------------------------------------------------------------------}
08020 
08021 \textcolor{keyword}{    -- Returns a string representation of a std\_logic\_vector.}
08022 \textcolor{keyword}{    -- Not synthesizable.}
08023     \textcolor{keywordflow}{function} str(v: \textcolor{comment}{std\_logic\_vector}) \textcolor{keywordflow}{return} \textcolor{comment}{string} \textcolor{keywordflow}{is}
08024         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{str\_value} \textcolor{vhdlchar}{:} \textcolor{comment}{string} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{v}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)};
08025         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{str\_len}   \textcolor{vhdlchar}{:} \textcolor{comment}{integer};
08026         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{c}         \textcolor{vhdlchar}{:} \textcolor{comment}{character};
08027 \textcolor{vhdlkeyword}{    begin}
08028         \textcolor{vhdlchar}{str\_len} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08029         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdlchar}{v}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range} \textcolor{keywordflow}{loop}
08030             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{v}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}
08031                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{c} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08032                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{c} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08033                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{c} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}?\textcolor{vhdlchar}{'};
08034             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
08035 
08036             \textcolor{vhdlchar}{str\_value}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{str\_len}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c};
08037             \textcolor{vhdlchar}{str\_len}            \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{str\_len} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08038         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08039         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{str\_value};
08040     \textcolor{keywordflow}{end} \textcolor{vhdlchar}{str};
08041 
08042 
08043 \textcolor{keyword}{    --  functions and procedures for window processing}
08044 
08045     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_window_processing} \textcolor{keywordflow}{is}
08046         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{output} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_window_processing};
08047 \textcolor{vhdlkeyword}{    begin}
08048         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08049         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08050         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_good_edge}       \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08051         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_start}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08052         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size}   \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08053         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08054         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_start}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08055         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size}   \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08056         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08057         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08058         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit}           \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08059         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{multiple_eq_windows}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08060         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{valid_phase_seen}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08061         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{invalid_phase_seen}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08062         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{found_a_good_edge}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08063         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status}                \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_valid\_phases};
08064         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle}           \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08065         \textcolor{vhdlchar}{output}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{windows_seen}          \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08066         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{output};
08067     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults};
08068 
08069 
08070     \textcolor{keywordflow}{procedure} initialise_window_for_proc ( working : \textcolor{keywordflow}{inout} t_window_processing ) \textcolor{keywordflow}{is}
08071         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_working\_window} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}  \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08072 \textcolor{vhdlkeyword}{    begin}
08073         \textcolor{vhdlchar}{v\_working\_window}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window};
08074         \textcolor{vhdlchar}{working}                      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
08075         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_working\_window};
08076         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{calculating};
08077         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle}          \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
08078         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08079         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{windows_seen}         \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08080     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure} \textcolor{vhdlchar}{initialise\_window\_for\_proc};
08081 
08082 
08083     \textcolor{keywordflow}{procedure} shift_window (working    : \textcolor{keywordflow}{inout} t_window_processing;
08084                             num\_phases : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_phase_shifts
08085                            )
08086     \textcolor{keywordflow}{is}
08087 \textcolor{vhdlkeyword}{    begin}
08088         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08089             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{invalid_phase_seen}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
08090         \textcolor{keywordflow}{else}
08091             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{valid_phase_seen}     \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
08092         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08093 
08094 \textcolor{keyword}{        -- general bit serial shifting of window and incrementing of current bit counter.}
08095         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{num\_phases} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
08096             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08097         \textcolor{keywordflow}{else}
08098             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08099         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08100 
08101         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08102         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
08103 
08104 \textcolor{keyword}{        --synopsis translate\_off}
08105 \textcolor{keyword}{        -- for simulation to make it simpler to see IF we are not using all the bits in the window}
08106         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdlchar}{H}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- for visual debug}
08107 \textcolor{keyword}{        --synopsis translate\_on}
08108         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{num\_phases} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value};
08109 
08110         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08111     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure} \textcolor{vhdlchar}{shift\_window};
08112 
08113 
08114     \textcolor{keywordflow}{procedure} find_centre_of_largest_data_valid_window
08115                              ( working    : \textcolor{keywordflow}{inout} t_window_processing;
08116                                num\_phases : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_phase_shifts
08117                               ) \textcolor{keywordflow}{is}
08118 \textcolor{vhdlkeyword}{    begin}
08119         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- not first call to procedure, then handle end conditions}
08120             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{found_a_good_edge} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- have been all way
       arround window  (circular)}
08121                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{valid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08122                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_valid\_phases};
08123                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{invalid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08124                       \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_invalid\_phases};
08125                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08126             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_good_edge} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if have found a good edge then
       complete a circular sweep to that edge}
08127                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{multiple_eq_windows} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
08128                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{multiple\_equal\_windows};
08129                 \textcolor{keywordflow}{else}
08130                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{valid\_result};
08131                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08132             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08133         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08134 
08135 \textcolor{keyword}{        -- start of a window condition}
08136         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08137             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_start}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit};
08138             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{   -- equivalent to assigning
       to one because if not in a window then it is set to 0}
08139             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update}  \textcolor{vhdlchar}{:=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update};
08140             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit};
08141 
08142             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{found_a_good_edge} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}\textcolor{keyword}{                          -- if have not yet found a
       good edge then store this value}
08143                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_good_edge}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit};
08144                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{found_a_good_edge} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
08145             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08146 
08147 \textcolor{keyword}{        -- end of window conditions}
08148         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08149 
08150             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size} \textcolor{vhdlchar}{>} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size} \textcolor{keywordflow}{then}
08151 
08152                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size};
08153                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_start}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_start};
08154                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre};
08155                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{multiple_eq_windows}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
08156 
08157             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size} \textcolor{keywordflow}{then}
08158 
08159                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{multiple_eq_windows}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
08160 
08161             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08162 
08163 \textcolor{keyword}{            -- put counter in here because start of window 1 is observed twice}
08164             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{found_a_good_edge} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
08165                 \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{windows_seen} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{windows_seen} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08166             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08167 
08168             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size}  \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08169 
08170         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      found_a_good_edge} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{  --note operand in brackets is excessive but for may provide power savings
       and makes visual inspection of simulatuion easier}
08171 
08172             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08173                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{num\_phases} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
08174                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      current_window_centre} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08175                 \textcolor{keywordflow}{else}
08176                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_centre} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08177                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08178             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08179 
08180             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update} \textcolor{vhdlchar}{:=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{window_centre_update};
08181 
08182             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_size} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08183         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08184 
08185         \textcolor{vhdlchar}{shift\_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{num\_phases}\textcolor{vhdlchar}{)};
08186     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure} \textcolor{vhdlchar}{find\_centre\_of\_largest\_data\_valid\_window};
08187 
08188 
08189     \textcolor{keywordflow}{procedure} find_last_failing_phase
08190                              ( working    : \textcolor{keywordflow}{inout} t_window_processing;
08191                                num\_phases : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_phase_shifts + \textcolor{vhdllogic}{1}
08192                               ) \textcolor{keywordflow}{is}
08193 \textcolor{vhdlkeyword}{    begin}
08194         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- not first call to procedure}
08195             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ --     and working.found\_a\_good\_edge = false then}
08196                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{valid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08197                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_valid\_phases};
08198                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{invalid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08199                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_invalid\_phases};
08200                 \textcolor{keywordflow}{else}
08201                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{valid\_result};
08202                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08203             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08204         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08205 
08206         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{calculating} \textcolor{keywordflow}{then}
08207             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_start} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit};
08208         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08209 
08210         \textcolor{vhdlchar}{shift\_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{num\_phases}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- shifts window and sets first\_cycle = false}
08211     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure} \textcolor{vhdlchar}{find\_last\_failing\_phase};
08212 
08213 
08214     \textcolor{keywordflow}{procedure} find_first_passing_phase
08215                              ( working    : \textcolor{keywordflow}{inout} t_window_processing;
08216                                num\_phases : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} 
      c_max_phase_shifts
08217                               ) \textcolor{keywordflow}{is}
08218 \textcolor{vhdlkeyword}{    begin}
08219         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{first_cycle} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- not first call to procedure}
08220             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ --     and working.found\_a\_good\_edge = false then}
08221                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{valid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08222                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_valid\_phases};
08223                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{invalid_phase_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
08224                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{no\_invalid\_phases};
08225                 \textcolor{keywordflow}{else}
08226                     \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{valid\_result};
08227                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08228             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08229         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08230 
08231         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{calculating} \textcolor{keywordflow}{then}
08232             \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_window_start} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_bit};
08233         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08234 
08235         \textcolor{vhdlchar}{shift\_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{num\_phases}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- shifts window and sets first\_cycle = false}
08236     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure} \textcolor{vhdlchar}{find\_first\_passing\_phase};
08237 
08238 
08239 \textcolor{keyword}{    -- shift in current pass/fail result to the working window}
08240     \textcolor{keywordflow}{procedure} shift_in(
08241                     working    : \textcolor{keywordflow}{inout} t_window_processing;
08242                     status     : \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
08243                     num\_phases : \textcolor{keywordflow}{in}    \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} c_max_phase_shifts
08244                 ) \textcolor{keywordflow}{is}
08245 \textcolor{vhdlkeyword}{    begin}
08246         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{last_bit_value}                        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08247         \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{num\_phases}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      status}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{working}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{num\_phases}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
08248     \textcolor{keywordflow}{end} \textcolor{keywordflow}{procedure};
08249 
08250 \textcolor{keyword}{    -- The following function sets the width over which}
08251 \textcolor{keyword}{    -- write latency should be repeated on the dq bus}
08252 \textcolor{keyword}{    -- the default value is MEM\_IF\_DQ\_PER\_DQS}
08253     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
08254 \textcolor{vhdlkeyword}{    begin}
08255         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS} \textcolor{keywordflow}{loop}
08256             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>=} \textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{keywordflow}{then}
08257                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS};
08258             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08259         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08260         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"the specified maximum write latency cannot be fully represented in the
       given number of DQ pins"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
08261                                     \textcolor{keyword}{"** NOTE: This may cause overflow when setting ctl\_wlat signal"} \textcolor{keywordflow}{
      severity} \textcolor{vhdlchar}{warning};
08262         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS};
08263     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
08264 
08265 \textcolor{keyword}{    -- extract PHY 'addr/cmd' to 'wdata\_valid' write latency from current read data}
08266 -    \textcolor{keywordflow}{function} wd_lat_from_rdata(\textcolor{keywordflow}{signal} rdata : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(DWIDTH_RATIO * 
      MEM_IF_DWIDTH  \textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}))
08267             \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
08268         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_wd\_lat} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08269 \textcolor{vhdlkeyword}{    begin}
08270         \textcolor{vhdlchar}{v\_wd\_lat} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08271 
08272         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{>=} \textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{keywordflow}{then}
08273             \textcolor{vhdlchar}{v\_wd\_lat} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_wd\_lat}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08274         \textcolor{keywordflow}{else}
08275             \textcolor{vhdlchar}{v\_wd\_lat}                                   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08276             \textcolor{vhdlchar}{v\_wd\_lat}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08277         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08278 
08279         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_wd\_lat};
08280     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
08281 
08282 \textcolor{keyword}{    -- check if rdata\_valid is correctly aligned}
08283 --    \textcolor{keywordflow}{function} rdata_valid_aligned(
08284                 \textcolor{keywordflow}{signal} rdata       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(DWIDTH_RATIO * 
      MEM_IF_DWIDTH  \textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
08285                 \textcolor{keywordflow}{signal} rdata_valid : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(DWIDTH\_RATIO/2  \textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
08286             ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic} \textcolor{keywordflow}{is}
08287 
08288         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_dq\_rdata}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08289         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_aligned}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08290 \textcolor{vhdlkeyword}{    begin}
08291 \textcolor{keyword}{        -- Look at data from a single DQ pin 0 (DWIDTH\_RATIO data bits)}
08292         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
08293             \textcolor{vhdlchar}{v\_dq\_rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{)};
08294         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08295 
08296 \textcolor{keyword}{        -- Check each alignment (necessary because in the HR case rdata can be in any alignment)}
08297         \textcolor{vhdlchar}{v\_aligned} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08298         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
08299             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata_valid}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08300                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_dq\_rdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{i} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{then}
08301                     \textcolor{vhdlchar}{v\_aligned} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08302                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08303             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08304         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08305 
08306         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_aligned};
08307     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
08308 
08309 
08310 \textcolor{keyword}{    -- set severity level for calibration failures}
08311     \textcolor{keywordflow}{function} set_cal_fail_sev_level (
08312         generate\_additional\_debug\_rtl : \textcolor{comment}{natural}
08313         ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{severity\_level} \textcolor{keywordflow}{is}
08314 \textcolor{vhdlkeyword}{    begin}
08315         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{generate\_additional\_debug\_rtl} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
08316             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{warning};
08317         \textcolor{keywordflow}{else}
08318             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{failure};
08319         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08320     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
08321 
08322     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{cal_fail_sev_level} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{severity\_level} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_cal\_fail\_sev\_level}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      GENERATE_ADDITIONAL_DBG_RTL}\textcolor{vhdlchar}{)};
08323 
08324 \textcolor{keyword}{-- ------------------------------------------------------------------}
08325 \textcolor{keyword}{--  signal declarations}
08326 \textcolor{keyword}{-- rsc = resync - the mechanism of capturing DQ pin data onto a local clock domain}
08327 \textcolor{keyword}{-- trk = tracking - a mechanism to track rsc clock phase with PVT variations}
08328 \textcolor{keyword}{-- poa = postamble - protection circuitry from postamble glitched on DQS}
08329 \textcolor{keyword}{-- ac  = memory address / command signals}
08330 \textcolor{keyword}{-- ------------------------------------------------------------------}
08331 
08332 \textcolor{keyword}{    -- main state machine}
08333     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dgrb_state}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_dgrb_state};
08334     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dgrb_last_state}        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_dgrb_state};
08335 
08336     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_req}                \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_resync_state};\textcolor{keyword}{ -- tells resync block which state to transition to.}
08337 
08338 \textcolor{keyword}{    -- centre of data-valid window process}
08339     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_cdvw_state}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_window_processing};
08340 
08341 \textcolor{keyword}{    -- control signals for the address/command process}
08342     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_addr_cmd}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
08343     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_ac_req}                 \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ac_state};
08344     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dimm_driving_dq}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08345     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_doing_rd}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08346     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_ac_even}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- odd/even count of PHY clock cycles.}
08347 \textcolor{keyword}{        --}
08348 \textcolor{keyword}{        --  sig\_ac\_even behaviour}
08349 \textcolor{keyword}{        --}
08350 \textcolor{keyword}{        --  sig\_ac\_even is always '1' on the cycle a command is issued.  It will}
08351 \textcolor{keyword}{        -- be '1' on even clock cycles thereafter and '0' otherwise.}
08352 \textcolor{keyword}{        --}
08353 \textcolor{keyword}{        --                    ;         ;         ;         ;         ;         ;}
08354 \textcolor{keyword}{        --                    ; \_\_\_\_\_\_\_ ;         ;         ;         ;         ;}
08355 \textcolor{keyword}{        --               XXXXX /       \(\backslash\) XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
08356 \textcolor{keyword}{        --      addr/cmd XXXXXX   CMD   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
08357 \textcolor{keyword}{        --               XXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
08358 \textcolor{keyword}{        --                    ;         ;         ;         ;         ;         ;}
08359 \textcolor{keyword}{        --                    ;         ;         ;         ;         ;         ;}
08360 \textcolor{keyword}{        --                     \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_}
08361 \textcolor{keyword}{        --   sig\_ac\_even  \_\_\_\_|         |\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_\_}
08362 \textcolor{keyword}{        --                    ;         ;         ;         ;         ;         ;}
08363 \textcolor{keyword}{        --                    ;         ;         ;         ;         ;         ;}
08364 \textcolor{keyword}{        --   phy clk}
08365 \textcolor{keyword}{        --    count               (0)       (1)       (2)       (3)       (4)}
08366 \textcolor{keyword}{        --}
08367 \textcolor{keyword}{        --}
08368 
08369 \textcolor{keyword}{    -- resync related signals}
08370     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_ack}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08371     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_err}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08372     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_result}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_command_result_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{vhdlchar}{)};
08373 
08374     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_cdvw_phase}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08375     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_cdvw_shift_in}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08376     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_cdvw_calc}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08377 
08378     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08379     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08380 
08381     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_ac_access_req}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- High when the resync block requires a training
       pattern to be read.}
08382 
08383 \textcolor{keyword}{    -- tracking related signals}
08384     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_ack}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08385     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_err}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08386     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_result}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_command_result_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{vhdlchar}{)};
08387 
08388     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_cdvw_phase}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08389     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_cdvw_shift_in}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08390     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_cdvw_calc}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08391 
08392     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08393     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_pll_select}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{DOWNTO} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08394     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08395 
08396     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_rsc_drift}          \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{c_max_rsc_drift_in_phases} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{
      c_max_rsc_drift_in_phases};\textcolor{keyword}{  -- stores total change in rsc phase from first calibration}
08397 
08398 \textcolor{keyword}{    -- phs\_shft\_busy could (potentially) be asynchronous}
08399 \textcolor{keyword}{    -- triple register it for metastability hardening}
08400 \textcolor{keyword}{    -- these signals are the taps on the shift register}
08401     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_phs_shft_busy}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08402     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_phs_shft_busy_1t}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08403     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_phs_shft_start}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08404     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_phs_shft_end}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08405 
08406 \textcolor{keyword}{    -- locally register crl\_dgrb to minimise fan out}
08407     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_dgrb_r}                \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_command};
08408 
08409 \textcolor{keyword}{    -- command\_op signals}
08410     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_cs}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08411     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_mtp_almt}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08412     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{single_bit_cal}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08413 
08414 \textcolor{keyword}{    -- codvw status signals (packed into record and sent to mmi block)}
08415     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cal_codvw_phase}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08416     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{codvw_trk_shift}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08417     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cal_codvw_size}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08418 
08419 \textcolor{keyword}{    -- error signal and result from main state machine (operations other than rsc or tracking)}
08420     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_cmd_err}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08421     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_cmd_result}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_command_result_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{vhdlchar}{)};
08422 
08423 
08424 \textcolor{keyword}{    -- signals that the training pattern matched correctly on the last clock}
08425 \textcolor{keyword}{    -- cycle.}
08426     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dq_pin_ctr}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08427     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mtp_match}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08428 
08429 \textcolor{keyword}{    -- controls postamble match and timing.}
08430     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_poa_match_en}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08431     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_poa_match}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08432 
08433 \textcolor{keyword}{    -- postamble signals}
08434     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_poa_ack}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{  -- '1' for postamble block to acknowledge.}
08435 
08436 \textcolor{keyword}{    -- calibration byte lane select}
08437     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cal_byte_lanes}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}  \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08438 
08439     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{codvw_grt_one_dvw}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08440 
08441 \textcolor{vhdlkeyword}{begin}
08442 
08443 
08444     \textcolor{vhdlchar}{doing_rd}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_doing_rd};
08445 
08446 \textcolor{keyword}{    -- pack record of codvw status signals}
08447     \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_phase}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cal_codvw_phase};
08448     \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_trk_shift}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{codvw_trk_shift};
08449     \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_codvw_size}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cal_codvw_size};
08450     \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{codvw_grt_one_dvw};
08451 
08452 \textcolor{keyword}{    -- map some internal signals to outputs}
08453     \textcolor{vhdlchar}{dgrb_ac} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_addr_cmd};
08454 
08455 \textcolor{keyword}{    -- locally register crl\_dgrb to minimise fan out}
08456     \textcolor{keywordflow}{process} (clk, rst_n)
08457 \textcolor{vhdlkeyword}{    begin}
08458         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08459             \textcolor{vhdlchar}{ctrl_dgrb_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
08460         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08461             \textcolor{vhdlchar}{ctrl_dgrb_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_dgrb};
08462         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08463     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08464 
08465 \textcolor{keyword}{    -- generate the current\_cs signal to track which cs accessed by PHY at any instance}
08466     current\_cs\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
08467 \textcolor{vhdlkeyword}{    begin}
08468         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08469             \textcolor{vhdlchar}{current_cs}       \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08470             \textcolor{vhdlchar}{current_mtp_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08471             \textcolor{vhdlchar}{single_bit_cal}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08472 
08473             \textcolor{vhdlchar}{cal_byte_lanes}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08474 
08475         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08476             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08477                 \textcolor{vhdlchar}{current_cs}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs};
08478                 \textcolor{vhdlchar}{current_mtp_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mtp_almt};
08479                 \textcolor{vhdlchar}{single_bit_cal}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{single_bit};
08480             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08481 
08482 \textcolor{keyword}{            -- mux byte lane select for given chip select}
08483             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
08484                 \textcolor{vhdlchar}{cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctl_cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)};
08485             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08486 
08487             \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{ctl_cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" Byte lane 0 (chip select 0)
       disable is not supported - ending simulation"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
08488         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08489     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08490 
08491 
08492 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08493 \textcolor{keyword}{    -- main state machine for dgrb architecture}
08494 \textcolor{keyword}{    --}
08495 \textcolor{keyword}{    -- process of commands from control (ctrl) block and overall control of}
08496 \textcolor{keyword}{    -- the subsequent calibration processing functions}
08497 \textcolor{keyword}{    -- also communicates completion and any errors back to the ctrl block}
08498 \textcolor{keyword}{    -- read data valid alignment and advertised latency calculations are}
08499 \textcolor{keyword}{    -- included in this block}
08500 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08501 
08502     \textcolor{vhdlchar}{dgrb\_main\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
08503         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_count}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08504         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_wd_lat}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
08505 \textcolor{vhdlkeyword}{    begin}
08506         dgrb\_state\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
08507 \textcolor{vhdlkeyword}{        begin}
08508             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08509 \textcolor{keyword}{                -- initialise state}
08510                 \textcolor{vhdlchar}{sig_dgrb_state}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
08511                 \textcolor{vhdlchar}{sig_dgrb_last_state}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
08512 
08513                 \textcolor{vhdlchar}{sig_ac_req}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
08514                 \textcolor{vhdlchar}{sig_rsc_req}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
08515 
08516 \textcolor{keyword}{                -- set up rd\_lat defaults}
08517                 \textcolor{vhdlchar}{rd_lat}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_default_rd_lat_slv};
08518                 \textcolor{vhdlchar}{wd_lat}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_default_wd_lat_slv};
08519 
08520 \textcolor{keyword}{                -- set up rdata\_valid latency control defaults}
08521                 \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08522                 \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08523 
08524 \textcolor{keyword}{                -- reset counter}
08525                 \textcolor{vhdlchar}{sig_count}               \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08526 
08527 \textcolor{keyword}{                -- error signals}
08528                 \textcolor{vhdlchar}{sig_cmd_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08529                 \textcolor{vhdlchar}{sig_cmd_result}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08530 
08531 \textcolor{keyword}{                -- sig\_wd\_lat}
08532                 \textcolor{vhdlchar}{sig_wd_lat}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08533 
08534 \textcolor{keyword}{                -- status of the ac\_nt alignment}
08535                 \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08536 
08537             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08538                 \textcolor{vhdlchar}{sig_dgrb_last_state}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dgrb_state};
08539                 \textcolor{vhdlchar}{sig_rsc_req}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
08540 
08541 \textcolor{keyword}{                -- set up rdata\_valid latency control defaults}
08542                 \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08543                 \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08544 
08545 \textcolor{keyword}{                -- error signals}
08546                 \textcolor{vhdlchar}{sig_cmd_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08547                 \textcolor{vhdlchar}{sig_cmd_result}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08548 
08549 \textcolor{keyword}{                -- register wd\_lat output.}
08550                 \textcolor{vhdlchar}{wd_lat}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_wd_lat};
08551 
08552                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{keywordflow}{is}
08553                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08554                         \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08555 
08556                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08557                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{dgrb} \textcolor{keywordflow}{then}
08558                                 \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_wait\_admin};
08559                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08560                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08561 
08562                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
08563 
08564 
08565                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_wait\_admin} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08566                         \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_wait\_admin};
08567 
08568                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
08569 
08570                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_read\_mtp}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_read\_mtp};
08571                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_reset}       \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset\_cdvw};
08572                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_sweep}       \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_test\_phases};
08573                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_seek}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_seek\_cdvw};
08574                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rdv}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rdata\_valid\_align};
08575                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_prep\_adv\_rd\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_adv\_rd\_lat\_setup};
08576                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_prep\_adv\_wr\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_adv\_wd\_lat};
08577                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_tr\_due}          \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_track};
08578                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_poa}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_poa\_cal};
08579 
08580                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08581                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unknown command"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
08582                                 \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
08583                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
08584 
08585 
08586                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset\_cdvw} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08587 \textcolor{keyword}{                        -- the cdvw proc watches for this state and resets the cdvw}
08588 \textcolor{keyword}{                        -- state block.}
08589                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08590                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08591                         \textcolor{keywordflow}{else}
08592                             \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_reset\_cdvw};
08593                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08594 
08595 
08596                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_test\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08597                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08598                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08599                         \textcolor{keywordflow}{else}
08600                             \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_test\_phase};
08601                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08602                                 \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_mtp};
08603                             \textcolor{keywordflow}{else}
08604                                 \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
08605                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08606                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08607 
08608 
08609                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_seek\_cdvw} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08610                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08611                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08612                         \textcolor{keywordflow}{else}
08613                             \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_cdvw\_calc};
08614                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08615 
08616 
08617                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08618                         \textcolor{vhdlchar}{sig_ac_req}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
08619 
08620                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgrb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08621                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
08622                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08623 
08624 
08625                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rdata\_valid\_align} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08626                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_rdv};
08627 
08628                         \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08629                         \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08630 
08631                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08632 \textcolor{keyword}{                            -- only do comparison if rdata\_valid is all 'ones'}
08633                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata_valid} \textcolor{vhdlchar}{/=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08634 \textcolor{keyword}{                                -- rdata\_valid is all ones}
08635                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata\_valid\_aligned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{rdata_valid}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08636 \textcolor{keyword}{                                    -- success: rdata\_valid and rdata are properly aligned}
08637                                     \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08638                                 \textcolor{keywordflow}{else}
08639 \textcolor{keyword}{                                    -- misaligned: bring in rdata\_valid by a clock cycle}
08640                                     \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08641                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08642                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08643                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08644 
08645 
08646                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08647 \textcolor{keyword}{                        -- wait for sig\_doing\_rd to go high}
08648                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_rdv};
08649 
08650                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgrb_last_state} \textcolor{keywordflow}{then}
08651                             \textcolor{vhdlchar}{rd_lat}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08652                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08653                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_doing_rd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{2-1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08654 \textcolor{keyword}{                            -- a read has started: start counter}
08655                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_adv\_rd\_lat};
08656                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08657 
08658 
08659                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08660                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_rdv};
08661 
08662                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08663                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{>=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{rd_lat}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{keywordflow}{then}
08664                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"maximum read latency exceeded while waiting
       for rdata\_valid"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{cal_fail_sev_level};
08665                                 \textcolor{vhdlchar}{sig_cmd_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08666                                 \textcolor{vhdlchar}{sig_cmd_result}          \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_MAX_RD_LAT_EXCEEDED}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{sig_cmd_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
08667                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08668 
08669                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata_valid} \textcolor{vhdlchar}{/=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      rdata_valid}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08670 \textcolor{keyword}{                                -- have found the read latency}
08671                                 \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08672                             \textcolor{keywordflow}{else}
08673                                 \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08674                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08675 
08676                             \textcolor{vhdlchar}{rd_lat} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      rd_lat}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
08677                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08678 
08679 
08680                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_wd\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08681                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_wd\_lat};
08682 
08683                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgrb_last_state} \textcolor{keywordflow}{then}
08684                             \textcolor{vhdlchar}{sig_wd_lat} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08685                         \textcolor{keywordflow}{else}
08686                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{rdata_valid} \textcolor{vhdlchar}{/=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{,}
       \textcolor{vhdlchar}{rdata_valid}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08687 \textcolor{keyword}{                                -- construct wd\_lat using data from the lowest addresses}
08688 \textcolor{keyword}{                                -- wd\_lat <= rdata(MEM\_IF\_DQ\_PER\_DQS - 1 downto 0);}
08689                                 \textcolor{vhdlchar}{sig_wd_lat}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{wd\_lat\_from\_rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{)};
08690                                 \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08691 
08692 \textcolor{keyword}{                                -- check data integrity}
08693                                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
08694 \textcolor{keyword}{                                    -- wd\_lat is copied across MEM\_IF\_DWIDTH bits in fields of width
       MEM\_IF\_DQ\_PER\_DQS.}
08695 \textcolor{keyword}{                                    -- All of these fields must have the same value or it is an error.}
08696 
08697 \textcolor{keyword}{                                    -- only check if byte lane not disabled}
08698                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{
      MEM_IF_DQ_PER_DQS}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08699 
08700                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{
      rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08701 \textcolor{keyword}{                                            -- signal write latency different between DQS groups}
08702                                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"the write latency read from memory
       is different accross dqs groups"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{cal_fail_sev_level};
08703                                             \textcolor{vhdlchar}{sig_cmd_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08704                                             \textcolor{vhdlchar}{sig_cmd_result}          \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_WD_LAT_DISAGREEMENT}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_cmd_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
08705                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08706                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08707 
08708                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08709 
08710 \textcolor{keyword}{                                -- check if ac\_nt alignment is ok}
08711 \textcolor{keyword}{                                -- in this condition all DWIDTH\_RATIO copies of rdata should be identical}
08712                                 \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08713                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
08714                                     \textcolor{keywordflow}{for} \textcolor{vhdlchar}{j} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
08715                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{j}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      MEM_IF_DQ_PER_DQS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{j}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{j}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      MEM_IF_DQ_PER_DQS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{j}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08716                                             \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08717                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08718                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
08719                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08720 
08721                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08722                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08723 
08724 
08725                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa\_cal} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08726 \textcolor{keyword}{                        -- Request the address/command block begins reading the "M"}
08727 \textcolor{keyword}{                        -- training pattern here.  There is no provision for doing}
08728 \textcolor{keyword}{                        -- refreshes so this limits the time spent in this state}
08729 \textcolor{keyword}{                        -- to 9 x tREFI (by the DDR2 JEDEC spec).  Instead of the}
08730 \textcolor{keyword}{                        -- maximum value, a maximum "safe" time in this postamble}
08731 \textcolor{keyword}{                        -- state is chosen to be tpoamax = 5 x tREFI = 5 x 3.9us.}
08732 \textcolor{keyword}{                        -- When entering this s\_poa\_cal state it must be guaranteed}
08733 \textcolor{keyword}{                        -- that the number of stacked refreshes is at maximum.}
08734 \textcolor{keyword}{                        --}
08735 \textcolor{keyword}{                        -- Minimum clock freq supported by DRAM is fck,min=125MHz.}
08736 \textcolor{keyword}{                        -- Each adjustment to postamble latency requires 16*clock}
08737 \textcolor{keyword}{                        -- cycles (time to read "M" training pattern twice) so}
08738 \textcolor{keyword}{                        -- maximum number of adjustments to POA latency (n) is:}
08739 \textcolor{keyword}{                        --}
08740 \textcolor{keyword}{                        --   n = (5 x trefi x fck,min) / 16}
08741 \textcolor{keyword}{                        --     = (5 x 3.9us x 125MHz) / 16}
08742 \textcolor{keyword}{                        --     ~ 152}
08743 \textcolor{keyword}{                        --}
08744 \textcolor{keyword}{                        -- Postamble latency must be adjusted less than 152 cycles}
08745 \textcolor{keyword}{                        -- to meet this requirement.}
08746 \textcolor{keyword}{                        --}
08747 
08748                         \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_read\_poa\_mtp};
08749 
08750                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_poa_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08751                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08752                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08753 
08754                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_track} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08755                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_trk_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08756                             \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08757                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08758 
08759 
08760                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{null};
08761                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"undefined state"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
08762                         \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
08763                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
08764 
08765 
08766 \textcolor{keyword}{                -- default if not calibrating go to idle state via s\_release\_admin}
08767                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_idle} \textcolor{keywordflow}{and}
08768                    \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{and}
08769                    \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{keywordflow}{then}
08770 
08771                     \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
08772                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08773 
08774             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08775         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08776     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
08777 
08778 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08779 \textcolor{keyword}{    -- metastability hardening of potentially async phs\_shift\_busy signal}
08780 \textcolor{keyword}{    --}
08781 \textcolor{keyword}{    -- Triple register it for metastability hardening.  This process}
08782 \textcolor{keyword}{    -- creates the shift register.  Also add a sig\_phs\_shft\_busy and}
08783 \textcolor{keyword}{    -- an sig\_phs\_shft\_busy\_1t echo because various other processes find}
08784 \textcolor{keyword}{    -- this useful.}
08785 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08786     \textcolor{vhdlchar}{phs\_shft\_busy\_reg}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
08787             \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{phs_shft_busy_1r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08788             \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{phs_shft_busy_2r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08789             \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{phs_shft_busy_3r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08790 \textcolor{vhdlkeyword}{    begin}
08791         phs\_shift\_busy\_sync : \textcolor{keywordflow}{process} (clk, rst_n)
08792 \textcolor{vhdlkeyword}{        begin}
08793             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08794                 \textcolor{vhdlchar}{sig_phs_shft_busy}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08795                 \textcolor{vhdlchar}{sig_phs_shft_busy_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08796 
08797                 \textcolor{vhdlchar}{phs_shft_busy_1r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08798                 \textcolor{vhdlchar}{phs_shft_busy_2r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08799                 \textcolor{vhdlchar}{phs_shft_busy_3r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08800 
08801                 \textcolor{vhdlchar}{sig_phs_shft_start}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08802                 \textcolor{vhdlchar}{sig_phs_shft_end}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08803 
08804             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08805                 \textcolor{vhdlchar}{sig_phs_shft_busy_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_3r};
08806                 \textcolor{vhdlchar}{sig_phs_shft_busy}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_2r};
08807 
08808 \textcolor{keyword}{                -- register the below to reduce fan out on sig\_phs\_shft\_busy and sig\_phs\_shft\_busy\_1t}
08809                 \textcolor{vhdlchar}{sig_phs_shft_start}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_3r} \textcolor{keywordflow}{or}  \textcolor{vhdlchar}{phs_shft_busy_2r};
08810                 \textcolor{vhdlchar}{sig_phs_shft_end}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_3r} \textcolor{keywordflow}{and} \textcolor{keywordflow}{not}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      phs_shft_busy_2r}\textcolor{vhdlchar}{)};
08811 
08812                 \textcolor{vhdlchar}{phs_shft_busy_3r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_2r};
08813                 \textcolor{vhdlchar}{phs_shft_busy_2r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy_1r};
08814                 \textcolor{vhdlchar}{phs_shft_busy_1r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{phs_shft_busy};
08815             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08816         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08817     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
08818 
08819 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08820 \textcolor{keyword}{    -- PLL reconfig MUX}
08821 \textcolor{keyword}{    --}
08822 \textcolor{keyword}{    -- switches PLL Reconfig input between tracking and resync blocks}
08823 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08824     pll\_reconf\_mux : \textcolor{keywordflow}{process} (clk, rst_n)
08825 \textcolor{vhdlkeyword}{    begin}
08826         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08827             \textcolor{vhdlchar}{seq_pll_inc_dec_n}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08828             \textcolor{vhdlchar}{seq_pll_select}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
08829             \textcolor{vhdlchar}{seq_pll_start_reconfig}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08830         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08831             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_seek\_cdvw} \textcolor{keywordflow}{or}
08832                \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_test\_phases} \textcolor{keywordflow}{or}
08833                \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset\_cdvw} \textcolor{keywordflow}{then}
08834                 \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_resync_clk_index};
08835                 \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n};
08836                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig};
08837             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_track} \textcolor{keywordflow}{then}
08838                 \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_pll_select};
08839                 \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n};
08840                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_pll_start_reconfig};
08841             \textcolor{keywordflow}{else}
08842                 \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_measure_clk_index};
08843                 \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08844                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08845             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08846         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08847     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08848 
08849 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08850 \textcolor{keyword}{    -- Centre of data valid window calculation block}
08851 \textcolor{keyword}{    --}
08852 \textcolor{keyword}{    -- This block handles the sharing of the centre of window calculation}
08853 \textcolor{keyword}{    -- logic between the rsc and trk operations. Functions defined in the}
08854 \textcolor{keyword}{    -- header of this entity are called to do this.}
08855 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08856     \textcolor{vhdlchar}{cdvw\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
08857         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_cdvw_calc_1t} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08858 \textcolor{vhdlkeyword}{    begin}
08859 \textcolor{keyword}{        -- purpose: manages centre of data valid window calculations}
08860 \textcolor{keyword}{        -- type   : sequential}
08861 \textcolor{keyword}{        -- inputs : clk, rst\_n}
08862 \textcolor{keyword}{        -- outputs: sig\_cdvw\_state}
08863         cdvw\_proc: \textcolor{keywordflow}{process} (clk, rst_n)
08864             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cdvw\_state}  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_window_processing};
08865             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_start\_calc}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08866             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_shift\_in}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08867             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_phase}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08868 \textcolor{vhdlkeyword}{        begin }\textcolor{keyword}{ -- process cdvw\_proc}
08869             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{             -- asynchronous reset (active low)}
08870 
08871                 \textcolor{vhdlchar}{sig_cdvw_state}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
08872                 \textcolor{vhdlchar}{sig_cdvw_calc_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08873 
08874             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- rising clock edge}
08875                 \textcolor{vhdlchar}{v\_cdvw\_state} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_cdvw_state};
08876 
08877                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{keywordflow}{is}
08878                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_track} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08879                     \textcolor{vhdlchar}{v\_start\_calc} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_trk_cdvw_calc};
08880                     \textcolor{vhdlchar}{v\_phase} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_trk_cdvw_phase};
08881                     \textcolor{vhdlchar}{v\_shift\_in} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_trk_cdvw_shift_in};
08882 
08883                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_seek\_cdvw} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_test\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08884                     \textcolor{vhdlchar}{v\_start\_calc} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_rsc_cdvw_calc};
08885                     \textcolor{vhdlchar}{v\_phase}      \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_rsc_cdvw_phase};
08886                     \textcolor{vhdlchar}{v\_shift\_in}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{sig_rsc_cdvw_shift_in};
08887 
08888                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
08889                     \textcolor{vhdlchar}{v\_start\_calc} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08890                     \textcolor{vhdlchar}{v\_phase} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08891                     \textcolor{vhdlchar}{v\_shift\_in} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08892                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
08893 
08894                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset\_cdvw} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_track} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      sig_dgrb_last_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_track}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08895 \textcolor{keyword}{                    -- reset *C*entre of *D*ata *V*alid *W*indow}
08896                     \textcolor{vhdlchar}{v\_cdvw\_state} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
08897                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_cdvw_calc_1t} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{v\_start\_calc} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08898                     \textcolor{vhdlchar}{initialise\_window\_for\_proc}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{)};
08899                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{calculating} \textcolor{keywordflow}{then}
08900                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_track} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- ensure 360 degrees sweep}
08901                         \textcolor{vhdlchar}{find\_centre\_of\_largest\_data\_valid\_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{)};
08902                     \textcolor{keywordflow}{else}\textcolor{keyword}{ -- can be a 720 degrees sweep}
08903                         \textcolor{vhdlchar}{find\_centre\_of\_largest\_data\_valid\_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      c_max_phase_shifts}\textcolor{vhdlchar}{)};
08904                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08905                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{v\_shift\_in} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08906                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_track} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- ensure 360 degrees sweep}
08907                         \textcolor{vhdlchar}{shift\_in}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_phase}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{)};
08908                     \textcolor{keywordflow}{else}
08909                         \textcolor{vhdlchar}{shift\_in}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cdvw\_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_phase}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{c_max_phase_shifts}\textcolor{vhdlchar}{)};
08910                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08911                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08912 
08913                 \textcolor{vhdlchar}{sig_cdvw_calc_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_start\_calc};
08914                 \textcolor{vhdlchar}{sig_cdvw_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_cdvw\_state};
08915             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08916         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process} \textcolor{vhdlchar}{cdvw\_proc};
08917     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
08918 
08919 
08920 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08921 \textcolor{keyword}{    -- block for resync calculation.}
08922 \textcolor{keyword}{    --}
08923 \textcolor{keyword}{    -- This block implements the following:}
08924 \textcolor{keyword}{    -- 1) Control logic for the rsc slave state machine}
08925 \textcolor{keyword}{    -- 2) Processing of resync operations - through reports form cdvw block and}
08926 \textcolor{keyword}{    --    test pattern match blocks}
08927 \textcolor{keyword}{    -- 3) Shifting of the resync phase for rsc sweeps}
08928 \textcolor{keyword}{    -- 4) Writing of results to iram (optional)}
08929 \textcolor{keyword}{    -- ------------------------------------------------------------------}
08930     \textcolor{vhdlchar}{rsc\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
08931 
08932         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_state}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_resync_state};
08933         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_last_state}        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_resync_state};
08934 
08935         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_num_phase_shifts}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
08936 
08937         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rewind_direction}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08938         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_count}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
08939         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_test_dq_expired}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08940         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_chkd_all_dq_pins}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08941 
08942 \textcolor{keyword}{        -- prompts to write data to iram}
08943         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dgrb_iram}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_iram_push};\textcolor{keyword}{                               -- internal copy of
       dgrb to iram control signals}
08944         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_push_rrp_sweep}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                 -- push result of a
       rrp sweep pass (for cmd\_rrp\_sweep)}
08945         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_push_rrp_pass}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                 -- result of a rrp
       sweep result (for cmd\_rrp\_sweep)}
08946         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_push_rrp_seek}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                 -- write seek results
       (for cmd\_rrp\_seek / cmd\_read\_mtp states)}
08947         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_push_footer}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                 -- write a footer}
08948         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dq_pin_ctr_r}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{      -- registered version
       of dq\_pin\_ctr}
08949         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_curr_phase}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- which phase is
       being processed}
08950         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_iram_idle}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                 -- track if iram
       currently writing data}
08951         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mtp_match_en}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08952 
08953 \textcolor{keyword}{        -- current byte lane disabled?}
08954         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_curr_byte_ln_dis}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08955 
08956         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_iram_wds_req}          \textcolor{vhdlchar}{:} \textcolor{comment}{integer};\textcolor{keyword}{  -- words required for a given iram dump (used to
       locate where to write footer)}
08957 
08958 \textcolor{vhdlkeyword}{    begin}
08959 \textcolor{keyword}{        -- When using DQS capture or not at full-rate only match on "even" clock cycles.}
08960         \textcolor{vhdlchar}{sig_mtp_match_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{active\_high}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_ac_even} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{
      DWIDTH_RATIO} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
08961 
08962 \textcolor{keyword}{        -- register current byte lane disable mux for speed}
08963         byte\_lane\_dis: \textcolor{keywordflow}{process} (clk, rst_n)
08964 \textcolor{vhdlkeyword}{        begin}
08965             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08966                 \textcolor{vhdlchar}{sig_curr_byte_ln_dis} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08967             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08968                 \textcolor{vhdlchar}{sig_curr_byte_ln_dis} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_dq_pin_ctr}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{
      MEM_IF_DQ_PER_DQS}\textcolor{vhdlchar}{)};
08969             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08970         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08971 
08972 \textcolor{keyword}{        -- check if all dq pins checked in rsc sweep}
08973         chkd\_dq : \textcolor{keywordflow}{process} (clk, rst_n)
08974 \textcolor{vhdlkeyword}{        begin}
08975             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08976                 \textcolor{vhdlchar}{sig_chkd_all_dq_pins}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08977             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
08978                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dq_pin_ctr} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
08979                     \textcolor{vhdlchar}{sig_chkd_all_dq_pins} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
08980                 \textcolor{keywordflow}{else}
08981                     \textcolor{vhdlchar}{sig_chkd_all_dq_pins} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
08982                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08983             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
08984         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
08985 
08986 \textcolor{keyword}{        -- main rsc process}
08987         rsc\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
08988 \textcolor{keyword}{            -- these are temporary variables which should not infer FFs and}
08989 \textcolor{keyword}{            -- are not guaranteed to be initialized by s\_rsc\_idle.}
08990             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_rdata\_correct}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08991             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_phase\_works}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
08992 
08993 \textcolor{vhdlkeyword}{        begin}
08994             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
08995 \textcolor{keyword}{                -- initialise signals}
08996                 \textcolor{vhdlchar}{sig_rsc_state}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
08997                 \textcolor{vhdlchar}{sig_rsc_last_state}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
08998 
08999                 \textcolor{vhdlchar}{sig_dq_pin_ctr}        \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09000                 \textcolor{vhdlchar}{sig_num_phase_shifts}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- want c\_max\_phase\_shifts-1 inc / decs
       of phase}
09001 
09002                 \textcolor{vhdlchar}{sig_count}             \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09003                 \textcolor{vhdlchar}{sig_test_dq_expired}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09004 
09005                 \textcolor{vhdlchar}{v\_phase\_works}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09006 
09007 \textcolor{keyword}{                -- interface to other processes to tell them when we are done.}
09008                 \textcolor{vhdlchar}{sig_rsc_ack}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09009                 \textcolor{vhdlchar}{sig_rsc_err}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09010                 \textcolor{vhdlchar}{sig_rsc_result}        \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{C_SUCCESS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      c_command_result_len}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09011 
09012 \textcolor{keyword}{                -- centre of data valid window functions}
09013                 \textcolor{vhdlchar}{sig_rsc_cdvw_phase}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09014                 \textcolor{vhdlchar}{sig_rsc_cdvw_shift_in} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09015                 \textcolor{vhdlchar}{sig_rsc_cdvw_calc}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09016 
09017 \textcolor{keyword}{                -- set up PLL reconfig interface controls}
09018                 \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09019                 \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
09020                 \textcolor{vhdlchar}{sig_rewind_direction}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_dec};
09021 
09022 \textcolor{keyword}{                -- True when access to the ac\_block is required.}
09023                 \textcolor{vhdlchar}{sig_rsc_ac_access_req}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09024 
09025 \textcolor{keyword}{                -- default values on centre and size of data valid window}
09026                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
09027                     \textcolor{vhdlchar}{cal_codvw_phase}        \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      PRESET_CODVW_PHASE}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09028                     \textcolor{vhdlchar}{cal_codvw_size}         \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      PRESET_CODVW_SIZE}\textcolor{vhdlchar}{,}  \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09029                 \textcolor{keywordflow}{else}
09030                     \textcolor{vhdlchar}{cal_codvw_phase}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09031                     \textcolor{vhdlchar}{cal_codvw_size}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09032                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09033 
09034                 \textcolor{vhdlchar}{sig_rsc_push_rrp_sweep}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09035                 \textcolor{vhdlchar}{sig_rsc_push_rrp_seek}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09036                 \textcolor{vhdlchar}{sig_rsc_push_rrp_pass}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09037                 \textcolor{vhdlchar}{sig_rsc_push_footer}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09038 
09039                 \textcolor{vhdlchar}{codvw_grt_one_dvw}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09040 
09041             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09042 \textcolor{keyword}{                -- default values assigned to some signals}
09043                 \textcolor{vhdlchar}{sig_rsc_ack}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09044 
09045                 \textcolor{vhdlchar}{sig_rsc_cdvw_phase}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09046                 \textcolor{vhdlchar}{sig_rsc_cdvw_shift_in}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09047                 \textcolor{vhdlchar}{sig_rsc_cdvw_calc}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09048 
09049                 \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09050                 \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
09051                 \textcolor{vhdlchar}{sig_rewind_direction}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_dec};
09052 
09053 \textcolor{keyword}{                -- by default don't ask the resync block to read anything}
09054                 \textcolor{vhdlchar}{sig_rsc_ac_access_req}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09055 
09056                 \textcolor{vhdlchar}{sig_rsc_push_rrp_sweep}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09057                 \textcolor{vhdlchar}{sig_rsc_push_rrp_seek}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09058                 \textcolor{vhdlchar}{sig_rsc_push_rrp_pass}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09059                 \textcolor{vhdlchar}{sig_rsc_push_footer}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09060 
09061                 \textcolor{vhdlchar}{sig_test_dq_expired}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09062 
09063 \textcolor{keyword}{                -- resync state machine}
09064                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{keywordflow}{is}
09065                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09066 \textcolor{keyword}{                        -- initialize those signals we are ready to use.}
09067                         \textcolor{vhdlchar}{sig_dq_pin_ctr}        \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09068 
09069                         \textcolor{vhdlchar}{sig_count}             \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09070 
09071                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- avoid transition when acknowledging
       a command has finished}
09072                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_rsc\_test\_phase} \textcolor{keywordflow}{then}
09073                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_test\_phase};
09074                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_rsc\_cdvw\_calc} \textcolor{keywordflow}{then}
09075                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_cdvw\_calc};
09076                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_rsc\_seek\_cdvw} \textcolor{keywordflow}{then}
09077                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_seek\_cdvw};
09078                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_rsc_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_rsc\_reset\_cdvw} \textcolor{keywordflow}{then}
09079                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_reset\_cdvw};
09080                             \textcolor{keywordflow}{else}
09081                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09082                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09083                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09084 
09085 
09086                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_next\_phase} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09087                         \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
09088                         \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09089                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09090 \textcolor{keyword}{                            -- PLL phase shift started - so stop requesting a shift}
09091                             \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09092                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09093 
09094                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_end} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09095 \textcolor{keyword}{                            -- PLL phase shift finished - so proceed to flush the datapath}
09096                             \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09097                             \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_test\_phase};
09098                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09099 
09100                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_test\_phase}  \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09101                         \textcolor{vhdlchar}{v\_phase\_works}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09102 \textcolor{keyword}{                        -- Note: For single pin single CS calibration set sig\_dq\_pin\_ctr to 0 to}
09103 \textcolor{keyword}{                        --       ensure that only 1 pin calibrated}
09104 
09105                         \textcolor{vhdlchar}{sig_rsc_state}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_wait\_for\_idle\_dimm};
09106 
09107                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{single_bit_cal} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09108                             \textcolor{vhdlchar}{sig_dq_pin_ctr}      \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09109                         \textcolor{keywordflow}{else}
09110                             \textcolor{vhdlchar}{sig_dq_pin_ctr}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09111                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09112 
09113                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_wait\_for\_idle\_dimm}  \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09114                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09115                             \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_flush\_datapath};
09116                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09117 
09118 
09119                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_flush\_datapath} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09120                         \textcolor{vhdlchar}{sig_rsc_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09121                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}
09122 \textcolor{keyword}{                            -- reset variables we are interested in when we first arrive in this state.}
09123                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_read_lat} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09124                         \textcolor{keywordflow}{else}
09125                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09126                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
09127                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_test\_dq};
09128                                 \textcolor{keywordflow}{else}
09129                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09130                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09131                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09132                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09133 
09134 
09135                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_test\_dq} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09136                         \textcolor{vhdlchar}{sig_rsc_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09137 
09138                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state}  \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}
09139 \textcolor{keyword}{                            -- reset variables we are interested in when we first arrive in this state.}
09140                             \textcolor{vhdlchar}{sig_count}             \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_cal_mtp_t};
09141 
09142                         \textcolor{keywordflow}{else}
09143 
09144                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09145 
09146                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}
09147                                     \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_mtp_match} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_mtp_match_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}\textcolor{keyword}{ -- have a pattern
       match}
09148                                     \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_test_dq_expired} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}\textcolor{keyword}{ -- time in this phase has expired.}
09149                                     \textcolor{vhdlchar}{sig_curr_byte_ln_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{keyword}{  -- byte lane disabled}
09150                                 \textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09151 
09152                                     \textcolor{vhdlchar}{v\_phase\_works} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_phase\_works} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_mtp_match} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_mtp_match_en}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{not} \textcolor{vhdlchar}{sig_curr_byte_ln_dis}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09153 
09154                                     \textcolor{vhdlchar}{sig_rsc_push_rrp_sweep} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09155                                     \textcolor{vhdlchar}{sig_rsc_push_rrp_pass} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_mtp_match} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      sig_mtp_match_en}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{not} \textcolor{vhdlchar}{sig_curr_byte_ln_dis}\textcolor{vhdlchar}{)};
09156 
09157                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_chkd_all_dq_pins} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09158 \textcolor{keyword}{                                        -- finished checking all dq pins.}
09159 \textcolor{keyword}{                                        -- done checking this phase.}
09160 
09161 \textcolor{keyword}{                                        -- shift phase status into}
09162                                         \textcolor{vhdlchar}{sig_rsc_cdvw_phase}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_phase\_works};
09163                                         \textcolor{vhdlchar}{sig_rsc_cdvw_shift_in} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09164 
09165                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
09166 \textcolor{keyword}{                                            -- there are more phases to test so shift to next phase}
09167                                             \textcolor{vhdlchar}{sig_rsc_state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_next\_phase};
09168                                         \textcolor{keywordflow}{else}
09169 \textcolor{keyword}{                                            -- no more phases to check.}
09170 \textcolor{keyword}{                                            -- clean up after ourselves by}
09171 \textcolor{keyword}{                                            -- going into s\_rsc\_rewind\_phase}
09172                                             \textcolor{vhdlchar}{sig_rsc_state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_rewind\_phase};
09173                                             \textcolor{vhdlchar}{sig_rewind_direction} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      c_pll_phs_dec};
09174                                             \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09175                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09176                                     \textcolor{keywordflow}{else}
09177 \textcolor{keyword}{                                        -- shift to next dq pin}
09178                                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{71} \textcolor{keywordflow}{and}\textcolor{keyword}{             -- if >= 72 pins then:}
09179                                            \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_dq_pin_ctr} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{64}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{   -- ensure refreshes at least
       once every 64 pins}
09180 
09181                                             \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_wait\_for\_idle\_dimm};
09182 
09183                                         \textcolor{keywordflow}{else}\textcolor{keyword}{ -- otherwise continue sweep}
09184 
09185                                             \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_flush\_datapath};
09186                                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09187 
09188                                         \textcolor{vhdlchar}{sig_dq_pin_ctr} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dq_pin_ctr} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09189 
09190                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09191 
09192                                 \textcolor{keywordflow}{else}
09193 
09194                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09195 
09196                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
09197                                         \textcolor{vhdlchar}{sig_test_dq_expired} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09198                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09199 
09200                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09201                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09202                        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09203 
09204                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_reset\_cdvw} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09205                         \textcolor{vhdlchar}{sig_rsc_state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_rewind\_phase};
09206 
09207 \textcolor{keyword}{                        -- determine the amount to rewind by (may be wind forward depending on tracking
       behaviour)}
09208                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{cal_codvw_phase}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      sig_trk_rsc_drift} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
09209                             \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      cal_codvw_phase}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{sig_trk_rsc_drift}\textcolor{vhdlchar}{)};
09210                             \textcolor{vhdlchar}{sig_rewind_direction} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
09211                         \textcolor{keywordflow}{else}
09212                             \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      cal_codvw_phase}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{sig_trk_rsc_drift}\textcolor{vhdlchar}{)};
09213                             \textcolor{vhdlchar}{sig_rewind_direction} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_dec};
09214                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09215 
09216 \textcolor{keyword}{                        -- reset the calibrated phase and size to zero (because un-doing prior calibration
       here)}
09217                         \textcolor{vhdlchar}{cal_codvw_phase}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09218                         \textcolor{vhdlchar}{cal_codvw_size}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09219 
09220                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_rewind\_phase} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09221 \textcolor{keyword}{                        -- rewinds the resync PLL by sig\_num\_phase\_shifts steps and returns to idle state}
09222                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
09223 \textcolor{keyword}{                            -- no more steps to take off, go to next state}
09224                             \textcolor{vhdlchar}{sig_num_phase_shifts}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09225 
09226                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if iram present hold off until
       access finished}
09227                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_wait\_iram};
09228                             \textcolor{keywordflow}{else}
09229                                 \textcolor{vhdlchar}{sig_rsc_ack}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09230                                 \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09231                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09232 
09233                         \textcolor{keywordflow}{else}
09234                             \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rewind_direction};
09235 
09236 \textcolor{keyword}{                            -- request a phase shift}
09237                             \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09238                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_busy} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09239 \textcolor{keyword}{                                -- inhibit a phase shift if phase shift is busy.}
09240                                 \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09241                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09242 
09243                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_busy_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_phs_shft_busy} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09244 \textcolor{keyword}{                                -- we've just successfully removed a phase step}
09245 \textcolor{keyword}{                                -- decrement counter}
09246                                 \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_num_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09247                                 \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09248                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09249                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09250 
09251 
09252                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_cdvw\_calc} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09253                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}
09254                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{keywordflow}{then}
09255                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"gathered resync phase samples (for mtp
       alignment "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_mtp_almt}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{keyword}{") is DGRB\_PHASE\_SAMPLES: "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{str}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
09256                             \textcolor{keywordflow}{else}
09257                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"gathered resync phase samples
       DGRB\_PHASE\_SAMPLES: "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{str}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
09258                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09259                             \textcolor{vhdlchar}{sig_rsc_cdvw_calc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- begin calculating result}
09260                         \textcolor{keywordflow}{else}
09261                             \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_cdvw\_wait};
09262                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09263 
09264 
09265                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_cdvw\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09266                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{calculating} \textcolor{keywordflow}{then}
09267 \textcolor{keyword}{                            -- a result has been reached.}
09268                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if doing mtp alignment then skip
       setting phase}
09269 
09270                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if iram present hold off until
       access finished}
09271                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_wait\_iram};
09272                                 \textcolor{keywordflow}{else}
09273                                     \textcolor{vhdlchar}{sig_rsc_ack}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09274                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09275                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09276 
09277                             \textcolor{keywordflow}{else}
09278                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{valid\_result} \textcolor{keywordflow}{then}
09279 \textcolor{keyword}{                                    -- calculation successfully found a}
09280 \textcolor{keyword}{                                    -- data-valid window to seek to.}
09281                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_seek\_cdvw};
09282 
09283                     \textcolor{vhdlchar}{sig_rsc_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{C_SUCCESS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      sig_rsc_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09284 
09285 \textcolor{keyword}{                    -- If more than one data valid window was seen, then set the result code :}
09286                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{windows_seen} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09287                                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"Warning : multiple data-valid windows
       found, largest chosen."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
09288                     \textcolor{vhdlchar}{codvw_grt_one_dvw} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09289                                     \textcolor{keywordflow}{else}
09290                                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"data-valid window found successfully."}
       \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
09291                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09292 
09293                                 \textcolor{keywordflow}{else}
09294 \textcolor{keyword}{                                    -- calculation failed to find a data-valid window.}
09295 
09296                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"couldn't find a data-valid window in
       resync."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
09297                                     \textcolor{vhdlchar}{sig_rsc_ack}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09298                                     \textcolor{vhdlchar}{sig_rsc_err}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09299                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09300 
09301 \textcolor{keyword}{                                    -- set resync result code}
09302                                     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{keywordflow}{is}
09303                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{no\_invalid\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09304                                             \textcolor{vhdlchar}{sig_rsc_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_NO_VALID_PHASES}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_rsc_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09305                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{multiple\_equal\_windows} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09306                                             \textcolor{vhdlchar}{sig_rsc_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_MULTIPLE_EQUAL_WINDOWS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_rsc_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09307                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{no\_valid\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09308                                             \textcolor{vhdlchar}{sig_rsc_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_NO_VALID_PHASES}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_rsc_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09309                                         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09310                                             \textcolor{vhdlchar}{sig_rsc_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_CRITICAL}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_rsc_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09311                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
09312                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09313                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09314 
09315 \textcolor{keyword}{                            -- signal to write a rrp\_sweep result to iram}
09316                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
09317                                 \textcolor{vhdlchar}{sig_rsc_push_rrp_seek} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09318                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09319 
09320                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09321 
09322 
09323                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_seek\_cdvw} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09324                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}
09325 \textcolor{keyword}{                            -- reset variables we are interested in when we first arrive in this state}
09326                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre};
09327                         \textcolor{keywordflow}{else}
09328                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{or}
09329                             \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and}
09330                              \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{)}\textcolor{keyword}{ -- if FR and DQS capture ensure within 0-360
       degrees phase}
09331 
09332                             \textcolor{keywordflow}{then}
09333 \textcolor{keyword}{                                -- ready to transition to next state}
09334                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if iram present hold off until
       access finished}
09335                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_wait\_iram};
09336                                 \textcolor{keywordflow}{else}
09337                                     \textcolor{vhdlchar}{sig_rsc_ack}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09338                                     \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09339                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09340 
09341 \textcolor{keyword}{                                -- return largest window centre and size in the result}
09342 
09343 \textcolor{keyword}{                                -- perform cal\_codvw phase / size update only if a valid result is found}
09344                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{valid\_result} \textcolor{keywordflow}{then}
09345 
09346                                     \textcolor{vhdlchar}{cal_codvw_phase} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09347                                     \textcolor{vhdlchar}{cal_codvw_size}  \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size}\textcolor{vhdlchar}{,}   \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09348 
09349                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09350 
09351 \textcolor{keyword}{                                -- leaving sig\_rsc\_err or sig\_rsc\_result at}
09352 \textcolor{keyword}{                                -- their default values (of success)}
09353                             \textcolor{keywordflow}{else}
09354                                 \textcolor{vhdlchar}{sig_rsc_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
09355 
09356 \textcolor{keyword}{                                -- request a phase shift}
09357                                 \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09358                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09359 \textcolor{keyword}{                                    -- inhibit a phase shift if phase shift is busy}
09360                                     \textcolor{vhdlchar}{sig_rsc_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09361                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09362 
09363                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_end} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}  \textcolor{keywordflow}{then}
09364 \textcolor{keyword}{                                    -- we've just successfully removed a phase step}
09365 \textcolor{keyword}{                                    -- decrement counter}
09366                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09367                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09368                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09369                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09370 
09371                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rsc\_wait\_iram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09372 
09373 \textcolor{keyword}{                        -- hold off check 1 clock cycle to enable last rsc push operations to start}
09374                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{keywordflow}{then}
09375 
09376                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_iram_idle} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09377 
09378                                 \textcolor{vhdlchar}{sig_rsc_ack}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09379                                 \textcolor{vhdlchar}{sig_rsc_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rsc\_idle};
09380                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_test\_phases} \textcolor{keywordflow}{or}
09381                                    \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_seek\_cdvw} \textcolor{keywordflow}{or}
09382                                    \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{keywordflow}{then}
09383 
09384                                     \textcolor{vhdlchar}{sig_rsc_push_footer} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09385 
09386                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09387 
09388                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09389 
09390                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09391 
09392                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09393                         \textcolor{keywordflow}{null};
09394                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
09395 
09396                 \textcolor{vhdlchar}{sig_rsc_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_state};
09397             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09398 
09399         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09400 
09401 
09402 \textcolor{keyword}{        -- write results to the iram}
09403 
09404         iram\_push: \textcolor{keywordflow}{process} (clk, rst_n)
09405 
09406 \textcolor{vhdlkeyword}{        begin}
09407 
09408             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09409 
09410                 \textcolor{vhdlchar}{sig_dgrb_iram}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
09411                 \textcolor{vhdlchar}{sig_iram_idle}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09412                 \textcolor{vhdlchar}{sig_dq_pin_ctr_r}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09413                 \textcolor{vhdlchar}{sig_rsc_curr_phase} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09414 
09415                 \textcolor{vhdlchar}{sig_iram_wds_req}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09416 
09417 
09418             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09419 
09420                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
09421 
09422                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      iram_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09423                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"iram\_done and iram\_write signals concurrently set -
       iram contents may be corrupted"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
09424                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09425 
09426                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      iram_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09427                         \textcolor{vhdlchar}{sig_iram_idle}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09428                     \textcolor{keywordflow}{else}
09429                         \textcolor{vhdlchar}{sig_iram_idle}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09430                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09431 
09432 \textcolor{keyword}{                    -- registered sig\_dq\_pin\_ctr to align with rrp\_sweep result}
09433                     \textcolor{vhdlchar}{sig_dq_pin_ctr_r}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dq_pin_ctr};
09434 
09435 \textcolor{keyword}{                    -- calculate current phase (registered to align with rrp\_sweep result)}
09436                     \textcolor{vhdlchar}{sig_rsc_curr_phase} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_phase_shifts} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{
      sig_num_phase_shifts};
09437 
09438 \textcolor{keyword}{                    -- serial push of rrp\_sweep results into memory}
09439                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_push_rrp_sweep} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09440 
09441 \textcolor{keyword}{                        -- signal an iram write and track a write pending}
09442                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09443                         \textcolor{vhdlchar}{sig_iram_idle}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09444 
09445 \textcolor{keyword}{                        -- if not single\_bit\_cal then pack pin phase results in MEM\_IF\_DWIDTH word blocks}
09446                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{single_bit_cal} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09447                             \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dq_pin_ctr_r} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_rsc_curr_phase}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)};
09448                             \textcolor{vhdlchar}{sig_iram_wds_req}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram\_wd\_for\_one\_pin\_rrp}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- note total word requirement}
09449                         \textcolor{keywordflow}{else}
09450                             \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dq_pin_ctr_r} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_rsc_curr_phase}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{MEM_IF_DWIDTH};
09451                             \textcolor{vhdlchar}{sig_iram_wds_req}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram\_wd\_for\_full\_rrp}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE}\textcolor{vhdlchar}{)};\textcolor{keyword}{     -- note total word requirement}
09452                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09453 
09454 \textcolor{keyword}{                        -- check if current pin and phase passed:}
09455                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_push_rrp_pass};
09456 
09457 \textcolor{keyword}{                        -- bit offset is modulo phase}
09458                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_bitnum}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_curr_phase} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32};
09459 
09460                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09461 
09462 \textcolor{keyword}{                    -- write result of rrp\_calc to iram when completed}
09463                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_push_rrp_seek} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- a result found}
09464 
09465                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09466                         \textcolor{vhdlchar}{sig_iram_idle}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09467 
09468                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09469                         \textcolor{vhdlchar}{sig_iram_wds_req}           \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- note total word requirement}
09470 
09471                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{valid\_result} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- result is valid}
09472 
09473                             \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"0000"} \textcolor{vhdlchar}{&}
09474                                                            \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
09475                                                            \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09476 
09477                         \textcolor{keywordflow}{else}\textcolor{keyword}{  -- invalid result (error code communicated elsewhere)}
09478 
09479                             \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_pushdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{x}\textcolor{keyword}{"FFFF"} \textcolor{vhdlchar}{&}\textcolor{keyword}{ -- signals an error condition}
09480                                                            \textcolor{vhdlchar}{x}\textcolor{vhdllogic}{"0000"};
09481 
09482                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09483 
09484                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09485 
09486 \textcolor{keyword}{                    -- when stage finished write footer}
09487                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rsc_push_footer} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09488 
09489                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09490                         \textcolor{vhdlchar}{sig_iram_idle}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09491 
09492 \textcolor{keyword}{                        -- set address location of footer}
09493                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_wordnum} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_iram_wds_req};
09494 
09495                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09496 
09497 \textcolor{keyword}{                    -- if write completed deassert iram\_write and done signals}
09498                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_push_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09499 
09500                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_write} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09501                         \textcolor{vhdlchar}{sig_dgrb_iram}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{iram_done}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09502 
09503                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09504 
09505                 \textcolor{keywordflow}{else}
09506 
09507                     \textcolor{vhdlchar}{sig_iram_idle}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09508                     \textcolor{vhdlchar}{sig_dq_pin_ctr_r}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09509                     \textcolor{vhdlchar}{sig_rsc_curr_phase} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09510 
09511                     \textcolor{vhdlchar}{sig_dgrb_iram}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
09512 
09513                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09514 
09515             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09516 
09517         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09518 
09519 \textcolor{keyword}{        -- concurrently assign sig\_dgrb\_iram to dgrb\_iram}
09520         \textcolor{vhdlchar}{dgrb_iram} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dgrb_iram};
09521 
09522     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};\textcolor{keyword}{ -- resync calculation}
09523 
09524 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09525 \textcolor{keyword}{    -- test pattern match block}
09526 \textcolor{keyword}{    --}
09527 \textcolor{keyword}{    -- This block handles the sharing of logic for test pattern matching}
09528 \textcolor{keyword}{    -- which is used in resync and postamble calibration / code blocks}
09529 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09530     \textcolor{vhdlchar}{tp\_match\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
09531 \textcolor{keyword}{    --}
09532 \textcolor{keyword}{    --  Ascii Waveforms:}
09533 \textcolor{keyword}{    --}
09534 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09535 \textcolor{keyword}{    --                     \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_}
09536 \textcolor{keyword}{    --   delayed\_dqs |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|}
09537 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09538 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09539 \textcolor{keyword}{    --                    ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_   \_\_\_\_\_\_\_}
09540 \textcolor{keyword}{    --               XXXXX /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\)}
09541 \textcolor{keyword}{    --         c0,c1 XXXXXX   A B   X   C D   X   E F   X   G H   X   I J   X   L M   X  captured data}
09542 \textcolor{keyword}{    --               XXXXX \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/}
09543 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09544 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09545 \textcolor{keyword}{    --                \_\_\_\_;     \_\_\_\_;     \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_}
09546 \textcolor{keyword}{    -- 180-resync\_clk     |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |  180deg shift from
       delayed dqs}
09547 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09548 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09549 \textcolor{keyword}{    --                    ;      \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_}
09550 \textcolor{keyword}{    --               XXXXXXXXXX /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /}
09551 \textcolor{keyword}{    --     180-r0,r1 XXXXXXXXXXX   A B   X   C D   X   E F   X   G H   X   I J   X   L   resync data}
09552 \textcolor{keyword}{    --               XXXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_}
09553 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09554 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09555 \textcolor{keyword}{    --                     \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_}
09556 \textcolor{keyword}{    -- 360-resync\_clk \_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|}
09557 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09558 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09559 \textcolor{keyword}{    --                    ;         ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_ ; \_\_\_\_\_\_\_}
09560 \textcolor{keyword}{    --               XXXXXXXXXXXXXXX /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\)}
09561 \textcolor{keyword}{    --     360-r0,r1 XXXXXXXXXXXXXXXX   A B   X   C D   X   E F   X   G H   X   I J   X resync data}
09562 \textcolor{keyword}{    --               XXXXXXXXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/}
09563 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09564 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09565 \textcolor{keyword}{    --                \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_}
09566 \textcolor{keyword}{    -- 540-resync\_clk     |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |}
09567 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09568 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09569 \textcolor{keyword}{    --                    ;         ;      \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_}
09570 \textcolor{keyword}{    --                XXXXXXXXXXXXXXXXXXX /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /       \(\backslash\) /}
09571 \textcolor{keyword}{    --      540-r0,r1 XXXXXXXXXXXXXXXXXXXX   A B   X   C D   X   E F   X   G H   X   I  resync data}
09572 \textcolor{keyword}{    --                XXXXXXXXXXXXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_}
09573 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09574 \textcolor{keyword}{    --                    ;         ;         ;         ;         ;         ;}
09575 \textcolor{keyword}{    --                    ;\_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_}
09576 \textcolor{keyword}{    --       phy\_clk |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|}
09577 \textcolor{keyword}{    --}
09578 \textcolor{keyword}{    --                    0         1         2         3         4         5         6}
09579 \textcolor{keyword}{    --}
09580 \textcolor{keyword}{    --}
09581 \textcolor{keyword}{    --              |<- Aligned Data ->|}
09582 \textcolor{keyword}{    --      phy\_clk 180-r0,r1  540-r0,r1  sig\_mtp\_match\_en (generated from sig\_ac\_even)}
09583 \textcolor{keyword}{    --            0  XXXXXXXX   XXXXXXXX  '1'}
09584 \textcolor{keyword}{    --            1  XXXXXXAB   XXXXXXXX  '0'}
09585 \textcolor{keyword}{    --            2  XXXXABCD   XXXXXXAB  '1'}
09586 \textcolor{keyword}{    --            3  XXABCDEF   XXXXABCD  '0'}
09587 \textcolor{keyword}{    --            4  ABCDEFGH   XXABCDEF  '1'}
09588 \textcolor{keyword}{    --            5  CDEFGHAB   ABCDEFGH  '0'}
09589 \textcolor{keyword}{    --}
09590 \textcolor{keyword}{    --  In DQS-based capture, sweeping resync\_clk from 180 degrees to 360}
09591 \textcolor{keyword}{    --  does not necessarily result in a failure because the setup/hold}
09592 \textcolor{keyword}{    --  requirements are so small.  The data comparison needs to fail when}
09593 \textcolor{keyword}{    --  the resync\_clk is shifted more than 360 degrees.  The}
09594 \textcolor{keyword}{    --  sig\_mtp\_match\_en signal allows the sequencer to blind itself}
09595 \textcolor{keyword}{    --  training pattern matches that occur above 360 degrees.}
09596 \textcolor{keyword}{    --}
09597 \textcolor{keyword}{    --}
09598 \textcolor{keyword}{    --}
09599 \textcolor{keyword}{    --}
09600 \textcolor{keyword}{    --}
09601 \textcolor{keyword}{    --  Asserts sig\_mtp\_match.}
09602 \textcolor{keyword}{    --}
09603 \textcolor{keyword}{    --  Data comes in from rdata and is pushed into a two-bit wide shift register.}
09604 \textcolor{keyword}{    --  It is a critical assumption that the rdata comes back byte aligned.}
09605 \textcolor{keyword}{    --}
09606 \textcolor{keyword}{    --}
09607 \textcolor{keyword}{    --sig\_mtp\_match\_valid}
09608 \textcolor{keyword}{    --   rdata\_valid  (shift-enable)}
09609 \textcolor{keyword}{    --      |}
09610 \textcolor{keyword}{    --      |}
09611 \textcolor{keyword}{    --      +-----------------------+-----------+------------------+}
09612 \textcolor{keyword}{    --                 \_\_\_          |           |                  |}
09613 \textcolor{keyword}{    --     dq(0)  >---|   \(\backslash\)         |     Shift Register           |}
09614 \textcolor{keyword}{    --     dq(1)  >---|    \(\backslash\)     +------+    +------+           +------------------+}
09615 \textcolor{keyword}{    --     dq(2)  >---|     )--->| D(0) |-+->| D(1) |-+->...-+->| D(c\_cal\_mtp\_len - 1) |}
09616 \textcolor{keyword}{    --     ...        |    /     +------+ |  +------+ |      |  +------------------+}
09617 \textcolor{keyword}{    --   dq(n-1)  >---|\_\_\_/               +-----------++-...-+}
09618 \textcolor{keyword}{    --                  |                             ||                                 +---+}
09619 \textcolor{keyword}{    --                  |                            (==)--------> sig\_mtp\_match\_0t ---->|  
       |-->sig\_mtp\_match\_1t-->sig\_mtp\_match}
09620 \textcolor{keyword}{    --                  |                             ||                                 +---+}
09621 \textcolor{keyword}{    --                  |                 +-----------++...-+}
09622 \textcolor{keyword}{    -- sig\_dq\_pin\_ctr >-+        +------+ |  +------+ |     |  +------------------+}
09623 \textcolor{keyword}{    --                           | P(0) |-+  | P(1) |-+ ...-+->| P(c\_cal\_mtp\_len - 1) |}
09624 \textcolor{keyword}{    --                           +------+    +------+          +------------------+}
09625 \textcolor{keyword}{    --}
09626 \textcolor{keyword}{    --}
09627 \textcolor{keyword}{    --}
09628 \textcolor{keyword}{    --}
09629         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rdata_current_pin} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_cal_mtp_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
09630 
09631 \textcolor{keyword}{        -- A fundamental assumption here is that rdata\_valid is all}
09632 \textcolor{keyword}{        -- ones or all zeros - not both.}
09633         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rdata_valid_1t} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- rdata\_valid delayed by 1 clock period.}
09634         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rdata_valid_2t} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- rdata\_valid delayed by 2 clock periods.}
09635 
09636 \textcolor{vhdlkeyword}{    begin}
09637         rdata\_valid\_1t\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
09638 \textcolor{vhdlkeyword}{        begin}
09639             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09640                 \textcolor{vhdlchar}{sig_rdata_valid_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09641                 \textcolor{vhdlchar}{sig_rdata_valid_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09642             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09643                 \textcolor{vhdlchar}{sig_rdata_valid_2t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rdata_valid_1t};
09644                 \textcolor{vhdlchar}{sig_rdata_valid_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdata_valid}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
09645             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09646         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09647 
09648 
09649 \textcolor{keyword}{        -- MUX data into sig\_rdata\_current\_pin shift register.}
09650         rdata\_current\_pin\_proc: \textcolor{keywordflow}{process} (clk, rst_n)
09651 \textcolor{vhdlkeyword}{        begin}
09652             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09653                 \textcolor{vhdlchar}{sig_rdata_current_pin} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09654             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09655 \textcolor{keyword}{                -- shift old data down the shift register}
09656                 \textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=}
09657                     \textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{)};
09658 
09659 \textcolor{keyword}{                -- shift new data into the bottom of the shift register.}
09660                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
09661                     \textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{
      DWIDTH_RATIO} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{sig_dq_pin_ctr}\textcolor{vhdlchar}{)};
09662                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
09663            \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09664         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09665 
09666 
09667 
09668         mtp\_match\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
09669 \textcolor{vhdlkeyword}{        begin}
09670             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ --  * when at least c\_max\_read\_lat clock cycles have passed}
09671                 \textcolor{vhdlchar}{sig_mtp_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09672             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09673                 \textcolor{vhdlchar}{sig_mtp_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09674 
09675                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rdata_current_pin} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{c_cal_mtp} \textcolor{keywordflow}{then}
09676                     \textcolor{vhdlchar}{sig_mtp_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09677                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09678             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09679         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09680 
09681 
09682         poa\_match\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
09683 \textcolor{keyword}{        -- poa\_match\_Calibration Strategy}
09684 \textcolor{keyword}{        --}
09685 \textcolor{keyword}{        --  Ascii Waveforms:}
09686 \textcolor{keyword}{        --}
09687 \textcolor{keyword}{        --                   \_\_    \_\_    \_\_    \_\_    \_\_    \_\_    \_\_    \_\_    \_\_}
09688 \textcolor{keyword}{        --            clk \_\_|  |\_\_|  |\_\_|  |\_\_|  |\_\_|  |\_\_|  |\_\_|  |\_\_|  |\_\_|  |}
09689 \textcolor{keyword}{        --}
09690 \textcolor{keyword}{        --                                          ;     ;     ;     ;}
09691 \textcolor{keyword}{        --                         \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09692 \textcolor{keyword}{        --    rdata\_valid \_\_\_\_\_\_\_\_|                 |\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09693 \textcolor{keyword}{        --}
09694 \textcolor{keyword}{        --                                          ;     ;     ;     ;}
09695 \textcolor{keyword}{        --                                                       \_\_\_\_\_}
09696 \textcolor{keyword}{        --   poa\_match\_en \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|     |\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09697 \textcolor{keyword}{        --}
09698 \textcolor{keyword}{        --                                          ;     ;     ;     ;}
09699 \textcolor{keyword}{        --                                                       \_\_\_\_\_}
09700 \textcolor{keyword}{        --      poa\_match XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX     XXXXXXXXXXXXXXXX}
09701 \textcolor{keyword}{        --}
09702 \textcolor{keyword}{        --}
09703 \textcolor{keyword}{        -- Notes:}
09704 \textcolor{keyword}{        --   -poa\_match is only valid while poa\_match\_en is asserted.}
09705 \textcolor{keyword}{        --}
09706 \textcolor{keyword}{        --}
09707 \textcolor{keyword}{        --}
09708 \textcolor{keyword}{        --}
09709 \textcolor{keyword}{        --}
09710 \textcolor{keyword}{        --}
09711 \textcolor{vhdlkeyword}{        begin}
09712             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09713 
09714                 \textcolor{vhdlchar}{sig_poa_match_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09715                 \textcolor{vhdlchar}{sig_poa_match}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09716 
09717             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09718                 \textcolor{vhdlchar}{sig_poa_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09719 
09720                 \textcolor{vhdlchar}{sig_poa_match_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09721                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rdata_valid_2t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_rdata_valid_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09722                     \textcolor{vhdlchar}{sig_poa_match_en} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09723                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09724 
09725                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
09726                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{
      sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"111100"} \textcolor{keywordflow}{then}
09727                         \textcolor{vhdlchar}{sig_poa_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09728                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09729                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
09730                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{
      sig_rdata_current_pin}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"11111100"} \textcolor{keywordflow}{then}
09731                         \textcolor{vhdlchar}{sig_poa_match} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09732                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09733                 \textcolor{keywordflow}{else}
09734                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported DWIDTH\_RATIO"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
09735                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09736 
09737             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09738         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09739     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
09740 
09741 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09742 \textcolor{keyword}{    -- Postamble calibration}
09743 \textcolor{keyword}{    --}
09744 \textcolor{keyword}{    -- Implements the postamble slave state machine and collates the}
09745 \textcolor{keyword}{    -- processing data from the test pattern match block.}
09746 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09747     \textcolor{vhdlchar}{poa\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
09748 \textcolor{keyword}{    -- Postamble Calibration Strategy}
09749 \textcolor{keyword}{    --}
09750 \textcolor{keyword}{    --  Ascii Waveforms:}
09751 \textcolor{keyword}{    --}
09752 \textcolor{keyword}{    --                   c\_read\_burst\_t      c\_read\_burst\_t}
09753 \textcolor{keyword}{    --                    ;<------->;         ;<------->;}
09754 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09755 \textcolor{keyword}{    --                            \_\_      / /         \_\_}
09756 \textcolor{keyword}{    --      mem\_dq[0] \_\_\_\_\_\_\_\_\_\_\_|  |\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_|  |\_\_\_}
09757 \textcolor{keyword}{    --}
09758 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09759 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09760 \textcolor{keyword}{    --                       \_\_\_\_\_\_\_\_\_    / /  \_\_\_\_\_\_\_\_\_}
09761 \textcolor{keyword}{    --     poa\_enable \_\_\_\_\_\_|         |\_\_\_\(\backslash\) \(\backslash\)\_|         |\_\_\_}
09762 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09763 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09764 \textcolor{keyword}{    --                            \_\_       / /        \_\_\_\_\_\_}
09765 \textcolor{keyword}{    --       rdata[0] \_\_\_\_\_\_\_\_\_\_\_|  |\_\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_|}
09766 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09767 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09768 \textcolor{keyword}{    --                    ;         ;         ;         ;}
09769 \textcolor{keyword}{    --                               \_    / /            \_}
09770 \textcolor{keyword}{    --    poa\_match\_en \_\_\_\_\_\_\_\_\_\_\_\_\_| |\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_| |\_}
09771 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09772 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09773 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09774 \textcolor{keyword}{    --                                    / /            \_}
09775 \textcolor{keyword}{    --       poa\_match \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_| |\_}
09776 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09777 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09778 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09779 \textcolor{keyword}{    --                                 \_  / /}
09780 \textcolor{keyword}{    -- seq\_poa\_lat\_dec \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_| |\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09781 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09782 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09783 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09784 \textcolor{keyword}{    --                                    / /}
09785 \textcolor{keyword}{    -- seq\_poa\_lat\_inc \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09786 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09787 \textcolor{keyword}{    --                    ;         ; ;       ;         ; ;}
09788 \textcolor{keyword}{    --}
09789 \textcolor{keyword}{    --                             (1)                 (2)}
09790 \textcolor{keyword}{    --}
09791 \textcolor{keyword}{    --}
09792 \textcolor{keyword}{    -- (1) poa\_enable signal is late, and the zeros on mem\_dq after (1)}
09793 \textcolor{keyword}{    --    are captured.}
09794 \textcolor{keyword}{    -- (2) poa\_enable signal is aligned.  Zeros following (2) are not}
09795 \textcolor{keyword}{    --    captured rdata remains at '1'.}
09796 \textcolor{keyword}{    --}
09797 \textcolor{keyword}{    --   The DQS capture circuit wth the dqs enable asynchronous set.}
09798 \textcolor{keyword}{    --}
09799 \textcolor{keyword}{    --}
09800 \textcolor{keyword}{    --}
09801 \textcolor{keyword}{    --  dqs\_en\_async\_preset ----------+}
09802 \textcolor{keyword}{    --                                |}
09803 \textcolor{keyword}{    --                                v}
09804 \textcolor{keyword}{    --                           +---------+}
09805 \textcolor{keyword}{    --                        +--|Q  SET  D|----------- gnd}
09806 \textcolor{keyword}{    --                        |  |        <O---+}
09807 \textcolor{keyword}{    --                        |  +---------+   |}
09808 \textcolor{keyword}{    --                        |                |}
09809 \textcolor{keyword}{    --                        |                |}
09810 \textcolor{keyword}{    --                        +--+---.         |}
09811 \textcolor{keyword}{    --                           |AND )--------+------- dqs\_bus}
09812 \textcolor{keyword}{    --          delayed\_dqs -----+---^}
09813 \textcolor{keyword}{    --}
09814 \textcolor{keyword}{    --}
09815 \textcolor{keyword}{    --}
09816 \textcolor{keyword}{    --                     \_\_\_\_\_       \_\_\_\_\_       \_\_\_\_\_       \_\_\_\_\_}
09817 \textcolor{keyword}{    --           dqs  \_\_\_\_|     |\_\_\_\_\_|     |\_\_\_\_\_|     |\_\_\_\_\_|    
       |\_\_\_\_\_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
09818 \textcolor{keyword}{    --                    ;  ;           ;           ;           ;}
09819 \textcolor{keyword}{    --                       ;           ;           ;           ;}
09820 \textcolor{keyword}{    --                        \_\_\_\_\_       \_\_\_\_\_       \_\_\_\_\_       \_\_\_\_\_}
09821 \textcolor{keyword}{    --   delayed\_dqs  \_\_\_\_\_\_\_|     |\_\_\_\_\_|     |\_\_\_\_\_|     |\_\_\_\_\_|    
       |\_\_\_\_\_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
09822 \textcolor{keyword}{    --}
09823 \textcolor{keyword}{    --                       ;           ;           ;           ;           ;}
09824 \textcolor{keyword}{    --                       ;                     
       \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
09825 \textcolor{keyword}{    -- dqs\_en\_async\_  \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|                                                       
             |\_\_\_\_\_}
09826 \textcolor{keyword}{    --        preset}
09827 \textcolor{keyword}{    --                       ;           ;           ;           ;           ;}
09828 \textcolor{keyword}{    --                       ;           ;           ;           ;           ;}
09829 \textcolor{keyword}{    --                        \_\_\_\_\_                   \_\_\_\_\_       \_\_\_\_\_}
09830 \textcolor{keyword}{    --       dqs\_bus  \_\_\_\_\_\_\_|     |\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|     |\_\_\_\_\_|    
       |\_\_\_\_\_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX}
09831 \textcolor{keyword}{    --}
09832 \textcolor{keyword}{    --                       ;                       ;}
09833 \textcolor{keyword}{    --                      (1)                     (2)}
09834 \textcolor{keyword}{    --}
09835 \textcolor{keyword}{    --}
09836 \textcolor{keyword}{    -- Notes:}
09837 \textcolor{keyword}{    --    (1) The dqs\_bus pulse here comes because the last value of Q}
09838 \textcolor{keyword}{    --       is '1' until the first DQS pulse clocks gnd into the FF,}
09839 \textcolor{keyword}{    --       brings low the AND gate, and disables dqs\_bus.  A training}
09840 \textcolor{keyword}{    --       pattern could potentially match at this point even though}
09841 \textcolor{keyword}{    --       between (1) and (2) there are no dqs\_bus triggers.  Data}
09842 \textcolor{keyword}{    --       is frozen on rdata while awaiting the dqs\_bus pulses at}
09843 \textcolor{keyword}{    --       (2).  For this reason, wait until the first match of the}
09844 \textcolor{keyword}{    --       training pattern, and continue reducing latency until it}
09845 \textcolor{keyword}{    --       TP no longer matches, then increase latency by one.  In}
09846 \textcolor{keyword}{    --       this case, dqs\_en\_async\_preset will have its latency}
09847 \textcolor{keyword}{    --       reduced by three until the training pattern is not matched,}
09848 \textcolor{keyword}{    --       then latency is increased by one.}
09849 \textcolor{keyword}{    --}
09850 \textcolor{keyword}{    --}
09851 \textcolor{keyword}{    --}
09852 \textcolor{keyword}{    --}
09853 
09854 \textcolor{keyword}{        -- Postamble calibration state}
09855         \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_poa_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
09856 \textcolor{keyword}{            -- decrease poa enable latency by 1 cycle iteratively until 'correct' position found}
09857             \textcolor{vhdlchar}{s\_poa\_rewind\_to\_pass}\textcolor{vhdlchar}{,}
09858 \textcolor{keyword}{            -- poa cal complete}
09859             \textcolor{vhdlchar}{s\_poa\_done}
09860         \textcolor{vhdlchar}{)};
09861 
09862         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_poa_lat_cmd_wait} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10};\textcolor{keyword}{ -- Number of clock cycles to wait for lat\_inc/lat\_dec
       signal to take effect.}
09863         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_poa_max_lat} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{100};\textcolor{keyword}{ -- Maximum number of allowable latency changes.}
09864         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09865 
09866         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_poa_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_poa_state};
09867 
09868 
09869 \textcolor{vhdlkeyword}{    begin}
09870 
09871         poa\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
09872 \textcolor{vhdlkeyword}{        begin}
09873             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09874                 \textcolor{vhdlchar}{sig_poa_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09875                 \textcolor{vhdlchar}{seq_poa_lat_dec_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09876                 \textcolor{vhdlchar}{seq_poa_lat_inc_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09877                 \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09878 
09879                 \textcolor{vhdlchar}{sig_poa_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_poa\_rewind\_to\_pass};
09880 
09881             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09882                 \textcolor{vhdlchar}{sig_poa_ack}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
09883                 \textcolor{vhdlchar}{seq_poa_lat_inc_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09884                 \textcolor{vhdlchar}{seq_poa_lat_dec_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09885 
09886                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_poa\_cal} \textcolor{keywordflow}{then}
09887                     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_poa_state} \textcolor{keywordflow}{is}
09888                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa\_rewind\_to\_pass} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09889 \textcolor{keyword}{                            -- In postamble calibration}
09890 \textcolor{keyword}{                            --}
09891 \textcolor{keyword}{                            -- Normally, must wait for sig\_dimm\_driving\_dq to be '1'}
09892 \textcolor{keyword}{                            -- before reading, but by this point in calibration}
09893 \textcolor{keyword}{                            -- rdata\_valid is assumed to be set up properly.  The}
09894 \textcolor{keyword}{                            -- sig\_poa\_match\_en (derived from rdata\_valid) is used}
09895 \textcolor{keyword}{                            -- here rather than sig\_dimm\_driving\_dq.}
09896                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_poa_match_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09897                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_poa_match} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09898                                     \textcolor{vhdlchar}{sig_poa_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_poa\_done};
09899                                 \textcolor{keywordflow}{else}
09900                                     \textcolor{vhdlchar}{seq_poa_lat_dec_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09901                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09902 
09903                                 \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09904                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09905 
09906 
09907                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa\_done} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
09908                             \textcolor{vhdlchar}{sig_poa_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
09909                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
09910                 \textcolor{keywordflow}{else}
09911                     \textcolor{vhdlchar}{sig_poa_state}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_poa\_rewind\_to\_pass};
09912                     \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
09913                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09914 
09915 
09916                 \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{sig_poa_adjust_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_poa_max_lat}
09917                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"Maximum number of postamble latency adjustments exceeded."}
09918                     \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
09919             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09920         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
09921 
09922     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
09923 
09924 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09925 \textcolor{keyword}{    -- code block for tracking signal generation}
09926 \textcolor{keyword}{    --}
09927 \textcolor{keyword}{    -- this is used for initial tracking setup (finding a reference window)}
09928 \textcolor{keyword}{    -- and periodic tracking operations (PVT compensation on rsc phase)}
09929 \textcolor{keyword}{    --}
09930 \textcolor{keyword}{    -- A slave trk state machine is described and implemented within the block}
09931 \textcolor{keyword}{    -- The mimic path is controlled within this block}
09932 \textcolor{keyword}{    -- ------------------------------------------------------------------}
09933     \textcolor{vhdlchar}{trk\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
09934 
09935         \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_tracking_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
09936 \textcolor{keyword}{            -- initialise variables out of reset}
09937             \textcolor{vhdlchar}{s\_trk\_init}\textcolor{vhdlchar}{,}
09938 \textcolor{keyword}{            -- idle state}
09939             \textcolor{vhdlchar}{s\_trk\_idle}\textcolor{vhdlchar}{,}
09940 \textcolor{keyword}{            -- sample data from the mimic path (build window)}
09941             \textcolor{vhdlchar}{s\_trk\_mimic\_sample}\textcolor{vhdlchar}{,}
09942 \textcolor{keyword}{            -- 'shift' mimic path phase}
09943             \textcolor{vhdlchar}{s\_trk\_next\_phase}\textcolor{vhdlchar}{,}
09944 \textcolor{keyword}{            -- calculate mimic window}
09945             \textcolor{vhdlchar}{s\_trk\_cdvw\_calc}\textcolor{vhdlchar}{,}
09946             \textcolor{vhdlchar}{s\_trk\_cdvw\_wait}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- for results}
09947 \textcolor{keyword}{            -- calculate how much mimic window has moved (only entered in periodic tracking)}
09948             \textcolor{vhdlchar}{s\_trk\_cdvw\_drift}\textcolor{vhdlchar}{,}
09949 \textcolor{keyword}{            -- track rsc phase (only entered in periodic tracking)}
09950             \textcolor{vhdlchar}{s\_trk\_adjust\_resync}\textcolor{vhdlchar}{,}
09951 \textcolor{keyword}{            -- communicate command complete to the master state machine}
09952             \textcolor{vhdlchar}{s\_trk\_complete}
09953         \textcolor{vhdlchar}{)};
09954 
09955         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mmc_seq_done}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09956         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mmc_seq_done_1t}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09957         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmc_seq_value_r}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09958 
09959         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mmc_start}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09960 
09961         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_state}                 \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_tracking_state};
09962         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_trk_last_state}            \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_tracking_state};
09963 
09964         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_rsc_drift}                 \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{
      c_max_rsc_drift_in_phases} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_rsc_drift_in_phases};\textcolor{keyword}{  -- stores total change in rsc phase from first
       calibration}
09965         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_req_rsc_shift}             \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{
      c_max_rsc_drift_in_phases} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_max_rsc_drift_in_phases};\textcolor{keyword}{  -- stores required shift in rsc phase
       instantaneously}
09966         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mimic_cdv_found}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09967         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mimic_cdv}                 \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE};\textcolor{keyword}{  -- centre of data valid window calculated from first mimic-cycle}
09968         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_mimic_delta}               \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};
09969         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_large_drift_seen}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
09970 
09971         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_remaining_samples}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
09972 
09973 \textcolor{vhdlkeyword}{    begin}
09974 
09975 \textcolor{keyword}{        -- advertise the codvw phase shift}
09976         \textcolor{keywordflow}{process} (clk, rst_n)
09977             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_length} \textcolor{vhdlchar}{:} \textcolor{comment}{integer};
09978 \textcolor{vhdlkeyword}{        begin}
09979 
09980             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09981 
09982                 \textcolor{vhdlchar}{codvw_trk_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09983 
09984             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
09985 
09986                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mimic_cdv_found} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
09987 
09988 \textcolor{keyword}{                    -- check range}
09989                     \textcolor{vhdlchar}{v\_length} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{codvw_trk_shift}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length};
09990 
09991                     \textcolor{vhdlchar}{codvw_trk_shift} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_signed}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rsc_drift}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
09992 
09993                 \textcolor{keywordflow}{else}
09994 
09995                     \textcolor{vhdlchar}{codvw_trk_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
09996 
09997                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
09998 
09999             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10000         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10001 
10002 \textcolor{keyword}{        -- request a mimic sample}
10003         mimic\_sample\_req : \textcolor{keywordflow}{process} (clk, rst_n)
10004             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{seq\_mmc\_start\_r} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10005 \textcolor{vhdlkeyword}{        begin}
10006             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10007                 \textcolor{vhdlchar}{seq_mmc_start}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10008                 \textcolor{vhdlchar}{seq\_mmc\_start\_r} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"0000"};
10009            \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10010 
10011                 \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)};
10012                 \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
10013                 \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10014 
10015 \textcolor{keyword}{                -- extend sig\_mmc\_start by one clock cycle}
10016                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mmc_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10017                     \textcolor{vhdlchar}{seq_mmc_start} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10018                     \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10019 
10020                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10021                     \textcolor{vhdlchar}{seq_mmc_start} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10022                     \textcolor{vhdlchar}{seq\_mmc\_start\_r}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10023 
10024                 \textcolor{keywordflow}{else}
10025                     \textcolor{vhdlchar}{seq_mmc_start} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10026 
10027                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10028 
10029             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10030         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10031 
10032 \textcolor{keyword}{        -- metastability hardening of async mmc\_seq\_done signal}
10033         mmc\_seq\_req\_sync : \textcolor{keywordflow}{process} (clk, rst_n)
10034             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_1r}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
10035             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_2r}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
10036             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_3r}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
10037 \textcolor{vhdlkeyword}{        begin}
10038             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10039                 \textcolor{vhdlchar}{sig_mmc_seq_done}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10040                 \textcolor{vhdlchar}{sig_mmc_seq_done_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10041 
10042                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_1r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10043                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_2r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10044                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_3r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10045             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10046                 \textcolor{vhdlchar}{sig_mmc_seq_done_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_3r};
10047                 \textcolor{vhdlchar}{sig_mmc_seq_done}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_2r};
10048 
10049                 \textcolor{vhdlchar}{mmc_seq_value_r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmc_seq_value};
10050 
10051                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_3r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_2r};
10052                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_2r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_mmc\_seq\_done\_1r};
10053                 \textcolor{vhdlchar}{v\_mmc\_seq\_done\_1r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmc_seq_done};
10054 
10055             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10056         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10057 
10058 
10059 \textcolor{keyword}{        -- collect mimic samples as they arrive}
10060         shift\_in\_mmc\_seq\_value : \textcolor{keywordflow}{process} (clk, rst_n)
10061 \textcolor{vhdlkeyword}{        begin}
10062             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10063                 \textcolor{vhdlchar}{sig_trk_cdvw_shift_in} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10064                 \textcolor{vhdlchar}{sig_trk_cdvw_phase}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10065             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10066                 \textcolor{vhdlchar}{sig_trk_cdvw_shift_in} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10067                 \textcolor{vhdlchar}{sig_trk_cdvw_phase}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10068                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mmc_seq_done_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_mmc_seq_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10069                     \textcolor{vhdlchar}{sig_trk_cdvw_shift_in} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10070                     \textcolor{vhdlchar}{sig_trk_cdvw_phase} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmc_seq_value_r};
10071                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10072             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10073         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10074 
10075 
10076 \textcolor{keyword}{        -- main tracking state machine}
10077         trk\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
10078 \textcolor{vhdlkeyword}{        begin}
10079             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10080                 \textcolor{vhdlchar}{sig_trk_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_init};
10081                 \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_init};
10082 
10083                 \textcolor{vhdlchar}{sig_trk_result}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10084                 \textcolor{vhdlchar}{sig_trk_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10085                 \textcolor{vhdlchar}{sig_mmc_start}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10086 
10087                 \textcolor{vhdlchar}{sig_trk_pll_select}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10088 
10089                 \textcolor{vhdlchar}{sig_req_rsc_shift}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{c_max_rsc_drift_in_phases};
10090                 \textcolor{vhdlchar}{sig_rsc_drift}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{c_max_rsc_drift_in_phases};
10091                 \textcolor{vhdlchar}{sig_mimic_delta}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{-}\textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};
10092 
10093                 \textcolor{vhdlchar}{sig_mimic_cdv_found}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10094                 \textcolor{vhdlchar}{sig_mimic_cdv}           \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10095 
10096                 \textcolor{vhdlchar}{sig_large_drift_seen}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10097 
10098                 \textcolor{vhdlchar}{sig_trk_cdvw_calc}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10099 
10100                 \textcolor{vhdlchar}{sig_remaining_samples}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10101 
10102                 \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10103                 \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
10104 
10105                 \textcolor{vhdlchar}{sig_trk_ack}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10106 
10107             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10108                 \textcolor{vhdlchar}{sig_trk_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_measure_clk_index};
10109                 \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10110                 \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
10111                 \textcolor{vhdlchar}{sig_large_drift_seen}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10112 
10113                 \textcolor{vhdlchar}{sig_trk_cdvw_calc}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10114 
10115                 \textcolor{vhdlchar}{sig_trk_ack}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10116                 \textcolor{vhdlchar}{sig_trk_err}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10117                 \textcolor{vhdlchar}{sig_trk_result}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10118 
10119                 \textcolor{vhdlchar}{sig_mmc_start}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10120 
10121 \textcolor{keyword}{                -- if no cdv found then reset tracking results}
10122                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mimic_cdv_found} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10123                     \textcolor{vhdlchar}{sig_rsc_drift}       \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10124                     \textcolor{vhdlchar}{sig_req_rsc_shift}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10125                     \textcolor{vhdlchar}{sig_mimic_delta}     \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10126                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10127 
10128                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_track} \textcolor{keywordflow}{then}
10129 
10130 \textcolor{keyword}{                    -- resync state machine}
10131                     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_trk_state} \textcolor{keywordflow}{is}
10132                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_init} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10133                             \textcolor{vhdlchar}{sig_trk_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_idle};
10134                             \textcolor{vhdlchar}{sig_mimic_cdv_found} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10135                             \textcolor{vhdlchar}{sig_rsc_drift}       \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10136                             \textcolor{vhdlchar}{sig_req_rsc_shift}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10137                             \textcolor{vhdlchar}{sig_mimic_delta}     \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10138 
10139 
10140                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10141                             \textcolor{vhdlchar}{sig_remaining_samples} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};\textcolor{keyword}{  -- ensure a 360 degrees sweep}
10142                             \textcolor{vhdlchar}{sig_trk_state}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_mimic\_sample};
10143 
10144 
10145                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_mimic\_sample} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10146                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_remaining_samples} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10147                                 \textcolor{vhdlchar}{sig_trk_state}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_cdvw\_calc};
10148                             \textcolor{keywordflow}{else}
10149                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{keywordflow}{then}
10150 \textcolor{keyword}{                                    -- request a sample as soon as we arrive in this state.}
10151 \textcolor{keyword}{                                    -- the default value of sig\_mmc\_start is zero!}
10152                                     \textcolor{vhdlchar}{sig_mmc_start} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10153                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10154 
10155                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mmc_seq_done_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      sig_mmc_seq_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10156 \textcolor{keyword}{                                    -- a sample has been collected, go to next PLL phase}
10157                                     \textcolor{vhdlchar}{sig_remaining_samples} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      sig_remaining_samples} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10158                                     \textcolor{vhdlchar}{sig_trk_state}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_next\_phase};
10159                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10160                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10161 
10162 
10163                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_next\_phase} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10164                             \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10165                             \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
10166 
10167                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10168                                 \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10169                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10170 
10171                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_end} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10172                                 \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_mimic\_sample};
10173                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10174 
10175 
10176                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_cdvw\_calc} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10177                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{keywordflow}{then}
10178 \textcolor{keyword}{                                -- reset variables we are interested in when we first arrive in this state}
10179                                 \textcolor{vhdlchar}{sig_trk_cdvw_calc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10180                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"gathered mimic phase samples
       DGRB\_MIMIC\_SAMPLES: "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{str}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{high} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{working_window}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
10181                             \textcolor{keywordflow}{else}
10182                                 \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_cdvw\_wait};
10183                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10184 
10185 
10186                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_cdvw\_wait} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10187                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{calculating} \textcolor{keywordflow}{then}
10188                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{valid\_result} \textcolor{keywordflow}{then}
10189                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"mimic window successfully found."} \textcolor{keywordflow}{severity}
       \textcolor{vhdlchar}{note};
10190                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mimic_cdv_found} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- first run of tracking operation}
10191                                         \textcolor{vhdlchar}{sig_mimic_cdv_found} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10192                                         \textcolor{vhdlchar}{sig_mimic_cdv}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      largest_window_centre};
10193                                         \textcolor{vhdlchar}{sig_trk_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_complete};
10194                                     \textcolor{keywordflow}{else}\textcolor{keyword}{  -- subsequent tracking operation runs}
10195                                         \textcolor{vhdlchar}{sig_mimic_delta}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_mimic_cdv} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_centre};
10196                                         \textcolor{vhdlchar}{sig_mimic_cdv}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      largest_window_centre};
10197                                         \textcolor{vhdlchar}{sig_trk_state}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_cdvw\_drift};
10198                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10199                                 \textcolor{keywordflow}{else}
10200                                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"couldn't find a data-valid window for
       tracking."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{cal_fail_sev_level};
10201                                     \textcolor{vhdlchar}{sig_trk_ack}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10202                                     \textcolor{vhdlchar}{sig_trk_err}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10203                                     \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_idle};
10204 
10205 \textcolor{keyword}{                                    -- set resync result code}
10206                                     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{status} \textcolor{keywordflow}{is}
10207                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{no\_invalid\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10208                                             \textcolor{vhdlchar}{sig_trk_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_NO_INVALID_PHASES}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_trk_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10209                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{multiple\_equal\_windows} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10210                                             \textcolor{vhdlchar}{sig_trk_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_MULTIPLE_EQUAL_WINDOWS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_trk_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10211                                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{no\_valid\_phases} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10212                                             \textcolor{vhdlchar}{sig_trk_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_RESYNC_NO_VALID_PHASES}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_trk_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10213                                         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10214                                             \textcolor{vhdlchar}{sig_trk_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_CRITICAL}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_trk_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10215                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
10216                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10217                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10218 
10219                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_cdvw\_drift} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- calculate the drift in rsc phase}
10220 \textcolor{keyword}{                            -- pipeline stage 1}
10221                             \textcolor{keywordflow}{if} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_mimic_delta}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
10222                                 \textcolor{vhdlchar}{sig_large_drift_seen} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10223                             \textcolor{keywordflow}{else}
10224                                 \textcolor{vhdlchar}{sig_large_drift_seen} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10225                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10226 
10227 \textcolor{keyword}{                            --pipeline stage 2}
10228                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{keywordflow}{then}
10229                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_large_drift_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10230                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_mimic_delta} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- anti-clockwise movement}
10231                                         \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      sig_mimic_delta} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};
10232                                     \textcolor{keywordflow}{else}\textcolor{keyword}{  -- clockwise movement}
10233                                         \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      sig_mimic_delta} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};
10234                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10235                                 \textcolor{keywordflow}{else}
10236                                     \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      sig_mimic_delta};
10237                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10238                                 \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_adjust\_resync};
10239                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10240 
10241                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_adjust\_resync} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10242                             \textcolor{vhdlchar}{sig_trk_pll_select} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_resync_clk_index};
10243 
10244                             \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10245 
10246                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{keywordflow}{then}
10247                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10248                                     \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_inc};
10249                                     \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10250                                     \textcolor{vhdlchar}{sig_rsc_drift}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_drift} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10251                                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10252                                     \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_pll_phs_dec};
10253                                     \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_req_rsc_shift} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10254                                     \textcolor{vhdlchar}{sig_rsc_drift}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_drift} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10255                                 \textcolor{keywordflow}{else}
10256                                     \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_complete};
10257                                     \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10258                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10259                             \textcolor{keywordflow}{else}
10260                                 \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_pll_inc_dec_n};\textcolor{keyword}{ -- maintain current value}
10261                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10262 
10263                             \textcolor{keywordflow}{if} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rsc_drift}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{c_max_rsc_drift_in_phases} \textcolor{keywordflow}{then}
10264                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" a maximum absolute change in resync\_clk of "} \textcolor{vhdlchar}{
      &} \textcolor{comment}{integer}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_rsc_drift}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{keyword}{" phases has "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
10265                                                             \textcolor{keyword}{" occurred (since read resynch phase
       calibration) during tracking"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{cal_fail_sev_level};
10266                                 \textcolor{vhdlchar}{sig_trk_err}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10267                                 \textcolor{vhdlchar}{sig_trk_result} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      C_ERR_MAX_TRK_SHFT_EXCEEDED}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_trk_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10268                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10269 
10270                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10271                                 \textcolor{vhdlchar}{sig_trk_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10272                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10273 
10274                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_phs_shft_end} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10275                                 \textcolor{vhdlchar}{sig_trk_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_complete};
10276                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10277 
10278 
10279                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_trk\_complete} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10280                             \textcolor{vhdlchar}{sig_trk_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10281 
10282                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
10283 
10284                     \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_state};
10285                 \textcolor{keywordflow}{else}
10286                     \textcolor{vhdlchar}{sig_trk_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_idle};
10287                     \textcolor{vhdlchar}{sig_trk_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_trk\_idle};
10288                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10289             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10290 
10291         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10292 
10293 
10294         rsc\_drift: \textcolor{keywordflow}{process} (sig_rsc_drift)
10295 \textcolor{vhdlkeyword}{        begin}
10296             \textcolor{vhdlchar}{sig_trk_rsc_drift} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_drift};\textcolor{keyword}{  -- communicate tracking shift to rsc process}
10297         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10298 
10299 
10300     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};\textcolor{keyword}{  -- tracking signals}
10301 
10302 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10303 \textcolor{keyword}{    -- write-datapath (WDP) ` and on-chip-termination (OCT) signal}
10304 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10305     wdp\_oct : \textcolor{keywordflow}{process}(clk,rst_n)
10306 \textcolor{vhdlkeyword}{    begin}
10307         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10308             \textcolor{vhdlchar}{seq_oct_value}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_set_oct_to_rs};
10309             \textcolor{vhdlchar}{dgrb_wdp_ovride} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10310         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10311             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{EN_OCT} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10312                 \textcolor{vhdlchar}{seq_oct_value}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_set_oct_to_rs};
10313                 \textcolor{vhdlchar}{dgrb_wdp_ovride} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10314             \textcolor{keywordflow}{else}
10315                 \textcolor{vhdlchar}{seq_oct_value}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_set_oct_to_rt};
10316                 \textcolor{vhdlchar}{dgrb_wdp_ovride} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10317             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10318         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10319     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10320 
10321 
10322 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10323 \textcolor{keyword}{    -- handles muxing of error codes to the control block}
10324 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10325     ac\_handshake\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
10326 \textcolor{vhdlkeyword}{    begin}
10327         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10328             \textcolor{vhdlchar}{dgrb_ctrl}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
10329         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10330             \textcolor{vhdlchar}{dgrb_ctrl}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
10331 
10332             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_wait\_admin} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgrb_last_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{then}
10333                 \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10334             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10335 
10336 
10337             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{keywordflow}{is}
10338                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_seek\_cdvw} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10339                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_err};
10340                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_rsc_result};
10341                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_track} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10342                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_err};
10343                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_trk_result};
10344                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- from main state machine}
10345                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_cmd_err};
10346                     \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_cmd_result};
10347             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
10348 
10349             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_dgrb_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_read\_mtp} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- check against command because aligned with
       command done not command\_err}
10350                 \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10351                 \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result}    \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      sig_cdvw_state}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{largest_window_size}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
10352             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10353 
10354             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgrb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgrb_last_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{keywordflow}{then}
10355                 \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10356             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10357         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10358     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10359 
10360 
10361 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10362 \textcolor{keyword}{    -- address/command state machine}
10363 \textcolor{keyword}{    -- process is commanded to begin reading training patterns.}
10364 \textcolor{keyword}{    --}
10365 \textcolor{keyword}{    -- implements the address/command slave state machine}
10366 \textcolor{keyword}{    -- issues read commands to the memory relative to given calibration}
10367 \textcolor{keyword}{    -- stage being implemented}
10368 \textcolor{keyword}{    -- burst length is dependent on memory type}
10369 \textcolor{keyword}{    -- ------------------------------------------------------------------}
10370     \textcolor{vhdlchar}{ac\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
10371 
10372 \textcolor{keyword}{        -- override the calibration burst length for DDR3 device support}
10373 \textcolor{keyword}{        -- (requires BL8 / on the fly setting in MR in admin block)}
10374         \textcolor{keywordflow}{function} set_read_bl ( memtype: \textcolor{keywordflow}{in} \textcolor{comment}{string} ) \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
10375 \textcolor{vhdlkeyword}{        begin}
10376 
10377             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{memtype} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
10378                 \textcolor{keywordflow}{return} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8};
10379             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{memtype} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{memtype} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
10380                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{c_cal_burst_len};
10381             \textcolor{keywordflow}{else}
10382                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" a calibration burst length choice has not been set for memory
       type "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{memtype} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10383             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10384 
10385             \textcolor{keywordflow}{return} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10386 
10387         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
10388 
10389 \textcolor{keyword}{        -- parameterisation of the read algorithm by burst length}
10390         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_poa_addr_width}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{6};
10391         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_cal_read_burst_len}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_read\_bl}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
10392         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_bursts_per_btp}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_mtp_len} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{
      c_cal_read_burst_len};
10393         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_read_burst_t}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_read_burst_len} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{
      DWIDTH_RATIO};
10394         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_max_rdata_valid_lat} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{50}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_cal_read_burst_len} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- maximum latency that rdata\_valid can ever have with respect to doing\_rd}
10395         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_rdv_ones_rd_clks}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_max_rdata_valid_lat} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_read_burst_t}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{c_read_burst_t};\textcolor{keyword}{  -- number of cycles to read ones for before a pulse of zeros}
10396 
10397 \textcolor{keyword}{        -- array of burst training pattern addresses}
10398 \textcolor{keyword}{        -- here the MTP is used in this addressing}
10399         \textcolor{keywordflow}{subtype} \textcolor{vhdlchar}{t_btp_addr}    \textcolor{keywordflow}{is} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*} \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10400         \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_btp_addr_array} \textcolor{keywordflow}{is} \textcolor{keywordflow}{array} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{t_btp_addr};
10401 
10402 \textcolor{keyword}{        -- default values}
10403         \textcolor{keywordflow}{function} \textcolor{vhdlchar}{defaults} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_btp_addr_array} \textcolor{keywordflow}{is}
10404             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_btp\_array} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_btp_addr_array};
10405 \textcolor{vhdlkeyword}{        begin}
10406             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
10407                 \textcolor{vhdlchar}{v\_btp\_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10408             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
10409             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_btp\_array};
10410         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
10411 
10412 \textcolor{keyword}{        -- load btp array addresses}
10413 \textcolor{keyword}{        -- Note: this scales to burst lengths of 2, 4 and 8}
10414 \textcolor{keyword}{        --       the settings here are specific to the choice of training pattern and need updating if the
       pattern changes}
10415         \textcolor{keywordflow}{function} set_btp_addr (mtp_almt : \textcolor{comment}{natural} ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_btp_addr_array} \textcolor{keywordflow}{is}
10416             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_addr\_array} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_btp_addr_array};
10417 \textcolor{vhdlkeyword}{        begin}
10418             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{c_cal_read_burst_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
10419 
10420 \textcolor{keyword}{                -- set addresses for xF5 data}
10421                 \textcolor{vhdlchar}{v\_addr\_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      c_cal_ofs_xF5} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_cal_read_burst_len};
10422 
10423 \textcolor{keyword}{                -- set addresses for x30 data (based on mtp alignment)}
10424                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10425                     \textcolor{vhdlchar}{v\_addr\_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{
      c_cal_read_burst_len} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_0} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      c_cal_read_burst_len};
10426                 \textcolor{keywordflow}{else}
10427                     \textcolor{vhdlchar}{v\_addr\_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{
      c_cal_read_burst_len} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_1} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      c_cal_read_burst_len};
10428                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10429 
10430             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
10431 
10432             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_addr\_array};
10433 
10434         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
10435 
10436 
10437         \textcolor{keywordflow}{function} \textcolor{vhdlchar}{find\_poa\_cycle\_period} \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
10438 \textcolor{keyword}{            -- Returns the period over which the postamble reads}
10439 \textcolor{keyword}{            -- repeat in c\_read\_burst\_t units.}
10440             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10441 \textcolor{vhdlkeyword}{        begin}
10442             \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_poa_addr_width} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{c_read_burst_t};
10443             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c_poa_addr_width} \textcolor{keywordflow}{then}
10444                 \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10445             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10446 
10447             \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_num\_bursts} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10448 
10449             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_num\_bursts};
10450         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
10451 
10452 
10453         \textcolor{keywordflow}{function} get_poa_burst_addr(burst\_count : \textcolor{keywordflow}{in} \textcolor{comment}{natural}; mtp_almt : \textcolor{keywordflow}{in} \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{
      t_btp_addr} \textcolor{keywordflow}{is}
10454             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_btp_addr};
10455 \textcolor{vhdlkeyword}{        begin}
10456             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{burst\_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10457                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10458                     \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_1};
10459                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mtp_almt} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
10460                     \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_ofs_x30_almt_0};
10461                 \textcolor{keywordflow}{else}
10462                     \textcolor{keywordflow}{report} \textcolor{keyword}{"Unsupported mtp\_almt "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mtp_almt}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10463                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10464 
10465 \textcolor{keyword}{                -- address gets incremented by four if in burst-length four.}
10466                 \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{)};
10467             \textcolor{keywordflow}{else}
10468                 \textcolor{vhdlchar}{v\_addr} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_cal_ofs_zeros};
10469             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10470 
10471             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_addr};
10472         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
10473 
10474 
10475         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{btp_addr_array}          \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_btp_addr_array};\textcolor{keyword}{  -- burst training pattern addresses}
10476 
10477         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_addr_cmd_state}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ac_state};
10478         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ac_state};
10479 
10480         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_doing_rd_count} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10481         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_count}       \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10482         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_setup}       \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{c_max_read_lat} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10483         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_read_burst_t};
10484 
10485 \textcolor{vhdlkeyword}{    begin}
10486 \textcolor{keyword}{        -- handles counts for when to begin burst-reads (sig\_burst\_count)}
10487 \textcolor{keyword}{        -- sets sig\_dimm\_driving\_dq}
10488 \textcolor{keyword}{        -- sets dgrb\_ac\_access\_req}
10489         dimm\_driving\_dq\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
10490 \textcolor{vhdlkeyword}{        begin}
10491             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10492                 \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10493                 \textcolor{vhdlchar}{sig_setup}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_read_lat};
10494                 \textcolor{vhdlchar}{sig_burst_count}     \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10495                 \textcolor{vhdlchar}{dgrb_ac_access_req}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10496                 \textcolor{vhdlchar}{sig_ac_even}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10497             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10498                 \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10499 
10500                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_ac\_idle} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_ac\_relax} \textcolor{keywordflow}{then}
10501                     \textcolor{vhdlchar}{dgrb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10502                 \textcolor{keywordflow}{else}
10503                     \textcolor{vhdlchar}{dgrb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10504                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10505 
10506                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{keywordflow}{is}
10507                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_read\_mtp} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_ac\_read\_rdv} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_ac\_read\_wd\_lat} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_ac\_read\_poa\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10508                         \textcolor{vhdlchar}{sig_ac_even} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{sig_ac_even};
10509 
10510 \textcolor{keyword}{                        -- a counter that keeps track of when we are ready}
10511 \textcolor{keyword}{                        -- to issue a burst read.  Issue burst read eigvery}
10512 \textcolor{keyword}{                        -- time we are at zero.}
10513                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10514                             \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10515                         \textcolor{keywordflow}{else}
10516                             \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10517                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10518 
10519 
10520                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgrb_ac_access_gnt} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10521                             \textcolor{vhdlchar}{sig_setup} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_read_lat};
10522                         \textcolor{keywordflow}{else}
10523 \textcolor{keyword}{                            -- primes reads}
10524 \textcolor{keyword}{                            -- signal that dimms are driving dq pins after}
10525 \textcolor{keyword}{                            -- at least c\_max\_read\_lat clock cycles have passed.}
10526 \textcolor{keyword}{                            --}
10527                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_setup} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10528                                 \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10529                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dgrb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10530                                 \textcolor{vhdlchar}{sig_setup} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_setup} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10531                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10532                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10533 
10534 
10535                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_relax} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10536                         \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10537                         \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10538                         \textcolor{vhdlchar}{sig_ac_even} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10539 
10540 
10541                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10542                         \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10543                         \textcolor{vhdlchar}{sig_ac_even} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
10544 
10545                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
10546             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10547         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10548 
10549 
10550         ac\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
10551 \textcolor{vhdlkeyword}{        begin}
10552             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10553                 \textcolor{vhdlchar}{sig_count}               \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10554                 \textcolor{vhdlchar}{sig_addr_cmd_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
10555                 \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
10556                 \textcolor{vhdlchar}{sig_doing_rd_count}      \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
10557 
10558                 \textcolor{vhdlchar}{sig_addr_cmd}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
10559 
10560                 \textcolor{vhdlchar}{btp_addr_array}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
10561                 \textcolor{vhdlchar}{sig_doing_rd}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10562 
10563             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10564                 \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{c_cal_mtp_len} \textcolor{keywordflow}{mod} \textcolor{vhdlchar}{c_cal_read_burst_len} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{report} \textcolor{vhdlchar}{
      dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"burst-training pattern length must be a multiple of burst-length."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10565                 \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{MEM_IF_CAL_BANK} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH} \textcolor{keywordflow}{report} \textcolor{vhdlchar}{
      dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"MEM\_IF\_CAL\_BANK out of range."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10566                 \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{C\_CAL\_DATA\_LEN} \textcolor{keywordflow}{report} \textcolor{vhdlchar}{
      dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"MEM\_IF\_CAL\_BASE\_COL out of range."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10567 
10568                 \textcolor{vhdlchar}{sig_addr_cmd}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{)};
10569 
10570                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_ac_req} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_ac\_idle} \textcolor{keywordflow}{then}
10571 \textcolor{keyword}{                -- and dgrb\_ac\_access\_gnt = '1'}
10572                     \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_relax};
10573                 \textcolor{keywordflow}{else}
10574                     \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_ac_req};
10575                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10576 
10577                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_doing_rd_count} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10578                     \textcolor{vhdlchar}{sig_doing_rd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10579                     \textcolor{vhdlchar}{sig_doing_rd_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_doing_rd_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10580                 \textcolor{keywordflow}{else}
10581                     \textcolor{vhdlchar}{sig_doing_rd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10582                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10583 
10584                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{keywordflow}{is}
10585                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10586                         \textcolor{vhdlchar}{sig_addr_cmd}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
10587 
10588 
10589                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_relax} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10590 \textcolor{keyword}{                        -- waits at least c\_max\_read\_lat before returning to s\_ac\_idle state}
10591                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{keywordflow}{then}
10592                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_max_read_lat};
10593                         \textcolor{keywordflow}{else}
10594                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10595                                 \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
10596                             \textcolor{keywordflow}{else}
10597                                 \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10598                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10599                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10600 
10601                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_read\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10602 \textcolor{keyword}{                        -- reads 'more'-training pattern}
10603 \textcolor{keyword}{                        -- issue read commands for proper addresses}
10604 
10605 \textcolor{keyword}{                        -- set burst training pattern (mtp in this case) addresses}
10606                         \textcolor{vhdlchar}{btp_addr_array} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_btp\_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_mtp_almt}\textcolor{vhdlchar}{)};
10607 
10608                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{keywordflow}{then}
10609                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- counts number of bursts in a training
       pattern}
10610                         \textcolor{keywordflow}{else}
10611                             \textcolor{vhdlchar}{sig_doing_rd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10612 
10613 \textcolor{keyword}{                            -- issue a read command every c\_read\_burst\_t clock cycles}
10614                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10615 
10616 \textcolor{keyword}{                                -- decide which read command to issue}
10617                                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
10618 
10619                                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{then}
10620 
10621                                         \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
10622                                             \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           -- previous value}
10623                                             \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        -- bank}
10624                                             \textcolor{vhdlchar}{btp_addr_array}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{                      -- column address}
10625                                             \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
10626                                             \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- burst length}
10627                                             \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};
10628                                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10629 
10630                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
10631 
10632 \textcolor{keyword}{                                -- Set next value of count}
10633                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10634                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_bursts_per_btp} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10635                                 \textcolor{keywordflow}{else}
10636                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10637                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10638 
10639                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10640 
10641                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10642 
10643                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_read\_poa\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10644 \textcolor{keyword}{                        -- Postamble rdata/rdata\_valid Activity:}
10645 \textcolor{keyword}{                        --}
10646 \textcolor{keyword}{                        --}
10647 \textcolor{keyword}{                        --                   (0)       (1)                           (2)}
10648 \textcolor{keyword}{                        --                    ;         ;                             ;         ;}
10649 \textcolor{keyword}{                        --               \_\_\_\_\_\_\_\_\_   \_\_   \_\_\_\_\_\_\_\_\_\_\_\_  \_\_\_\_\_\_\_\_\_\_\_\_\_   \_\_\_\_\_\_\_   \_\_\_\_\_\_\_\_\_}
10650 \textcolor{keyword}{                        --                        \(\backslash\) /  \(\backslash\) /            \(\backslash\) \(\backslash\)            \(\backslash\) /       \(\backslash\) /}
10651 \textcolor{keyword}{                        -- (a)  rdata[0] 00000000  X 11 X  0000000000 / / 0000000000  X   MTP   X  00000000}
10652 \textcolor{keyword}{                        --               \_\_\_\_\_\_\_\_\_/ \(\backslash\)\_\_/ \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_/ \(\backslash\)\_\_\_\_\_\_\_\_\_}
10653 \textcolor{keyword}{                        --                    ;         ;                             ;         ;}
10654 \textcolor{keyword}{                        --                    ;         ;                             ;         ;}
10655 \textcolor{keyword}{                        --                     \_\_\_\_\_\_\_\_\_              / /              \_\_\_\_\_\_\_\_\_}
10656 \textcolor{keyword}{                        --   rdata\_valid  \_\_\_\_|         |\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\) \(\backslash\)\_\_\_\_\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_\_}
10657 \textcolor{keyword}{                        --}
10658 \textcolor{keyword}{                        --                    ;<- (b) ->;<------------(c)------------>;         ;}
10659 \textcolor{keyword}{                        --                    ;         ;                             ;         ;}
10660 \textcolor{keyword}{                        --}
10661 \textcolor{keyword}{                        --}
10662 \textcolor{keyword}{                        --   This block must issue reads and drive doing\_rd to place the above pattern on}
10663 \textcolor{keyword}{                        -- the rdata and rdata\_valid ports.  MTP will most likely come back corrupted but}
10664 \textcolor{keyword}{                        -- the postamble block (poa\_block) will make the necessary adjustments to improve}
10665 \textcolor{keyword}{                        -- matters.}
10666 \textcolor{keyword}{                        --}
10667 \textcolor{keyword}{                        --   (a) Read zeros followed by two ones.  The two will be at the end of a burst.}
10668 \textcolor{keyword}{                        --      Assert rdata\_valid only during the burst containing the ones.}
10669 \textcolor{keyword}{                        --   (b) c\_read\_burst\_t clock cycles.}
10670 \textcolor{keyword}{                        --   (c) Must be greater than but NOT equal to maximum postamble latency clock}
10671 \textcolor{keyword}{                        --      cycles. Another way: c\_min = (max\_poa\_lat + 1) phy clock cycles.  This}
10672 \textcolor{keyword}{                        --      must also be long enough to allow the postamble block to respond to a}
10673 \textcolor{keyword}{                        --      the seq\_poa\_lat\_dec\_1x signal, but this requirement is less stringent}
10674 \textcolor{keyword}{                        --      than the first so that we can ignore it.}
10675 \textcolor{keyword}{                        --}
10676 \textcolor{keyword}{                        --   The find\_poa\_cycle\_period function should return (b+c)/c\_read\_burst\_t}
10677 \textcolor{keyword}{                        -- rounded up to the next largest integer.}
10678 \textcolor{keyword}{                        --}
10679 \textcolor{keyword}{                        --}
10680 
10681 \textcolor{keyword}{                        -- set burst training pattern (mtp in this case) addresses}
10682                         \textcolor{vhdlchar}{btp_addr_array} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_btp\_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_mtp_almt}\textcolor{vhdlchar}{)};
10683 
10684 \textcolor{keyword}{                        -- issue read commands for proper addresses}
10685                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{keywordflow}{then}
10686                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_poa\_cycle\_period} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- length of read patter in bursts.}
10687                         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dgrb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10688 \textcolor{keyword}{                            -- only begin operation once dgrb\_ac\_access\_gnt has been issued}
10689 \textcolor{keyword}{                            -- otherwise rdata\_valid may be asserted when rdasta is not}
10690 \textcolor{keyword}{                            -- valid.}
10691 \textcolor{keyword}{                            --}
10692 \textcolor{keyword}{                            -- *** WARNING: BE SAFE.  DON'T LET THIS HAPPEN TO YOU: ***}
10693 \textcolor{keyword}{                            --}
10694 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10695 \textcolor{keyword}{                            --                    ; \_\_\_\_\_\_\_ ;         ; \_\_\_\_\_\_\_ ;         ; \_\_\_\_\_\_\_}
10696 \textcolor{keyword}{                            --               XXXXX /       \(\backslash\) XXXXXXXXX /       \(\backslash\) XXXXXXXXX /       \(\backslash\)
       XXXXXXXXX}
10697 \textcolor{keyword}{                            --      addr/cmd XXXXXX   READ  XXXXXXXXXXX   READ  XXXXXXXXXXX   READ 
       XXXXXXXXXXX}
10698 \textcolor{keyword}{                            --               XXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/
       XXXXXXXXX}
10699 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10700 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10701 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;
       \_\_\_\_\_\_\_}
10702 \textcolor{keyword}{                            --               XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX /     
        \(\backslash\)}
10703 \textcolor{keyword}{                            --         rdata XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX   MTP
         X}
10704 \textcolor{keyword}{                            --               XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
       \(\backslash\)\_\_\_\_\_\_\_/}
10705 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10706 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10707 \textcolor{keyword}{                            --                     \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_}
10708 \textcolor{keyword}{                            --      doing\_rd  \_\_\_\_|         |\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_|        
       |\_\_\_\_\_\_\_\_\_\_}
10709 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10710 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10711 \textcolor{keyword}{                            --                              
       \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
10712 \textcolor{keyword}{                            -- ac\_accesss\_gnt \_\_\_\_\_\_\_\_\_\_\_\_\_\_|}
10713 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10714 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10715 \textcolor{keyword}{                            --                                                   \_\_\_\_\_\_\_\_\_          
       \_\_\_\_\_\_\_\_\_}
10716 \textcolor{keyword}{                            --    rdata\_valid \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_|      
         |}
10717 \textcolor{keyword}{                            --                    ;         ;         ;         ;         ;         ;}
10718 \textcolor{keyword}{                            --}
10719 \textcolor{keyword}{                            --                   (0)       (1)                 (2)}
10720 \textcolor{keyword}{                            --}
10721 \textcolor{keyword}{                            --}
10722 \textcolor{keyword}{                            --   Cmmand and doing\_rd issued at (0).  The doing\_rd signal enters the}
10723 \textcolor{keyword}{                            -- rdata\_valid pipe here so that it will return on rdata\_valid with the}
10724 \textcolor{keyword}{                            -- expected latency (at this point in calibration, rdata\_valid and adv\_rd\_lat}
10725 \textcolor{keyword}{                            -- should be properly calibrated).  Unlike doing\_rd, since ac\_access\_gnt is not}
10726 \textcolor{keyword}{                            -- asserted the READ command at (0) is never actually issued.  This results}
10727 \textcolor{keyword}{                            -- in the situation at (2) where rdata is undefined yet rdata\_valid indicates}
10728 \textcolor{keyword}{                            -- valid data.  The moral of this story is to wait for ac\_access\_gnt = '1'}
10729 \textcolor{keyword}{                            -- before issuing commands when it is important that rdata\_valid be accurate.}
10730 \textcolor{keyword}{                            --}
10731 \textcolor{keyword}{                            --}
10732 \textcolor{keyword}{                            --}
10733 \textcolor{keyword}{                            --}
10734 
10735                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10736                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
10737                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           -- previous value}
10738                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        -- bank}
10739                                     \textcolor{vhdlchar}{get\_poa\_burst\_addr}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      current_mtp_almt}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}\textcolor{keyword}{-- column address}
10740                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
10741                                     \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- burst length}
10742                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};
10743 
10744 
10745 \textcolor{keyword}{                                -- Set doing\_rd}
10746                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10747                                     \textcolor{vhdlchar}{sig_doing_rd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10748                                     \textcolor{vhdlchar}{sig_doing_rd_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- Extend doing\_rd pulse by
       this many phy\_clk cycles.}
10749                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10750 
10751 
10752 \textcolor{keyword}{                                -- Set next value of count}
10753                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10754                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_poa\_cycle\_period} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- read for one period then
       relax (no read) for same time period}
10755                                 \textcolor{keywordflow}{else}
10756                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10757                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10758                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10759                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10760 
10761 
10762                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_read\_rdv} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10763                         \textcolor{keywordflow}{assert} \textcolor{vhdlchar}{c_max_rdata_valid_lat} \textcolor{keywordflow}{mod} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{report} \textcolor{vhdlchar}{
      dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"c\_max\_rdata\_valid\_lat must be a multiple of c\_read\_burst\_t."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
10764 
10765                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{keywordflow}{then}
10766                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_rdv_ones_rd_clks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10767                         \textcolor{keywordflow}{else}
10768                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10769                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10770 \textcolor{keyword}{                                    -- expecting to read ZEROS}
10771                                     \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
10772                                         \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           -- previous valid}
10773                                         \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        -- bank}
10774                                         \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{C\_CAL\_OFS\_ZEROS}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- column}
10775                                         \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
10776                                         \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- burst length}
10777                                         \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};
10778 
10779                                 \textcolor{keywordflow}{else}
10780 \textcolor{keyword}{                                    -- expecting to read ONES}
10781                                     \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- configuration}
10782                                         \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                           -- previous value}
10783                                         \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        -- bank}
10784                                         \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{C\_CAL\_OFS\_ONES}\textcolor{vhdlchar}{,}\textcolor{keyword}{   -- column address}
10785                                         \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
10786                                         \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{,}\textcolor{keyword}{                   -- op length}
10787                                         \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};
10788                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10789 
10790                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10791                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_rdv_ones_rd_clks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10792                                 \textcolor{keywordflow}{else}
10793                                     \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
10794                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10795                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10796 
10797                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{c_rdv_ones_rd_clks} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}
10798                                \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{c_read_burst_t} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
10799 \textcolor{keyword}{                                -- the last burst read- that was issued was supposed to read only zeros}
10800 \textcolor{keyword}{                                -- a burst read command will be issued on the next clock cycle}
10801 \textcolor{keyword}{                                --}
10802 \textcolor{keyword}{                                -- A long (>= maximim rdata\_valid latency) series of burst reads are}
10803 \textcolor{keyword}{                                -- issued for ONES.}
10804 \textcolor{keyword}{                                -- Into this stream a single burst read for ZEROs is issued.  After}
10805 \textcolor{keyword}{                                -- the ZERO read command is issued, rdata\_valid needs to come back}
10806 \textcolor{keyword}{                                -- high one clock cycle before the next read command (reading ONES}
10807 \textcolor{keyword}{                                -- again) is issued.  Since the rdata\_valid is just a delayed}
10808 \textcolor{keyword}{                                -- version of doing\_rd, doing\_rd needs to exhibit the same behaviour.}
10809 \textcolor{keyword}{                                --}
10810 \textcolor{keyword}{                                -- for FR (burst length 4): require that doing\_rd high 1 clock cycle after
       cs\_n is low}
10811 \textcolor{keyword}{                                --               \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_      \_\_\_\_    
        \_\_\_\_      \_\_\_\_      \_\_\_\_}
10812 \textcolor{keyword}{                                -- clk      \_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|   
       |\_\_\_\_|    |\_\_\_\_|    |\_\_\_\_|}
10813 \textcolor{keyword}{                                --}
10814 \textcolor{keyword}{                                --          \_\_\_             \_\_\_\_\_\_\_             \_\_\_\_\_\_\_             \_\_\_\_\_\_\_
                   \_\_\_\_\_\_\_}
10815 \textcolor{keyword}{                                --             \(\backslash\) XXXXXXXXX /       \(\backslash\) XXXXXXXXX /       \(\backslash\) XXXXXXXXX /      
       \(\backslash\) XXXXXXXXX /       \(\backslash\) XXXX}
10816 \textcolor{keyword}{                                -- addr         XXXXXXXXXXX  ONES   XXXXXXXXXXX  ONES   XXXXXXXXXXX  ZEROS 
       XXXXXXXXXXX  ONES   XXXXX--> Repeat}
10817 \textcolor{keyword}{                                --          \_\_\_/ XXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXX
       \(\backslash\)\_\_\_\_\_\_\_/ XXXXXXXXX \(\backslash\)\_\_\_\_\_\_\_/ XXXX}
10818 \textcolor{keyword}{                                --}
10819 \textcolor{keyword}{                                --               \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_           \_\_\_\_\_\_\_\_\_         
        \_\_\_\_\_\_\_\_\_           \_\_\_\_}
10820 \textcolor{keyword}{                                -- cs\_n     \_\_\_\_|         |\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_|        
       |\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_|}
10821 \textcolor{keyword}{                                --}
10822 \textcolor{keyword}{                                --                                                                         
        \_\_\_\_\_\_\_\_\_}
10823 \textcolor{keyword}{                                -- doing\_rd
       \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_|         |\_\_\_\_\_\_\_\_\_\_\_\_\_\_}
10824 \textcolor{keyword}{                                --}
10825 \textcolor{keyword}{                                --}
10826 \textcolor{keyword}{                                -- for HR: require that doing\_rd high in the same clock cycle as cs\_n is
       low}
10827 \textcolor{keyword}{                                --}
10828 
10829                                 \textcolor{vhdlchar}{sig_doing_rd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{2-1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
10830 
10831                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10832                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10833 
10834 
10835                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_ac\_read\_wd\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10836 \textcolor{keyword}{                        -- continuously issues reads on the memory locations}
10837 \textcolor{keyword}{                        -- containing write latency addr=[2*c\_cal\_burst\_len - (3*c\_cal\_burst\_len - 1)]}
10838 
10839                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{keywordflow}{then}
10840 \textcolor{keyword}{                            -- no initialization required here.  Must still wait}
10841 \textcolor{keyword}{                            -- a clock cycle before beginning operations so that}
10842 \textcolor{keyword}{                            -- we are properly synchronized with}
10843 \textcolor{keyword}{                            -- dimm\_driving\_dq\_proc.}
10844                         \textcolor{keywordflow}{else}
10845                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_burst_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
10846                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dimm_driving_dq} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
10847                                     \textcolor{vhdlchar}{sig_doing_rd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
10848                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10849 
10850                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{read}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- configuration}
10851                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}\textcolor{keyword}{                               -- previous value}
10852                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
10853                                     \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c_cal_ofs_wd_lat}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- column}
10854                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
10855                                     \textcolor{vhdlchar}{c_cal_read_burst_len}\textcolor{vhdlchar}{,}
10856                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};
10857                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10858                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10859 
10860 
10861                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
10862                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgrb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"undefined state in addr\_cmd\_proc"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{error};
10863                         \textcolor{vhdlchar}{sig_addr_cmd_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_ac\_idle};
10864                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
10865 
10866 \textcolor{keyword}{                -- mask odt signal}
10867                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
10868                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{odt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{odt_settings}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read};
10869                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
10870 
10871                 \textcolor{vhdlchar}{sig_addr_cmd_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_addr_cmd_state};
10872             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
10873 
10874         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
10875 
10876     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block} \textcolor{vhdlchar}{ac\_block};
10877 
10878 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
10879 
10880 \textcolor{keyword}{--}
10881 
10882 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
10883 \textcolor{keyword}{--  Abstract        : data gatherer (write bias) [dgwb] block for the non-levelling}
10884 \textcolor{keyword}{--                    AFI PHY sequencer}
10885 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
10886 
10887 
10888 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
10889 \textcolor{vhdlkeyword}{    use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
10890 \textcolor{vhdlkeyword}{    use }ieee.numeric\_std.\textcolor{keywordflow}{all};
10891 
10892 
10893 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
10894 
10895 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
10896 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
10897 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
10898 \textcolor{keyword}{--}
10899 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
10900 
10901 \textcolor{keyword}{-- The address and command package (alt\_mem\_phy\_addr\_cmd\_pkg) is used to combine DRAM address}
10902 \textcolor{keyword}{-- and command signals in one record and unify the functions operating on this record.}
10903 \textcolor{keyword}{--}
10904 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_addr_cmd_pkg.\textcolor{keywordflow}{all};
10905 
10906 \textcolor{keyword}{--}
10907 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_dgwb \textcolor{keywordflow}{is}
10908     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
10909 \textcolor{keyword}{        -- Physical IF width definitions}
10910         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10911         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10912         \textcolor{vhdlchar}{MEM_IF_DWIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10913         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10914         \textcolor{vhdlchar}{DWIDTH_RATIO}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10915         \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10916         \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10917         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- The sequencer outputs memory control signals of width
       num\_ranks}
10918         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
10919         \textcolor{vhdlchar}{ADV_LAT_WIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
10920         \textcolor{vhdlchar}{MEM_IF_CAL_BANK}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- Bank to which calibration data is written}
10921 \textcolor{keyword}{        -- Base column address to which calibration data is written.}
10922 \textcolor{keyword}{        -- Memory at MEM\_IF\_CAL\_BASE\_COL - MEM\_IF\_CAL\_BASE\_COL + C\_CAL\_DATA\_LEN - 1}
10923 \textcolor{keyword}{        -- is assumed to contain the proper data.}
10924         \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
10925     \textcolor{vhdlchar}{)};
10926     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
10927 \textcolor{keyword}{        -- CLK Reset}
10928         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
10929         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
10930 
10931         \textcolor{vhdlchar}{parameterisation_rec}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_algm_paramaterisation};
10932 
10933 \textcolor{keyword}{        -- Control interface :}
10934         \textcolor{vhdlchar}{dgwb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_ctrl_stat};
10935         \textcolor{vhdlchar}{ctrl_dgwb}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_command};
10936 
10937 \textcolor{keyword}{        -- iRAM 'push' interface :}
10938         \textcolor{vhdlchar}{dgwb_iram}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_iram_push};
10939         \textcolor{vhdlchar}{iram_push_done}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
10940 
10941 \textcolor{keyword}{        -- Admin block req/gnt interface.}
10942         \textcolor{vhdlchar}{dgwb_ac_access_req}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
10943         \textcolor{vhdlchar}{dgwb_ac_access_gnt}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
10944 
10945 \textcolor{keyword}{        -- WDP interface}
10946         \textcolor{vhdlchar}{dgwb_dqs_burst}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10947         \textcolor{vhdlchar}{dgwb_wdata_valid}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10948         \textcolor{vhdlchar}{dgwb_wdata}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}    \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DWIDTH}         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10949         \textcolor{vhdlchar}{dgwb_dm}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}    \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DM_WIDTH}       \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10950         \textcolor{vhdlchar}{dgwb_dqs}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}                            \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10951         \textcolor{vhdlchar}{dgwb_wdp_ovride}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
10952 
10953 \textcolor{keyword}{        -- addr/cmd output for write commands.}
10954         \textcolor{vhdlchar}{dgwb_ac}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
10955 
10956         \textcolor{vhdlchar}{bypassed_rdata}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
10957 
10958 \textcolor{keyword}{        -- odt settings per chip select}
10959         \textcolor{vhdlchar}{odt_settings}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_odt_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}
10960 
10961     \textcolor{vhdlchar}{)};
10962 
10963 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
10964 
10965 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
10966 
10967 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
10968 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
10969 \textcolor{keyword}{-- instances generics are used)}
10970 \textcolor{keyword}{--}
10971 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
10972 
10973 \textcolor{keyword}{--}
10974 \textcolor{keywordflow}{architecture} rtl \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_dgwb is
10975 
10976     \textcolor{keywordflow}{type} \textcolor{vhdlchar}{t_dgwb_state} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}
10977         \textcolor{vhdlchar}{s\_idle}\textcolor{vhdlchar}{,}
10978         \textcolor{vhdlchar}{s\_wait\_admin}\textcolor{vhdlchar}{,}
10979 
10980         \textcolor{vhdlchar}{s\_write\_btp}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- Writes bit-training pattern}
10981         \textcolor{vhdlchar}{s\_write\_ones}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- Writes ones}
10982         \textcolor{vhdlchar}{s\_write\_zeros}\textcolor{vhdlchar}{,}\textcolor{keyword}{    -- Writes zeros}
10983         \textcolor{vhdlchar}{s\_write\_mtp}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- Write more training patterns (requires read to check allignment)}
10984         \textcolor{vhdlchar}{s\_write\_01\_pairs}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- Writes 01 pairs}
10985         \textcolor{vhdlchar}{s\_write\_1100\_step}\textcolor{vhdlchar}{,}\textcolor{keyword}{-- Write step function (half zeros, half ones)}
10986         \textcolor{vhdlchar}{s\_write\_0011\_step}\textcolor{vhdlchar}{,}\textcolor{keyword}{-- Write reversed step function (half ones, half zeros)}
10987         \textcolor{vhdlchar}{s\_write\_wlat}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- Writes the write latency into a memory address.}
10988 
10989         \textcolor{vhdlchar}{s\_release\_admin}
10990     \textcolor{vhdlchar}{)};
10991 
10992     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_seq_addr_cmd_config}  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_config_rec}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_config\_rec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_ADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
10993 
10994 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
10995 \textcolor{keyword}{--}
10996     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{dgwb_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (dgwb) : "};
10997 
10998     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{dqs\_pattern} \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic\_vector} \textcolor{keywordflow}{is}
10999         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{dqs} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
11000 \textcolor{vhdlkeyword}{    begin}
11001         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
11002             \textcolor{vhdlchar}{dqs} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"10"};
11003         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
11004             \textcolor{vhdlchar}{dqs} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{"1100"};
11005         \textcolor{keywordflow}{else}
11006             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgwb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported DWIDTH\_RATIO in function dqs\_pattern."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{
      failure};
11007         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11008         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{dqs};
11009     \textcolor{keywordflow}{end};
11010 
11011     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_addr_cmd}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_addr_cmd_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
11012 
11013     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dgwb_state}           \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_dgwb_state};
11014     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_dgwb_last_state}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_dgwb_state};
11015     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{access_complete}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11016 
11017     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{generate_wdata}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{  -- for s\_write\_wlat only}
11018 
11019 \textcolor{keyword}{    -- current chip select being processed}
11020     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_cs}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11021 
11022 \textcolor{vhdlkeyword}{begin}
11023     \textcolor{vhdlchar}{dgwb_ac} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_addr_cmd};
11024 
11025 \textcolor{keyword}{    -- Set IRAM interface to defaults}
11026     \textcolor{vhdlchar}{dgwb_iram} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11027 
11028 \textcolor{keyword}{    -- Master state machine.  Generates state transitions.}
11029     \textcolor{vhdlchar}{master\_dgwb\_state\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{True} \textcolor{keywordflow}{generate}
11030         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_ctrl_dgwb} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_command};\textcolor{keyword}{ -- registers ctrl\_dgwb input.}
11031 \textcolor{vhdlkeyword}{    begin}
11032 \textcolor{keyword}{        -- generate the current\_cs signal to track which cs accessed by PHY at any instance}
11033         current\_cs\_proc : \textcolor{keywordflow}{process} (clk, rst_n)
11034 \textcolor{vhdlkeyword}{        begin}
11035             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11036                 \textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11037             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11038                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_ctrl_dgwb}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11039                     \textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_ctrl_dgwb}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs};
11040                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11041             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11042         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11043 
11044 
11045         master\_dgwb\_state\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
11046 \textcolor{vhdlkeyword}{        begin}
11047             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11048                 \textcolor{vhdlchar}{sig_dgwb_state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
11049                 \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
11050                 \textcolor{vhdlchar}{sig_ctrl_dgwb}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11051             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11052                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{keywordflow}{is}
11053                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11054                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_ctrl_dgwb}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11055                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_ctrl_dgwb}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{dgwb}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11056                                 \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_wait\_admin};
11057                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11058                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11059 
11060 
11061                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_wait\_admin} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11062                         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_ctrl_dgwb}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
11063                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_write\_btp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_btp};
11064                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_write\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_mtp};
11065                             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_was}       \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_wlat};
11066 
11067                             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}        \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11068                                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgwb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unknown command"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{error};
11069                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11070 
11071                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgwb_ac_access_gnt} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11072                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_wait\_admin};
11073                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11074 
11075 
11076                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11077                         \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_zeros};
11078 
11079 
11080                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_zeros} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11081                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11082                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_ones};
11083                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11084 
11085 
11086                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ones} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11087                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11088                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
11089                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11090 
11091 
11092                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11093                         \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_01\_pairs};
11094 
11095 
11096                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_01\_pairs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11097                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11098                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_1100\_step};
11099                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11100 
11101                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_1100\_step} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11102                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11103                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_0011\_step};
11104                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11105 
11106 
11107                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_0011\_step} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11108                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11109                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
11110                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11111 
11112 
11113                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_wlat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11114                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      access_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11115                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_release\_admin};
11116                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11117 
11118 
11119                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11120                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgwb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11121                             \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
11122                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11123 
11124 
11125                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11126                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgwb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"undefined state in addr\_cmd\_proc"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{error};
11127                         \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_idle};
11128                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11129 
11130                 \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_dgwb_state};
11131                 \textcolor{vhdlchar}{sig_ctrl_dgwb}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_dgwb};
11132             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11133         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11134     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate};
11135 
11136 
11137 \textcolor{keyword}{    -- Generates writes}
11138     \textcolor{vhdlchar}{ac\_write\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{True} \textcolor{keywordflow}{generate}
11139 
11140         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_BURST_T}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{C\_CAL\_BURST\_LEN} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{DWIDTH_RATIO};\textcolor{keyword}{  -- Number of phy-clock cycles
       per burst}
11141         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_MAX_WLAT}   \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{ADV_LAT_WIDTH}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- Maximum latency in clock cycles}
11142         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_MAX_COUNT}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{C_MAX_WLAT} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{C_BURST_T} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- up to 12 consecutive
       writes at 4 cycle intervals}
11143 
11144 \textcolor{keyword}{        -- The following function sets the width over which}
11145 \textcolor{keyword}{        -- write latency should be repeated on the dq bus}
11146 \textcolor{keyword}{        -- the default value is MEM\_IF\_DQ\_PER\_DQS}
11147         \textcolor{keywordflow}{function} \textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width} \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
11148 \textcolor{vhdlkeyword}{        begin}
11149             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS} \textcolor{keywordflow}{loop}
11150                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{>=} \textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{keywordflow}{then}
11151                     \textcolor{keywordflow}{return} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS};
11152                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11153             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11154             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgwb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"the specified maximum write latency cannot be fully represented in
       the given number of DQ pins"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
11155                                         \textcolor{keyword}{"** NOTE: This may cause overflow when setting ctl\_wlat signal"} \textcolor{keywordflow}{
      severity} \textcolor{vhdlchar}{warning};
11156             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS};
11157         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
11158 
11159         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{C_WLAT_DQ_REP_WIDTH} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_wlat\_dq\_rep\_width};
11160 
11161         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{sig_count}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11162 \textcolor{vhdlkeyword}{    begin}
11163         ac\_write\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
11164 \textcolor{vhdlkeyword}{        begin}
11165             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11166                 \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11167                 \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11168                 \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11169                 \textcolor{vhdlchar}{dgwb_wdata}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11170                 \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11171                 \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11172                 \textcolor{vhdlchar}{generate_wdata}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- for s\_write\_wlat only}
11173                 \textcolor{vhdlchar}{sig_count}        \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11174                 \textcolor{vhdlchar}{sig_addr_cmd}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int\_pup\_reset}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
11175                 \textcolor{vhdlchar}{access_complete}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11176 
11177             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11178                 \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11179                 \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11180                 \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11181                 \textcolor{vhdlchar}{dgwb_wdata}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11182                 \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11183                 \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11184                 \textcolor{vhdlchar}{sig_addr_cmd}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{deselect}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{)};
11185                 \textcolor{vhdlchar}{access_complete}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11186                 \textcolor{vhdlchar}{generate_wdata}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};\textcolor{keyword}{  -- for s\_write\_wlat only}
11187 
11188                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{keywordflow}{is}
11189 
11190                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11191                         \textcolor{vhdlchar}{sig_addr_cmd}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{)};
11192 
11193 \textcolor{keyword}{                    -- require ones in locations:}
11194 \textcolor{keyword}{                    --  1. c\_cal\_ofs\_ones (8 locations)}
11195 \textcolor{keyword}{                    --  2. 2nd half of location c\_cal\_ofs\_xF5 (4 locations)}
11196                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ones} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11197                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11198                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11199                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11200                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11201 
11202 \textcolor{keyword}{                        -- Write ONES to DQ pins}
11203                         \textcolor{vhdlchar}{dgwb_wdata}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11204                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11205 
11206 \textcolor{keyword}{                        -- Issue write command}
11207                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11208                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11209                         \textcolor{keywordflow}{else}
11210 
11211 \textcolor{keyword}{                            -- ensure safe intervals for DDRx memory writes (min 4 mem clk cycles between
       writes for BC4 DDR3)}
11212                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11213                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11214                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11215                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                        -- bank}
11216                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_ones}\textcolor{vhdlchar}{,}\textcolor{keyword}{   -- address}
11217                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- rank}
11218                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                      -- burst length
       (fixed at BC4)}
11219                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                 -- auto-precharge}
11220                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
11221                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11222                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11223                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- bank}
11224                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_ones} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- address}
11225                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- rank}
11226                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                        -- burst length
       (fixed at BC4)}
11227                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                   -- auto-precharge}
11228                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{then}
11229                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11230                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11231                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                          -- bank}
11232                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_xF5} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- address}
11233                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- rank}
11234                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                        -- burst length
       (fixed at BC4)}
11235                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                   -- auto-precharge}
11236                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11237                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11238                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11239 
11240                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
11241                             \textcolor{vhdlchar}{access_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11242                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11243 
11244 \textcolor{keyword}{                    -- require zeros in locations:}
11245 \textcolor{keyword}{                    --  1. c\_cal\_ofs\_zeros (8 locations)}
11246 \textcolor{keyword}{                    --  2. 1st half of c\_cal\_ofs\_x30\_almt\_0 (4 locations)}
11247 \textcolor{keyword}{                    --  3. 1st half of c\_cal\_ofs\_x30\_almt\_1 (4 locations)}
11248                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_zeros} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11249                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11250                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11251                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11252                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11253 
11254 \textcolor{keyword}{                        -- Write ZEROS to DQ pins}
11255                         \textcolor{vhdlchar}{dgwb_wdata}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11256                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11257 
11258 \textcolor{keyword}{                        -- Issue write command}
11259                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11260                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11261                         \textcolor{keywordflow}{else}
11262 
11263                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11264                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11265                                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11266                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
11267                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_zeros}\textcolor{vhdlchar}{,}\textcolor{keyword}{      -- address}
11268                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
11269                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                          -- burst
       length (fixed at BC4)}
11270                                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                     --
       auto-precharge}
11271                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
11272                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11273                                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11274                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
11275                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_zeros} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- address}
11276                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
11277                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                          -- burst
       length (fixed at BC4)}
11278                                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                     --
       auto-precharge}
11279                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8} \textcolor{keywordflow}{then}
11280                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11281                                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11282                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
11283                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_x30\_almt\_0}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- address}
11284                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
11285                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                          -- burst
       length (fixed at BC4)}
11286                                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                     --
       auto-precharge}
11287                             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{12} \textcolor{keywordflow}{then}
11288                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11289                                                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11290                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
11291                                                     \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_x30\_almt\_1}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- address}
11292                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
11293                                                     \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                          -- burst
       length (fixed at BC4)}
11294                                                     \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                     --
       auto-precharge}
11295                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11296                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11297                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11298 
11299 
11300                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
11301                             \textcolor{vhdlchar}{access_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11302                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11303 
11304 \textcolor{keyword}{                    -- require 0101 pattern in locations:}
11305 \textcolor{keyword}{                    --  1. 1st half of location c\_cal\_ofs\_xF5 (4 locations)}
11306                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_01\_pairs} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11307                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11308                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11309                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11310                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11311 
11312                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11313 
11314 \textcolor{keyword}{                        -- Issue write command}
11315                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11316                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11317                         \textcolor{keywordflow}{else}
11318                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11319                                 \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11320                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11321                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                       -- bank}
11322                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_xF5}\textcolor{vhdlchar}{,}\textcolor{keyword}{   -- address}
11323                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                         -- rank}
11324                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                     -- burst length}
11325                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                -- auto-precharge}
11326                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11327                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11328                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11329 
11330 
11331                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
11332                             \textcolor{vhdlchar}{access_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11333                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11334 
11335 \textcolor{keyword}{                        -- Write 01 to pairs of memory addresses}
11336                         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11337                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11338                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11339                             \textcolor{keywordflow}{else}
11340                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11341                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11342                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11343 
11344 \textcolor{keyword}{                    -- require pattern "0011" (or "1100") in locations:}
11345 \textcolor{keyword}{                    --  1. 2nd half of c\_cal\_ofs\_x30\_almt\_0 (4 locations)}
11346                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_0011\_step} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11347                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11348                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11349                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11350                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11351 
11352                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11353 
11354 \textcolor{keyword}{                        -- Issue write command}
11355                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11356                             \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11357                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11358                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                -- bank}
11359                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_x30\_almt\_0} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- address}
11360                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                  -- rank}
11361                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                              -- burst
       length}
11362                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                         --
       auto-precharge}
11363                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11364                         \textcolor{keywordflow}{else}
11365                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11366                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11367 
11368 
11369                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
11370                             \textcolor{vhdlchar}{access_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11371                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11372 
11373 \textcolor{keyword}{                        -- Write 0011 step to column addresses.  Note that}
11374 \textcolor{keyword}{                        -- it cannot be determined which at this point.  The}
11375 \textcolor{keyword}{                        -- strategy is to write both alignments and see which}
11376 \textcolor{keyword}{                        -- one is correct later on.}
11377 
11378 \textcolor{keyword}{                        -- this calculation has 2 parts:}
11379 \textcolor{keyword}{                        -- a) sig\_count mod C\_BURST\_T is a timewise iterator of repetition of the pattern}
11380 \textcolor{keyword}{                        -- b) i represents the temporal iterator of the pattern}
11381 \textcolor{keyword}{                        -- it is required to sum a and b and switch the pattern between 0 and 1 every 2
       locations in each dimension}
11382 \textcolor{keyword}{                        -- Note: the same formulae is used below for the 1100 pattern}
11383 
11384                         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11385                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count} \textcolor{keywordflow}{mod} \textcolor{vhdlchar}{C_BURST_T}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11386                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11387                             \textcolor{keywordflow}{else}
11388                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11389                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11390                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11391 
11392 \textcolor{keyword}{                    -- require pattern "1100" (or "0011") in locations:}
11393 \textcolor{keyword}{                    --  1. 2nd half of c\_cal\_ofs\_x30\_almt\_1 (4 locations)}
11394                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_1100\_step} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11395                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11396                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11397                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11398                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11399 
11400                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11401 
11402 \textcolor{keyword}{                        -- Issue write command}
11403                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11404                             \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
11405                                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11406                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                -- bank}
11407                                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_x30\_almt\_1} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{ -- address}
11408                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                  -- rank}
11409                                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                              -- burst
       length}
11410                                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                         --
       auto-precharge}
11411                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11412                         \textcolor{keywordflow}{else}
11413                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11414                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11415 
11416 
11417                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
11418                             \textcolor{vhdlchar}{access_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11419                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11420 
11421 \textcolor{keyword}{                        -- Write 1100 step to column addresses.  Note that}
11422 \textcolor{keyword}{                        -- it cannot be determined which at this point.  The}
11423 \textcolor{keyword}{                        -- strategy is to write both alignments and see which}
11424 \textcolor{keyword}{                        -- one is correct later on.}
11425                         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length} \textcolor{vhdlchar}{/} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11426                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count} \textcolor{keywordflow}{mod} \textcolor{vhdlchar}{C_BURST_T}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{mod} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11427                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11428                             \textcolor{keywordflow}{else}
11429                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DWIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11430                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11431                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11432 
11433 
11434                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_wlat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11435 \textcolor{keyword}{                        -- Effect:}
11436 \textcolor{keyword}{                        --   *Writes the memory latency to an array formed}
11437 \textcolor{keyword}{                        --   from memory addr=[2*C\_CAL\_BURST\_LEN-(3*C\_CAL\_BURST\_LEN-1)].}
11438 \textcolor{keyword}{                        --   The write latency is written to pairs of addresses}
11439 \textcolor{keyword}{                        --   across the given range.}
11440 \textcolor{keyword}{                        --}
11441 \textcolor{keyword}{                        --   Example}
11442 \textcolor{keyword}{                        --   C\_CAL\_BURST\_LEN = 4}
11443 \textcolor{keyword}{                        --   addr 8  -  9 [WLAT]  size = 2*MEM\_IF\_DWIDTH bits}
11444 \textcolor{keyword}{                        --   addr 10 - 11 [WLAT]  size = 2*MEM\_IF\_DWIDTH bits}
11445 \textcolor{keyword}{                        --}
11446 
11447                         \textcolor{vhdlchar}{dgwb_wdp_ovride}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11448                         \textcolor{vhdlchar}{dgwb_dqs}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dqs\_pattern};
11449                         \textcolor{vhdlchar}{dgwb_dm}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11450                         \textcolor{vhdlchar}{dgwb_wdata}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11451                         \textcolor{vhdlchar}{dgwb_dqs_burst}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11452                         \textcolor{vhdlchar}{dgwb_wdata_valid} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
11453 
11454                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{keywordflow}{then}
11455                             \textcolor{vhdlchar}{sig_addr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{write}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}\textcolor{keyword}{    -- A/C configuration}
11456                                 \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{,}
11457                                 \textcolor{vhdlchar}{MEM_IF_CAL_BANK}\textcolor{vhdlchar}{,}\textcolor{keyword}{                            -- bank}
11458                                 \textcolor{vhdlchar}{MEM_IF_CAL_BASE_COL} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{c\_cal\_ofs\_wd\_lat}\textcolor{vhdlchar}{,}\textcolor{keyword}{     -- address}
11459                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{,}\textcolor{keyword}{                              -- rank}
11460                                 \textcolor{vhdllogic}{}\textcolor{vhdllogic}{8}\textcolor{vhdlchar}{,}\textcolor{keyword}{                                          -- burst length (8 for DDR3 and
       4 for DDR/DDR2)}
11461                                 \textcolor{vhdlchar}{false}\textcolor{vhdlchar}{)};\textcolor{keyword}{                                     -- auto-precharge}
11462                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11463                         \textcolor{keywordflow}{else}
11464 \textcolor{keyword}{                            -- hold wdata\_valid and wdata 2 clock cycles}
11465 \textcolor{keyword}{                            -- 1 - because ac signal registered at top level of sequencer}
11466 \textcolor{keyword}{                            -- 2 - because want time to dqs\_burst edge which occurs 1 cycle earlier}
11467 \textcolor{keyword}{                            --     than wdata\_valid in an AFI compliant controller}
11468                             \textcolor{vhdlchar}{generate_wdata} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11469                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11470 
11471                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{generate_wdata} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11472                             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{C_WLAT_DQ_REP_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11473                                 \textcolor{vhdlchar}{dgwb_wdata}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{C_WLAT_DQ_REP_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      C_WLAT_DQ_REP_WIDTH}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{sig_count}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      C_WLAT_DQ_REP_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
11474                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11475 
11476 \textcolor{keyword}{                            -- delay by 1 clock cycle to account for 1 cycle discrepancy}
11477 \textcolor{keyword}{                            -- between dqs\_burst and wdata\_valid}
11478                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{C_MAX_COUNT} \textcolor{keywordflow}{then}
11479                                 \textcolor{vhdlchar}{access_complete}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11480                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11481 
11482                             \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{sig_count} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11483                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11484 
11485                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11486                         \textcolor{keywordflow}{null};
11487                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11488 
11489 \textcolor{keyword}{                -- mask odt signal}
11490                 \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11491                     \textcolor{vhdlchar}{sig_addr_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{odt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{odt_settings}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{current_cs}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write};
11492                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11493 
11494             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11495         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11496     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate};
11497 
11498 
11499 \textcolor{keyword}{    -- Handles handshaking for access to address/command}
11500     ac\_handshake\_proc : \textcolor{keywordflow}{process}(rst_n, clk)
11501 \textcolor{vhdlkeyword}{    begin}
11502         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11503             \textcolor{vhdlchar}{dgwb_ctrl}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11504             \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11505         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11506             \textcolor{vhdlchar}{dgwb_ctrl}          \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11507             \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11508 
11509             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{keywordflow}{then}
11510                 \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11511             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{keywordflow}{then}
11512                 \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11513             \textcolor{keywordflow}{else}
11514                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{dgwb_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unexpected state in ac\_handshake\_proc so haven't requested
       access to address/command."} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
11515             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11516 
11517             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_wait\_admin} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{then}
11518                 \textcolor{vhdlchar}{dgwb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11519             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11520 
11521             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sig_dgwb_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_idle} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{sig_dgwb_last_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_release\_admin} \textcolor{keywordflow}{then}
11522                 \textcolor{vhdlchar}{dgwb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11523             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11524         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11525     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11526 
11527 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{rtl};
11528 \textcolor{keyword}{--}
11529 
11530 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11531 \textcolor{keyword}{-- Abstract : ctrl block for the non-levelling AFI PHY sequencer}
11532 \textcolor{keyword}{--            This block is the central control unit for the sequencer. The method}
11533 \textcolor{keyword}{--            of control is to issue commands (prefixed cmd\_) to each of the other}
11534 \textcolor{keyword}{--            sequencer blocks to execute. Each command corresponds to a stage of}
11535 \textcolor{keyword}{--            the AFI PHY calibaration stage, and in turn each state represents a}
11536 \textcolor{keyword}{--            command or a supplimentary flow control operation. In addition to}
11537 \textcolor{keyword}{--            controlling the sequencer this block also checks for time out}
11538 \textcolor{keyword}{--            conditions which occur when a different system block is faulty.}
11539 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11540 
11541 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
11542 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
11543 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
11544 
11545 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
11546 
11547 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
11548 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
11549 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
11550 \textcolor{keyword}{--}
11551 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
11552 
11553 \textcolor{keyword}{-- The iram address package (alt\_mem\_phy\_iram\_addr\_pkg) is used to define the base addresses used}
11554 \textcolor{keyword}{-- for iram writes during calibration}
11555 \textcolor{keyword}{--}
11556 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_iram_addr_pkg.\textcolor{keywordflow}{all};
11557 
11558 \textcolor{keyword}{--}
11559 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_ctrl \textcolor{keywordflow}{is}
11560     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
11561         \textcolor{vhdlchar}{FAMILYGROUP_ID}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11562         \textcolor{vhdlchar}{MEM_IF_DLL_LOCK_COUNT}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11563         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
11564         \textcolor{vhdlchar}{DWIDTH_RATIO}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11565         \textcolor{vhdlchar}{IRAM_ADDRESSING}                \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_base_hdr_addresses};
11566         \textcolor{vhdlchar}{MEM_IF_CLK_PS}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11567         \textcolor{vhdlchar}{TRACKING_INTERVAL_IN_MS}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11568         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11569         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11570 
11571         \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
11572         \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{ -- if 0 null, if 1 skip rrp, if 2 rrp for 1 dqs group and
       1 cs}
11573 
11574         \textcolor{vhdlchar}{ACK_SEVERITY}                   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{severity\_level}
11575     \textcolor{vhdlchar}{)};
11576     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
11577 \textcolor{keyword}{        -- clk / reset}
11578         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
11579         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
11580 
11581 \textcolor{keyword}{        -- calibration status and redo request}
11582         \textcolor{vhdlchar}{ctl_init_success}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
11583         \textcolor{vhdlchar}{ctl_init_fail}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
11584         \textcolor{vhdlchar}{ctl_recalibrate_req}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};\textcolor{keyword}{    -- acts as a synchronous reset}
11585 
11586 \textcolor{keyword}{        -- status signals from iram}
11587         \textcolor{vhdlchar}{iram_status}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_iram_stat};
11588         \textcolor{vhdlchar}{iram_push_done}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
11589 
11590 \textcolor{keyword}{        -- standard control signal to all blocks}
11591         \textcolor{vhdlchar}{ctrl_op_rec}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_ctrl_command};
11592 
11593 \textcolor{keyword}{        -- standardised response from all system blocks}
11594         \textcolor{vhdlchar}{admin_ctrl}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_stat};
11595         \textcolor{vhdlchar}{dgrb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_stat};
11596         \textcolor{vhdlchar}{dgwb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{vhdlchar}{t_ctrl_stat};
11597 
11598 \textcolor{keyword}{        -- mmi to ctrl interface}
11599         \textcolor{vhdlchar}{mmi_ctrl}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}   \textcolor{vhdlchar}{t_mmi_ctrl};
11600         \textcolor{vhdlchar}{ctrl_mmi}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}  \textcolor{vhdlchar}{t_ctrl_mmi};
11601 
11602 \textcolor{keyword}{        -- byte lane select}
11603         \textcolor{vhdlchar}{ctl_cal_byte_lanes}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}  \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
11604 
11605 \textcolor{keyword}{        -- signals to control the ac\_nt setting}
11606         \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}   \textcolor{comment}{std\_logic};
11607         \textcolor{vhdlchar}{int_ac_nt}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}  \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{  --
       width of 1 for DWIDTH\_RATIO =2,4 and 2 for DWIDTH\_RATIO = 8}
11608 
11609 \textcolor{keyword}{        -- the following signals are reserved for future use}
11610         \textcolor{vhdlchar}{ctrl_iram_push}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{vhdlchar}{t_ctrl_iram}
11611 
11612     \textcolor{vhdlchar}{)};
11613 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
11614 
11615 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
11616 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
11617 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
11618 \textcolor{keyword}{-- instances generics are used)}
11619 \textcolor{keyword}{--}
11620 \textcolor{vhdlkeyword}{    use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
11621 
11622 
11623 \textcolor{keyword}{--}
11624 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_ctrl is
11625 
11626 \textcolor{keyword}{        -- a prefix for all report signals to identify phy and sequencer block}
11627 \textcolor{keyword}{--}
11628     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{ctrl_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (ctrl) : "};
11629 
11630 \textcolor{keyword}{    -- decoder to find the relevant disable bit (from mmi registers) for a given state}
11631     \textcolor{keywordflow}{function} find_dis_bit
11632         (
11633          state    : t_master_sm_state;
11634          mmi_ctrl : t_mmi_ctrl
11635         ) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic} \textcolor{keywordflow}{is}
11636         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11637 \textcolor{vhdlkeyword}{    begin}
11638         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
11639             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_phy\_initialise}         \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      phy_initialise_dis};
11640             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_dram} \textcolor{vhdlchar}{|}
11641                  \textcolor{vhdlchar}{s\_prog\_cal\_mr}            \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      init_dram_dis};
11642             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ihi}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      write_ihi_dis};
11643             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal_dis};
11644             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      write_btp_dis};
11645             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_mtp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      write_mtp_dis};
11646             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_read\_mtp}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      read_mtp_dis};
11647             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_reset}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      rrp_reset_dis};
11648             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_sweep}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      rrp_sweep_dis};
11649             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_seek}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      rrp_seek_dis};
11650             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rdv}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv_dis};
11651             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa_dis};
11652             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_was}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{was_dis};
11653             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      adv_rd_lat_dis};
11654             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_wr\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      adv_wr_lat_dis};
11655             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      prep_customer_mr_setup_dis};
11656             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_tracking\_setup} \textcolor{vhdlchar}{|}
11657                  \textcolor{vhdlchar}{s\_tracking}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      tracking_dis};
11658             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}                   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_dis} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};\textcolor{keyword}{ -- default change stage}
11659         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11660         \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_dis};
11661     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
11662 
11663 \textcolor{keyword}{    -- decoder to find the relevant command for a given state}
11664     \textcolor{keywordflow}{function} find_cmd
11665        (
11666         state : t_master_sm_state
11667        ) \textcolor{keywordflow}{return} \textcolor{vhdlchar}{t_ctrl_cmd_id} \textcolor{keywordflow}{is}
11668 \textcolor{vhdlkeyword}{    begin}
11669         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
11670             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_phy\_initialise}         \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_phy\_initialise};
11671             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_dram}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_init\_dram};
11672             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prog\_cal\_mr}            \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_prog\_cal\_mr};
11673             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ihi}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_write\_ihi};
11674             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_idle};
11675             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_write\_btp};
11676             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_mtp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_write\_mtp};
11677             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_read\_mtp}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_read\_mtp};
11678             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_reset}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_rrp\_reset};
11679             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_sweep}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_rrp\_sweep};
11680             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_seek}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_rrp\_seek};
11681             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rdv}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_rdv};
11682             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_poa};
11683             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_was}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_was};
11684             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_prep\_adv\_rd\_lat};
11685             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_wr\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_prep\_adv\_wr\_lat};
11686             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_prep\_customer\_mr\_setup};
11687             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_tracking\_setup} \textcolor{vhdlchar}{|}
11688                  \textcolor{vhdlchar}{s\_tracking}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_tr\_due};
11689             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}                   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{return} \textcolor{vhdlchar}{cmd\_idle};
11690         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11691     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
11692 
11693     \textcolor{keywordflow}{function} \textcolor{vhdlchar}{mcs\_rw\_state}\textcolor{keyword}{ -- returns true for multiple cs read/write states}
11694         \textcolor{vhdlchar}{(}
11695          \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_master_sm_state}
11696         \textcolor{vhdlchar}{)} \textcolor{keywordflow}{return} \textcolor{comment}{boolean} \textcolor{keywordflow}{is}
11697 \textcolor{vhdlkeyword}{    begin}
11698         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
11699 
11700             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_write\_mtp} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_rrp\_sweep} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11701                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{true};
11702 
11703             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_phy\_initialise} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_init\_dram} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_prog\_cal\_mr} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_write\_ihi} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_cal} \textcolor{vhdlchar}{|}
11704                  \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_rrp\_reset} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_rrp\_seek} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_rdv} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_poa} \textcolor{vhdlchar}{|}
11705                  \textcolor{vhdlchar}{s\_was} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_adv\_rd\_lat} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_adv\_wr\_lat} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup} \textcolor{vhdlchar}{|}
11706                  \textcolor{vhdlchar}{s\_tracking\_setup} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_tracking} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_operational} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11707 
11708                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{false};
11709 
11710             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
11711 \textcolor{keyword}{--}
11712                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{false};
11713 
11714         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11715 
11716     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
11717 
11718 \textcolor{keyword}{    -- timing parameters}
11719     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_done_timeout_count}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32768};
11720     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ack_timeout_count}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1000};
11721     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ticks_per_ms}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1000000000}\textcolor{vhdlchar}{/}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_CLK_PS}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
11722     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_ticks_per_10us}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{10000000}  \textcolor{vhdlchar}{/}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_CLK_PS}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
11723 
11724 \textcolor{keyword}{    -- local copy of calibration fail/success signals}
11725     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ctl_init_fail}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11726     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ctl_init_success}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11727 
11728 \textcolor{keyword}{    -- state machine (master for sequencer)}
11729     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{state}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_master_sm_state};
11730     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{last_state}                 \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_master_sm_state};
11731 
11732 \textcolor{keyword}{    -- flow control signals for state machine}
11733     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dis_state}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{   -- disable state}
11734     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{hold_state}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{   -- hold in state for 1 clock cycle}
11735 
11736     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{master_ctrl_op_rec}         \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_command};\textcolor{keyword}{ -- master command record to all sequencer blocks}
11737     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{master_ctrl_iram_push}      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_iram};\textcolor{keyword}{    -- record indicating control details for pushes}
11738 
11739     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dll_lock_counter}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{MEM_IF_DLL_LOCK_COUNT} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{  -- to wait for
       dll to lock}
11740     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_init_complete}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11741 
11742 \textcolor{keyword}{    -- timeout signals to check if a block has 'hung'}
11743     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{timeout_counter}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdlchar}{c_done_timeout_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
11744     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{timeout_counter_stop}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11745     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{timeout_counter_enable}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11746     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{timeout_counter_clear}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11747 
11748     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cmd_req_asserted}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- a command has been issued}
11749 
11750     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{flag_ack_timeout}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- req -> ack timed out}
11751     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{flag_done_timeout}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- reg -> done timed out}
11752 
11753     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{waiting_for_ack}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- command issued}
11754     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cmd_ack_seen}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{     -- command completed}
11755 
11756     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{curr_ctrl}                  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_stat};\textcolor{keyword}{   -- response for current active block}
11757     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{curr_cmd}                   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_cmd_id};
11758 
11759 \textcolor{keyword}{    -- store state information based on issued command}
11760     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ctrl_prev_stage}        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_cmd_id};
11761     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ctrl_current_stage}     \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_cmd_id};
11762 
11763 \textcolor{keyword}{    -- multiple chip select counter}
11764     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cs_counter}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11765     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{reissue_cmd_req}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- reissue command request for multiple cs}
11766 
11767     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{cal_cs_enabled}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
11768 
11769 \textcolor{keyword}{    -- signals to check the ac\_nt setting}
11770     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ac_nt_almts_checked}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{2-1};
11771     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ac_nt}                      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
11772 
11773 \textcolor{keyword}{    -- track the mtp alignment setting}
11774     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mtp_almts_checked}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};
11775     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mtp_correct_almt}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11776     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mtp_no_valid_almt}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11777     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mtp_both_valid_almt}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11778     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mtp_err}                    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11779 
11780 \textcolor{keyword}{    -- tracking timing}
11781     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{milisecond_tick_gen_count}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_ticks_per_ms} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{
      c_ticks_per_ms} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11782     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{tracking_ms_counter}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{255};
11783     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{tracking_update_due}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11784 
11785 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
11786 
11787 \textcolor{keyword}{-------------------------------------------------------------------------------}
11788 \textcolor{keyword}{-- check if chip selects are enabled}
11789 \textcolor{keyword}{-- this only effects reactive stages (i,e, those requiring memory reads)}
11790 \textcolor{keyword}{-------------------------------------------------------------------------------}
11791 
11792     \textcolor{keywordflow}{process}(ctl_cal_byte_lanes)
11793         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cs\_enabled} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
11794 \textcolor{vhdlkeyword}{    begin}
11795 
11796         \textcolor{keywordflow}{for} \textcolor{vhdlchar}{i} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11797 
11798 \textcolor{keyword}{            -- check if any bytes enabled}
11799             \textcolor{vhdlchar}{v\_cs\_enabled} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11800             \textcolor{keywordflow}{for} \textcolor{vhdlchar}{j} \textcolor{keywordflow}{in} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{loop}
11801                 \textcolor{vhdlchar}{v\_cs\_enabled} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_cs\_enabled} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctl_cal_byte_lanes}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{j}\textcolor{vhdlchar}{)};
11802             \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11803 
11804 \textcolor{keyword}{            -- if any byte enabled set cs as enabled else not}
11805             \textcolor{vhdlchar}{cal_cs_enabled}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{i}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_cs\_enabled};
11806 
11807 \textcolor{keyword}{            -- sanity checking:}
11808             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{i} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{v\_cs\_enabled} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11809                 \textcolor{keywordflow}{report} \textcolor{vhdlchar}{ctrl_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" disabling of chip select 0 is unsupported by the sequencer,"} \textcolor{vhdlchar}{
      &} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
11810                        \textcolor{keyword}{"-> if this is your intention then please remap CS pins such that CS 0 is not
       disabled"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
11811             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11812 
11813         \textcolor{keywordflow}{end} \textcolor{keywordflow}{loop};
11814 
11815     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11816 
11817 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11818 \textcolor{keyword}{--  dll lock counter}
11819 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11820 
11821     \textcolor{keywordflow}{process}(clk, rst_n)
11822 \textcolor{vhdlkeyword}{    begin}
11823         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11824             \textcolor{vhdlchar}{dll_lock_counter}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{MEM_IF_DLL_LOCK_COUNT} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11825 
11826         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11827             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11828                 \textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{MEM_IF_DLL_LOCK_COUNT} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11829 
11830             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11831                 \textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11832             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11833         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11834     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11835 
11836 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11837 \textcolor{keyword}{--  timeout counter : this counter is used to determine if an ack, or done has}
11838 \textcolor{keyword}{--  not been received within the expected number of clock cycles of a req being}
11839 \textcolor{keyword}{--  asserted.}
11840 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11841 
11842     \textcolor{keywordflow}{process}(clk, rst_n)
11843 \textcolor{vhdlkeyword}{    begin}
11844         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11845             \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_done_timeout_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11846 
11847         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11848           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{timeout_counter_clear} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11849               \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_done_timeout_count} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11850 
11851           \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{timeout_counter_enable} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_init\_dram} \textcolor{keywordflow}{then}
11852               \textcolor{keywordflow}{if} \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
11853                   \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
11854               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11855           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11856         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11857 
11858     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11859 
11860 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11861 \textcolor{keyword}{--  register current ctrl signal based on current command}
11862 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11863 
11864     \textcolor{keywordflow}{process}(clk, rst_n)
11865 \textcolor{vhdlkeyword}{    begin}
11866         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11867 
11868             \textcolor{vhdlchar}{curr_ctrl} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11869             \textcolor{vhdlchar}{curr_cmd}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cmd\_idle};
11870 
11871         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11872 
11873             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_cmd}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}
11874                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{admin}  \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{curr_ctrl} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{admin_ctrl};
11875                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{dgrb}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{curr_ctrl} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_ctrl};
11876                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{dgwb}   \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{curr_ctrl} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgwb_ctrl};
11877                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{curr_ctrl} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11878             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
11879 
11880             \textcolor{vhdlchar}{curr_cmd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command};
11881 
11882         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11883 
11884     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11885 
11886 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11887 \textcolor{keyword}{--  generation of cmd\_ack\_seen}
11888 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11889 
11890     \textcolor{keywordflow}{process} (curr_ctrl)
11891 \textcolor{vhdlkeyword}{    begin}
11892         \textcolor{vhdlchar}{cmd_ack_seen} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack};
11893     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11894 
11895 \textcolor{keyword}{-------------------------------------------------------------------------------}
11896 \textcolor{keyword}{-- generation of waiting\_for\_ack flag (to determine whether ack has timed out)}
11897 \textcolor{keyword}{-------------------------------------------------------------------------------}
11898 
11899     \textcolor{keywordflow}{process}(clk, rst_n)
11900 \textcolor{vhdlkeyword}{    begin}
11901         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11902             \textcolor{vhdlchar}{waiting_for_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11903 
11904         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11905             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cmd_req_asserted} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11906                 \textcolor{vhdlchar}{waiting_for_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11907 
11908             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{cmd_ack_seen} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11909                 \textcolor{vhdlchar}{waiting_for_ack} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11910             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11911         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11912 
11913     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11914 
11915 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11916 \textcolor{keyword}{--  generation of timeout flags}
11917 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11918 
11919     \textcolor{keywordflow}{process}(clk, rst_n)
11920 \textcolor{vhdlkeyword}{    begin}
11921         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11922             flag\_ack\_timeout  <= '0';
11923             flag\_done\_timeout <= '0';
11924 
11925         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11926             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11927                 flag\_ack\_timeout <= '0';
11928 
11929             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{waiting_for_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11930                 flag\_ack\_timeout <= '1';
11931             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11932 
11933             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11934                 flag\_done\_timeout <= '0';
11935 
11936             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{timeout_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and}
11937                   \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_rrp\_sweep} \textcolor{keywordflow}{and}\textcolor{keyword}{          -- rrp can take enough cycles to overflow counter so
       don't timeout}
11938                   \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_init\_dram} \textcolor{keywordflow}{and}\textcolor{keyword}{          -- init\_dram takes about 200 us, so don't timeout}
11939                   \textcolor{vhdlchar}{timeout_counter_clear} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- check if currently clearing the timeout (i.e.
       command\_done asserted for s\_init\_dram or s\_rrp\_sweep)}
11940 
11941                 flag\_done\_timeout <= '1';
11942             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11943         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11944 
11945     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11946 
11947 \textcolor{keyword}{    -- generation of timeout\_counter\_stop}
11948     \textcolor{vhdlchar}{timeout_counter_stop} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done};
11949 
11950 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11951 \textcolor{keyword}{--  generation of timeout\_counter\_enable and timeout\_counter\_clear}
11952 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
11953 
11954     \textcolor{keywordflow}{process}(clk, rst_n)
11955 \textcolor{vhdlkeyword}{    begin}
11956         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11957 
11958             \textcolor{vhdlchar}{timeout_counter_enable} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11959             \textcolor{vhdlchar}{timeout_counter_clear}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11960 
11961         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11962             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cmd_req_asserted} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11963                 \textcolor{vhdlchar}{timeout_counter_enable} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11964                 \textcolor{vhdlchar}{timeout_counter_clear}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11965 
11966             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{timeout_counter_stop} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}
11967                \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_operational}
11968                \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_non\_operational}
11969                \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset} \textcolor{keywordflow}{then}
11970                 \textcolor{vhdlchar}{timeout_counter_enable} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11971                 \textcolor{vhdlchar}{timeout_counter_clear}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
11972             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11973         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
11974 
11975     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
11976 
11977 \textcolor{keyword}{-------------------------------------------------------------------------------}
11978 \textcolor{keyword}{-- assignment to ctrl\_mmi record}
11979 \textcolor{keyword}{-------------------------------------------------------------------------------}
11980 
11981     \textcolor{keywordflow}{process} (clk, rst_n)
11982     \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_ctrl\_mmi} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t_ctrl_mmi};
11983 \textcolor{vhdlkeyword}{    begin}
11984         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
11985 
11986             \textcolor{vhdlchar}{v\_ctrl\_mmi}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
11987             \textcolor{vhdlchar}{ctrl_mmi}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
11988             \textcolor{vhdlchar}{int_ctrl_prev_stage}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cmd\_idle};
11989             \textcolor{vhdlchar}{int_ctrl_current_stage} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cmd\_idle};
11990 
11991         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11992 
11993             \textcolor{vhdlchar}{ctrl_mmi} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_ctrl\_mmi};
11994 
11995             \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_success} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11996             \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_fail}    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
11997 
11998             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
11999                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
12000                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_dram}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_dram}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12001                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_btp}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12002                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_mtp}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mtp}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12003                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_read\_mtp}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{read_mtp}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12004                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_reset}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_reset}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12005                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_sweep}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_sweep}              \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12006                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_seek}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp_seek}               \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12007                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rdv}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12008                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12009                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_was}                    \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{was}                    \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12010                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_rd_lat}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12011                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_wr\_lat}             \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{adv_wr_lat}             \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12012                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{prep_customer_mr_setup} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12013                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_tracking\_setup} \textcolor{vhdlchar}{|}
12014                          \textcolor{vhdlchar}{s\_tracking}               \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_setup}         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12015                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{null};
12016                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
12017             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12018 
12019 \textcolor{keyword}{            -- special 'ack' (actually finished) triggers for phy\_initialise, writing iram header info and
       s\_cal}
12020             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_phy\_initialise} \textcolor{keywordflow}{then}
12021                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
12022                     \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{phy_initialise} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12023                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12024             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12025 
12026             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_write\_ihi} \textcolor{keywordflow}{then}
12027                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_push_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12028                     \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_ihi} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12029                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12030             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12031 
12032             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_cal} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{find\_dis\_bit}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if cal state and calibration
       not disabled acknowledge}
12033                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_cal_stage_ack_seen}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12034             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12035 
12036 
12037             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_operational} \textcolor{keywordflow}{then}
12038                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_success} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12039             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12040 
12041             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{keywordflow}{then}
12042                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_calibration_fail} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12043             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12044 
12045             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{keywordflow}{then}
12046                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_active_block} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      active_block};
12047                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command};
12048             \textcolor{keywordflow}{else}
12049                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_active_block} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_current_active_block};
12050                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage}        \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      ctrl_current_stage};
12051             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12052 
12053             \textcolor{vhdlchar}{int_ctrl_prev_stage}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ctrl_current_stage};
12054             \textcolor{vhdlchar}{int_ctrl_current_stage} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage};
12055 
12056             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{int_ctrl_prev_stage} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{int_ctrl_current_stage} \textcolor{keywordflow}{then}
12057                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage_done} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12058 
12059             \textcolor{keywordflow}{else}
12060                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done}  \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12061                     \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_current_stage_done}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12062                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12063             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12064 
12065             \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{master_state_r} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{last_state};
12066 
12067             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12068                 \textcolor{vhdlchar}{v\_ctrl\_mmi} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
12069                 \textcolor{vhdlchar}{ctrl_mmi}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
12070             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12071 
12072 \textcolor{keyword}{            -- assert error codes here}
12073             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12074                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_result};
12075             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{flag_ack_timeout} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12076                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_err\_ctrl\_ack\_timeout}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{
      .}\textcolor{vhdlchar}{ctrl_err_code}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12077             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{flag_done_timeout} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12078                 \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_err\_ctrl\_done\_timeout}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12079             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mtp_err} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12080                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_no_valid_almt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12081                     \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{C\_ERR\_READ\_MTP\_NO\_VALID\_ALMT}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12082                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mtp_both_valid_almt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12083                     \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code} \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{C\_ERR\_READ\_MTP\_BOTH\_ALMT\_PASS}\textcolor{vhdlchar}{,}
       \textcolor{vhdlchar}{v\_ctrl\_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ctrl_err_code}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12084                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12085             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12086 
12087         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12088 
12089     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12090 
12091 \textcolor{keyword}{    -- check if iram finished init}
12092     \textcolor{keywordflow}{process}(iram_status)
12093 \textcolor{vhdlkeyword}{    begin}
12094         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
12095             \textcolor{vhdlchar}{iram_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12096         \textcolor{keywordflow}{else}
12097             \textcolor{vhdlchar}{iram_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{init_done};
12098         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12099     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12100 
12101 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12102 \textcolor{keyword}{--  master state machine}
12103 \textcolor{keyword}{--  (this controls the operation of the entire sequencer)}
12104 \textcolor{keyword}{--  the states are summarised as follows:}
12105 \textcolor{keyword}{--     s\_reset}
12106 \textcolor{keyword}{--     s\_phy\_initialise          - wait for dll lock and init done flag from iram}
12107 \textcolor{keyword}{--     s\_init\_dram,              -- dram initialisation - reset sequence}
12108 \textcolor{keyword}{--     s\_prog\_cal\_mr,            -- dram initialisation - programming mode registers (once per chip select)}
12109 \textcolor{keyword}{--     s\_write\_ihi               - write header information in iRAM}
12110 \textcolor{keyword}{--     s\_cal                     - check if calibration to be executed}
12111 \textcolor{keyword}{--     s\_write\_btp               - write burst training pattern}
12112 \textcolor{keyword}{--     s\_write\_mtp               - write more training pattern}
12113 \textcolor{keyword}{--     s\_rrp\_reset               - read resync phase setup - reset initial conditions}
12114 \textcolor{keyword}{--     s\_rrp\_sweep               - read resync phase setup - sweep phases per chip select}
12115 \textcolor{keyword}{--     s\_read\_mtp                - read training patterns to find correct alignment for 1100 burst}
12116 \textcolor{keyword}{--                                 (this is a special case of s\_rrp\_seek with no resych phase setting)}
12117 \textcolor{keyword}{--     s\_rrp\_seek                - read resync phase setup - seek correct alignment}
12118 \textcolor{keyword}{--     s\_rdv                     - read data valid setup}
12119 \textcolor{keyword}{--     s\_poa                     - calibrate the postamble}
12120 \textcolor{keyword}{--     s\_was                     - write datapath setup (ac to write data timing)}
12121 \textcolor{keyword}{--     s\_adv\_rd\_lat              - advertise read latency}
12122 \textcolor{keyword}{--     s\_adv\_wr\_lat              - advertise write latency}
12123 \textcolor{keyword}{--     s\_tracking\_setup          - perform tracking (1st pass to setup mimic window)}
12124 \textcolor{keyword}{--     s\_prep\_customer\_mr\_setup  - apply user mode register settings (in admin block)}
12125 \textcolor{keyword}{--     s\_tracking                - perform tracking (subsequent passes in user mode)}
12126 \textcolor{keyword}{--     s\_operational             - calibration successful and in user mode}
12127 \textcolor{keyword}{--     s\_non\_operational         - calibration unsuccessful and in user mode}
12128 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12129 
12130     \textcolor{keywordflow}{process}(clk, rst_n)
12131         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_seen\_ack} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
12132         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_dis}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- disable bit}
12133 \textcolor{vhdlkeyword}{    begin}
12134         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12135 
12136             \textcolor{vhdlchar}{state}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
12137             \textcolor{vhdlchar}{last_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
12138             \textcolor{vhdlchar}{int_ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12139             \textcolor{vhdlchar}{int_ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12140             \textcolor{vhdlchar}{v\_seen\_ack}           \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
12141             \textcolor{vhdlchar}{hold_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12142             \textcolor{vhdlchar}{cs_counter}           \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12143             \textcolor{vhdlchar}{mtp_almts_checked}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12144             \textcolor{vhdlchar}{ac_nt}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
12145             \textcolor{vhdlchar}{ac_nt_almts_checked}  \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12146             \textcolor{vhdlchar}{reissue_cmd_req}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12147 
12148             \textcolor{vhdlchar}{dis_state}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12149 
12150         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12151             \textcolor{vhdlchar}{last_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{state};
12152 
12153 \textcolor{keyword}{            -- check if state\_tx required}
12154             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12155                 \textcolor{vhdlchar}{v\_seen\_ack} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
12156             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12157 
12158 \textcolor{keyword}{            -- find disable bit for current state (do once to avoid exit mid-state)}
12159             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{last_state} \textcolor{keywordflow}{then}
12160                 \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_dis\_bit}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{)};
12161             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12162 
12163 \textcolor{keyword}{            -- Set special conditions:}
12164 
12165             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_reset} \textcolor{keywordflow}{or}
12166                \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_operational} \textcolor{keywordflow}{or}
12167                \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{keywordflow}{then}
12168                 \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12169             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12170 
12171 \textcolor{keyword}{            -- override to ensure execution of next state logic}
12172             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_cal}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12173                 \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12174             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12175 
12176 \textcolor{keyword}{            -- if header writing in iram check finished}
12177             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_write\_ihi}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12178                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{iram_push_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_ihi_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12179                     \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12180                 \textcolor{keywordflow}{else}
12181                     \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12182                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12183             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12184 
12185 \textcolor{keyword}{            -- Special condition for initialisation}
12186             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_phy\_initialise}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12187                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dll_lock_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{iram_init_complete} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}
12188                    \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{phy_initialise_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12189                     \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12190                 \textcolor{keywordflow}{else}
12191                     \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12192                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12193             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12194 
12195             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12196                 \textcolor{vhdlchar}{v\_seen\_ack} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
12197             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12198                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_seen\_ack} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
12199                     \textcolor{keywordflow}{report} \textcolor{vhdlchar}{ctrl_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"have not seen ack but have seen command done from "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      t_ctrl_active_block}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{keyword}{"\_block in state "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      t_master_sm_state}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
12200                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12201                 \textcolor{vhdlchar}{v\_seen\_ack} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
12202             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12203 
12204 \textcolor{keyword}{            -- default do not reissue command request}
12205             \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12206 
12207             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{hold_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12208                 \textcolor{vhdlchar}{hold_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12209             \textcolor{keywordflow}{else}
12210                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dis_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}
12211                    \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{or}
12212                    \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{cal_cs_enabled}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{cs_counter}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mcs\_rw\_state}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{True}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- current
       chip select is disabled and read/write}
12213 
12214                     \textcolor{vhdlchar}{hold_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12215 
12216 \textcolor{keyword}{                    -- Only reset the below if making state change}
12217                     \textcolor{vhdlchar}{int_ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12218                     \textcolor{vhdlchar}{int_ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12219 
12220 \textcolor{keyword}{                    -- default chip select counter gets reset to zero}
12221                     \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12222 
12223                     \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
12224                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                  \textcolor{vhdlchar}{state}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_phy\_initialise};
12225                                                          \textcolor{vhdlchar}{ac_nt}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
12226                                                          \textcolor{vhdlchar}{mtp_almts_checked}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12227                                                          \textcolor{vhdlchar}{ac_nt_almts_checked} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12228 
12229                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_phy\_initialise} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}         \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_init\_dram};
12230 
12231                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_init\_dram} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_prog\_cal\_mr};
12232 
12233                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prog\_cal\_mr} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}            \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
12234 
12235 \textcolor{keyword}{                                                             -- if no debug interface don't write iram
       header}
12236                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{
      GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
12237                                                                  \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_ihi};
12238                                                              \textcolor{keywordflow}{else}
12239                                                                  \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal};
12240                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12241 
12242                                                          \textcolor{keywordflow}{else}
12243 
12244                                                              \textcolor{vhdlchar}{cs_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12245                                                              \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12246 
12247                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12248 
12249                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ihi} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal};
12250 
12251                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_cal} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      cal_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12252                                                              \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_btp};
12253                                                          \textcolor{keywordflow}{else}
12254                                                              \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_tracking\_setup};
12255                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12256 
12257 \textcolor{keyword}{                                                         -- always enter s\_cal before calibration so reset
       some variables here}
12258                                                          \textcolor{vhdlchar}{mtp_almts_checked}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12259                                                          \textcolor{vhdlchar}{ac_nt_almts_checked} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12260 
12261                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_btp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or}
12262                                                             \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12263 
12264                                                              \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_write\_mtp};
12265 
12266                                                          \textcolor{keywordflow}{else}
12267                                                              \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12268 
12269 \textcolor{keyword}{                                                             -- only reissue command if current chip select
       enabled}
12270                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_cs_enabled}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12271                                                                 \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12272                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12273 
12274                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12275 
12276                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or}
12277                                                             \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12278 
12279                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{
      SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
12280                                                                  \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rdv};
12281                                                              \textcolor{keywordflow}{else}
12282                                                                  \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rrp\_reset};
12283                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12284 
12285                                                          \textcolor{keywordflow}{else}
12286                                                              \textcolor{vhdlchar}{cs_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12287 
12288 \textcolor{keyword}{                                                             -- only reissue command if current chip select
       enabled}
12289                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_cs_enabled}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12290                                                                 \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12291                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12292 
12293                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12294 
12295                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_reset} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rrp\_sweep};
12296 
12297                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_sweep} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{or}
12298                                                             \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{or}
12299                                                             \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12300 
12301                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{
      mtp_almts_checked} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12302                                                                  \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_read\_mtp};
12303                                                              \textcolor{keywordflow}{else}
12304                                                                  \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rrp\_seek};
12305                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12306 
12307                                                          \textcolor{keywordflow}{else}
12308                                                              \textcolor{vhdlchar}{cs_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12309 
12310 \textcolor{keyword}{                                                             -- only reissue command if current chip select
       enabled}
12311                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal_cs_enabled}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12312                                                                 \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12313                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12314 
12315                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12316 
12317                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}               \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12318                                                              \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      mtp_almts_checked} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12319                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12320                                                          \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rrp\_reset};
12321 
12322                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_seek} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}               \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rdv};
12323 
12324                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rdv} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                    \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_was};
12325                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_was} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                    \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_adv\_rd\_lat};
12326                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_rd\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_adv\_wr\_lat};
12327 
12328                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_adv\_wr\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12329                                                              \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_poa};
12330                                                          \textcolor{keywordflow}{else}
12331                                                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{
      ac_nt_almts_checked} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12332                                                                  \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_non\_operational};
12333                                                              \textcolor{keywordflow}{else}
12334 \textcolor{keyword}{                                                                 -- switch alignment and restart
       calibration}
12335                                                                  \textcolor{vhdlchar}{ac_nt}               \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{comment}{
      unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ac_nt}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
12336                                                                  \textcolor{vhdlchar}{
      ac_nt_almts_checked} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ac_nt_almts_checked} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12337 
12338                                                                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{
      SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
12339                                                                     \textcolor{vhdlchar}{state}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rdv};
12340                                                                 \textcolor{keywordflow}{else}
12341                                                                     \textcolor{vhdlchar}{state}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_rrp\_reset};
12342                                                                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12343 
12344                                                                 \textcolor{vhdlchar}{
      mtp_almts_checked}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12345                                                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12346                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12347 
12348                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_poa} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                    \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_tracking\_setup};
12349 
12350                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_tracking\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}         \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup};
12351 
12352                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_prep\_customer\_mr\_setup} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cs_counter} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- s\_prep\_customer\_mr\_setup is always performed over all cs}
12353                                                              \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_operational};
12354                                                          \textcolor{keywordflow}{else}
12355                                                              \textcolor{vhdlchar}{cs_counter}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      cs_counter} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12356                                                              \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12357                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12358 
12359                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_tracking} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}               \textcolor{vhdlchar}{state}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_operational};
12360                                                          \textcolor{vhdlchar}{int_ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      int_ctl_init_success};
12361                                                          \textcolor{vhdlchar}{int_ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      int_ctl_init_fail};
12362 
12363                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}            \textcolor{vhdlchar}{int_ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12364                                                          \textcolor{vhdlchar}{int_ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12365                                                          \textcolor{vhdlchar}{hold_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12366                                                          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{tracking_update_due} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12367                                                              \textcolor{vhdlchar}{state}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_tracking};
12368                                                              \textcolor{vhdlchar}{hold_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12369                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12370 
12371                         \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}        \textcolor{vhdlchar}{int_ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12372                                                          \textcolor{vhdlchar}{int_ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12373                                                          \textcolor{vhdlchar}{hold_state}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12374                                                          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{last_state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- print a
       warning on entering this state}
12375                                                              \textcolor{keywordflow}{report} \textcolor{vhdlchar}{
      ctrl_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"memory calibration has failed (output from ctrl block)"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{WARNING};
12376                                                          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12377 
12378                         \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}                   \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      t_master_sm_state}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{succ}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)};
12379                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
12380                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12381             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12382 
12383         \textcolor{keywordflow}{if}   \textcolor{vhdlchar}{flag_done_timeout} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{keyword}{            -- no done signal from current active block}
12384           \textcolor{keywordflow}{or} \textcolor{vhdlchar}{flag_ack_timeout} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{keyword}{             -- or no ack signal from current active block}
12385           \textcolor{keywordflow}{or} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_err} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{keyword}{         -- or an error from current active block}
12386           \textcolor{keywordflow}{or} \textcolor{vhdlchar}{mtp_err} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{                  -- or an error due to mtp alignment}
12387             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_non\_operational};
12388         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12389 
12390         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- restart calibration process}
12391             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_cal};
12392         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12393 
12394         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- restart all incl. initialisation}
12395             \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{s\_reset};
12396         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12397 
12398       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12399 
12400     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12401 
12402 \textcolor{keyword}{    -- generate output calibration fail/success signals}
12403     \textcolor{keywordflow}{process}(clk, rst_n)
12404 \textcolor{vhdlkeyword}{    begin}
12405         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12406 
12407             \textcolor{vhdlchar}{ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12408             \textcolor{vhdlchar}{ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12409 
12410         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12411 
12412             \textcolor{vhdlchar}{ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ctl_init_fail};
12413             \textcolor{vhdlchar}{ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ctl_init_success};
12414 
12415         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12416     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12417 
12418 \textcolor{keyword}{    -- assign ac\_nt to the output int\_ac\_nt}
12419     \textcolor{keywordflow}{process}(ac_nt)
12420 \textcolor{vhdlkeyword}{    begin}
12421         \textcolor{vhdlchar}{int_ac_nt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ac_nt};
12422     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12423 
12424 \textcolor{keyword}{-- ------------------------------------------------------------------------------}
12425 \textcolor{keyword}{-- find correct mtp\_almt from returned data}
12426 \textcolor{keyword}{-- ------------------------------------------------------------------------------}
12427 
12428     \textcolor{vhdlchar}{mtp_almt}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
12429 
12430         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dvw_size_a0} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{255};\textcolor{keyword}{  -- maximum size of command result}
12431         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dvw_size_a1} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{255};
12432 
12433 \textcolor{vhdlkeyword}{    begin}
12434 
12435         \textcolor{keywordflow}{process} (clk, rst_n)
12436 
12437             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_dvw\_a0\_small} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
12438             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_dvw\_a1\_small} \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
12439 
12440 \textcolor{vhdlkeyword}{        begin}
12441             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12442 
12443                \textcolor{vhdlchar}{mtp_correct_almt}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12444                \textcolor{vhdlchar}{dvw_size_a0}         \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12445                \textcolor{vhdlchar}{dvw_size_a1}         \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12446                \textcolor{vhdlchar}{mtp_no_valid_almt}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12447                \textcolor{vhdlchar}{mtp_both_valid_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12448                \textcolor{vhdlchar}{mtp_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12449 
12450             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12451 
12452 \textcolor{keyword}{                -- update the dvw sizes}
12453                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{keywordflow}{then}
12454                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12455                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
12456                             \textcolor{vhdlchar}{dvw_size_a0} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command_result}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12457                         \textcolor{keywordflow}{else}
12458                             \textcolor{vhdlchar}{dvw_size_a1} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{curr_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{
      command_result}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12459                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12460                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12461                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12462 
12463 \textcolor{keyword}{                -- check dvw size and set mtp almt}
12464                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dvw_size_a0} \textcolor{vhdlchar}{<} \textcolor{vhdlchar}{dvw_size_a1} \textcolor{keywordflow}{then}
12465                     \textcolor{vhdlchar}{mtp_correct_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12466                 \textcolor{keywordflow}{else}
12467                     \textcolor{vhdlchar}{mtp_correct_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12468                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12469 
12470 \textcolor{keyword}{                -- error conditions}
12471                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- if finished alignment
       checking (and GENERATE\_ADDITIONAL\_DBG\_RTL set)}
12472 
12473 \textcolor{keyword}{                    -- perform size checks once per dvw}
12474                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dvw_size_a0} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{then}
12475                         \textcolor{vhdlchar}{v\_dvw\_a0\_small} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
12476                     \textcolor{keywordflow}{else}
12477                         \textcolor{vhdlchar}{v\_dvw\_a0\_small} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
12478                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12479 
12480                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dvw_size_a1} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3} \textcolor{keywordflow}{then}
12481                         \textcolor{vhdlchar}{v\_dvw\_a1\_small} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{true};
12482                     \textcolor{keywordflow}{else}
12483                         \textcolor{vhdlchar}{v\_dvw\_a1\_small} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{false};
12484                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12485 
12486                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_dvw\_a0\_small} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{v\_dvw\_a1\_small} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
12487                         \textcolor{vhdlchar}{mtp_no_valid_almt}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12488                         \textcolor{vhdlchar}{mtp_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12489                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12490 
12491                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_dvw\_a0\_small} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{v\_dvw\_a1\_small} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
12492                         \textcolor{vhdlchar}{mtp_both_valid_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12493                         \textcolor{vhdlchar}{mtp_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12494                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12495 
12496                 \textcolor{keywordflow}{else}
12497 
12498                     \textcolor{vhdlchar}{mtp_no_valid_almt}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12499                     \textcolor{vhdlchar}{mtp_both_valid_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12500                     \textcolor{vhdlchar}{mtp_err}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12501 
12502                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12503 
12504             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12505 
12506         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12507 
12508     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
12509 
12510 \textcolor{keyword}{-- ------------------------------------------------------------------------------}
12511 \textcolor{keyword}{-- process to generate command outputs, based on state, last\_state and mmi\_ctrl.}
12512 \textcolor{keyword}{-- asynchronously}
12513 \textcolor{keyword}{-- ------------------------------------------------------------------------------}
12514 
12515     \textcolor{keywordflow}{process} (state, last_state, mmi_ctrl, reissue_cmd_req, cs_counter, 
      mtp_almts_checked, mtp_correct_almt)
12516 \textcolor{vhdlkeyword}{    begin}
12517         \textcolor{vhdlchar}{master_ctrl_op_rec}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
12518         \textcolor{vhdlchar}{master_ctrl_iram_push}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
12519 
12520         \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
12521 
12522 \textcolor{keyword}{            -- special condition states}
12523             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_reset} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_phy\_initialise} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_cal} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12524                 \textcolor{keywordflow}{null};
12525 
12526             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_write\_ihi} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12527                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{hl_css}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_ihi_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12528                     \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)};
12529                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{last_state} \textcolor{keywordflow}{then}
12530                         \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12531                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12532                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12533 
12534             \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_operational} \textcolor{vhdlchar}{|} \textcolor{vhdlchar}{s\_non\_operational} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12535                 \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)};
12536 
12537             \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- default condition for most states}
12538                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{find\_dis\_bit}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12539                     \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)};
12540                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{last_state} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{reissue_cmd_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12541                         \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12542                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12543                 \textcolor{keywordflow}{else}
12544                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{last_state} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- safe state exit if state disabled mid-calibration}
12545                         \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{find\_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)};
12546                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12547                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12548 
12549         \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
12550 
12551 \textcolor{keyword}{        -- for multiple chip select commands assign operand to cs\_counter}
12552         \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
12553         \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{current_cs} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{cs_counter};
12554         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_rrp\_sweep} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_poa} \textcolor{keywordflow}{then}
12555            \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12556                \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{single_bit} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12557            \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12558            \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mtp_almts_checked} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{then}
12559                \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mtp_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mtp_almts_checked};
12560            \textcolor{keywordflow}{else}
12561                \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mtp_almt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mtp_correct_almt};
12562            \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12563         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12564 
12565 \textcolor{keyword}{        -- set write mode and packing mode for iram}
12566         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
12567 
12568             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{state} \textcolor{keywordflow}{is}
12569                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_sweep} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12570                     \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{overwrite\_ram};
12571                     \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dq\_bitwise};
12572 
12573                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{s\_rrp\_seek} \textcolor{vhdlchar}{|}
12574                      \textcolor{vhdlchar}{s\_read\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12575 
12576                     \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{write_mode}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{overwrite\_ram};
12577                     \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{packing_mode} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dq\_wordwise};
12578 
12579                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
12580 
12581                     \textcolor{keywordflow}{null};
12582 
12583             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
12584         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12585 
12586 \textcolor{keyword}{        -- set current active block}
12587         \textcolor{vhdlchar}{master_ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{active_block} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{curr\_active\_block}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{find\_cmd}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{state}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
12588 
12589     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12590 
12591 \textcolor{keyword}{    -- some concurc\_read\_burst\_trent assignments to outputs}
12592     \textcolor{keywordflow}{process} (master_ctrl_iram_push, master_ctrl_op_rec)
12593 \textcolor{vhdlkeyword}{    begin}
12594         \textcolor{vhdlchar}{ctrl_iram_push}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{master_ctrl_iram_push};
12595         \textcolor{vhdlchar}{ctrl_op_rec}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{master_ctrl_op_rec};
12596         \textcolor{vhdlchar}{cmd_req_asserted}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{master_ctrl_op_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command_req};
12597     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12598 
12599 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12600 \textcolor{keyword}{--  tracking interval counter}
12601 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12602     \textcolor{keywordflow}{process}(clk, rst_n)
12603 \textcolor{vhdlkeyword}{    begin}
12604        \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12605            \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ticks_per_ms} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12606            \textcolor{vhdlchar}{tracking_ms_counter}       \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
12607            \textcolor{vhdlchar}{tracking_update_due}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12608 
12609        \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
12610            \textcolor{keywordflow}{if} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_operational} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{last_state}\textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{s\_operational} \textcolor{keywordflow}{then}
12611 
12612                \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_orvd_to_10ms} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12613                    \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ticks_per_10us} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12614                \textcolor{keywordflow}{else}
12615                    \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ticks_per_ms} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12616                \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12617 
12618                \textcolor{vhdlchar}{tracking_ms_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_period_ms};
12619 
12620            \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{s\_operational} \textcolor{keywordflow}{then}
12621                \textcolor{keywordflow}{if} \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}  \textcolor{keywordflow}{and} \textcolor{vhdlchar}{tracking_update_due} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12622 
12623                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{tracking_ms_counter} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
12624                        \textcolor{vhdlchar}{tracking_update_due} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
12625                    \textcolor{keywordflow}{else}
12626                        \textcolor{vhdlchar}{tracking_ms_counter} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{tracking_ms_counter} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12627                    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12628 
12629                    \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{tracking_orvd_to_10ms} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
12630                        \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ticks_per_10us} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12631                    \textcolor{keywordflow}{else}
12632                        \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_ticks_per_ms} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12633                    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12634 
12635                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
12636                    \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{milisecond_tick_gen_count} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
12637                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12638 
12639            \textcolor{keywordflow}{else}
12640 
12641                \textcolor{vhdlchar}{tracking_update_due} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
12642            \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12643        \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
12644 
12645     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
12646 
12647 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
12648 \textcolor{keyword}{--}
12649 
12650 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12651 \textcolor{keyword}{--  Abstract        : top level for the non-levelling AFI PHY sequencer}
12652 \textcolor{keyword}{--                    The top level instances the sub-blocks of the AFI PHY}
12653 \textcolor{keyword}{--                    sequencer. In addition a number of multiplexing and high-}
12654 \textcolor{keyword}{--                    level control operations are performed. This includes the}
12655 \textcolor{keyword}{--                    multiplexing and generation of control signals for: the}
12656 \textcolor{keyword}{--                    address and command DRAM interface and pll, oct and datapath}
12657 \textcolor{keyword}{--                    latency control signals.}
12658 \textcolor{keyword}{-- -----------------------------------------------------------------------------}
12659 
12660 \textcolor{keyword}{--altera message\_off 10036}
12661 
12662 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
12663 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
12664 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
12665 
12666 \textcolor{keyword}{--}
12667 \textcolor{keywordflow}{entity }ddr2_phy_alt_mem_phy_seq \textcolor{keywordflow}{IS}
12668     \textcolor{keywordflow}{generic} \textcolor{vhdlchar}{(}
12669 \textcolor{keyword}{        -- choice of FPGA device family and DRAM type}
12670         \textcolor{vhdlchar}{FAMILY}                         \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12671         \textcolor{vhdlchar}{MEM_IF_MEMTYPE}                 \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12672         \textcolor{vhdlchar}{SPEED_GRADE}                    \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12673         \textcolor{vhdlchar}{FAMILYGROUP_ID}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12674 
12675 \textcolor{keyword}{        -- physical interface width definitions}
12676         \textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12677         \textcolor{vhdlchar}{MEM_IF_DWIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12678         \textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12679         \textcolor{vhdlchar}{MEM_IF_DQ_PER_DQS}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12680         \textcolor{vhdlchar}{DWIDTH_RATIO}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12681         \textcolor{vhdlchar}{CLOCK_INDEX_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12682         \textcolor{vhdlchar}{MEM_IF_CLK_PAIR_COUNT}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12683         \textcolor{vhdlchar}{MEM_IF_ADDR_WIDTH}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12684         \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12685         \textcolor{vhdlchar}{MEM_IF_CS_WIDTH}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12686         \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12687         \textcolor{vhdlchar}{MEM_IF_RANKS_PER_SLOT}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12688         \textcolor{vhdlchar}{ADV_LAT_WIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12689         \textcolor{vhdlchar}{RESYNCHRONISE_AVALON_DBG}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{  -- 0 = false, 1 = true}
12690         \textcolor{vhdlchar}{AV_IF_ADDR_WIDTH}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12691 
12692 \textcolor{keyword}{        -- Not used for non-levelled seq}
12693         \textcolor{vhdlchar}{CHIP_OR_DIMM}                    \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12694         \textcolor{vhdlchar}{RDIMM_CONFIG_BITS}               \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12695 
12696 \textcolor{keyword}{        -- setup / algorithm information}
12697         \textcolor{vhdlchar}{NOM_DQS_PHASE_SETTING}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12698         \textcolor{vhdlchar}{SCAN_CLK_DIVIDE_BY}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12699         \textcolor{vhdlchar}{RDP_ADDR_WIDTH}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12700         \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12701         \textcolor{vhdlchar}{IOE_PHASES_PER_TCK}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12702         \textcolor{vhdlchar}{IOE_DELAYS_PER_PHS}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12703         \textcolor{vhdlchar}{MEM_IF_CLK_PS}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12704 
12705         \textcolor{vhdlchar}{WRITE_DESKEW_T10}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12706         \textcolor{vhdlchar}{WRITE_DESKEW_HC_T10}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12707         \textcolor{vhdlchar}{WRITE_DESKEW_T9NI}              \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12708         \textcolor{vhdlchar}{WRITE_DESKEW_HC_T9NI}           \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12709         \textcolor{vhdlchar}{WRITE_DESKEW_T9I}               \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12710         \textcolor{vhdlchar}{WRITE_DESKEW_HC_T9I}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12711         \textcolor{vhdlchar}{WRITE_DESKEW_RANGE}             \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12712 
12713 \textcolor{keyword}{        -- initial mode register settings}
12714         \textcolor{vhdlchar}{PHY_DEF_MR_1ST}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12715         \textcolor{vhdlchar}{PHY_DEF_MR_2ND}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12716         \textcolor{vhdlchar}{PHY_DEF_MR_3RD}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12717         \textcolor{vhdlchar}{PHY_DEF_MR_4TH}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12718 
12719         \textcolor{vhdlchar}{MEM_IF_DQSN_EN}                 \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- default off for Cyclone-III}
12720         \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE_EN}          \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12721 
12722         \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL}    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- 1 signals to include iram and mmi blocks and 0
       not to include}
12723 
12724         \textcolor{vhdlchar}{SINGLE_DQS_DELAY_CONTROL_CODE}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- reserved for future use}
12725         \textcolor{vhdlchar}{PRESET_RLAT}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- reserved for future use}
12726         \textcolor{vhdlchar}{EN_OCT}                         \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- Does the sequencer use OCT during calibration.}
12727         \textcolor{vhdlchar}{OCT_LAT_WIDTH}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12728         \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- if 0 null, if 2 rrp for 1 dqs group and 1 cs}
12729         \textcolor{vhdlchar}{FORCE_HC}                       \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- Use to force HardCopy in simulation.}
12730         \textcolor{vhdlchar}{CAPABILITIES}                   \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{       -- advertise capabilities i.e. which ctrl block
       states to execute (default all on)}
12731         \textcolor{vhdlchar}{TINIT_TCK}                      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12732         \textcolor{vhdlchar}{TINIT_RST}                      \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
12733         \textcolor{vhdlchar}{GENERATE_TRACKING_PHASE_STORE}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{      -- reserved for future use}
12734         \textcolor{vhdlchar}{IP_BUILDNUM}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural}
12735     \textcolor{vhdlchar}{)};
12736     \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
12737 \textcolor{keyword}{        -- clk / reset}
12738         \textcolor{vhdlchar}{clk}                            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12739         \textcolor{vhdlchar}{rst_n}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12740 
12741 \textcolor{keyword}{        -- calibration status and prompt}
12742         \textcolor{vhdlchar}{ctl_init_success}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12743         \textcolor{vhdlchar}{ctl_init_fail}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12744         \textcolor{vhdlchar}{ctl_init_warning}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};\textcolor{keyword}{  -- unused}
12745         \textcolor{vhdlchar}{ctl_recalibrate_req}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12746 
12747 \textcolor{keyword}{        -- the following two signals are reserved for future use}
12748         \textcolor{vhdlchar}{mem_ac_swapped_ranks}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1}  \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12749         \textcolor{vhdlchar}{ctl_cal_byte_lanes}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_NUM_RANKS} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12750 
12751 \textcolor{keyword}{        -- pll reconfiguration}
12752         \textcolor{vhdlchar}{seq_pll_inc_dec_n}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12753         \textcolor{vhdlchar}{seq_pll_start_reconfig}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12754         \textcolor{vhdlchar}{seq_pll_select}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH}                        \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12755         \textcolor{vhdlchar}{seq_pll_phs_shift_busy}         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12756         \textcolor{vhdlchar}{pll_resync_clk_index}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH}                        \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- PLL phase used to select resync clock}
12757         \textcolor{vhdlchar}{pll_measure_clk_index}          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CLOCK_INDEX_WIDTH}                        \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- PLL phase used to select mimic/measure clock}
12758 
12759 
12760 \textcolor{keyword}{        -- scanchain associated signals (reserved for future use)}
12761         \textcolor{vhdlchar}{seq_scan_clk}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12762         \textcolor{vhdlchar}{seq_scan_enable_dqs_config}     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12763         \textcolor{vhdlchar}{seq_scan_update}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12764         \textcolor{vhdlchar}{seq_scan_din}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12765         \textcolor{vhdlchar}{seq_scan_enable_ck}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_CLK_PAIR_COUNT}                    \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12766         \textcolor{vhdlchar}{seq_scan_enable_dqs}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12767         \textcolor{vhdlchar}{seq_scan_enable_dqsn}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12768         \textcolor{vhdlchar}{seq_scan_enable_dq}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DWIDTH}                            \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12769         \textcolor{vhdlchar}{seq_scan_enable_dm}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DM_WIDTH}                          \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12770         \textcolor{vhdlchar}{hr_rsc_clk}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12771 
12772 \textcolor{keyword}{        -- address / command interface (note these are mapped internally to the seq\_ac record)}
12773         \textcolor{vhdlchar}{seq_ac_addr}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_ADDR_WIDTH}     \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12774         \textcolor{vhdlchar}{seq_ac_ba}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_BANKADDR_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12775         \textcolor{vhdlchar}{seq_ac_cas_n}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12776         \textcolor{vhdlchar}{seq_ac_ras_n}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12777         \textcolor{vhdlchar}{seq_ac_we_n}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12778         \textcolor{vhdlchar}{seq_ac_cke}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12779         \textcolor{vhdlchar}{seq_ac_cs_n}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12780         \textcolor{vhdlchar}{seq_ac_odt}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12781         \textcolor{vhdlchar}{seq_ac_rst_n}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12782         \textcolor{vhdlchar}{seq_ac_sel}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12783         \textcolor{vhdlchar}{seq_mem_clk_disable}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12784 
12785 \textcolor{keyword}{        -- additional datapath latency (reserved for future use)}
12786         \textcolor{vhdlchar}{seq_ac_add_1t_ac_lat_internal}  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12787         \textcolor{vhdlchar}{seq_ac_add_1t_odt_lat_internal} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12788         \textcolor{vhdlchar}{seq_ac_add_2t}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12789 
12790 \textcolor{keyword}{        -- read datapath interface}
12791         \textcolor{vhdlchar}{seq_rdp_reset_req_n}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12792         \textcolor{vhdlchar}{seq_rdp_inc_read_lat_1x}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12793         \textcolor{vhdlchar}{seq_rdp_dec_read_lat_1x}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12794         \textcolor{vhdlchar}{rdata}                          \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}    \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DWIDTH}         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12795 
12796 \textcolor{keyword}{        -- read data valid (associated signals) interface}
12797         \textcolor{vhdlchar}{seq_rdv_doing_rd}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}        \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12798         \textcolor{vhdlchar}{rdata_valid}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}                          \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12799         \textcolor{vhdlchar}{seq_rdata_valid_lat_inc}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12800         \textcolor{vhdlchar}{seq_rdata_valid_lat_dec}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12801         \textcolor{vhdlchar}{seq_ctl_rlat}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH}                            \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12802 
12803 \textcolor{keyword}{        -- postamble interface (unused for Cyclone-III)}
12804         \textcolor{vhdlchar}{seq_poa_lat_dec_1x}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12805         \textcolor{vhdlchar}{seq_poa_lat_inc_1x}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12806         \textcolor{vhdlchar}{seq_poa_protection_override_1x} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12807 
12808 \textcolor{keyword}{        -- OCT path control}
12809         \textcolor{vhdlchar}{seq_oct_oct_delay}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{OCT_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12810         \textcolor{vhdlchar}{seq_oct_oct_extend}             \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{OCT_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12811         \textcolor{vhdlchar}{seq_oct_value}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12812 
12813 \textcolor{keyword}{        -- write data path interface}
12814         \textcolor{vhdlchar}{seq_wdp_dqs_burst}              \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12815         \textcolor{vhdlchar}{seq_wdp_wdata_valid}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DQS_WIDTH}      \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12816         \textcolor{vhdlchar}{seq_wdp_wdata}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}    \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DWIDTH}         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12817         \textcolor{vhdlchar}{seq_wdp_dm}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}    \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      MEM_IF_DM_WIDTH}       \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12818         \textcolor{vhdlchar}{seq_wdp_dqs}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(} \textcolor{vhdlchar}{DWIDTH_RATIO}                            \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12819         \textcolor{vhdlchar}{seq_wdp_ovride}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12820         \textcolor{vhdlchar}{seq_dqs_add_2t_delay}           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12821         \textcolor{vhdlchar}{seq_ctl_wlat}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH}                            \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12822 
12823 \textcolor{keyword}{        -- mimic path interface}
12824         \textcolor{vhdlchar}{seq_mmc_start}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12825         \textcolor{vhdlchar}{mmc_seq_done}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12826         \textcolor{vhdlchar}{mmc_seq_value}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12827 
12828 \textcolor{keyword}{        -- parity signals (not used for non-levelled PHY)}
12829         \textcolor{vhdlchar}{mem_err_out_n}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12830         \textcolor{vhdlchar}{parity_error_n}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic};
12831 
12832 \textcolor{keyword}{        --synchronous Avalon debug interface  (internally re-synchronised to input clock (a generic
       option))}
12833         \textcolor{vhdlchar}{dbg_seq_clk}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12834         \textcolor{vhdlchar}{dbg_seq_rst_n}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12835         \textcolor{vhdlchar}{dbg_seq_addr}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{AV_IF_ADDR_WIDTH}                         \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{
      1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12836         \textcolor{vhdlchar}{dbg_seq_wr}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12837         \textcolor{vhdlchar}{dbg_seq_rd}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12838         \textcolor{vhdlchar}{dbg_seq_cs}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic};
12839         \textcolor{vhdlchar}{dbg_seq_wr_data}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in}    \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}                                         
        \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12840         \textcolor{vhdlchar}{seq_dbg_rd_data}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31}                                         
        \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12841         \textcolor{vhdlchar}{seq_dbg_waitrequest}            \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out}   \textcolor{comment}{std\_logic}
12842     \textcolor{vhdlchar}{)};
12843 \textcolor{keywordflow}{end} \textcolor{keywordflow}{entity};
12844 
12845 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{work};
12846 
12847 \textcolor{keyword}{-- The record package (alt\_mem\_phy\_record\_pkg) is used to combine command and status signals}
12848 \textcolor{keyword}{-- (into records) to be passed between sequencer blocks. It also contains type and record definitions}
12849 \textcolor{keyword}{-- for the stages of DRAM memory calibration.}
12850 \textcolor{keyword}{--}
12851 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_record_pkg.\textcolor{keywordflow}{all};
12852 
12853 \textcolor{keyword}{-- The registers package (alt\_mem\_phy\_regs\_pkg) is used to combine the definition of the}
12854 \textcolor{keyword}{-- registers for the mmi status registers and functions/procedures applied to the registers}
12855 \textcolor{keyword}{--}
12856 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_regs_pkg.\textcolor{keywordflow}{all};
12857 
12858 \textcolor{keyword}{-- The constant package (alt\_mem\_phy\_constants\_pkg) contains global 'constants' which are fixed}
12859 \textcolor{keyword}{-- thoughout the sequencer and will not change (for constants which may change between sequencer}
12860 \textcolor{keyword}{-- instances generics are used)}
12861 \textcolor{keyword}{--}
12862 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_constants_pkg.\textcolor{keywordflow}{all};
12863 
12864 \textcolor{keyword}{-- The iram address package (alt\_mem\_phy\_iram\_addr\_pkg) is used to define the base addresses used}
12865 \textcolor{keyword}{-- for iram writes during calibration}
12866 \textcolor{keyword}{--}
12867 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_iram_addr_pkg.\textcolor{keywordflow}{all};
12868 
12869 \textcolor{keyword}{-- The address and command package (alt\_mem\_phy\_addr\_cmd\_pkg) is used to combine DRAM address}
12870 \textcolor{keyword}{-- and command signals in one record and unify the functions operating on this record.}
12871 \textcolor{keyword}{--}
12872 \textcolor{vhdlkeyword}{use }work.ddr2_phy_alt_mem_phy_addr_cmd_pkg.\textcolor{keywordflow}{all};
12873 
12874 
12875 \textcolor{keyword}{-- Individually include each of library files for the sub-blocks of the sequencer:}
12876 \textcolor{keyword}{--}
12877 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_admin};
12878 \textcolor{keyword}{--}
12879 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_mmi};
12880 \textcolor{keyword}{--}
12881 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_iram};
12882 \textcolor{keyword}{--}
12883 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_dgrb};
12884 \textcolor{keyword}{--}
12885 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_dgwb};
12886 \textcolor{keyword}{--}
12887 \textcolor{vhdlkeyword}{use }\textcolor{keywordflow}{work.ddr2\_phy\_alt\_mem\_phy\_ctrl};
12888 
12889 \textcolor{keyword}{--}
12890 \textcolor{keywordflow}{architecture} struct \textcolor{keywordflow}{of} ddr2_phy_alt_mem_phy_seq IS
12891 
12892     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{altera_attribute} \textcolor{vhdlchar}{:} \textcolor{comment}{string};
12893     \textcolor{keywordflow}{attribute} \textcolor{vhdlchar}{altera_attribute} \textcolor{keywordflow}{of} \textcolor{vhdlchar}{struct} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{architecture} \textcolor{keywordflow}{is} \textcolor{keyword}{"-name MESSAGE\_DISABLE 18010"};
12894 
12895 \textcolor{keyword}{    -- debug signals (similar to those seen in the Quartus v8.0 DDR/DDR2 sequencer)}
12896     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_multiple_valid_latencies_err} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                     -- true if >2
       valid latency values are detected}
12897     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_grt_one_dvw_err}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                     -- true if >1
       data valid window is detected}
12898     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_no_dvw_err}                   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                     -- true if no
       data valid window is detected}
12899     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_codvw_phase}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11}                \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- set to the
       phase of the DVW detected if calibration is successful}
12900     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_codvw_size}                   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{11}                \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{  -- set to the
       phase of the DVW detected if calibration is successful}
12901     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rsu_read_latency}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{   -- set to the
       correct read latency if calibration is successful}
12902 
12903 \textcolor{keyword}{    -- outputs from the dgrb to generate the above rsu\_codvw\_* signals and report status to the mmi}
12904     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_mmi}                         \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_dgrb\_mmi};
12905 
12906 \textcolor{keyword}{    -- admin to mmi interface}
12907     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{regs_admin_ctrl_rec}            \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_admin\_ctrl};\textcolor{keyword}{  -- mmi register settings information}
12908     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{admin_regs_status_rec}          \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_admin\_stat};\textcolor{keyword}{  -- admin status information}
12909 
12910 \textcolor{keyword}{    -- odt enable from the admin block based on mr settings}
12911     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{enable_odt}                     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12912 
12913 \textcolor{keyword}{    -- iram status information (sent to the ctrl block)}
12914     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_status}                    \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_iram\_stat};
12915 
12916 \textcolor{keyword}{    -- dgrb iram write interface}
12917     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_iram}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_iram\_push};
12918 
12919 \textcolor{keyword}{    -- ctrl to iram interface}
12920     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_idib_top}                  \textcolor{vhdlchar}{:} \textcolor{comment}{natural};\textcolor{keyword}{              -- current write location in the iram}
12921     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_active_block}              \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_active\_block};
12922     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_iram_push}                 \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_iram};
12923     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{iram_push_done}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12924     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_iram_ihi_write}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12925 
12926 \textcolor{keyword}{    -- local copies of calibration status}
12927     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctl_init_success_int}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12928     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctl_init_fail_int}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12929 
12930 \textcolor{keyword}{    -- refresh period failure flag}
12931     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{trefi_failure}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12932 
12933 \textcolor{keyword}{    -- unified ctrl signal broadcast to all blocks from the ctrl block}
12934     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_broadcast}                 \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_command};
12935 
12936 \textcolor{keyword}{    -- standardised status report per block to control block}
12937     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{admin_ctrl}                     \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_stat};
12938     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgwb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_stat};
12939     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_ctrl}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_stat};
12940 
12941 \textcolor{keyword}{    -- mmi and ctrl block interface}
12942     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_ctrl}                       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_mmi\_ctrl};
12943     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_mmi}                       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_mmi};
12944 
12945 \textcolor{keyword}{    -- write datapath override signals}
12946     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgwb_wdp_override}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12947     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_wdp_override}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12948 
12949 \textcolor{keyword}{    -- address/command access request and grant between the dgrb/dgwb blocks and the admin block}
12950     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgb_ac_access_gnt}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12951     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgb_ac_access_gnt_r}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12952     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgb_ac_access_req}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12953     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgwb_ac_access_req}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12954     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_ac_access_req}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12955 
12956 \textcolor{keyword}{    -- per block address/command record (multiplexed in this entity)}
12957     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{admin_ac}                       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_addr\_cmd\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
12958     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgwb_ac}                        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_addr\_cmd\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
12959     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_ac}                        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_addr\_cmd\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
12960 
12961 \textcolor{keyword}{    -- doing read signal}
12962     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_rdv_doing_rd_int}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq_rdv_doing_rd}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
12963 
12964 \textcolor{keyword}{    -- local copy of interface to inc/dec latency on rdata\_valid and postamble}
12965     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_rdata_valid_lat_dec_int}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12966     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_rdata_valid_lat_inc_int}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12967     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_poa_lat_inc_1x_int}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12968     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_poa_lat_dec_1x_int}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{MEM_IF_DQS_WIDTH} \textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12969 
12970 \textcolor{keyword}{    -- local copy of write/read latency}
12971     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_ctl_wlat_int}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq_ctl_wlat}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
12972     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_ctl_rlat_int}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq_ctl_rlat}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
12973 
12974 \textcolor{keyword}{    -- parameterisation of dgrb / dgwb / admin blocks from mmi register settings}
12975     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{parameterisation_rec}           \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_algm\_paramaterisation};
12976 
12977 \textcolor{keyword}{    -- PLL reconfig}
12978     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_r}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12979     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd}     \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12980     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_pll_inc_dec_n}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12981     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_pll_start_reconfig}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12982     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_pll_select}                \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12983     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_phs_shft_busy}             \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12984     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_pll_inc_dec_n}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12985     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_pll_start_reconfig}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12986     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_pll_select}                 \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{CLOCK_INDEX_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12987     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pll_mmi}                        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_pll\_mmi};
12988     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_pll}                        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_mmi\_pll\_reconfig};
12989 
12990 
12991 \textcolor{keyword}{    -- address and command 1t setting (unused for Full Rate)}
12992     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{int_ac_nt}                      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{+}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
12993     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
12994 
12995 \textcolor{keyword}{    -- the following signals are reserved for future use}
12996     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctl_cal_byte_lanes_r}           \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctl_cal_byte_lanes}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)};
12997     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_setup}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_cmd\_id};
12998     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dgwb_iram}                      \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_iram\_push};
12999 
13000 \textcolor{keyword}{    -- track number of poa / rdv adjustments (reporting only)}
13001     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{poa_adjustments}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
13002     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rdv_adjustments}                \textcolor{vhdlchar}{:} \textcolor{comment}{natural};
13003 
13004 \textcolor{keyword}{    -- convert input generics from natural to std\_logic\_vector}
13005     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_phy_def_mr_1st_sl_vector}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{PHY_DEF_MR_1ST}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13006     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_phy_def_mr_2nd_sl_vector}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{PHY_DEF_MR_2ND}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13007     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_phy_def_mr_3rd_sl_vector}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{PHY_DEF_MR_3RD}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13008     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_phy_def_mr_4th_sl_vector}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{15} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{PHY_DEF_MR_4TH}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{16}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13009 
13010 \textcolor{keyword}{    -- overrride on capabilities to speed up simulation time}
13011     \textcolor{keywordflow}{function} capabilities_override(capabilities        : \textcolor{comment}{natural};
13012                                    sim\_time\_reductions : \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
13013 \textcolor{vhdlkeyword}{    begin}
13014         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{sim\_time\_reductions} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
13015             \textcolor{keywordflow}{return} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{c\_hl\_css\_reg\_cal\_dis\_bit};\textcolor{keyword}{ -- disable calibration completely}
13016         \textcolor{keywordflow}{else}
13017             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{capabilities};
13018         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13019     \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
13020 
13021 \textcolor{keyword}{    -- set sequencer capabilities}
13022     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_capabilities_override}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{capabilities\_override}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      CAPABILITIES}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS}\textcolor{vhdlchar}{)};
13023     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_capabilities}               \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}   \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{c_capabilities_override}\textcolor{vhdlchar}{,}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13024 
13025 \textcolor{keyword}{    -- setup for address/command interface}
13026     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_seq_addr_cmd_config}        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_addr\_cmd\_config\_rec}           \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_config\_rec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_ADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_BANKADDR_WIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
13027 
13028 \textcolor{keyword}{    -- setup for odt signals}
13029 \textcolor{keyword}{    -- odt setting as implemented in the altera high-performance controller for ddrx memories}
13030     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_odt_settings}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_odt\_array}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{set\_odt\_values}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_RANKS_PER_SLOT}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_MEMTYPE}\textcolor{vhdlchar}{)};
13031 
13032 \textcolor{keyword}{    -- a prefix for all report signals to identify phy and sequencer block}
13033 \textcolor{keyword}{--}
13034     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{seq_report_prefix}     \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"ddr2\_phy\_alt\_mem\_phy\_seq (top) : "};
13035 
13036 \textcolor{keyword}{    -- setup iram configuration}
13037     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_iram_addresses}             \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_base\_hdr\_addresses}            \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{calc\_iram\_addresses}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_NUM_RANKS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      MEM_IF_DQS_CAPTURE_EN}\textcolor{vhdlchar}{)};
13038     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_int_iram_awidth}            \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                         \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{
      c_iram_addresses}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{required\_addr\_bits};
13039 
13040     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_preset_cal_setup}   \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_preset\_cal} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{setup\_instant\_on}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      SIM_TIME_REDUCTIONS}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{FAMILYGROUP_ID}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_MEMTYPE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{c_phy_def_mr_1st_sl_vector}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{c_phy_def_mr_2nd_sl_vector}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      c_phy_def_mr_3rd_sl_vector}\textcolor{vhdlchar}{)};
13041     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_preset_codvw_phase} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw\_phase};
13042     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_preset_codvw_size}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw\_size};
13043 
13044     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_tracking_interval_in_ms} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{128};
13045     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_mem_if_cal_bank}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{      -- location to calibrate to}
13046     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_mem_if_cal_base_col}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{      -- default all zeros}
13047     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_mem_if_cal_base_row}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
13048     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_non_op_eval_md}          \textcolor{vhdlchar}{:} \textcolor{comment}{string}  \textcolor{vhdlchar}{:=} \textcolor{keyword}{"PIN\_FINDER"};\textcolor{keyword}{  -- non\_operational evaluation mode (used
       when GENERATE\_ADDITIONAL\_DBG\_RTL = 1)}
13049 
13050 \textcolor{vhdlkeyword}{begin }\textcolor{keyword}{ -- architecture struct}
13051 
13052 \textcolor{keyword}{-- ---------------------------------------------------------------}
13053 \textcolor{keyword}{-- tie off unused signals to default values}
13054 \textcolor{keyword}{-- ---------------------------------------------------------------}
13055 
13056 \textcolor{keyword}{    -- scan chain associated signals}
13057     \textcolor{vhdlchar}{seq_scan_clk}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13058     \textcolor{vhdlchar}{seq_scan_enable_dqs_config} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13059     \textcolor{vhdlchar}{seq_scan_update}            \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13060     \textcolor{vhdlchar}{seq_scan_din}               \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13061     \textcolor{vhdlchar}{seq_scan_enable_ck}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13062     \textcolor{vhdlchar}{seq_scan_enable_dqs}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13063     \textcolor{vhdlchar}{seq_scan_enable_dqsn}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13064     \textcolor{vhdlchar}{seq_scan_enable_dq}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13065     \textcolor{vhdlchar}{seq_scan_enable_dm}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13066 
13067     \textcolor{vhdlchar}{seq_dqs_add_2t_delay}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13068 
13069     \textcolor{vhdlchar}{seq_rdp_inc_read_lat_1x}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13070     \textcolor{vhdlchar}{seq_rdp_dec_read_lat_1x}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13071 
13072 \textcolor{keyword}{    -- warning flag (not used in non-levelled sequencer)}
13073     \textcolor{vhdlchar}{ctl_init_warning}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13074 
13075 \textcolor{keyword}{    -- parity error flag (not used in non-levelled sequencer)}
13076     \textcolor{vhdlchar}{parity_error_n}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13077 
13078 \textcolor{keyword}{    --}
13079     admin: \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_admin
13080         \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}
13081     (
13082         MEM_IF_DQS_WIDTH             => MEM_IF_DQS_WIDTH,
13083         MEM_IF_DWIDTH                => MEM_IF_DWIDTH,
13084         MEM_IF_DM_WIDTH              => MEM_IF_DM_WIDTH,
13085         MEM_IF_DQ_PER_DQS            => MEM_IF_DQ_PER_DQS,
13086         DWIDTH_RATIO                 => DWIDTH_RATIO,
13087         CLOCK_INDEX_WIDTH            => CLOCK_INDEX_WIDTH,
13088         MEM_IF_CLK_PAIR_COUNT        => MEM_IF_CLK_PAIR_COUNT,
13089         MEM_IF_ADDR_WIDTH            => MEM_IF_ADDR_WIDTH,
13090         MEM_IF_BANKADDR_WIDTH        => MEM_IF_BANKADDR_WIDTH,
13091         MEM_IF_NUM_RANKS             => MEM_IF_NUM_RANKS,
13092         ADV_LAT_WIDTH                => ADV_LAT_WIDTH,
13093         MEM_IF_DQSN_EN               => MEM_IF_DQSN_EN,
13094         MEM_IF_MEMTYPE               => MEM_IF_MEMTYPE,
13095         MEM_IF_CAL_BANK              => c_mem_if_cal_bank,
13096         MEM_IF_CAL_BASE_ROW          => c_mem_if_cal_base_row,
13097         GENERATE_ADDITIONAL_DBG_RTL  => GENERATE_ADDITIONAL_DBG_RTL,
13098         NON_OP_EVAL_MD               => c_non_op_eval_md,
13099         MEM_IF_CLK_PS                => MEM_IF_CLK_PS,
13100         TINIT_TCK                    => TINIT_TCK,
13101         TINIT_RST                    => TINIT_RST
13102     \textcolor{vhdlchar}{)}
13103     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}
13104     (
13105         clk                          => clk,
13106         rst_n                        => rst_n,
13107         mem_ac_swapped_ranks         => mem_ac_swapped_ranks,
13108         ctl_cal_byte_lanes           => ctl_cal_byte_lanes_r,
13109         seq_ac                       => admin_ac,
13110         seq_ac_sel                   => seq_ac_sel,
13111         enable_odt                   => enable_odt,
13112         regs_admin_ctrl_rec          => regs_admin_ctrl_rec,
13113         admin_regs_status_rec        => admin_regs_status_rec,
13114         trefi_failure                => trefi_failure,
13115         ctrl_admin                   => ctrl_broadcast,
13116         admin_ctrl                   => admin_ctrl,
13117         ac_access_req                => dgb_ac_access_req,
13118         ac_access_gnt                => dgb_ac_access_gnt,
13119         cal_fail                     => ctl_init_fail_int,
13120         cal_success                  => ctl_init_success_int,
13121         ctl_recalibrate_req          => ctl_recalibrate_req
13122     \textcolor{vhdlchar}{)};
13123 
13124 \textcolor{keyword}{    -- selectively include the debug i/f (iram and mmi blocks)}
13125     \textcolor{vhdlchar}{with\_debug\_if} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{generate}
13126 
13127     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_iram}                       \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_iram\_ctrl};
13128     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_iram_enable_writes}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
13129     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rrp_mem_loc}                    \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      c_int_iram_awidth} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13130     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{command_req_r}                  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
13131 
13132     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_broadcast_r}               \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_command};
13133 
13134 \textcolor{vhdlkeyword}{    begin}
13135 
13136 \textcolor{keyword}{        -- register ctrl\_broadcast locally}
13137          \textcolor{keywordflow}{process} (clk, rst_n)
13138 \textcolor{vhdlkeyword}{         begin}
13139             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13140                 \textcolor{vhdlchar}{ctrl_broadcast_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
13141             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13142                 \textcolor{vhdlchar}{ctrl_broadcast_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_broadcast};
13143             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13144          \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13145 
13146 \textcolor{keyword}{        --}
13147         mmi : \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_mmi
13148                 \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map} (
13149             MEM_IF_DQS_WIDTH           => MEM_IF_DQS_WIDTH,
13150             MEM_IF_DWIDTH              => MEM_IF_DWIDTH,
13151             MEM_IF_DM_WIDTH            => MEM_IF_DM_WIDTH,
13152             MEM_IF_DQ_PER_DQS          => MEM_IF_DQ_PER_DQS,
13153             DWIDTH_RATIO               => DWIDTH_RATIO,
13154             CLOCK_INDEX_WIDTH          => CLOCK_INDEX_WIDTH,
13155             MEM_IF_CLK_PAIR_COUNT      => MEM_IF_CLK_PAIR_COUNT,
13156             MEM_IF_ADDR_WIDTH          => MEM_IF_ADDR_WIDTH,
13157             MEM_IF_BANKADDR_WIDTH      => MEM_IF_BANKADDR_WIDTH,
13158             MEM_IF_NUM_RANKS           => MEM_IF_NUM_RANKS,
13159             MEM_IF_DQS_CAPTURE         => MEM_IF_DQS_CAPTURE_EN,
13160             ADV_LAT_WIDTH              => ADV_LAT_WIDTH,
13161             RESYNCHRONISE_AVALON_DBG   => RESYNCHRONISE_AVALON_DBG,
13162             AV_IF_ADDR_WIDTH           => AV_IF_ADDR_WIDTH,
13163             NOM_DQS_PHASE_SETTING      => NOM_DQS_PHASE_SETTING,
13164             SCAN_CLK_DIVIDE_BY         => SCAN_CLK_DIVIDE_BY,
13165             RDP_ADDR_WIDTH             => RDP_ADDR_WIDTH,
13166             PLL_STEPS_PER_CYCLE        => PLL_STEPS_PER_CYCLE,
13167             IOE_PHASES_PER_TCK         => IOE_PHASES_PER_TCK,
13168             IOE_DELAYS_PER_PHS         => IOE_DELAYS_PER_PHS,
13169             MEM_IF_CLK_PS              => MEM_IF_CLK_PS,
13170             PHY_DEF_MR_1ST             => c_phy_def_mr_1st_sl_vector,
13171             PHY_DEF_MR_2ND             => c_phy_def_mr_2nd_sl_vector,
13172             PHY_DEF_MR_3RD             => c_phy_def_mr_3rd_sl_vector,
13173             PHY_DEF_MR_4TH             => c_phy_def_mr_4th_sl_vector,
13174             MEM_IF_MEMTYPE             => MEM_IF_MEMTYPE,
13175             PRESET_RLAT                => PRESET_RLAT,
13176             CAPABILITIES               => c_capabilities_override,
13177             USE_IRAM                   => '1',\textcolor{keyword}{  -- always use iram (generic is rfu)}
13178             IRAM_AWIDTH                => c_int_iram_awidth,
13179             TRACKING_INTERVAL_IN_MS    => c_tracking_interval_in_ms,
13180             READ_LAT_WIDTH             => ADV_LAT_WIDTH
13181         \textcolor{vhdlchar}{)}
13182         \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
13183             clk                        => clk,
13184             rst_n                      => rst_n,
13185             dbg_seq_clk                => dbg_seq_clk,
13186             dbg_seq_rst_n              => dbg_seq_rst_n,
13187             dbg_seq_addr               => dbg_seq_addr,
13188             dbg_seq_wr                 => dbg_seq_wr,
13189             dbg_seq_rd                 => dbg_seq_rd,
13190             dbg_seq_cs                 => dbg_seq_cs,
13191             dbg_seq_wr_data            => dbg_seq_wr_data,
13192             seq_dbg_rd_data            => seq_dbg_rd_data,
13193             seq_dbg_waitrequest        => seq_dbg_waitrequest,
13194             regs_admin_ctrl            => regs_admin_ctrl_rec,
13195             admin_regs_status          => admin_regs_status_rec,
13196             mmi_iram                   => mmi_iram,
13197             mmi_iram_enable_writes     => mmi_iram_enable_writes,
13198             iram_status                => iram_status,
13199             mmi_ctrl                   => mmi_ctrl,
13200             ctrl_mmi                   => ctrl_mmi,
13201             int_ac_1t                  => int_ac_nt\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)},
13202             invert_ac_1t               => \textcolor{keywordflow}{open},
13203             trefi_failure              => trefi_failure,
13204             parameterisation_rec       => parameterisation_rec,
13205             pll_mmi                    => pll_mmi,
13206             mmi_pll                    => mmi_pll,
13207             dgrb_mmi                   => dgrb_mmi
13208         \textcolor{vhdlchar}{)};
13209 
13210 
13211 \textcolor{keyword}{    --}
13212      iram : \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_iram
13213               \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
13214              MEM_IF_MEMTYPE          => MEM_IF_MEMTYPE,
13215              FAMILYGROUP_ID          => FAMILYGROUP_ID,
13216              MEM_IF_DQS_WIDTH        => MEM_IF_DQS_WIDTH,
13217              MEM_IF_DQ_PER_DQS       => MEM_IF_DQ_PER_DQS,
13218              MEM_IF_DWIDTH           => MEM_IF_DWIDTH,
13219              MEM_IF_DM_WIDTH         => MEM_IF_DM_WIDTH,
13220              MEM_IF_NUM_RANKS        => MEM_IF_NUM_RANKS,
13221              IRAM_AWIDTH             => c_int_iram_awidth,
13222              REFRESH_COUNT_INIT      => \textcolor{vhdllogic}{12},
13223              PRESET_RLAT             => PRESET_RLAT,
13224              PLL_STEPS_PER_CYCLE     => PLL_STEPS_PER_CYCLE,
13225              CAPABILITIES            => c_capabilities_override,
13226              IP_BUILDNUM             => IP_BUILDNUM
13227         \textcolor{vhdlchar}{)}
13228          \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
13229              clk                     => clk,
13230              rst_n                   => rst_n,
13231              mmi_iram                => mmi_iram,
13232              mmi_iram_enable_writes  => mmi_iram_enable_writes,
13233              iram_status             => iram_status,
13234              iram_push_done          => iram_push_done,
13235              ctrl_iram               => ctrl_broadcast_r,
13236              dgrb_iram               => dgrb_iram,
13237              admin_regs_status_rec   => admin_regs_status_rec,
13238              ctrl_idib_top           => ctrl_idib_top,
13239              ctrl_iram_push          => ctrl_iram_push,
13240              dgwb_iram               => dgwb_iram
13241          \textcolor{vhdlchar}{)};
13242 
13243 \textcolor{keyword}{         -- calculate where current data should go in the iram}
13244          \textcolor{keywordflow}{process} (clk, rst_n)
13245 
13246              \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_words\_req}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{MEM_IF_DWIDTH} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{
      PLL_STEPS_PER_CYCLE} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{  -- how many words are required}
13247 
13248 \textcolor{vhdlkeyword}{         begin}
13249              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13250 
13251                  \textcolor{vhdlchar}{ctrl_idib_top} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
13252                  \textcolor{vhdlchar}{command_req_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13253                  \textcolor{vhdlchar}{rrp_mem_loc}   \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
13254 
13255              \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13256 
13257                  \textcolor{keywordflow}{if} \textcolor{vhdlchar}{command_req_r} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- execute once on
       each command\_req assertion}
13258 
13259 \textcolor{keyword}{                     -- default a 'safe location'}
13260                      \textcolor{vhdlchar}{ctrl_idib_top} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_iram_addresses}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{safe\_dummy};
13261 
13262                      \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
13263 
13264                          \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_write\_ihi} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{  -- reset pointers}
13265 
13266                              \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_iram_addresses}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp};
13267                              \textcolor{vhdlchar}{ctrl_idib_top} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{ -- write header to zero location always}
13268 
13269                          \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_sweep} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
13270 
13271 \textcolor{keyword}{                             -- add previous space requirement onto the current address}
13272                              \textcolor{vhdlchar}{ctrl_idib_top} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rrp_mem_loc};
13273 
13274 \textcolor{keyword}{                             -- add the current space requirement to v\_rrp\_mem\_loc}
13275 \textcolor{keyword}{                             -- there are (DWIDTH\_RATIO/2) * PLL\_STEPS\_PER\_CYCLE phases swept packed into
       32 bit words per pin}
13276 \textcolor{keyword}{                             -- note: special case for single\_bit calibration stages (e.g. read\_mtp
       alignment)}
13277 
13278                              \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_op}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{single\_bit} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13279                                  \textcolor{vhdlchar}{v\_words\_req} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{iram\_wd\_for\_one\_pin\_rrp}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE_EN}\textcolor{vhdlchar}{)};
13280                              \textcolor{keywordflow}{else}
13281                                  \textcolor{vhdlchar}{v\_words\_req} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{iram\_wd\_for\_full\_rrp}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DWIDTH}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE_EN}\textcolor{vhdlchar}{)};
13282                              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13283 
13284                              \textcolor{vhdlchar}{v\_words\_req} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{v\_words\_req} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};\textcolor{keyword}{ -- add 1 word location for header / footer
       information}
13285 
13286                              \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{v\_words\_req};
13287 
13288                          \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rrp\_seek} \textcolor{vhdlchar}{|}
13289                               \textcolor{vhdlchar}{cmd\_read\_mtp} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
13290 
13291 \textcolor{keyword}{                            -- add previous space requirement onto the current address}
13292                              \textcolor{vhdlchar}{ctrl_idib_top} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rrp_mem_loc};
13293 
13294 \textcolor{keyword}{                             -- require 3 words - header, result and footer}
13295                              \textcolor{vhdlchar}{v\_words\_req} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
13296 
13297                              \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{v\_words\_req};
13298 
13299                          \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
13300                              \textcolor{keywordflow}{null};
13301 
13302                      \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
13303 
13304                  \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13305 
13306                  \textcolor{vhdlchar}{command_req_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_req};
13307 
13308 \textcolor{keyword}{                 -- if recalibration request then reset iram address}
13309                  \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{mmi_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{calibration\_start} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13310 
13311                     \textcolor{vhdlchar}{rrp_mem_loc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_iram_addresses}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rrp};
13312 
13313                  \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13314 
13315              \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13316 
13317          \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13318 
13319     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate};\textcolor{keyword}{  -- with debug interface}
13320 
13321 \textcolor{keyword}{    -- if no debug interface (iram/mmi block) tie off relevant signals}
13322     \textcolor{vhdlchar}{without\_debug\_if} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{if} \textcolor{vhdlchar}{GENERATE_ADDITIONAL_DBG_RTL} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{generate}
13323 
13324     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_slv_hl_stage_enable}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{31} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}                    \textcolor{vhdlchar}{:=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{
      (}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_capabilities_override}\textcolor{vhdlchar}{,} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{32}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13325     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_hl_stage_enable}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_ccs\_num\_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{
      c_slv_hl_stage_enable}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_ccs\_num\_stages}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
13326     \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_pll_360_sweeps}        \textcolor{vhdlchar}{:} \textcolor{comment}{natural}                       \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{rrp\_pll\_phase\_mult}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DWIDTH_RATIO}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE_EN}\textcolor{vhdlchar}{)};
13327 
13328     \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_regs}                  \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_mmi\_regs} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{defaults};
13329 
13330 \textcolor{vhdlkeyword}{    begin}
13331 
13332 \textcolor{keyword}{        -- avalon interface signals}
13333         \textcolor{vhdlchar}{seq_dbg_rd_data}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13334         \textcolor{vhdlchar}{seq_dbg_waitrequest} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13335 
13336 \textcolor{keyword}{        -- The following registers are generated to simplify the assignments which follow}
13337 \textcolor{keyword}{        -- but will be optimised away in synthesis}
13338         \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_phy_def_mr_1st_sl_vector}\textcolor{vhdlchar}{,}
13339                                         \textcolor{vhdlchar}{c_phy_def_mr_2nd_sl_vector}\textcolor{vhdlchar}{,}
13340                                         \textcolor{vhdlchar}{c_phy_def_mr_3rd_sl_vector}\textcolor{vhdlchar}{,}
13341                                         \textcolor{vhdlchar}{c_phy_def_mr_4th_sl_vector}\textcolor{vhdlchar}{,}
13342                                         \textcolor{vhdlchar}{NOM_DQS_PHASE_SETTING}\textcolor{vhdlchar}{,}
13343                                         \textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE}\textcolor{vhdlchar}{,}
13344                                         \textcolor{vhdlchar}{c_pll_360_sweeps}\textcolor{vhdlchar}{,}
13345                                         \textcolor{vhdlchar}{c_tracking_interval_in_ms}\textcolor{vhdlchar}{,}
13346                                         \textcolor{vhdlchar}{c_hl_stage_enable}\textcolor{vhdlchar}{)};
13347 
13348         \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ro\_regs}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{,}
13349                                         \textcolor{vhdlchar}{ctrl_mmi}\textcolor{vhdlchar}{,}
13350                                         \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{,}
13351                                         \textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_if\_test}\textcolor{vhdlchar}{,}
13352                                         \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{,}\textcolor{keyword}{  -- do not use iram}
13353                                         \textcolor{vhdlchar}{MEM_IF_DQS_CAPTURE_EN}\textcolor{vhdlchar}{,}
13354                                         \textcolor{vhdlchar}{int_ac_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{,}
13355                                         \textcolor{vhdlchar}{trefi_failure}\textcolor{vhdlchar}{,}
13356                                         \textcolor{vhdlchar}{iram_status}\textcolor{vhdlchar}{,}
13357                                         \textcolor{vhdlchar}{c_int_iram_awidth}\textcolor{vhdlchar}{)};
13358 
13359         \textcolor{keywordflow}{process}(mmi_regs)
13360 \textcolor{vhdlkeyword}{        begin}
13361 \textcolor{keyword}{            --  debug parameterisation signals}
13362             regs\_admin\_ctrl\_rec          <= pack\_record(mmi\_regs.rw\_regs);
13363             \textcolor{vhdlchar}{parameterisation_rec}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
13364             \textcolor{vhdlchar}{mmi_pll}                      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
13365             \textcolor{vhdlchar}{mmi_ctrl}                     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pack\_record}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_regs}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rw\_regs}\textcolor{vhdlchar}{)};
13366         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13367 
13368 \textcolor{keyword}{        -- from the iram}
13369         \textcolor{vhdlchar}{iram_status}                      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
13370         \textcolor{vhdlchar}{iram_push_done}                   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13371 
13372     \textcolor{keywordflow}{end} \textcolor{keywordflow}{generate};\textcolor{keyword}{ -- without debug interface}
13373 
13374 \textcolor{keyword}{    --}
13375     dgrb : \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_dgrb
13376         \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
13377         MEM_IF_DQS_WIDTH                 => MEM_IF_DQS_WIDTH,
13378         MEM_IF_DQ_PER_DQS                => MEM_IF_DQ_PER_DQS,
13379         MEM_IF_DWIDTH                    => MEM_IF_DWIDTH,
13380         MEM_IF_DM_WIDTH                  => MEM_IF_DM_WIDTH,
13381         MEM_IF_DQS_CAPTURE               => MEM_IF_DQS_CAPTURE_EN,
13382         DWIDTH_RATIO                     => DWIDTH_RATIO,
13383         CLOCK_INDEX_WIDTH                => CLOCK_INDEX_WIDTH,
13384         MEM_IF_ADDR_WIDTH                => MEM_IF_ADDR_WIDTH,
13385         MEM_IF_BANKADDR_WIDTH            => MEM_IF_BANKADDR_WIDTH,
13386         MEM_IF_NUM_RANKS                 => MEM_IF_NUM_RANKS,
13387         MEM_IF_MEMTYPE                   => MEM_IF_MEMTYPE,
13388         ADV_LAT_WIDTH                    => ADV_LAT_WIDTH,
13389         PRESET_RLAT                      => PRESET_RLAT,
13390         PLL_STEPS_PER_CYCLE              => PLL_STEPS_PER_CYCLE,
13391         SIM_TIME_REDUCTIONS              => SIM_TIME_REDUCTIONS,
13392         GENERATE_ADDITIONAL_DBG_RTL      => GENERATE_ADDITIONAL_DBG_RTL,
13393         PRESET_CODVW_PHASE               => c_preset_codvw_phase,
13394         PRESET_CODVW_SIZE                => c_preset_codvw_size,
13395         MEM_IF_CAL_BANK                  => c_mem_if_cal_bank,
13396         MEM_IF_CAL_BASE_COL              => c_mem_if_cal_base_col,
13397         EN_OCT                           => EN_OCT
13398    \textcolor{vhdlchar}{)}
13399     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
13400         clk                              => clk,
13401         rst_n                            => rst_n,
13402         dgrb_ctrl                        => dgrb_ctrl,
13403         ctrl_dgrb                        => ctrl_broadcast,
13404         parameterisation_rec             => parameterisation_rec,
13405         phs_shft_busy                    => dgrb_phs_shft_busy,
13406         seq_pll_inc_dec_n                => dgrb_pll_inc_dec_n,
13407         seq_pll_select                   => dgrb_pll_select,
13408         seq_pll_start_reconfig           => dgrb_pll_start_reconfig,
13409         pll_resync_clk_index             => pll_resync_clk_index,
13410         pll_measure_clk_index            => pll_measure_clk_index,
13411         dgrb_iram                        => dgrb_iram,
13412         iram_push_done                   => iram_push_done,
13413         dgrb_ac                          => dgrb_ac,
13414         dgrb_ac_access_req               => dgrb_ac_access_req,
13415         dgrb_ac_access_gnt               => dgb_ac_access_gnt_r,
13416         seq_rdata_valid_lat_inc          => seq_rdata_valid_lat_inc_int,
13417         seq_rdata_valid_lat_dec          => seq_rdata_valid_lat_dec_int,
13418         seq_poa_lat_dec_1x               => seq_poa_lat_dec_1x_int,
13419         seq_poa_lat_inc_1x               => seq_poa_lat_inc_1x_int,
13420         rdata_valid                      => rdata_valid,
13421         rdata                            => rdata,
13422         doing_rd                         => seq_rdv_doing_rd_int,
13423         rd_lat                           => seq_ctl_rlat_int,
13424         wd_lat                           => seq_ctl_wlat_int,
13425         dgrb_wdp_ovride                  => dgrb_wdp_override,
13426         seq_oct_value                    => seq_oct_value,
13427         seq_mmc_start                    => seq_mmc_start,
13428         mmc_seq_done                     => mmc_seq_done,
13429         mmc_seq_value                    => mmc_seq_value,
13430         ctl_cal_byte_lanes               => ctl_cal_byte_lanes_r,
13431         odt_settings                     => c_odt_settings,
13432         dgrb_ctrl_ac_nt_good             => dgrb_ctrl_ac_nt_good,
13433         dgrb_mmi                         => dgrb_mmi
13434     \textcolor{vhdlchar}{)};
13435 
13436 \textcolor{keyword}{    --}
13437     dgwb : \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_dgwb
13438         \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
13439 \textcolor{keyword}{        -- Physical IF width definitions}
13440         MEM_IF_DQS_WIDTH             => MEM_IF_DQS_WIDTH,
13441         MEM_IF_DQ_PER_DQS            => MEM_IF_DQ_PER_DQS,
13442         MEM_IF_DWIDTH                => MEM_IF_DWIDTH,
13443         MEM_IF_DM_WIDTH              => MEM_IF_DM_WIDTH,
13444         DWIDTH_RATIO                 => DWIDTH_RATIO,
13445         MEM_IF_ADDR_WIDTH            => MEM_IF_ADDR_WIDTH,
13446         MEM_IF_BANKADDR_WIDTH        => MEM_IF_BANKADDR_WIDTH,
13447         MEM_IF_NUM_RANKS             => MEM_IF_NUM_RANKS,
13448         MEM_IF_MEMTYPE               => MEM_IF_MEMTYPE,
13449         ADV_LAT_WIDTH                => ADV_LAT_WIDTH,
13450         MEM_IF_CAL_BANK              => c_mem_if_cal_bank,
13451         MEM_IF_CAL_BASE_COL          => c_mem_if_cal_base_col
13452    \textcolor{vhdlchar}{)}
13453     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
13454         clk                          => clk,
13455         rst_n                        => rst_n,
13456         parameterisation_rec         => parameterisation_rec,
13457         dgwb_ctrl                    => dgwb_ctrl,
13458         ctrl_dgwb                    => ctrl_broadcast,
13459         dgwb_iram                    => dgwb_iram,
13460         iram_push_done               => iram_push_done,
13461         dgwb_ac_access_req           => dgwb_ac_access_req,
13462         dgwb_ac_access_gnt           => dgb_ac_access_gnt_r,
13463         dgwb_dqs_burst               => seq_wdp_dqs_burst,
13464         dgwb_wdata_valid             => seq_wdp_wdata_valid,
13465         dgwb_wdata                   => seq_wdp_wdata,
13466         dgwb_dm                      => seq_wdp_dm,
13467         dgwb_dqs                     => seq_wdp_dqs,
13468         dgwb_wdp_ovride              => dgwb_wdp_override,
13469         dgwb_ac                      => dgwb_ac,
13470         bypassed_rdata               => rdata\textcolor{vhdlchar}{(}DWIDTH_RATIO * MEM_IF_DWIDTH -\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdlchar}{(}
      DWIDTH_RATIO-\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} * MEM_IF_DWIDTH\textcolor{vhdlchar}{)},
13471         odt_settings                 => c_odt_settings
13472     \textcolor{vhdlchar}{)};
13473 
13474 \textcolor{keyword}{    --}
13475     ctrl: \textcolor{keywordflow}{entity} ddr2_phy_alt_mem_phy_ctrl
13476         \textcolor{keywordflow}{generic} \textcolor{keywordflow}{map}(
13477         FAMILYGROUP_ID               => FAMILYGROUP_ID,
13478         MEM_IF_DLL_LOCK_COUNT        => 1280/\textcolor{vhdlchar}{(}DWIDTH\_RATIO/2\textcolor{vhdlchar}{)},
13479         MEM_IF_MEMTYPE               => MEM_IF_MEMTYPE,
13480         DWIDTH_RATIO                 => DWIDTH_RATIO,
13481         IRAM_ADDRESSING              => c_iram_addresses,
13482         MEM_IF_CLK_PS                => MEM_IF_CLK_PS,
13483         TRACKING_INTERVAL_IN_MS      => c_tracking_interval_in_ms,
13484         GENERATE_ADDITIONAL_DBG_RTL  => GENERATE_ADDITIONAL_DBG_RTL,
13485         MEM_IF_NUM_RANKS             => MEM_IF_NUM_RANKS,
13486         MEM_IF_DQS_WIDTH             => MEM_IF_DQS_WIDTH,
13487         SIM_TIME_REDUCTIONS          => SIM_TIME_REDUCTIONS,
13488         ACK_SEVERITY                 => warning
13489     \textcolor{vhdlchar}{)}
13490     \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
13491         clk                          => clk,
13492         rst_n                        => rst_n,
13493         ctl_init_success             => ctl_init_success_int,
13494         ctl_init_fail                => ctl_init_fail_int,
13495         ctl_recalibrate_req          => ctl_recalibrate_req,
13496         iram_status                  => iram_status,
13497         iram_push_done               => iram_push_done,
13498         ctrl_op_rec                  => ctrl_broadcast,
13499         admin_ctrl                   => admin_ctrl,
13500         dgrb_ctrl                    => dgrb_ctrl,
13501         dgwb_ctrl                    => dgwb_ctrl,
13502         ctrl_iram_push               => ctrl_iram_push,
13503         ctl_cal_byte_lanes           => ctl_cal_byte_lanes_r,
13504         dgrb_ctrl_ac_nt_good         => dgrb_ctrl_ac_nt_good,
13505         int_ac_nt                    => int_ac_nt,
13506         mmi_ctrl                     => mmi_ctrl,
13507         ctrl_mmi                     => ctrl_mmi
13508     \textcolor{vhdlchar}{)};
13509 
13510 
13511 \textcolor{keyword}{-- ------------------------------------------------------------------}
13512 \textcolor{keyword}{-- generate legacy rsu signals}
13513 \textcolor{keyword}{-- ------------------------------------------------------------------}
13514     \textcolor{keywordflow}{process}(rst_n, clk)
13515 \textcolor{vhdlkeyword}{    begin}
13516         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13517             \textcolor{vhdlchar}{rsu_multiple_valid_latencies_err} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13518             \textcolor{vhdlchar}{rsu_grt_one_dvw_err}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13519             \textcolor{vhdlchar}{rsu_no_dvw_err}                   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13520             \textcolor{vhdlchar}{rsu_codvw_phase}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13521             \textcolor{vhdlchar}{rsu_codvw_size}                   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13522             \textcolor{vhdlchar}{rsu_read_latency}                 \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13523         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13524 
13525             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_err} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13526                 \textcolor{keywordflow}{case} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dgrb_ctrl}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_result}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{is}
13527                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{C\_ERR\_RESYNC\_NO\_VALID\_PHASES} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
13528                         \textcolor{vhdlchar}{rsu_no_dvw_err}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13529                     \textcolor{keywordflow}{when} \textcolor{vhdlchar}{C\_ERR\_RESYNC\_MULTIPLE\_EQUAL\_WINDOWS} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}
13530                         \textcolor{vhdlchar}{rsu_multiple_valid_latencies_err} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13531                     \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{null};
13532                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
13533             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13534 
13535             \textcolor{vhdlchar}{rsu_codvw_phase}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_phase}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_phase};
13536             \textcolor{vhdlchar}{rsu_codvw_size}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_size}\textcolor{vhdlchar}{'}\textcolor{keywordflow}{range}\textcolor{vhdlchar}{)}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_size};
13537             \textcolor{vhdlchar}{rsu_read_latency}                                 \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_ctl_rlat_int};
13538         \textcolor{vhdlchar}{rsu_grt_one_dvw_err}                              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw\_grt\_one\_dvw};
13539 
13540 \textcolor{keyword}{        -- Reset the flag on a recal request :}
13541         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{(} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13542             \textcolor{vhdlchar}{rsu_grt_one_dvw_err} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13543                 \textcolor{vhdlchar}{rsu_no_dvw_err}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13544                 \textcolor{vhdlchar}{rsu_multiple_valid_latencies_err} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13545         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13546 
13547         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13548     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13549 
13550 \textcolor{keyword}{-- ---------------------------------------------------------------}
13551 \textcolor{keyword}{-- top level multiplexing and ctrl functionality}
13552 \textcolor{keyword}{-- ---------------------------------------------------------------}
13553 
13554     \textcolor{vhdlchar}{oct\_delay\_block} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
13555         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{DEFAULT_OCT_DELAY_CONST} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2};\textcolor{keyword}{ -- higher increases delay by one mem\_clk cycle,
       lower decreases delay by one mem\_clk cycle.}
13556         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{DEFAULT_OCT_EXTEND}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
13557 
13558 \textcolor{keyword}{        -- Returns additive latency extracted from mr0 as a natural number.}
13559         \textcolor{keywordflow}{function} decode_cl(mr0 : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}))
13560                 \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
13561             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13562 \textcolor{vhdlkeyword}{        begin}
13563             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
13564                 \textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13565             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
13566                 \textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{6} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4};
13567             \textcolor{keywordflow}{else}
13568                 \textcolor{keywordflow}{report} \textcolor{keyword}{"Unsupported memory type "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13569             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13570 
13571             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_cl};
13572         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
13573 
13574 
13575 \textcolor{keyword}{        -- Returns additive latency extracted from mr1 as a natural number.}
13576         \textcolor{keywordflow}{function} decode_al(mr1 : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0}))
13577                 \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
13578             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_al} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13579 \textcolor{vhdlkeyword}{        begin}
13580             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
13581                 \textcolor{vhdlchar}{v\_al} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr1}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{5} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13582             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
13583                 \textcolor{vhdlchar}{v\_al} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr1}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13584             \textcolor{keywordflow}{else}
13585                 \textcolor{keywordflow}{report} \textcolor{keyword}{"Unsupported memory type "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13586             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13587 
13588             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_al};
13589         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
13590 
13591 
13592 \textcolor{keyword}{        -- Returns cas write latency extracted from mr2 as a natural number.}
13593         \textcolor{keywordflow}{function} decode_cwl(
13594                 mr0 : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0});
13595                 mr2 : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}(\textcolor{vhdllogic}{12} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{0})
13596             )
13597                 \textcolor{keywordflow}{return} \textcolor{comment}{natural} \textcolor{keywordflow}{is}
13598             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13599 \textcolor{vhdlkeyword}{        begin}
13600             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR"} \textcolor{keywordflow}{then}
13601                 \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13602             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{then}
13603                 \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{decode\_cl}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13604             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{vhdlchar}{=} \textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
13605                 \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mr2}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{5};
13606             \textcolor{keywordflow}{else}
13607                 \textcolor{keywordflow}{report} \textcolor{keyword}{"Unsupported memory type "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{MEM_IF_MEMTYPE} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13608             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13609 
13610             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{v\_cwl};
13611         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
13612 
13613 \textcolor{vhdlkeyword}{    begin}
13614 \textcolor{keyword}{        -- Process to work out timings for OCT extension and delay with respect to doing\_read. NOTE that it
       is calculated on the basis of CL, CWL, ctl\_wlat}
13615         oct\_delay\_proc : \textcolor{keywordflow}{process}(clk, rst_n)
13616             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- Total read latency.}
13617             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};\textcolor{keyword}{ -- Total write latency}
13618             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{oct\_delay} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{OCT_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13619 
13620             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_wlat} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{ADV_LAT_WIDTH} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13621 
13622 \textcolor{vhdlkeyword}{        begin}
13623             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13624                 \textcolor{vhdlchar}{seq_oct_oct_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13625                 \textcolor{vhdlchar}{seq_oct_oct_extend} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DEFAULT_OCT_EXTEND}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{OCT_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13626             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13627                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_init_success_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13628                     \textcolor{vhdlchar}{seq_oct_oct_extend} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DEFAULT_OCT_EXTEND}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{OCT_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13629 
13630                     \textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{decode\_cl}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{)};
13631                     \textcolor{vhdlchar}{v\_cwl} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{decode\_cwl}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr0}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      admin_regs_status_rec}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{mr2}\textcolor{vhdlchar}{)};
13632 
13633                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
13634                         \textcolor{vhdlchar}{v\_wlat} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wlat};
13635                     \textcolor{keywordflow}{else}
13636                         \textcolor{vhdlchar}{v\_wlat} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{seq_ctl_wlat_int}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13637                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13638 
13639                     \textcolor{vhdlchar}{oct\_delay} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{*} \textcolor{vhdlchar}{v\_wlat} \textcolor{vhdlchar}{/} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{vhdlchar}{+}  \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{v\_cl} \textcolor{vhdlchar}{-} \textcolor{vhdlchar}{v\_cwl}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{+} \textcolor{vhdlchar}{
      DEFAULT_OCT_DELAY_CONST};
13640 
13641                     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{FAMILYGROUP_ID} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- CIII doesn't support OCT}
13642                         \textcolor{vhdlchar}{seq_oct_oct_delay} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{oct\_delay}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{
      OCT_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13643                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13644                 \textcolor{keywordflow}{else}
13645                     \textcolor{vhdlchar}{seq_oct_oct_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13646                     \textcolor{vhdlchar}{seq_oct_oct_extend} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      DEFAULT_OCT_EXTEND}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{OCT_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13647                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13648             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13649         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13650     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
13651 
13652 
13653 \textcolor{keyword}{    -- control postamble protection override signal (seq\_poa\_protection\_override\_1x)}
13654     \textcolor{keywordflow}{process}(clk, rst_n)
13655         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_warning\_given} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
13656 \textcolor{vhdlkeyword}{    begin}
13657         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13658             \textcolor{vhdlchar}{seq_poa_protection_override_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13659 
13660             \textcolor{vhdlchar}{v\_warning\_given} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13661         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13662 
13663             \textcolor{keywordflow}{case} \textcolor{vhdlchar}{ctrl_broadcast}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{keywordflow}{is}
13664                 \textcolor{keywordflow}{when} \textcolor{vhdlchar}{cmd\_rdv}             \textcolor{vhdlchar}{|}
13665                      \textcolor{vhdlchar}{cmd\_rrp\_sweep}       \textcolor{vhdlchar}{|}
13666                      \textcolor{vhdlchar}{cmd\_rrp\_seek}        \textcolor{vhdlchar}{|}
13667                      \textcolor{vhdlchar}{cmd\_prep\_adv\_rd\_lat} \textcolor{vhdlchar}{|}
13668                      \textcolor{vhdlchar}{cmd\_prep\_adv\_wr\_lat} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{seq_poa_protection_override_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13669                 \textcolor{keywordflow}{when} \textcolor{keywordflow}{others}              \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{seq_poa_protection_override_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13670             \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
13671 
13672         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13673     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13674 
13675     \textcolor{vhdlchar}{ac\_mux} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
13676 
13677         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_mem_clk_disable_pipe_len} \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{3};
13678 
13679 
13680         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seen_phy_init_complete}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
13681         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mem_clk_disable}         \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_mem_clk_disable_pipe_len} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
13682 
13683         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ctrl_broadcast_r}        \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_ctrl\_command};
13684 
13685 \textcolor{vhdlkeyword}{    begin}
13686 
13687 \textcolor{keyword}{        -- register ctrl\_broadcast locally}
13688 \textcolor{keyword}{        -- #for speed and to reduce fan out}
13689         \textcolor{keywordflow}{process} (clk, rst_n)
13690 \textcolor{vhdlkeyword}{         begin}
13691             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13692                 \textcolor{vhdlchar}{ctrl_broadcast_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{defaults};
13693             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13694                 \textcolor{vhdlchar}{ctrl_broadcast_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctrl_broadcast};
13695             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13696          \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13697 
13698 \textcolor{keyword}{        -- multiplex mem interface control between admin, dgrb and dgwb}
13699         \textcolor{keywordflow}{process}(clk, rst_n)
13700             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_seq\_ac\_mux} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{t\_addr\_cmd\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{DWIDTH_RATIO}\textcolor{vhdlchar}{/}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
13701 \textcolor{vhdlkeyword}{        begin}
13702             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13703 
13704                 \textcolor{vhdlchar}{seq_rdv_doing_rd}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13705 
13706                 \textcolor{vhdlchar}{seq_mem_clk_disable}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13707                 \textcolor{vhdlchar}{mem_clk_disable}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13708                 \textcolor{vhdlchar}{seen_phy_init_complete}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13709 
13710                 \textcolor{vhdlchar}{seq_ac_addr}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13711                 \textcolor{vhdlchar}{seq_ac_ba}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13712                 \textcolor{vhdlchar}{seq_ac_cas_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13713                 \textcolor{vhdlchar}{seq_ac_ras_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13714                 \textcolor{vhdlchar}{seq_ac_we_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13715                 \textcolor{vhdlchar}{seq_ac_cke}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13716                 \textcolor{vhdlchar}{seq_ac_cs_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13717                 \textcolor{vhdlchar}{seq_ac_odt}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13718                 \textcolor{vhdlchar}{seq_ac_rst_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13719 
13720             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13721 
13722                 \textcolor{vhdlchar}{seq_rdv_doing_rd}                                       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      seq_rdv_doing_rd_int};
13723                 \textcolor{vhdlchar}{seq_mem_clk_disable}                                    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      mem_clk_disable}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_mem_clk_disable_pipe_len}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)};
13724                 \textcolor{vhdlchar}{mem_clk_disable}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_mem_clk_disable_pipe_len}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      mem_clk_disable}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_mem_clk_disable_pipe_len}\textcolor{vhdlchar}{-}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
13725 
13726                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dgb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13727                    \textcolor{vhdlchar}{v\_seq\_ac\_mux} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{dgwb_ac};
13728                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dgrb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dgb_ac_access_gnt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13729                    \textcolor{vhdlchar}{v\_seq\_ac\_mux} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{dgrb_ac};
13730                 \textcolor{keywordflow}{else}
13731                    \textcolor{vhdlchar}{v\_seq\_ac\_mux} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{admin_ac};
13732                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13733 
13734                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13735                     \textcolor{vhdlchar}{mem_clk_disable}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13736                     \textcolor{vhdlchar}{seen_phy_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13737                 \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_init\_dram} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      ctrl_broadcast_r}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command\_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13738                     \textcolor{vhdlchar}{mem_clk_disable}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13739                     \textcolor{vhdlchar}{seen_phy_init_complete} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13740                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13741 
13742                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seen_phy_init_complete} \textcolor{vhdlchar}{/=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- if not initialised the phy hold in reset}
13743 
13744                     \textcolor{vhdlchar}{seq_ac_addr}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13745                     \textcolor{vhdlchar}{seq_ac_ba}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13746                     \textcolor{vhdlchar}{seq_ac_cas_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13747                     \textcolor{vhdlchar}{seq_ac_ras_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13748                     \textcolor{vhdlchar}{seq_ac_we_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13749                     \textcolor{vhdlchar}{seq_ac_cke}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13750                     \textcolor{vhdlchar}{seq_ac_cs_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13751                     \textcolor{vhdlchar}{seq_ac_odt}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13752                     \textcolor{vhdlchar}{seq_ac_rst_n}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13753 
13754                 \textcolor{keywordflow}{else}
13755 
13756                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{enable_odt} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13757                         \textcolor{vhdlchar}{v\_seq\_ac\_mux} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{mask}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{v\_seq\_ac\_mux}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{odt}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13758                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13759 
13760                     \textcolor{vhdlchar}{unpack\_addr\_cmd\_vector} \textcolor{vhdlchar}{(}
13761                         \textcolor{vhdlchar}{c_seq_addr_cmd_config}\textcolor{vhdlchar}{,}
13762                         \textcolor{vhdlchar}{v\_seq\_ac\_mux}\textcolor{vhdlchar}{,}
13763                         \textcolor{vhdlchar}{seq_ac_addr}\textcolor{vhdlchar}{,}
13764                         \textcolor{vhdlchar}{seq_ac_ba}\textcolor{vhdlchar}{,}
13765                         \textcolor{vhdlchar}{seq_ac_cas_n}\textcolor{vhdlchar}{,}
13766                         \textcolor{vhdlchar}{seq_ac_ras_n}\textcolor{vhdlchar}{,}
13767                         \textcolor{vhdlchar}{seq_ac_we_n}\textcolor{vhdlchar}{,}
13768                         \textcolor{vhdlchar}{seq_ac_cke}\textcolor{vhdlchar}{,}
13769                         \textcolor{vhdlchar}{seq_ac_cs_n}\textcolor{vhdlchar}{,}
13770                         \textcolor{vhdlchar}{seq_ac_odt}\textcolor{vhdlchar}{,}
13771                         \textcolor{vhdlchar}{seq_ac_rst_n}\textcolor{vhdlchar}{)};
13772 
13773                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13774 
13775             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13776         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13777 
13778     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
13779 
13780 \textcolor{keyword}{    -- register dgb\_ac\_access\_gnt signal to ensure ODT set correctly in dgrb and dgwb prior to a read or
       write operation}
13781     \textcolor{keywordflow}{process}(clk, rst_n)
13782 \textcolor{vhdlkeyword}{    begin}
13783         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13784             \textcolor{vhdlchar}{dgb_ac_access_gnt_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13785         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13786             \textcolor{vhdlchar}{dgb_ac_access_gnt_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgb_ac_access_gnt};
13787         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13788     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13789 
13790 \textcolor{keyword}{    -- multiplex access request from dgrb/dgwb to admin block with checking for multiple accesses}
13791     \textcolor{keywordflow}{process} (dgrb_ac_access_req, dgwb_ac_access_req)
13792 \textcolor{vhdlkeyword}{    begin}
13793         \textcolor{vhdlchar}{dgb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13794         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dgrb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13795             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"multiple accesses attempted from DGRB and DGWB to admin block via
       signals dg.b\_ac\_access\_reg "} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13796         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{dgwb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{dgrb_ac_access_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13797             \textcolor{vhdlchar}{dgb_ac_access_req} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13798         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13799     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13800 
13801 
13802     \textcolor{vhdlchar}{rdv\_poa\_blk} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
13803 
13804 \textcolor{keyword}{        -- signals to control static setup of ctl\_rdata\_valid signal for instant on mode:}
13805         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_static_rdv_offset} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv\_lat};\textcolor{keyword}{                     --
       required change in RDV latency (should always be > 0)}
13806         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{static_rdv_offset}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_static_rdv_offset}\textcolor{vhdlchar}{)};\textcolor{keyword}{               -- signal to count # RDV shifts}
13807         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_dly_rdv_set}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};\textcolor{keyword}{                                              -- delay
       between RDV shifts}
13808         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dly_rdv_inc_dec}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};\textcolor{keyword}{                                                 -- 1 =
       inc, 0 = dec}
13809         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{rdv_set_delay}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_dly_rdv_set};\textcolor{keyword}{                          -- signal
       to delay RDV shifts}
13810 
13811 \textcolor{keyword}{        -- same for poa protection}
13812         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_static_poa_offset} \textcolor{vhdlchar}{:} \textcolor{comment}{integer} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa\_lat};
13813         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{static_poa_offset}     \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      c_static_poa_offset}\textcolor{vhdlchar}{)};
13814         \textcolor{keywordflow}{constant} \textcolor{vhdlchar}{c_dly_poa_set}       \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{vhdlchar}{:=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7};
13815         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{dly_poa_inc_dec}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
13816         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{poa_set_delay}         \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdlchar}{c_dly_poa_set};
13817 
13818 \textcolor{keyword}{        -- function to abstract increment or decrement checking}
13819         \textcolor{keywordflow}{function} set_inc_dec(offset : \textcolor{comment}{integer}) \textcolor{keywordflow}{return} \textcolor{comment}{std\_logic} \textcolor{keywordflow}{is}
13820 \textcolor{vhdlkeyword}{        begin}
13821             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{offset} \textcolor{vhdlchar}{<} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13822                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
13823             \textcolor{keywordflow}{else}
13824                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13825             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13826         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
13827 
13828 \textcolor{vhdlkeyword}{    begin}
13829 
13830 \textcolor{keyword}{        -- register postamble and rdata\_valid latencies}
13831 \textcolor{keyword}{        -- note: postamble unused for Cyclone-III}
13832 
13833 \textcolor{keyword}{        -- RDV}
13834         \textcolor{keywordflow}{process}(clk, rst_n)
13835 \textcolor{vhdlkeyword}{        begin}
13836             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13837 
13838                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
13839 
13840 \textcolor{keyword}{                    -- setup offset calc}
13841                     \textcolor{vhdlchar}{static_rdv_offset} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_rdv_offset}\textcolor{vhdlchar}{)};
13842                     \textcolor{vhdlchar}{dly_rdv_inc_dec}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_inc\_dec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_rdv_offset}\textcolor{vhdlchar}{)};
13843                     \textcolor{vhdlchar}{rdv_set_delay}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_rdv_set};
13844 
13845                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13846 
13847                 \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13848                 \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
13849 
13850             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13851 
13852                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- perform static setup of RDV signal}
13853 
13854                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- second reset condition}
13855 
13856 \textcolor{keyword}{                        -- setup offset calc}
13857                         \textcolor{vhdlchar}{static_rdv_offset} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_rdv_offset}\textcolor{vhdlchar}{)};
13858                         \textcolor{vhdlchar}{dly_rdv_inc_dec}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_inc\_dec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_rdv_offset}\textcolor{vhdlchar}{)};
13859                         \textcolor{vhdlchar}{rdv_set_delay}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_rdv_set};
13860 
13861                     \textcolor{keywordflow}{else}
13862 
13863                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{static_rdv_offset} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and}
13864                            \textcolor{vhdlchar}{rdv_set_delay} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13865 
13866                             \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{dly_rdv_inc_dec};
13867                             \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dly_rdv_inc_dec};
13868 
13869                             \textcolor{vhdlchar}{static_rdv_offset}       \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{static_rdv_offset} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13870                             \textcolor{vhdlchar}{rdv_set_delay}           \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_rdv_set};
13871 
13872                         \textcolor{keywordflow}{else}\textcolor{keyword}{  -- once conplete pass through internal signals}
13873 
13874                             \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      seq_rdata_valid_lat_dec_int};
13875                             \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{
      seq_rdata_valid_lat_inc_int};
13876 
13877                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13878 
13879                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdv_set_delay} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13880                             \textcolor{vhdlchar}{rdv_set_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdv_set_delay} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13881                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13882 
13883                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13884 
13885                 \textcolor{keywordflow}{else}\textcolor{keyword}{  -- no static setup}
13886 
13887                     \textcolor{vhdlchar}{seq_rdata_valid_lat_dec} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_rdata_valid_lat_dec_int};
13888                     \textcolor{vhdlchar}{seq_rdata_valid_lat_inc} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_rdata_valid_lat_inc_int};
13889 
13890                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13891 
13892             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13893 
13894         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13895 
13896 \textcolor{keyword}{        -- count number of RDV adjustments for debug}
13897         \textcolor{keywordflow}{process}(clk, rst_n)
13898 \textcolor{vhdlkeyword}{        begin}
13899 
13900             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13901                 \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
13902             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13903                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_rdata_valid_lat_dec_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13904                     \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13905                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13906                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_rdata_valid_lat_inc_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13907                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13908                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" read data valid adjustment wrap around detected - more
       increments than decrements"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13909                     \textcolor{keywordflow}{else}
13910                         \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{rdv_adjustments} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13911                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13912                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13913 
13914             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13915 
13916         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13917 
13918 \textcolor{keyword}{        -- POA protection}
13919         \textcolor{keywordflow}{process}(clk, rst_n)
13920 \textcolor{vhdlkeyword}{        begin}
13921             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13922 
13923                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
13924 
13925 \textcolor{keyword}{                    -- setup offset calc}
13926                     \textcolor{vhdlchar}{static_poa_offset} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_poa_offset}\textcolor{vhdlchar}{)};
13927                     \textcolor{vhdlchar}{dly_poa_inc_dec}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_inc\_dec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_poa_offset}\textcolor{vhdlchar}{)};
13928                     \textcolor{vhdlchar}{poa_set_delay}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_poa_set};
13929 
13930                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13931 
13932                 \textcolor{vhdlchar}{seq_poa_lat_dec_1x}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13933                 \textcolor{vhdlchar}{seq_poa_lat_inc_1x}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
13934 
13935             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13936 
13937                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- static setup}
13938 
13939                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{  -- second reset condition}
13940 
13941 \textcolor{keyword}{                        -- setup offset calc}
13942                         \textcolor{vhdlchar}{static_poa_offset} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{abs}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_poa_offset}\textcolor{vhdlchar}{)};
13943                         \textcolor{vhdlchar}{dly_poa_inc_dec}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{set\_inc\_dec}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_static_poa_offset}\textcolor{vhdlchar}{)};
13944                         \textcolor{vhdlchar}{poa_set_delay}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_poa_set};
13945 
13946                     \textcolor{keywordflow}{else}
13947 
13948                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{static_poa_offset} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and}
13949                            \textcolor{vhdlchar}{poa_set_delay} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13950 
13951                             \textcolor{vhdlchar}{seq_poa_lat_dec_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{keywordflow}{not}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{dly_poa_inc_dec}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
13952                             \textcolor{vhdlchar}{seq_poa_lat_inc_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{dly_poa_inc_dec}\textcolor{vhdlchar}{)};
13953 
13954                             \textcolor{vhdlchar}{static_poa_offset}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{static_poa_offset} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13955                             \textcolor{vhdlchar}{poa_set_delay}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_dly_poa_set};
13956 
13957                         \textcolor{keywordflow}{else}
13958 
13959                             \textcolor{vhdlchar}{seq_poa_lat_inc_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_poa_lat_inc_1x_int};
13960                             \textcolor{vhdlchar}{seq_poa_lat_dec_1x} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_poa_lat_dec_1x_int};
13961 
13962                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13963 
13964                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{poa_set_delay} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13965                             \textcolor{vhdlchar}{poa_set_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{poa_set_delay} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13966                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13967 
13968                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13969 
13970                 \textcolor{keywordflow}{else}\textcolor{keyword}{  -- no static setup}
13971 
13972                     \textcolor{vhdlchar}{seq_poa_lat_inc_1x}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_poa_lat_inc_1x_int};
13973                     \textcolor{vhdlchar}{seq_poa_lat_dec_1x}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_poa_lat_dec_1x_int};
13974 
13975                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13976 
13977             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13978 
13979         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
13980 
13981 \textcolor{keyword}{        -- count POA protection adjustments for debug}
13982         \textcolor{keywordflow}{process}(clk, rst_n)
13983 \textcolor{vhdlkeyword}{        begin}
13984 
13985             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13986                 \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
13987             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
13988                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_poa_lat_dec_1x_int}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13989                     \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13990                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13991                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_poa_lat_inc_1x_int}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
13992                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
13993                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" postamble adjustment wrap around detected - more
       increments than decrements"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
13994                     \textcolor{keywordflow}{else}
13995                         \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{poa_adjustments} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
13996                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13997                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13998             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
13999 
14000         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14001 
14002     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};
14003 
14004 \textcolor{keyword}{    -- register output fail/success signals - avoiding optimisation out}
14005     \textcolor{keywordflow}{process}(clk, rst_n)
14006 \textcolor{vhdlkeyword}{    begin}
14007         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14008             \textcolor{vhdlchar}{ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14009             \textcolor{vhdlchar}{ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14010         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14011             \textcolor{vhdlchar}{ctl_init_fail}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctl_init_fail_int};
14012             \textcolor{vhdlchar}{ctl_init_success} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ctl_init_success_int};
14013         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14014     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14015 
14016 \textcolor{keyword}{    -- ctl\_cal\_byte\_lanes register}
14017 \textcolor{keyword}{    -- seq\_rdp\_reset\_req\_n - when ctl\_recalibrate\_req issued}
14018     \textcolor{keywordflow}{process}(clk,rst_n)
14019 \textcolor{vhdlkeyword}{    begin}
14020         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14021             \textcolor{vhdlchar}{seq_rdp_reset_req_n}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14022             \textcolor{vhdlchar}{ctl_cal_byte_lanes_r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
14023         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14024             \textcolor{vhdlchar}{ctl_cal_byte_lanes_r} \textcolor{vhdlchar}{<=} \textcolor{keywordflow}{not} \textcolor{vhdlchar}{ctl_cal_byte_lanes};
14025 
14026             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14027                 \textcolor{vhdlchar}{seq_rdp_reset_req_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14028             \textcolor{keywordflow}{else}
14029 
14030                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_broadcast}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{command} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{cmd\_rrp\_sweep} \textcolor{keywordflow}{or}
14031                    \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14032                     \textcolor{vhdlchar}{seq_rdp_reset_req_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14033                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14034 
14035             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14036 
14037         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14038     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14039 
14040 \textcolor{keyword}{    -- register 1t addr/cmd and odt latency outputs}
14041     \textcolor{keywordflow}{process}(clk, rst_n)
14042 \textcolor{vhdlkeyword}{    begin}
14043         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14044             \textcolor{vhdlchar}{seq_ac_add_1t_ac_lat_internal}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14045             \textcolor{vhdlchar}{seq_ac_add_1t_odt_lat_internal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14046             \textcolor{vhdlchar}{seq_ac_add_2t}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14047         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14048             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14049                 \textcolor{vhdlchar}{seq_ac_add_1t_ac_lat_internal}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ac\_1t};
14050                 \textcolor{vhdlchar}{seq_ac_add_1t_odt_lat_internal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ac\_1t};
14051             \textcolor{keywordflow}{else}
14052                 \textcolor{vhdlchar}{seq_ac_add_1t_ac_lat_internal}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ac_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
14053                 \textcolor{vhdlchar}{seq_ac_add_1t_odt_lat_internal} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{int_ac_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
14054             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14055             \textcolor{vhdlchar}{seq_ac_add_2t}                  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14056         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14057     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14058 
14059 \textcolor{keyword}{    -- override write datapath signal generation}
14060     \textcolor{keywordflow}{process}(dgwb_wdp_override, dgrb_wdp_override, ctl_init_success_int, 
      ctl_init_fail_int)
14061 \textcolor{vhdlkeyword}{    begin}
14062         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_init_success_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ctl_init_fail_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- if calibrating}
14063             \textcolor{vhdlchar}{seq_wdp_ovride} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgwb_wdp_override} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{dgrb_wdp_override};
14064         \textcolor{keywordflow}{else}
14065             \textcolor{vhdlchar}{seq_wdp_ovride} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14066         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14067     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14068 
14069 \textcolor{keyword}{    -- output write/read latency (override with preset values when sim time reductions equals 1}
14070     \textcolor{vhdlchar}{seq_ctl_wlat} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wlat}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      ADV_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{seq_ctl_wlat_int};
14071     \textcolor{vhdlchar}{seq_ctl_rlat} \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rlat}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      ADV_LAT_WIDTH}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{when} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{else} \textcolor{vhdlchar}{seq_ctl_rlat_int};
14072 
14073     \textcolor{keywordflow}{process} (clk, rst_n)
14074 \textcolor{vhdlkeyword}{    begin}
14075         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14076             \textcolor{vhdlchar}{seq_pll_phs_shift_busy_r}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14077             \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14078         \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14079             \textcolor{vhdlchar}{seq_pll_phs_shift_busy_r}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_pll_phs_shift_busy};
14080             \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_r};
14081         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14082     \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14083 
14084 
14085     \textcolor{vhdlchar}{pll\_ctrl}\textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
14086 
14087 \textcolor{keyword}{        -- static resync setup variables for sim time reductions}
14088         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{static_rst_offset}  \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{to} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2}\textcolor{vhdlchar}{*}\textcolor{vhdlchar}{PLL_STEPS_PER_CYCLE};
14089         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{phs_shft_busy_1r}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14090         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{pll_set_delay}      \textcolor{vhdlchar}{:} \textcolor{comment}{natural} \textcolor{keywordflow}{range} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{100} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};\textcolor{keyword}{ -- wait 100 clock cycles for clk to be
       stable before setting resync phase}
14091 
14092 \textcolor{keyword}{        -- pll signal generation}
14093         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{mmi_pll_active}                \textcolor{vhdlchar}{:} \textcolor{comment}{boolean};
14094         \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd_1t} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14095 
14096 \textcolor{vhdlkeyword}{    begin}
14097 
14098 \textcolor{keyword}{        -- multiplex ppl interface between dgrb and mmi blocks}
14099 \textcolor{keyword}{        -- plus static setup of rsc phase to a known 'good' condition}
14100         \textcolor{keywordflow}{process}(clk,rst_n)
14101 
14102 \textcolor{vhdlkeyword}{        begin}
14103             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14104 
14105                 \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14106                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14107                 \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
14108 
14109                 \textcolor{vhdlchar}{dgrb_phs_shft_busy}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14110 
14111 \textcolor{keyword}{                -- static resync setup variables for sim time reductions}
14112                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14113                     \textcolor{vhdlchar}{static_rst_offset}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{c_preset_codvw_phase};
14114                 \textcolor{keywordflow}{else}
14115                     \textcolor{vhdlchar}{static_rst_offset}    \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0};
14116                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14117 
14118                 \textcolor{vhdlchar}{phs_shft_busy_1r}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14119                 \textcolor{vhdlchar}{pll_set_delay}        \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{100};
14120 
14121             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14122 
14123                 \textcolor{vhdlchar}{dgrb_phs_shft_busy}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14124 
14125                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{static_rst_offset} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and}\textcolor{keyword}{   -- not finished decrementing}
14126                    \textcolor{vhdlchar}{pll_set_delay} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{and}\textcolor{keyword}{        -- initial reset period over}
14127                    \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- in reduce sim time mode (optimse logic away when not in
       this mode)}
14128 
14129                             \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14130                             \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14131                             \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_resync_clk_index};
14132 
14133                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}\textcolor{keyword}{ -- no metastability hardening needed
       in simulation}
14134 \textcolor{keyword}{                                -- PLL phase shift started - so stop requesting a shift}
14135                                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14136                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14137 
14138                             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      phs_shft_busy_1r} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14139 \textcolor{keyword}{                                -- PLL phase shift finished - so proceed to flush the datapath}
14140                                 \textcolor{vhdlchar}{static_rst_offset}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{static_rst_offset} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
14141                                 \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14142                             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14143 
14144                             \textcolor{vhdlchar}{phs_shft_busy_1r} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd};
14145 
14146                 \textcolor{keywordflow}{else}
14147 
14148                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctrl_iram_push}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{active\_block} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{ret\_dgrb} \textcolor{keywordflow}{then}
14149                         \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_pll_inc_dec_n};
14150                         \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_pll_start_reconfig};
14151                         \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{dgrb_pll_select};
14152                         \textcolor{vhdlchar}{dgrb_phs_shft_busy}     \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd};
14153                     \textcolor{keywordflow}{else}
14154                         \textcolor{vhdlchar}{seq_pll_inc_dec_n}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_pll_inc_dec_n};
14155                         \textcolor{vhdlchar}{seq_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_pll_start_reconfig};
14156                         \textcolor{vhdlchar}{seq_pll_select}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_pll_select};
14157                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14158 
14159                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14160 
14161                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{pll_set_delay} \textcolor{vhdlchar}{/=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{then}
14162                     \textcolor{vhdlchar}{pll_set_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{pll_set_delay} \textcolor{vhdlchar}{-} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
14163                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14164 
14165                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14166                     \textcolor{vhdlchar}{pll_set_delay} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{100};
14167                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14168 
14169             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14170         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14171 
14172 
14173 
14174 \textcolor{keyword}{        -- generate mmi pll signals}
14175         \textcolor{keywordflow}{process} (clk, rst_n)
14176 
14177 \textcolor{vhdlkeyword}{        begin}
14178           \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14179 
14180               \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_busy}              \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14181               \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err}                   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
14182               \textcolor{vhdlchar}{mmi_pll_inc_dec_n}             \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14183               \textcolor{vhdlchar}{mmi_pll_start_reconfig}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14184               \textcolor{vhdlchar}{mmi_pll_select}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
14185               \textcolor{vhdlchar}{mmi_pll_active}                \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{false};
14186               \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14187 
14188           \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{rising\_edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14189 
14190               \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
14191                   \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_busy} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14192               \textcolor{keywordflow}{else}
14193                   \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_busy} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_up\_wc} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_dn\_wc};
14194               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14195 
14196               \textcolor{keywordflow}{if}    \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dgrb_pll_start_reconfig} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14197                 \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"01"};
14198               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
14199                 \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"10"};
14200               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{"00"} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{dgrb_pll_start_reconfig} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{then}
14201                 \textcolor{vhdlchar}{pll_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{err} \textcolor{vhdlchar}{<=} \textcolor{vhdllogic}{"11"};
14202               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14203 
14204               \textcolor{keywordflow}{if} \textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_up\_wc} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false} \textcolor{keywordflow}{then}
14205                   \textcolor{vhdlchar}{mmi_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14206                   \textcolor{vhdlchar}{mmi_pll_select}    \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_phase\_sel}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      mmi_pll_select}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
14207                   \textcolor{vhdlchar}{mmi_pll_active}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{true};
14208 
14209               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_dn\_wc} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{false}  \textcolor{keywordflow}{then}
14210                   \textcolor{vhdlchar}{mmi_pll_inc_dec_n} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14211                   \textcolor{vhdlchar}{mmi_pll_select}    \textcolor{vhdlchar}{<=} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{mmi_pll}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{pll\_phs\_shft\_phase\_sel}\textcolor{vhdlchar}{,}\textcolor{vhdlchar}{
      mmi_pll_select}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{length}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
14212                   \textcolor{vhdlchar}{mmi_pll_active}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{true};
14213 
14214               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14215                   \textcolor{vhdlchar}{mmi_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14216                   \textcolor{vhdlchar}{mmi_pll_active}         \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{false};
14217 
14218               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{mmi_pll_active} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{true} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{mmi_pll_start_reconfig} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14219                   \textcolor{vhdlchar}{mmi_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14220 
14221               \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd_1t} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      seq_pll_phs_shift_busy_ccd} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14222                   \textcolor{vhdlchar}{mmi_pll_start_reconfig} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14223 
14224               \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14225 
14226               \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd_1t} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{seq_pll_phs_shift_busy_ccd};
14227 
14228           \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14229         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14230 
14231     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};\textcolor{keyword}{ -- pll\_ctrl}
14232 
14233 \textcolor{keyword}{--synopsys synthesis\_off}
14234 
14235     \textcolor{vhdlchar}{reporting} \textcolor{vhdlchar}{:} \textcolor{keywordflow}{block}
14236 
14237         \textcolor{keywordflow}{function} pass_or_fail_report( cal\_success : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
14238                                       cal\_fail    : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
14239                                     ) \textcolor{keywordflow}{return} \textcolor{comment}{string} \textcolor{keywordflow}{is}
14240 \textcolor{vhdlkeyword}{        begin}
14241             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal\_success} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{cal\_fail} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14242                 \textcolor{keywordflow}{return} \textcolor{keyword}{"unknown state cal\_fail and cal\_success both high"};
14243             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14244             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal\_success} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14245                 \textcolor{keywordflow}{return} \textcolor{keyword}{"PASSED"};
14246             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14247             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{cal\_fail} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14248                 \textcolor{keywordflow}{return} \textcolor{keyword}{"FAILED"};
14249             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14250             \textcolor{keywordflow}{return} \textcolor{keyword}{"calibration report run whilst sequencer is still calibrating"};
14251         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14252 
14253         \textcolor{keywordflow}{function} is_stage_disabled ( stage\_name : \textcolor{keywordflow}{in} \textcolor{comment}{string};
14254                                      stage\_dis  : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
14255                                    ) \textcolor{keywordflow}{return} \textcolor{comment}{string} \textcolor{keywordflow}{is}
14256 \textcolor{vhdlkeyword}{        begin}
14257             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{stage\_dis} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14258                 \textcolor{keywordflow}{return} \textcolor{keyword}{""};
14259             \textcolor{keywordflow}{else}
14260                 \textcolor{keywordflow}{return} \textcolor{vhdlchar}{stage\_name} \textcolor{vhdlchar}{&} \textcolor{keyword}{" stage is disabled"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14261             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14262         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14263 
14264         \textcolor{keywordflow}{function} disabled_stages ( capabilities : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}
14265                                  ) \textcolor{keywordflow}{return} \textcolor{comment}{string} \textcolor{keywordflow}{is}
14266 \textcolor{vhdlkeyword}{        begin}
14267             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"all calibration"}\textcolor{vhdlchar}{,}                              \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_cal\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14268                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"initialisation"}\textcolor{vhdlchar}{,}                               \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_phy\_initialise\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14269                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"DRAM initialisation"}\textcolor{vhdlchar}{,}                          \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_init\_dram\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14270                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"iram header write"}\textcolor{vhdlchar}{,}                            \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_write\_ihi\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14271                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"burst training pattern write"}\textcolor{vhdlchar}{,}                 \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_write\_btp\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14272                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"more training pattern (MTP) write"}\textcolor{vhdlchar}{,}            \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_write\_mtp\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14273                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"check MTP pattern alignment calculation"}\textcolor{vhdlchar}{,}      \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_read\_mtp\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14274                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"read resynch phase reset stage"}\textcolor{vhdlchar}{,}               \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_rrp\_reset\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14275                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"read resynch phase sweep stage"}\textcolor{vhdlchar}{,}               \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_rrp\_sweep\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14276                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"read resynch phase seek stage (set phase)"}\textcolor{vhdlchar}{,}    \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_rrp\_seek\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14277                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"read data valid window setup"}\textcolor{vhdlchar}{,}                 \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_rdv\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14278                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"postamble calibration"}\textcolor{vhdlchar}{,}                        \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_poa\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14279                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"write latency timing calc"}\textcolor{vhdlchar}{,}                    \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_was\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14280                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"advertise read latency"}\textcolor{vhdlchar}{,}                       \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_adv\_rd\_lat\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14281                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"advertise write latency"}\textcolor{vhdlchar}{,}                      \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_adv\_wr\_lat\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14282                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"write customer mode register settings"}\textcolor{vhdlchar}{,}        \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_prep\_customer\_mr\_setup\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14283                    \textcolor{vhdlchar}{is\_stage\_disabled}\textcolor{vhdlchar}{(}\textcolor{keyword}{"tracking"}\textcolor{vhdlchar}{,}                                     \textcolor{vhdlchar}{
      c_capabilities}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c\_hl\_css\_reg\_tracking\_dis\_bit}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)};
14284         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14285 
14286         \textcolor{keywordflow}{function} ac_nt_report(  ac\_nt                : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14287                                 dgrb_ctrl_ac_nt_good : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
14288                                 preset\_cal\_setup     : \textcolor{keywordflow}{in} t\_preset\_cal) \textcolor{keywordflow}{return} \textcolor{comment}{string}
14289         \textcolor{keywordflow}{is}
14290             \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_ac\_nt} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
14291 \textcolor{vhdlkeyword}{        begin}
14292             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14293                 \textcolor{vhdlchar}{v\_ac\_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{ac\_1t};
14294 
14295                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_ac\_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14296                     \textcolor{keywordflow}{return} \textcolor{keyword}{"-- statically set address and command 1T delay: add 1T delay"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14297                 \textcolor{keywordflow}{else}
14298                     \textcolor{keywordflow}{return} \textcolor{keyword}{"-- statically set address and command 1T delay: no 1T delay"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14299                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14300 
14301             \textcolor{keywordflow}{else}
14302                 \textcolor{vhdlchar}{v\_ac\_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{ac\_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
14303 
14304                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14305                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_ac\_nt}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14306                         \textcolor{keywordflow}{return} \textcolor{keyword}{"-- chosen address and command 1T delay: add 1T delay"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14307                     \textcolor{keywordflow}{else}
14308                         \textcolor{keywordflow}{return} \textcolor{keyword}{"-- chosen address and command 1T delay: no 1T delay"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14309                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14310                 \textcolor{keywordflow}{else}
14311                     \textcolor{keywordflow}{return} \textcolor{keyword}{"-- no valid address and command phase chosen (calibration FAILED)"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14312                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14313 
14314             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14315 
14316         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14317 
14318         \textcolor{keywordflow}{function} read_resync_report ( codvw\_phase      : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14319                                       codvw\_size       : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14320                                       ctl\_rlat         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14321                                       ctl\_wlat         : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14322                                       preset\_cal\_setup : \textcolor{keywordflow}{in} t\_preset\_cal) \textcolor{keywordflow}{return} \textcolor{comment}{string}
14323         \textcolor{keywordflow}{is}
14324 \textcolor{vhdlkeyword}{        begin}
14325             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14326                 \textcolor{keywordflow}{return} \textcolor{keyword}{"-- read resynch phase static setup (no calibration run) report:"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14327                        \textcolor{keyword}{"    -- statically set centre of data valid window phase : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw\_phase}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14328                        \textcolor{keyword}{"    -- statically set centre of data valid window size  : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{codvw\_size}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14329                        \textcolor{keyword}{"    -- statically set read latency (ctl\_rlat)           : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rlat}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14330                        \textcolor{keyword}{"    -- statically set write latency (ctl\_wlat)          : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{wlat}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14331                        \textcolor{keyword}{"    -- note: this mode only works for simulation and sets resync phase"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14332                        \textcolor{keyword}{"             to a known good operating condition for no test bench"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14333                        \textcolor{keyword}{"             delays on mem\_dq signal"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14334             \textcolor{keywordflow}{else}
14335                 \textcolor{keywordflow}{return} \textcolor{keyword}{"-- PHY read latency (ctl\_rlat) is  : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctl\_rlat}\textcolor{vhdlchar}{
      )}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14336                        \textcolor{keyword}{"-- address/command to PHY write latency (ctl\_wlat) is : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{
      to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ctl\_wlat}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14337                        \textcolor{keyword}{"-- read resynch phase calibration report:"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14338                        \textcolor{keyword}{"    -- calibrated centre of data valid window phase : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{
      unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{codvw\_phase}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14339                        \textcolor{keyword}{"    -- calibrated centre of data valid window size  : "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{to\_integer}\textcolor{vhdlchar}{(}\textcolor{comment}{
      unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{codvw\_size}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14340             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14341         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14342 
14343         \textcolor{keywordflow}{function} poa_rdv_adjust_report( poa\_adjust : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
14344                                         rdv\_adjust : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
14345                                         preset\_cal\_setup : \textcolor{keywordflow}{in} t\_preset\_cal) \textcolor{keywordflow}{return} \textcolor{comment}{string}
14346         \textcolor{keywordflow}{is}
14347 \textcolor{vhdlkeyword}{        begin}
14348             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{SIM_TIME_REDUCTIONS} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1} \textcolor{keywordflow}{then}
14349                 \textcolor{keywordflow}{return} \textcolor{keyword}{"Statically set poa and rdv (adjustments from reset value):"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14350                        \textcolor{keyword}{"poa 'dec' adjustments = "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{poa\_lat}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14351                        \textcolor{keyword}{"rdv 'dec' adjustments = "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{rdv\_lat}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14352             \textcolor{keywordflow}{else}
14353                 \textcolor{keywordflow}{return} \textcolor{keyword}{"poa 'dec' adjustments = "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{poa\_adjust}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14354                        \textcolor{keyword}{"rdv 'dec' adjustments = "} \textcolor{vhdlchar}{&} \textcolor{comment}{natural}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{image}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{rdv\_adjust}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF};
14355 
14356             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14357         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14358 
14359         \textcolor{keywordflow}{function} calibration_report ( capabilities : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14360                                       cal\_success  : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
14361                                       cal\_fail     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
14362                                       ctl\_rlat     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14363                                       ctl\_wlat     : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14364                                       codvw\_phase  : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14365                                       codvw\_size   : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14366                                       ac\_nt        : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector};
14367                                       dgrb_ctrl_ac_nt_good : \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
14368                                       preset\_cal\_setup : \textcolor{keywordflow}{in} t\_preset\_cal;
14369                                       poa\_adjust : \textcolor{keywordflow}{in} \textcolor{comment}{natural};
14370                                       rdv\_adjust : \textcolor{keywordflow}{in} \textcolor{comment}{natural}) \textcolor{keywordflow}{return} \textcolor{comment}{string}
14371         \textcolor{keywordflow}{is}
14372 
14373 \textcolor{vhdlkeyword}{        begin}
14374             \textcolor{keywordflow}{return} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{" report..."} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14375                    \textcolor{keyword}{"-----------------------------------------------------------------------"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14376                    \textcolor{keyword}{"-- **** ALTMEMPHY CALIBRATION has completed ****"} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14377                    \textcolor{keyword}{"-- Status:"}  \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14378                    \textcolor{keyword}{"-- calibration has  : "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{pass\_or\_fail\_report}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{cal\_success}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{cal\_fail}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{LF} \textcolor{vhdlchar}{&}
14379                    \textcolor{vhdlchar}{read\_resync\_report}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{codvw\_phase}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{codvw\_size}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ctl\_rlat}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ctl\_wlat}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14380                    \textcolor{vhdlchar}{ac\_nt\_report}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{ac\_nt}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14381                    \textcolor{vhdlchar}{poa\_rdv\_adjust\_report}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{poa\_adjust}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{rdv\_adjust}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{preset\_cal\_setup}\textcolor{vhdlchar}{)} \textcolor{vhdlchar}{&}
14382                    disabled\_stages(capabilities) &
14383                    \textcolor{keyword}{"-----------------------------------------------------------------------"};
14384         \textcolor{keywordflow}{end} \textcolor{keywordflow}{function};
14385 
14386 \textcolor{vhdlkeyword}{    begin}
14387 
14388 \textcolor{keyword}{        -- -------------------------------------------------------}
14389 \textcolor{keyword}{        -- calibration result reporting}
14390 \textcolor{keyword}{        -- -------------------------------------------------------}
14391         \textcolor{keywordflow}{process}(rst_n, clk)
14392         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_reports\_written} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14393         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_cal\_request\_r}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14394         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{v\_rewrite\_report}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14395 
14396 \textcolor{vhdlkeyword}{        begin}
14397             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14398                 \textcolor{vhdlchar}{v\_reports\_written} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14399                 \textcolor{vhdlchar}{v\_cal\_request\_r}   \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14400                 \textcolor{vhdlchar}{v\_rewrite\_report}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14401 
14402             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{Rising\_Edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14403                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_reports\_written} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14404                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_init_success_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{ctl_init_fail_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14405                         \textcolor{vhdlchar}{v\_reports\_written} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14406 
14407                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{calibration\_report}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_capabilities}\textcolor{vhdlchar}{,}
14408                                                   \textcolor{vhdlchar}{ctl_init_success_int}\textcolor{vhdlchar}{,}
14409                                                   \textcolor{vhdlchar}{ctl_init_fail_int}\textcolor{vhdlchar}{,}
14410                                                   \textcolor{vhdlchar}{seq_ctl_rlat_int}\textcolor{vhdlchar}{,}
14411                                                   \textcolor{vhdlchar}{seq_ctl_wlat_int}\textcolor{vhdlchar}{,}
14412                                                   \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_phase}\textcolor{vhdlchar}{,}
14413                                                   \textcolor{vhdlchar}{dgrb_mmi}\textcolor{vhdlchar}{.}\textcolor{vhdlchar}{cal\_codvw\_size}\textcolor{vhdlchar}{,}
14414                                                   \textcolor{vhdlchar}{int_ac_nt}\textcolor{vhdlchar}{,}
14415                                                   \textcolor{vhdlchar}{dgrb_ctrl_ac_nt_good}\textcolor{vhdlchar}{,}
14416                                                   \textcolor{vhdlchar}{c_preset_cal_setup}\textcolor{vhdlchar}{,}
14417                                                   \textcolor{vhdlchar}{poa_adjustments}\textcolor{vhdlchar}{,}
14418                                                   \textcolor{vhdlchar}{rdv_adjustments}
14419                                                  \textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
14420 
14421                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14422                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14423 
14424 \textcolor{keyword}{                -- if recalibrate request triggered watch for cal success / fail going low and re-trigger
       report writing}
14425                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ctl_recalibrate_req} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{v\_cal\_request\_r} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14426                     \textcolor{vhdlchar}{v\_rewrite\_report} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14427                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14428                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{v\_rewrite\_report} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{ctl_init_success_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{
      ctl_init_fail_int} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14429                     \textcolor{vhdlchar}{v\_reports\_written} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14430                     \textcolor{vhdlchar}{v\_rewrite\_report}  \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14431                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14432 
14433                 \textcolor{vhdlchar}{v\_cal\_request\_r} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{ctl_recalibrate_req};
14434             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14435         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14436 
14437 \textcolor{keyword}{        -- -------------------------------------------------------}
14438 \textcolor{keyword}{        -- capabilities vector reporting and coarse PHY setup sanity checks}
14439 \textcolor{keyword}{        -- -------------------------------------------------------}
14440 
14441         \textcolor{keywordflow}{process}(rst_n, clk)
14442         \textcolor{keywordflow}{variable} \textcolor{vhdlchar}{reports\_written} \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
14443 \textcolor{vhdlkeyword}{        begin}
14444             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{rst_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14445                 \textcolor{vhdlchar}{reports\_written} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
14446 
14447             \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{Rising\_Edge}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then}
14448 
14449                 \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reports\_written} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then}
14450                     \textcolor{vhdlchar}{reports\_written} \textcolor{vhdlchar}{:=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'};
14451                     \textcolor{keywordflow}{if} \textcolor{vhdlchar}{MEM_IF_MEMTYPE}\textcolor{vhdlchar}{=}\textcolor{keyword}{"DDR"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{MEM_IF_MEMTYPE}\textcolor{vhdlchar}{=}\textcolor{keyword}{"DDR2"} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE}\textcolor{vhdlchar}{=}\textcolor{keyword}{"DDR3"} \textcolor{keywordflow}{then}
14452                         \textcolor{keywordflow}{if} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{or} \textcolor{vhdlchar}{DWIDTH_RATIO} \textcolor{vhdlchar}{=} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{4} \textcolor{keywordflow}{then}
14453                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{disabled\_stages}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{c_capabilities}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{note};
14454                         \textcolor{keywordflow}{else}
14455                             \textcolor{keywordflow}{report} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"unsupported rate for non-levelling AFI PHY
       sequencer - only full- or half-rate supported"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{warning};
14456                         \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14457                     \textcolor{keywordflow}{else}
14458                         \textcolor{keywordflow}{report} \textcolor{vhdlchar}{seq_report_prefix} \textcolor{vhdlchar}{&} \textcolor{keyword}{"memory type "} \textcolor{vhdlchar}{&} \textcolor{vhdlchar}{
      MEM_IF_MEMTYPE} \textcolor{vhdlchar}{&} \textcolor{keyword}{" is not supported in non-levelling AFI PHY sequencer"} \textcolor{keywordflow}{severity} \textcolor{vhdlchar}{failure};
14459                     \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14460                 \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14461             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
14462 
14463         \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
14464 
14465     \textcolor{keywordflow}{end} \textcolor{keywordflow}{block};\textcolor{keyword}{  -- reporting}
14466 
14467 \textcolor{keyword}{--synopsys synthesis\_on}
14468 
14469 \textcolor{keywordflow}{end} \textcolor{keywordflow}{architecture} \textcolor{vhdlchar}{struct};
\end{DoxyCode}
