\subsection{pll\+\_\+ps\+\_\+top.\+vhd}
\label{pll__ps__top_8vhd_source}\index{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/dyn\+\_\+ps/synth/pll\+\_\+ps\+\_\+top.\+vhd@{/home/erik/git/dev/\+Lime\+S\+D\+R-\/\+U\+S\+B\+\_\+\+G\+W/src/dyn\+\_\+ps/synth/pll\+\_\+ps\+\_\+top.\+vhd}}

\begin{DoxyCode}
00001 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00002 \textcolor{keyword}{-- FILE:          pll\_ps\_top.vhd}
00003 \textcolor{keyword}{-- DESCRIPTION:   describe file}
00004 \textcolor{keyword}{-- DATE:          4:31 PM Friday, January 12, 2018}
00005 \textcolor{keyword}{-- AUTHOR(s):     Lime Microsystems}
00006 \textcolor{keyword}{-- REVISIONS:}
00007 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00008 
00009 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00010 \textcolor{keyword}{--NOTES: in auto mode pll\_ps\_fsm automatically adjust C1 output clock phase}
00011 \textcolor{keyword}{-- to get correct samples from external interface (checking is done trough }
00012 \textcolor{keyword}{-- smpl\_cmp module)}
00013 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00014 \textcolor{vhdlkeyword}{library }\textcolor{keywordflow}{ieee};
00015 \textcolor{vhdlkeyword}{use }ieee.std\_logic\_1164.\textcolor{keywordflow}{all};
00016 \textcolor{vhdlkeyword}{use }ieee.numeric\_std.\textcolor{keywordflow}{all};
00017 
00018 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00019 \textcolor{keyword}{-- Entity declaration}
00020 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00021 \textcolor{keywordflow}{entity }pll_ps_top \textcolor{keywordflow}{is}
00022    \textcolor{keywordflow}{port} \textcolor{vhdlchar}{(}
00023 
00024       \textcolor{vhdlchar}{clk}                           \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00025       \textcolor{vhdlchar}{reset_n}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00026 \textcolor{keyword}{      --module control ports}
00027       \textcolor{vhdlchar}{ps_en}                         \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- rising edge triggers dynamic phase shift}
00028       \textcolor{vhdlchar}{ps_mode}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- 0 - manual, 1 - auto}
00029       \textcolor{vhdlchar}{ps_tst}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00030       \textcolor{vhdlchar}{ps_cnt}                        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)}; 
00031 \textcolor{keyword}{                                                   -- 000 - ALL, 001 -   M, 010 - C0,}
00032 \textcolor{keyword}{                                                   -- 011 -  C1, 100 -  C2, 101 - C3,}
00033 \textcolor{keyword}{                                                   -- 110 -  C4}
00034       \textcolor{vhdlchar}{ps_updwn}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};\textcolor{keyword}{ -- 1- UP, 0 - DOWN }
00035       \textcolor{vhdlchar}{ps_phase}                      \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};\textcolor{keyword}{ -- phase value in steps}
00036       \textcolor{vhdlchar}{ps_step_size}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00037       \textcolor{vhdlchar}{ps_busy}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00038       \textcolor{vhdlchar}{ps_done}                       \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00039       \textcolor{vhdlchar}{ps_status}                     \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};     
00040 \textcolor{keyword}{      --pll ports}
00041       \textcolor{vhdlchar}{pll_phasecounterselect}        \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00042       \textcolor{vhdlchar}{pll_phaseupdown}               \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00043       \textcolor{vhdlchar}{pll_phasestep}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00044       \textcolor{vhdlchar}{pll_phasedone}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00045       \textcolor{vhdlchar}{pll_locked}                    \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00046       \textcolor{vhdlchar}{pll_reconfig}                  \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00047       \textcolor{vhdlchar}{pll_reset_req}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00048 \textcolor{keyword}{      --sample compare module}
00049       \textcolor{vhdlchar}{smpl_cmp_en}                   \textcolor{vhdlchar}{:} \textcolor{keywordflow}{out} \textcolor{comment}{std\_logic};
00050       \textcolor{vhdlchar}{smpl_cmp_done}                 \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic};
00051       \textcolor{vhdlchar}{smpl_cmp_error}                \textcolor{vhdlchar}{:} \textcolor{keywordflow}{in} \textcolor{comment}{std\_logic}
00052             
00053       \textcolor{vhdlchar}{)};
00054 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{pll\_ps\_top};
00055 
00056 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00057 \textcolor{keyword}{-- Architecture}
00058 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00059 \textcolor{keywordflow}{architecture} arch \textcolor{keywordflow}{of} pll_ps_top is
00060 \textcolor{keyword}{--declare signals,  components here}
00061 
00062 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ps_tst_reg}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00063 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ps_en_reg}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00064 \textcolor{keyword}{--inst 0}
00065 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_ph_step}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00066 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_ps_status}  \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00067 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst0_busy}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00068 
00069 \textcolor{keyword}{--isnt1}
00070 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_en}            \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00071 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_done}          \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00072 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_status}        \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00073 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_ctrl_phase}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{9} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00074 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_ctrl_en}       \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00075 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_smpl_cmp_en}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00076 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_pll_reset_req}    \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00077 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_ctrl_cnt}      \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic\_vector}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{2} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00078 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{inst1_ps_ctrl_updown}   \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00079 
00080 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ps_en_tst}              \textcolor{vhdlchar}{:} \textcolor{comment}{std\_logic};
00081 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{ps_disable_cnt}         \textcolor{vhdlchar}{:} \textcolor{comment}{unsigned}\textcolor{vhdlchar}{(}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{downto} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{)};
00082    
00083    
00084 \textcolor{keywordflow}{type} \textcolor{vhdlchar}{state_type} \textcolor{keywordflow}{is} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{idle}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{check\_mode}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ps\_enable}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{ps\_disable}\textcolor{vhdlchar}{)};
00085 \textcolor{keywordflow}{signal} \textcolor{vhdlchar}{current_state}\textcolor{vhdlchar}{,} \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{:} \textcolor{vhdlchar}{state_type};
00086 
00087 
00088   
00089 \textcolor{vhdlkeyword}{begin}
00090 
00091 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00092 \textcolor{keyword}{-- Input registers}
00093 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00094    \textcolor{keywordflow}{process}(clk, reset_n)
00095 \textcolor{vhdlkeyword}{   begin}
00096       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00097          \textcolor{vhdlchar}{ps_tst_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00098          \textcolor{vhdlchar}{ps_en_reg}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'};
00099       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00100          \textcolor{vhdlchar}{ps_tst_reg}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps_tst};
00101          \textcolor{vhdlchar}{ps_en_reg}   \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps_en};
00102       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00103    \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00104    
00105    
00106 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00107 \textcolor{keyword}{-- state machine for testing}
00108 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00109 fsm\_f : \textcolor{keywordflow}{process}(clk, reset_n)\textcolor{keywordflow}{begin}
00110    \textcolor{keywordflow}{if}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then}
00111       \textcolor{vhdlchar}{current_state}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00112    \textcolor{keywordflow}{elsif}\textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{and} \textcolor{vhdlchar}{clk} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)}\textcolor{keywordflow}{then} 
00113       \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{next_state};
00114    \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};  
00115 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00116 
00117 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00118 \textcolor{keyword}{--state machine combo for testing}
00119 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00120 fsm : \textcolor{keywordflow}{process}(current_state, ps_tst, ps_en_reg, ps_en, inst1_ps_done, 
      ps_disable_cnt,
00121                inst1_ps_status) \textcolor{keywordflow}{begin}
00122    \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{current_state};
00123    \textcolor{keywordflow}{case} \textcolor{vhdlchar}{current_state} \textcolor{keywordflow}{is}
00124    
00125       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{idle} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{                     -- wait for start}
00126          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ps_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{ps_en_reg} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00127             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{check\_mode};
00128          \textcolor{keywordflow}{else} 
00129             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00130          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00131          
00132       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{check\_mode} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{               --check if this is test mode}
00133          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ps_tst} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00134             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps\_enable};
00135          \textcolor{keywordflow}{else} 
00136             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00137          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00138       
00139       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ps\_enable} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{                -- enable and wait for done}
00140          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{inst1_ps_done} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00141             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{inst1_ps_status} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00142                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00143             \textcolor{keywordflow}{else} 
00144                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps\_disable};
00145             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00146          \textcolor{keywordflow}{else} 
00147             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps\_enable};
00148          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00149          
00150       \textcolor{keywordflow}{when} \textcolor{vhdlchar}{ps\_disable} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>}\textcolor{keyword}{               -- diable and go to idle or enable again}
00151          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ps_disable_cnt} \textcolor{vhdlchar}{>} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{7} \textcolor{keywordflow}{then} 
00152             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ps_en} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00153                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps\_enable};
00154             \textcolor{keywordflow}{else} 
00155                \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00156             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00157          \textcolor{keywordflow}{else} 
00158             \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps\_disable};
00159          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00160 
00161          
00162       \textcolor{keywordflow}{when} \textcolor{keywordflow}{others} \textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} 
00163          \textcolor{vhdlchar}{next_state} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{idle};
00164    \textcolor{keywordflow}{end} \textcolor{keywordflow}{case};
00165 \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00166 
00167 
00168 
00169 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00170 \textcolor{keyword}{-- fsm dependant registers}
00171 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00172    \textcolor{keywordflow}{process}(clk, reset_n)
00173 \textcolor{vhdlkeyword}{   begin}
00174       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00175          \textcolor{vhdlchar}{ps_disable_cnt}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00176       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00177          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{ps\_disable} \textcolor{keywordflow}{then} 
00178             \textcolor{vhdlchar}{ps_disable_cnt} \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{ps_disable_cnt} \textcolor{vhdlchar}{+} \textcolor{vhdllogic}{}\textcolor{vhdllogic}{1};
00179          \textcolor{keywordflow}{else} 
00180             \textcolor{vhdlchar}{ps_disable_cnt}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{(}\textcolor{keywordflow}{others}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{>} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)};
00181          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00182       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00183    \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00184 
00185    \textcolor{keywordflow}{process}(clk, reset_n)
00186 \textcolor{vhdlkeyword}{   begin}
00187       \textcolor{keywordflow}{if} \textcolor{vhdlchar}{reset_n} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00188          inst1\_ps\_en  <= '0';
00189       \textcolor{keywordflow}{elsif} \textcolor{vhdlchar}{(}\textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{'}\textcolor{vhdlkeyword}{event} \textcolor{keywordflow}{AND} \textcolor{vhdlchar}{clk}\textcolor{vhdlchar}{=}\textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{1}\textcolor{vhdlchar}{'}\textcolor{vhdlchar}{)} \textcolor{keywordflow}{then} 
00190          \textcolor{keywordflow}{if} \textcolor{vhdlchar}{ps_tst} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{'}\textcolor{vhdllogic}{}\textcolor{vhdllogic}{0}\textcolor{vhdlchar}{'} \textcolor{keywordflow}{then} 
00191             inst1\_ps\_en <= ps\_en;
00192          \textcolor{keywordflow}{else} 
00193             \textcolor{keywordflow}{if} \textcolor{vhdlchar}{current_state} \textcolor{vhdlchar}{=} \textcolor{vhdlchar}{ps\_enable} \textcolor{keywordflow}{then} 
00194                inst1\_ps\_en <= '1';
00195             \textcolor{keywordflow}{else} 
00196                inst1\_ps\_en <= '0';
00197             \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00198          \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00199       \textcolor{keywordflow}{end} \textcolor{keywordflow}{if};
00200    \textcolor{keywordflow}{end} \textcolor{keywordflow}{process};
00201 
00202 \textcolor{keyword}{-- ----------------------------------------------------------------------------}
00203 \textcolor{keyword}{-- lower level instances}
00204 \textcolor{keyword}{-- ----------------------------------------------------------------------------   }
00205 pll\_ps\_inst0 : \textcolor{keywordflow}{entity} work.pll_ps
00206    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00207       clk                     => clk,
00208       reset_n                 => reset_n,
00209       busy                    => inst0_busy,
00210       en                      => inst1_ps_ctrl_en,
00211       phase                   => inst1_ps_ctrl_phase,
00212       cnt                     => inst1_ps_ctrl_cnt,
00213       updown                  => inst1_ps_ctrl_updown,    
00214 \textcolor{keyword}{      --pll ports}
00215       pll_phasecounterselect  => pll_phasecounterselect,
00216       pll_phaseupdown         => pll_phaseupdown,
00217       pll_phasestep           => pll_phasestep,
00218       pll_phasedone           => pll_phasedone
00219 
00220       \textcolor{vhdlchar}{)};
00221    
00222    
00223 pll\_ps\_fsm\_inst1 : \textcolor{keywordflow}{entity} work.pll_ps_fsm
00224    \textcolor{keywordflow}{port} \textcolor{keywordflow}{map}(
00225       clk               => clk,
00226       reset_n           => reset_n,
00227 \textcolor{keyword}{      --module control ports}
00228       ps_en             => inst1_ps_en,
00229       ps_reset_at_start => '1',
00230       ps_mode           => ps_mode,
00231       ps_cnt            => ps_cnt,
00232       ps_updwn          => ps_updwn,
00233       ps_phase          => ps_phase,
00234       ps_step_size      => ps_step_size,
00235       ps_done           => inst1_ps_done,
00236       ps_status         => inst1_ps_status,
00237 \textcolor{keyword}{      --pll ports}
00238       pll_locked        => pll_locked,
00239       pll_reconfig      => pll_reconfig,
00240       pll_reset_req     => inst1_pll_reset_req,
00241 \textcolor{keyword}{      --pll\_ps\_cntrl ports}
00242       ps_ctrl_busy      => inst0_busy,
00243       ps_ctrl_en        => inst1_ps_ctrl_en,
00244       ps_ctrl_phase     => inst1_ps_ctrl_phase,
00245       ps_ctrl_cnt       => inst1_ps_ctrl_cnt,
00246       ps_ctrl_updown    => inst1_ps_ctrl_updown,
00247 \textcolor{keyword}{      --sample compare module}
00248       smpl_cmp_en       => inst1_smpl_cmp_en,
00249       smpl_cmp_done     => smpl_cmp_done,
00250       smpl_cmp_error    => smpl_cmp_error
00251       \textcolor{vhdlchar}{)};
00252       
00253    
00254    
00255 \textcolor{keyword}{   --output ports}
00256    \textcolor{vhdlchar}{ps_done}        \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst1_ps_done};
00257    \textcolor{vhdlchar}{ps_status}      \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst1_ps_status};
00258    \textcolor{vhdlchar}{smpl_cmp_en}    \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst1_smpl_cmp_en};
00259    \textcolor{vhdlchar}{pll_reset_req}  \textcolor{vhdlchar}{<=} \textcolor{vhdlchar}{inst1_pll_reset_req};
00260    
00261 
00262   
00263 \textcolor{keywordflow}{end} \textcolor{vhdlchar}{arch};   
00264 
00265 
\end{DoxyCode}
